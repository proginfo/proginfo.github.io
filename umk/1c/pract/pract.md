---
layout: page
title: Информационные системы. Практические работы
---

<p>Оглавление</p>
<p><a href="#_Toc454870646">Лабораторная работа № 1 «Создание БД в 1С» 4</a></p>
<p><a href="#_Toc454870647">Лабораторная работа № 2 «Заполнение сведений о фирме» 15</a></p>
<p><a href="#_Toc454870648">Лабораторная работа № 3 Ввод операций 22</a></p>
<p><a href="#_Toc454870649">Лабораторная работа №4 Кассовые операции 37</a></p>
<p><a href="#_Toc454870650">Лабораторная работа № 5 Банковские операции 53</a></p>
<p><a href="#_Toc454870651">Лабораторная работа № 6 Учетные документы 58</a></p>
<p><a href="#_Toc454870652">Лабораторная работа № 7 Оформление банковского поручения 66</a></p>
<p><a href="#_Toc454870653">Лабораторная работа № 8 Расчеты с поставщиками 78</a></p>
<p><a href="#_Toc454870654">Лабораторная работа № 9Поступление и учет ОС 93</a></p>
<p><a href="#_Toc454870655">Лабораторная работа № 10 Учет материалов 101</a></p>
<p><a href="#_Toc454870656">Лабораторная работа № 11 Монтажные и наладочные работы 111</a></p>
<p><a href="#_Toc454870657">Лабораторная работа № 12 Оприходование МПЗ 121</a></p>
<p><a href="#_Toc454870658">Лабораторная работа № 13 Покупка МПЗ за наличный расчет 131</a></p>
<p><a href="#_Toc454870659">Лабораторная работа № 14 Учет затрат на производство 139</a></p>
<p><a href="#_Toc454870660">Лабораторная работа № 15Учет НМА 147</a></p>
<p><a href="#_Toc454870661">Лабораторная работа № 16 Отпуск материалов 154</a></p>
<p><a href="#_Toc454870662">Лабораторная работа № 17 Начисление зарплаты 162</a></p>
<p><a href="#_Toc454870663">Лабораторная работа № 18 Прием на работу 186</a></p>
<p><a href="#_Toc454870664">Лабораторная работа № 19 Передача готовой продукции 200</a></p>
<p><a href="#_Toc454870665">Лабораторная работа № 20 Реализация по безналу 215</a></p>
<p><a href="#_Toc454870666">Лабораторная работа № 21 Закрытие месяца 234</a></p>
<p><a href="#_Toc454870667">Лабораторная работа № 22 Защита отчетов 255</a></p>
<p><a href="#_Toc454870668">Лабораторная работа № 23 Учет фирмы в 1С 271</a></p>
<p><a href="#_Toc454870669">Лабораторная работа № 24 Пакетная печать документа 286</a></p>
<p><a href="#_Toc454870670">Лабораторная работа № 25 Создание БД учета кадров 300</a></p>
<p><a href="#_Toc454870671">Лабораторная работа № 26 Работа с БД учета кадров 307</a></p>
<p><a href="#_Toc454870672">Лабораторная работа № 27 Основные конструкции языка 1С 321</a></p>
<p><a href="#_Toc454870673">Лабораторная работа № 28 Основы работы со справочниками 332</a></p>
<p><a href="#_Toc454870674">Лабораторная работа № 29 Программирование справочников 353</a></p>
<p><a href="#_Toc454870675">Лабораторная работа № 30 Создание БД для отдела кадров 362</a></p>
<p><a href="#_Toc454870676">Лабораторная работа № 31Программирование документов 372</a></p>
<p><a href="#_Toc454870677">Лабораторная работа № 32 Система учета библиотеки 376</a></p>
<p><a href="#_Toc454870678">Лабораторная работа № 33 Программирование отчетов 382</a></p>
<p><a href="#_Toc454870679">Лабораторная работа № 34 Интернет-магазин 388</a></p>
<p><a href="#_Toc454870680">Лабораторная работа № 35 Программирование регистров 396</a></p>
<p><a href="#_Toc454870681">Лабораторная работа № 36 Работа с регистрами 404</a></p>
<p><a href="#_Toc454870682">Лабораторная работа № 37 Программирование запросов 414</a></p>
<p><a href="#_Toc454870683">Лабораторная работа № 39 Программирование таблицы значений 423</a></p>
<p><a href="#_Toc454870684">Лабораторная работа № 40 Программирование форм 433</a></p>
<p><a href="#_Toc454870685">Лабораторная работа № 41Работа с компонентой. Расчет 476</a></p>
<p><a href="#_Toc454870686">Лабораторная работа № 42 Создание новой заданной конфигурации 504</a></p>
<p><a href="#_Toc454870687">Лабораторная работа № 43 Система расчета зарплаты 515</a></p>
<p><a href="#_Toc454870688">Литература 534</a></p>
<h1><a id="_Toc454870646"></a>Лабораторная работа № 1 «Создание БД в 1С»</h1>
<p><strong>Порядок выполнения работы </strong></p>
<p>1. Ознакомьтесь с теоретическими основами в настоящих указаниях и конспектах лекций. </p>
<p>2. Получите задание у преподавателя. </p>
<p>3. Сделайте скриншоты (кнопка клавиатуры PrtSc) выполненных заданий в текстовом (Word) файле <em>Фамилия_ЛР</em></p>
<p>4. Составьте отчет по лабораторной работе. </p>
<p>5. Отчитайте работу преподавателю.</p>
<p><strong>Создание новой информационной базы</strong></p>
<p>При установке системы «1С:Предприятие» у вас не должно возникнуть никаких трудностей. Процесс установки подробно
	описан в документации «1С:Предприятие 8.3. Руководство администратора». </p>
<p>Также у вас не должно возникнуть трудностей при запуске системы и создании информационной базы, которая содержит
	пустую конфигурацию. </p>
<p>Будьте внимательны! Для выполнения примера, вам потребуется информационная база для разработки новой конфигурации, а
	не база, созданная из шаблона. Для этого вам нужно выполнить следующие действия.</p>
<p>Запустите «1С:Предприятие». В открывшемся диалоге вы увидите список информационных баз, с которыми вы работаете. Если
	этот список пуст, система сама предложит вам создать новую базу. Если же в списке информационных баз содержится
	какая-либо база, например, у вас установлена демонстрационная конфигурация, то для создания новой базы нажмите
	кнопку Добавить (рис. 1.2).</p>
<p><strong>Рис. 1.2.</strong> Создание новой информационной базы. Шаг 1</p>
<p>В открывшемся диалоге выберите пункт Создание новой информационной базы (рис. 1.3).</p>
<p>Нажмите кнопку Далее. На следующем шаге выберите пункт Создание информационной базы без конфигурации... (рис.
	1.4).</p>
<p>Нажмите кнопку Далее. На следующем шаге задайте наименование вашей информационной базы и выберите тип ее расположения
	На данном компьютере… (рис. 1.5).</p>
<p>Нажмите кнопку Далее. На следующем шаге укажите каталог для расположения вашей информационной базы. Язык по умолчанию
	установлен в значение Русский (рис. 1.6).</p>
<p>Нажмите кнопку Далее. На следующем шаге нажмите кнопку Готово </p>
<p>(рис. 1.7).</p>
<p>В диалоге запуска «1С:Предприятия», в списке информационных баз вы увидите созданную вами новую пустую базу (рис.
	1.8).</p>
<p><strong>В режиме «Конфигуратор»</strong></p>
<p>Знакомство с конфигуратором</p>
<p>Итак, запустим «1С:Предприятие» в режиме Конфигуратор. Для этого нажмем кнопку Конфигуратор в диалоге запуска
	системы </p>
<p>(см. рис. 1.8). </p>
<p>Перед вами окно конфигуратора (рис. 1.9). </p>
<p>Именно с помощью этого инструмента мы будем создавать нашу конфигурацию. Сразу под заголовком окна находится главное
	меню конфигуратора, содержащее пункты Файл, Правка, Конфигурация, Администрирование и т. п. В каждом из этих пунктов
	содержится много подпунктов, вызов которых обеспечивает выполнение различных действий конфигуратора. </p>
<p>Ниже находится панель инструментов конфигуратора, в которую в виде кнопок-пиктограмм помещены наиболее часто
	используемые действия, вызываемые из меню. </p>
<p>Таким образом, одни и те же действия можно выполнить двумя разными способами: вызвав определенный пункт меню или
	нажав соответствующую ему кнопку на панели инструментов.</p>
<p>Большое количество незнакомых пиктограмм часто смущает начинающего разработчика. Не следует этого бояться – со
	временем вы сможете свободно ориентироваться среди них. Просто подведите к какой-либо кнопке мышь, задержите ее на
	несколько секунд, и появится всплывающая подсказка, поясняющая назначение этой кнопки (см. рис. 1.9). </p>
<p>Вероятно, сначала вы будете пользоваться пунктами меню, но постепенно ваша работа сама собой переместится на панель
	инструментов, так как это удобнее. Со временем в случае надобности вы сможете настраивать панель инструментов под
	себя, удаляя или добавляя нужные вам кнопки (рис. 1.10).</p>
<p><strong>Рис. 1.10.</strong> Настройка панели инструментов конфигуратора</p>
<p>Дерево объектов конфигурации</p>
<p>Выполним первую команду, с которой начинается работа с любой конфигурацией, – откроем конфигурацию с помощью пункта
	меню Конфигурация  Открыть конфигурацию или соответствующей кнопки на панели инструментов (см. рис. 1.9). </p>
<p>На экране откроется <em>дерево объектов конфигурации</em> (рис. 1.11).</p>
<p>Можно сказать, что дерево объектов конфигурации – основной инструмент, с которым работает разработчик. Дерево
	объектов конфигурации содержит в себе практически всю информацию о том, из чего состоит конфигурация.</p>
<p>Наверняка у вас уже возник вопрос: почему в дереве что-то есть, если мы пока еще ничего не создавали? </p>
<p>Дело в том, что для облегчения работы разработчика все, из чего состоит конфигурация, сгруппировано, и сейчас дерево
	и показывает вам эти группы. Если вы будете перемещаться по дереву и нажимать на +, то увидите, что ни в одной
	группе ничего нет. Исключение составит лишь группа Общие  Языки, в которой вы обнаружите «нечто» под названием
	«Русский». Этот «Русский» платформа создала для вас сама, поскольку в данном случае конфигуратор использует
	русскоязычный интерфейс.</p>
<p>Хотелось бы уже начать что-нибудь делать, но прежде следует определиться с терминами. Вы наверняка уже заметили, что,
	говоря о содержимом конфигурации, мы сознательно избегали использования каких-либо терминов. Но теперь настало
	время, когда можно определиться с терминологией и рассказать про<em> объекты конфигурации</em>.</p>
<p>Что такое объекты конфигурации</p>
<p>Конфигурация представляет собой описание. Она описывает структуру данных, которые пользователь будет использовать в
	режиме работы 1С:Предприятие. </p>
<p>Кроме этого, конфигурация описывает всевозможные алгоритмы обработки этих данных, содержит информацию о том, как эти
	данные должны будут выглядеть на экране и на принтере и т. д. В дальнейшем платформа «1С:Предприятие» на основании
	этого описания создаст базу данных, которая будет иметь необходимую структуру и предоставит пользователю возможность
	работать с этой базой данных. </p>
<p>Для того чтобы систему «1С:Предприятие» можно было быстро и легко настраивать на нужные прикладные задачи, все
	описание, которое содержит конфигурация, состоит из неких логических единиц, называемых объектами конфигурации. </p>
<p>Поэтому что такое объекты конфигурации, мы объясним на бытовом уровне. Однако это даст вам возможность правильно
	понимать назначение объектов применительно к тем задачам, которые мы будем решать.</p>
<p>С одной стороны, объекты конфигурации представляют собой детали «конструктора», из которого собирается конфигурация.
	Обычно в конструкторе существует некоторый набор деталей. Детали могут быть разного вида: длинные, короткие,
	квадратные, прямоугольные и т. д. Теперь представьте, что деталей каждого вида мы можем создавать столько, сколько
	нам нужно (скажем, 5 длинных и 3 короткие). Мы можем соединять детали между собой различными способами. </p>
<p>То же и с объектами конфигурации. Мы можем создавать только объекты определенных видов. Но каждого вида объектов мы
	можем создать столько, сколько нам нужно. Объекты одного вида отличаются от объектов другого вида тем, что имеют
	разные свойства (точнее говоря, разный набор свойств). Объекты могут взаимодействовать друг с другом, и мы можем
	описать такое взаимодействие.</p>
<p>В чем еще сходство объектов конфигурации с деталями конструктора? В конструкторе обычно есть блоки, которые можно
	скрепить между собой, и есть другие детали, например колеса, которые скрепить между собой нельзя, зато их можно
	соединить с осью, и тогда колеса будут вращаться. То есть разные детали конструктора по-разному ведут себя. </p>
<p>Объекты конфигурации также обладают различным поведением, и оно зависит от вида объекта. Одни объекты могут выполнять
	какие-то действия, другие этих действий выполнять не могут, зато у них есть свой собственный набор действий.</p>
<p>Следующую особенность объектов конфигурации можно продемонстрировать на примере автомобиля. Автомобиль состоит из
	большого количества деталей. Одна из деталей автомобиля – это двигатель. Но двигатель, в свою очередь, тоже состоит
	из набора деталей, причем в разных двигателях могут использоваться одни и те же детали. </p>
<p>Так же «сложные» объекты конфигурации состоят из более «простых», и одни и те же «простые» объекты могут входить в
	состав сложных объектов. Такая структура позволяет упростить работу с объектами конфигурации, поскольку если мы
	знаем, как работать с каким-либо «простым» объектом, то в любом «сложном» объекте, в состав которого он входит, мы
	будем работать с ним все тем же образом.</p>
<p>И, наконец, самое важное качество объектов конфигурации – это их прикладная направленность. Объекты конфигурации не
	просто некие абстрактные конструкции, при помощи которых разработчик пытается описать поставленную перед ним задачу.
	Они представляют собой аналоги реальных объектов, которыми оперирует предприятие в ходе своей работы. </p>
<p>Например, на каждом предприятии существуют различные документы, с помощью которых оно фиксирует факты совершения
	хозяйственных операций. Точно так же в конфигурации существуют объекты вида Документ. </p>
<p>Кроме этого, на каждом предприятии обязательно ведется список сотрудников, справочник номенклатуры или товаров. В
	конфигурации тоже есть специальные объекты вида Справочник, которые позволяют разработчику создавать компьютерные
	аналоги таких списков.</p>
<p>Как мы уже говорили, на основе объектов конфигурации платформа создает в базе данных таблицы, в которых будут
	храниться данные. В литературе, как правило, объект конфигурации и соответствующий ему набор таблиц базы данных
	принято называть одинаково. </p>
<p>Например, если в конфигурации существует объект Справочник Сотрудники, то набор таблиц, созданный платформой на
	основе этого объекта конфигурации, также называют Справочник Сотрудники. </p>
<p>Мы отойдем от такого «размытого» стиля изложения и в тех местах, где речь пойдет о конфигурации, будем использовать
	явное уточнение – объект конфигурации справочник Сотрудники. Там же, где речь пойдет о базе данных, мы будем
	говорить просто: справочник Сотрудники.</p>
<p>Как добавить объект конфигурации</p>
<p>Прежде чем мы приступим к добавлению первых объектов конфигурации, нужно иметь в виду, что для разработки собственной
	конфигурации, автоматизирующей хозяйственную деятельность предприятия, разработчик может использовать только
	ограниченный набор объектов конфигурации, «жестко зашитый» в платформе. Ему не дано возможности создавать
	собственные объекты конфигурации. Он только может добавлять в конфигурацию какой-либо из стандартных объектов,
	поставляемых системой.</p>
<p>Перед началом работы следует объяснить некоторые приемы работы с конфигуратором. </p>
<p>Для того чтобы открыть и закрыть конфигурацию, следует использовать пункты меню Конфигурация  Открыть конфигурацию и
	Конфигурация  Закрыть конфигурацию или соответствующие им кнопки на панели инструментов. </p>
<p>После того как конфигурация открыта, ее состав появляется в окне дерева конфигурации (см. рис. 1.11). Это окно вы
	можете закрыть, как любое другое окно Windows, при этом конфигурация останется открытой (то есть доступной для
	редактирования). Чтобы снова отобразить на экране окно дерева конфигурации, следует воспользоваться командой меню
	Конфигурация  Окно конфигурации.</p>
<p>Добавить новый объект конфигурации можно несколькими способами, и вы можете использовать наиболее понятный и удобный
	для вас. </p>
<p><em>Первый</em> <em>способ</em>. Необходимо установить курсор на ту ветку объектов конфигурации, которая вас
	интересует, и в командной панели окна конфигурации нажать кнопку Действия  Добавить (рис. 1.12).</p>
<p><em>Второй способ.</em> Вы можете воспользоваться контекстным меню, которое вызывается при нажатии на правую клавишу
	мыши. Установите курсор на интересующую вас ветку объектов конфигурации и нажмите правую клавишу мыши. В появившемся
	меню выберите пункт Добавить (рис. 1.13).</p>
<p><em>Третий способ. </em>Установите курсор на интересующую вас ветку объектов конфигурации и в командной панели окна
	конфигурации нажмите кнопку Добавить (с пиктограммой +), рис. 1.14.</p>
<p>Последний способ, на наш взгляд, наиболее удобен, поэтому в основном мы будем использовать именно его.</p>
<p>Палитра свойств</p>
<p>Итак, мы начинаем!</p>
<p>Зададим имя нашей конфигурации и на этом примере познакомимся с палитрой свойств, с помощью которой разработчик может
	задавать свойства создаваемых им объектов конфигурации. </p>
<p><em>Палитра свойств</em> – это специальное служебное окно, которое позволяет редактировать все свойства объекта
	конфигурации и другую связанную с ним информацию. Поскольку разные объекты конфигурации имеют самые разные свойства,
	содержимое этого окна будет меняться в зависимости от того, какой объект является текущим (на каком объекте
	конфигурации установлен курсор). </p>
<p>Выделим в дереве объектов конфигурации корневой элемент Конфигурация и двойным щелчком мыши откроем его палитру
	свойств. </p>
<p>Зададим имя конфигурации ПособиеДляНачинающих. </p>
<p>Соответствующий ему синоним устанавливается автоматически, но его можно изменить по своему усмотрению. В дальнейшем
	именно его мы будем видеть в рабочем окне «1С:Предприятия» (рис. 1.15).</p>
<p><strong>Рис. 1.15.</strong> Палитра свойств конфигурации</p>
<p>При некоторых действиях разработчика палитра свойств открывается автоматически. Но разработчик всегда может открыть
	палитру свойств объекта конфигурации самостоятельно, воспользовавшись пунктом Свойства контекстного меню правой
	кнопки мыши. </p>
<p>В этом случае, как и сейчас, палитра свойств откроется и будет закреплена на рабочей области конфигуратора. То есть
	при выделении какого-либо объекта конфигурации окно его свойств всегда будет открыто. Однако есть удобная
	возможность открепить палитру свойств, используя символ кнопки в заголовке окна палитры свойств (рис. 1.16).</p>
<p><strong>Рис. 1.16.</strong> «Открепим» палитру свойств</p>
<p>В этом состоянии, при наведении курсора мыши на любое другое окно, палитра свойств будет сворачиваться на
	дополнительную панель в правой части экрана (рис. 1.17).</p>
<p><strong>Рис. 1.17.</strong> Кнопка на дополнительной панели</p>
<p>При наведении курсора мыши на символ свернутой палитры свойств она будет открываться. </p>
<p>Подобным поведением (возможностью быть прикрепленным, прячущимся и т. д.) обладает не только окно палитры свойств, но
	и другие окна конфигуратора (например, окно дерева конфигурации).</p>
<p>Запуск отладки в режиме «1С:Предприятие»</p>
<p>Теперь проверим наши первые изменения в режиме 1С:Предприятие. </p>
<p>Для этого выполним пункт меню Отладка  Начать отладку или нажмем соответствующую кнопку <img src="1.jpeg"/> на
	панели инструментов конфигуратора. Система сама анализирует наличие изменений в конфигурации и выдает
	соответствующий вопрос об обновлении конфигурации базы данных (рис. 1.18).</p>
<p>Мы не будем пока останавливаться подробно на том, почему это происходит, а рассмотрим этот вопрос в разделе «Основная
	конфигурация и конфигурация базы данных». </p>
<p>На вопрос конфигуратора ответим Да, и на экране появится окно «1С:Предприятия» (рис. 1.19).</p>
<p><strong>В режиме «1С:Предприятие»</strong></p>
<p>Внешний вид интерфейса прикладного решения</p>
<p>В заголовке окна мы видим название нашей конфигурации. Пустое пространство – это <em>рабочая область</em> приложения,
	которая пока ничем не заполнена.</p>
<p>Итак, мы видим, что кроме заголовка конфигурации в окне «1С:Предприятия» ничего не появилось. И этого следовало
	ожидать. </p>
<p>Мы еще не создали никаких объектов конфигурации и не создали никаких подсистем, в которых бы эти объекты
	отображались. </p>
<p>О подсистемах как основе разработки интерфейса «1С:Предприятия» и пойдет речь на следующем занятии. А пока, взглянув
	на список кратких итогов первого занятия, проверьте, насколько хорошо вы поняли изложенный материал. </p>
<h1><a id="_Toc454870647"></a>Лабораторная работа № 2 «Заполнение сведений о фирме»</h1>
<p><strong>Порядок выполнения работы </strong></p>
<p>1. Ознакомьтесь с теоретическими основами в настоящих указаниях и конспектах лекций. </p>
<p>2. Получите задание у преподавателя. </p>
<p>3. Сделайте скриншоты (кнопка клавиатуры PrtSc) выполненных заданий в текстовом (Word) файле <em>Фамилия_ЛР</em></p>
<p>4. Составьте отчет по лабораторной работе. </p>
<p>5. Отчитайте работу преподавателю.</p>
<p><strong>Добавление подсистемы</strong></p>
<p>В режиме «Конфигуратор»</p>
<p>Закроем приложение и вернемся в конфигуратор. Чтобы создать новые подсистемы, раскроем ветвь Общие в дереве объектов
	конфигурации, нажав на + слева от нее. </p>
<p>Затем выделим ветвь Подсистемы, вызовем ее контекстное меню и выберем пункт Добавить или нажмем соответствующую
	кнопку в командной панели окна конфигурации (рис. 2.3).</p>
<p>После этого система откроет <em>окно</em> <em>редактирования объекта конфигурации</em>. </p>
<p><strong>Рис. 2.3.</strong> Добавление новой подсистемы в дерево объектов конфигурации</p>
<p>Оно предназначено специально для сложных объектов конфигурации и позволяет путем выполнения последовательных действий
	быстро создавать такие объекты. </p>
<p>Для того чтобы придерживаться правильной последовательности действий, в нижней части окна имеются кнопки Далее и
	Назад. Кнопка Далее позволяет задавать свойства объекта в нужной последовательности, чтобы ничего не пропустить и не
	проскочить вперед, где потребуются данные, которые должны были быть введены ранее. Кнопка Назад позволяет вернуться
	на несколько шагов назад, если вы обнаружили, что ранее ввели не все или ошибочные данные. Впоследствии вы сможете
	задавать свойства объектов, сразу выделяя нужную вам закладку, например, Данные. При открытии окна редактирования
	объекта конфигурации мы попадаем на закладку Основные.</p>
<p>Зададим <em>имя</em> подсистемы – Бухгалтерия. На основании имени платформа автоматически создаст <em>синоним</em> –
	Бухгалтерия (рис. 2.4).</p>
<p><strong>Рис. 2.4.</strong> Установка имени и синонима подсистемы</p>
<p>Имя и синоним объекта конфигурации</p>
<p>Имя является основным свойством любого объекта конфигурации. При создании нового объекта система автоматически
	присваивает ему некоторое имя. </p>
<p>Можно использовать имя, присвоенное системой, но лучше заменить его своим, понятным именем. Имя можно задавать любое,
	главное чтобы оно начиналось с буквы и не содержало некоторых специальных символов (например, пробел). </p>
<p>Для удобства чтения конфигурации принято составлять интуитивно понятные имена и, если они состоят из нескольких слов,
	удалять пробелы между словами и каждое слово начинать с большой буквы. Имя объекта является уникальным и служит для
	обращения к свойствам и методам объекта на встроенном языке.</p>
<p>Свойство Синоним также есть у любого объекта конфигурации. Оно предназначено для хранения альтернативного
	наименования объекта конфигурации, которое будет использовано в элементах интерфейса нашей программы, то есть будет
	показано пользователю. Поэтому на синоним практически нет никаких ограничений, и его можно задавать в привычном для
	человека виде.</p>
<p>Картинка подсистемы</p>
<p>В целях усовершенствования интерфейса приложения мы можем также задать картинку для отображения подсистемы. </p>
<p>Нажмем кнопку выбора в поле Картинка (см. рис. 2.4). В окне выбора картинки добавим картинку в список на зак- ладке
	Из конфигурации. Для этого нажмем кнопку </p>
<p>Добавить (рис. 2.5).</p>
<p><strong>Рис. 2.5.</strong> Выбор картинки для представления подсистемы</p>
<p>Система создаст объект конфигурации <em>Общая картинка</em> и откроет окно редактирования его свойств. </p>
<p>Дадим картинке имя Бухгалтерия. Чтобы задать саму картинку, нажмем кнопку Выбрать из файла (рис. 2.6).</p>
<p>Далее выберем папку Image, содержащую картинки, и укажем нужный файл с изображением. </p>
<p>Для просмотра изображений установим флажок Просмотр. </p>
<p>Отметим файл Бухгалтерия и нажмем кнопку Открыть (рис. 2.7).</p>
<p><strong>Рис. 2.7.</strong> Выбор картинки для представления подсистемы</p>
<p>Выбранная нами картинка появится в окне редактирования общей картинки.</p>
<p>Закроем окно редактирования объекта конфигурации Общая картинка и вернемся в окно выбора картинки для подсистемы
	Бухгалтерия. Мы видим, что в списке картинок на закладке Из конфигурации появилась добавленная нами картинка. Нажмем
	ОК (рис. 2.8).</p>
<p>После наших действий в дереве объектов конфигурации в ветке Общие картинки появилась картинка Бухгалтерия, которую мы
	можем редактировать и использовать в дальнейшем в нашей конфигурации (рис. 2.9).</p>
<p><strong>Рис. 2.9.</strong> Общие картинки в дереве объектов конфигурации</p>
<p>Итак, мы вернулись в окно редактирования объекта конфигурации Подсистема Бухгалтерия. Мы видим, что выбранная нами
	одноименная картинка установилась в качестве картинки для подсистемы (рис. 2.10).</p>
<p>Таким образом, в интерфейсе «1С:Предприятия» в качестве названия раздела будет показан синоним подсистемы, и над ним
	будет выводиться указанная картинка. </p>
<p>Отсутствие картинки у подсистемы не препятствует отображению раздела в интерфейсе. В этом случае рядом с названием
	раздела отображается стандартная картинка по умолчанию.</p>
<p>Снова выделим ветвь Подсистемы, нажмем кнопку Добавить в дереве объектов конфигурации и создадим подсистемы с именами
	УчетМатериалов и ОказаниеУслуг. Установим для них в качестве картинок соответственно общие картинки Материалы и
	Услуги, добавив их из файлов Материалы и Услуги так же, как мы это делали для подсистемы Бухгалтерия.</p>
<p>Теперь воспользуемся другим способом для добавления подсистем. Вызовем контекстное меню одной из созданных подсистем.
	Выберем в нем пункт Добавить. Он разбивается на два подпункта. Выбор подпункта Подсистема позволяет добавить
	подсистему того же уровня иерархии, что и выделенная. Выбор подпункта Подчиненная Подсистема позволяет добавить
	подсистему, подчиненную выделенной (рис. 2.11).</p>
<p>Поскольку в нашей конфигурации не планируется сложной многоуровневой структуры, выберем первый вариант и добавим
	подсистему РасчетЗарплаты. Установим для нее в качестве картинки общую картинку Зарплата, добавив ее из файла
	Зарплата.</p>
<p>В заключение добавим подсистему Предприятие с соответствующей картинкой для доступа к административным и сервисным
	функциям. </p>
<p><strong>Панель разделов прикладного решения</strong></p>
<p>В режиме «1С:Предприятие»</p>
<p>Запустим «1С:Предприятие» в режиме отладки и увидим результат наших изменений. Вид разрабатываемого нами
	приложения </p>
<p><strong>Рис. 2.12.</strong> «1С:Предприятие»</p>
<p>Сразу под заголовком приложения с названием нашей конфигурации и областью системных команд располагается <em>панель
	разделов </em>приложения, где и отражены созданные нами подсистемы. Причем все разделы выводятся с выбранными в их
	свойствах картинками.</p>
<p>Разделы представлены в форме гиперссылок, нажав на которые пользователь может открыть связанные с ними документы,
	справочники, отчеты и т. п. Сейчас состав разделов пуст, так как мы еще не создали наполняющих их объектов
	конфигурации.</p>
<p><strong>Порядок разделов</strong></p>
<p>В режиме «Конфигуратор»</p>
<p>Однако порядок расположения подсистем нас не совсем устраивает. Изменим его.</p>
<p>Закроем приложение и вернемся в конфигуратор. Выделим корень дерева объектов конфигурации ПособиеДляНачинающих,
	нажатием правой кнопки мыши вызовем контекстное меню и выберем пункт Открыть командный интерфейс конфигурации (рис.
	2.13).</p>
<p>В открывшемся окне Командный интерфейс вы увидите список созданных вами подсистем (разделов приложения). С помощью
	кнопок Вверх, Вниз изменим порядок расположения разделов в этом списке. </p>
<p>Расположим сначала подсистемы, отражающие производственную деятельность нашей фирмы: Учет материалов и Оказание
	услуг, затем бухгалтерскую деятельность и расчет зарплаты сотрудников: Бухгалтерия и Расчет зарплаты, а затем
	подсистему Предприятие (рис. 2.14).</p>
<p><strong>В режиме «1С:Предприятие»</strong></p>
<p>Запустим «1С:Предприятие» в режиме отладки и увидим, что порядок расположения подсистем в панели разделов приложения
	изменился так, как мы его задали (рис. 2.15).</p>
<p>Заметьте, что если список подсистем не помещается на панель разделов, то появляется возможность прокрутки этой
	панели.</p>
<p>Закроем приложение и вернемся в конфигуратор. На следующем занятии мы начнем создавать первые объекты конфигурации,
	привязывать их к различным подсистемам и продемонстрируем их конкретное применение в интерфейсе
	«1С:Предприятия». </p>
<h1><a id="_Toc454870648"></a>Лабораторная работа № 3 Ввод операций</h1>
<p><strong>Порядок выполнения работы </strong></p>
<p>1. Ознакомьтесь с теоретическими основами в настоящих указаниях и конспектах лекций. </p>
<p>2. Получите задание у преподавателя. </p>
<p>3. Сделайте скриншоты (кнопка клавиатуры PrtSc) выполненных заданий в текстовом (Word) файле <em>Фамилия_ЛР</em></p>
<p>4. Составьте отчет по лабораторной работе. </p>
<p>5. Отчитайте работу преподавателю.</p>
<p><strong>Простой справочник</strong></p>
<p>Теперь, когда мы немного познакомились с возможностями объекта конфигурации Справочник, создадим несколько таких
	объектов, чтобы описать справочники, которые будут использоваться в нашей базе данных.</p>
<p>Так как наше ООО «На все руки мастер» оказывает услуги по ремонту бытовой техники, очевидно, что для ведения учета
	нам потребуется хранить некоторую списочную информацию. </p>
<p>Для начала нам понадобится список сотрудников предприятия, которые будут оказывать услуги. </p>
<p>Затем нам будет нужен список клиентов, с которыми работает наше ООО «На все руки мастер». </p>
<p>После этого нам понадобится перечень услуг, которые может оказывать наше предприятие, и список материалов, которые
	могут быть израсходованы. Кроме этого, нам потребуется список складов, на которых могут находиться материалы ООО «На
	все руки мастер».</p>
<p>Начнем с простых вещей – списка сотрудников и списка клиентов. Сначала создадим справочник, в котором будут храниться
	наименования наших клиентов.</p>
<p>В режиме «Конфигуратор»</p>
<p>Откроем в конфигураторе нашу учебную конфигурацию, выделим в дереве объектов конфигурации ветвь Справочники и нажмем
	кнопку Добавить в командной панели окна конфигурации (рис. 3.16).</p>
<p>В открывшемся окне редактирования объекта конфигурации зададим имя справочника – Клиенты. На основании имени
	платформа автоматически создаст синоним – Клиенты. Напомним, что свойство Синоним служит для представления объекта в
	интерфейсе нашей программы. </p>
<p>Также у разработчика есть возможность установки дополнительных свойств, определяющих пользовательское представление
	объектов. Эти свойства задавать не обязательно. Если они не заданы, то для представления объекта в интерфейсе
	«1С:Предприятия» используется синоним объекта конфигурации Справочник. Но, как мы увидим дальше, это не всегда
	хорошо.</p>
<p>Представления объекта конфигурации</p>
<p>Представление объекта определяет название объекта в единственном числе и используется в названии стандартной команды,
	например, команды создания объекта – Клиент: создать. Представление объекта нужно задавать тогда, когда синоним
	объекта конфигурации задан во множественном числе или когда он описывает множество объектов, потому что в интерфейсе
	автоматически формируются команды открытия списка справочника и команды создания нового элемента справочника. </p>
<p>Если синоним задан во множественном числе, то для команды открытия списка это вполне подходит – Клиенты, то есть
	посмотреть всех клиентов. Но для команды создания элемента справочника – одного клиента – это неудачный
	вариант. </p>
<p>Для этой команды нужно задать представление в единственном числе – Клиент. Представление объекта как раз и
	используется для того, чтобы описать, как будет выглядеть в интерфейсе команда добавления нового клиента. Также оно
	будет использовано в заголовке формы клиента (если не указано расширенное представление объекта) и в представлении
	ссылки на клиента. </p>
<p>Расширенное представление объекта определяет заголовок формы объекта, например формы для создания нового элемента
	справочника. </p>
<p>Если это свойство не задано, то вместо него используется свойство Представление объекта.</p>
<p>Представление списка определяет название списка объектов и используется в названии стандартной команды, например,
	команды открытия списка объектов – Клиенты. Представление списка нужно задавать тогда, когда синоним задан в
	единственном числе. </p>
<p>Например, это часто бывает у документов (Приходная накладная). Тогда в представлении списка нужно указывать название
	объекта конфигурации во множественном числе (Приходные накладные).</p>
<p>Расширенное представление списка определяет заголовок формы списка, например формы списка справочника. Если это
	свойство не задано, то вместо него используется свойство Представление списка.</p>
<p>Зададим два свойства Представление объекта – Клиент и Представление списка – Клиенты. Последнее можно было и не
	задавать, так как синоним справочника совпадает со свойством Представление списка (рис. 3.17). </p>
<p>В представлении списка вроде бы подразумевается название Список клиентов, но идущие подряд строки Список сотрудников,
	Список клиентов, Список складов не очень хорошо смотрятся в интерфейсе приложения. </p>
<p><strong>Рис. 3.17.</strong> Установка основных свойств справочника </p>
<p>Принадлежность объекта к подсистемам</p>
<p>Нажмем кнопку Далее и перейдем на закладку Подсистемы окна редактирования объекта конфигурации Справочник. На этой
	закладке определяется, в каких подсистемах будет отображаться данный справочник. </p>
<p>В списке подсистем мы видим подсистемы, созданные нами ранее при определении структуры приложения. Логично
	предположить, что список клиентов должен быть доступен в разделе Оказание услуг, так как оказываемые услуги
	относятся к определенному клиенту. Бухгалтерская отчетность, формируемая в разделе Бухгалтерия, также может быть
	представлена в разрезе клиентов.</p>
<p>Поэтому отметим в списке подсистемы Бухгалтерия и ОказаниеУслуг </p>
<p>(рис. 3.18). </p>
<p><strong>Рис. 3.18.</strong> Определение списка подсистем, в которых отображается справочник</p>
<p>Теперь откроем окно редактирования одной из отмеченных подсистем, например Бухгалтерия, и перейдем на закладку
	Состав. Мы видим, что в составе объектов этой подсистемы появился новый объект конфигурации Справочник Клиенты (рис.
	3.19). </p>
<p>Обратите внимание, что на закладке Состав также можно изменять список объектов, входящих в подсистему.</p>
<p><strong>Рис. 3.19.</strong> Состав объектов, входящих в подсистему</p>
<p>Код и наименование справочника</p>
<p>Теперь вернемся к окну редактирования объекта конфигурации Справочник и нажмем на закладку Данные. </p>
<p>Здесь для нас представляют интерес длина кода и длина наименования. </p>
<p>Длина кода – важное свойство справочника. Как правило, код справочника используется для идентификации элементов
	справочника и содержит уникальные для каждого элемента справочника значения. Платформа может сама контролировать
	уникальность кодов и поддерживать автоматическую нумерацию элементов справочника. Поэтому от длины кода будет
	зависеть количество элементов, содержащихся в справочнике. </p>
<p>Длина кода – 9 символов. В результате мы сможем использовать коды от 1 до 999999999 – этого вполне достаточно для
	нашего небольшого ООО «На все руки мастер». </p>
<p>Перейдем к длине наименования. 25 символов для нас явно мало, увеличим длину наименования до 50 (рис. 3.20).</p>
<p>Кроме того, хотелось бы чтобы вместо обозначения стандартного реквизита справочника Наименование в интерфейсе
	приложения выводилось бы более соответствующее обозначение для клиентов. Так как Наименование более подходит для
	неодушевленных предметов, а тут мы имеем дело с людьми.</p>
<p>Поскольку в интерфейсе приложения отображаются синонимы объектов, то изменим свойство Синоним стандартного реквизита
	Наименование нашего справочника.</p>
<p>Для этого нажмем внизу окна кнопку Стандартные реквизиты. Выделим в списке реквизит Наименование, вызовем его
	контекстное меню и выберем пункт Свойства (рис. 3.21).</p>
<p><strong>Рис. 3.21.</strong> Состав стандартных реквизитов справочника</p>
<p>В палитре свойств стандартного реквизита Наименование установим свойство Синоним как Ф. И. О. (рис. 3.22).</p>
<p>Обратите внимание, что мы изменили синоним реквизита объекта конфигурации, а не реквизита формы. В данном случае
	форма элемента справочника Клиенты вообще сгенерирована системой автоматически. </p>
<p>Теперь во всех видах форм данный реквизит будет иметь установленный синоним, если, конечно, разработчик не захочет
	его изменить при создании своей собственной формы.</p>
<p>Заодно обратите внимание, что свойство Проверка заполнения по умолчанию установлено в значение Выдавать ошибку. Это
	означает, что если реквизит Наименование не заполнен, то будет выведено сообщение об ошибке (см. рис. 3.29).</p>
<p>Команда добавления нового элемента</p>
<p>Прежде чем запускать «1С:Предприятие», настроим интерфейс приложения, чтобы нам было удобнее вводить новые элементы
	справочника. </p>
<p>Дело в том, что для размещения стандартных команд открытия списков и создания новых объектов конфигурации в
	интерфейсе «1С:Предприятия» существует общий стандартный алгоритм, который мы сейчас объясним на примере
	справочников. Но это справедливо и для документов, планов счетов и т. п.</p>
<p>Команда для открытия списка справочника, как и команда для создания его новых элементов, автоматически добавляется в
	интерфейс тех разделов (подсистем), в которых будет отображаться справочник. Но команда создания новых элементов по
	умолчанию невидима в интерфейсе приложения. </p>
<p>Это объясняется тем, что возможность просматривать списки справочника нужна, как правило, всегда. А возможность
	создания новых элементов справочника используется не так часто. Поэтому соответствующую команду следует включать
	только для тех справочников (объектов конфигурации), создание новых элементов которых является основной
	деятельностью для пользователей в данном разделе прикладного решения.</p>
<p>Сделаем доступной в панели команд раздела ОказаниеУслуг стандартную команду для создания новых клиентов. </p>
<p>Для этого откроем окно редактирования объекта конфигурации </p>
<p>Подсистема ОказаниеУслуг и нажмем кнопку Командный интерфейс </p>
<p>(рис. 3.23).</p>
<p>В открывшемся окне Командный интерфейс отразятся все команды этой подсистемы. </p>
<p>При создании справочника в группу Панель навигации.Обычное добавилась команда Клиенты для открытия этого списка. Она
	включена по умолчанию. В группу Панель действий.Создать добавилась команда Клиент: создать для создания нового
	элемента справочника, но она невидима по умолчанию. </p>
<p>Включим видимость у этой команды (рис. 3.24).</p>
<p>Для подсистемы Бухгалтерия команд для создания новых элементов справочника добавлять не будем, так как это
	определяется прикладной логикой работы. </p>
<p>В данном случае мы предполагаем, что основную ежедневную работу с клиентами ведет менеджер, занимающийся оказанием
	услуг. В том числе он создает в базе новых клиентов, если они появляются. А бухгалтерия просто обрабатывает
	имеющиеся в базе данные для получения регламентированной отчетности. </p>
<p>Именно поэтому команду создания нового клиента мы отражаем в разделе Оказание услуг, где работает менеджер, а для
	бухгалтерии она невидима, так как не предполагается, что бухгалтеры будут вводить новых клиентов. </p>
<p>Однако это не лишает бухгалтера такой возможности – он может создать нового клиента, используя список клиентов
	(открыть список клиентов и добавить нового клиента). Наличие команды создания нового элемента без использования
	списка элементов – это вопрос удобства работы, а не ограничения прав пользователя, и мы предоставляем эту удобную
	возможность менеджеру, а не бухгалтеру.</p>
<p>Закроем окно редактирования справочника Клиенты и запустим «1С:Предприятие» в режиме отладки. Ответим утвердительно
	на запрос конфигуратора об обновлении конфигурации и увидим окно, содержащее список изменений в структуре
	конфигурации, автоматически сгенерированный платформой. В данном случае мы добавили справочник Клиенты. </p>
<p>Нажмем кнопку Принять (рис. 3.25).</p>
<p><strong>Рис. 3.25.</strong> Список изменений в структуре конфигурации</p>
<p><strong>В режиме «1С:Предприятие»</strong></p>
<p>Панель команд текущего раздела</p>
<p>Перед нами откроется окно системы в режиме 1С:Предприятие. Мы видим, что если перейти в раздел Оказание услуг или
	Бухгалтерия, то под панелью разделов появится <em>панель команд текущего</em> <em>раздела</em> (рис. 3.26).</p>
<p><img src="2.jpeg"/></p>
<p><strong>Рис. 3.26.</strong> Окно «1С:Предприятия»</p>
<p>Панель команд текущего раздела содержит команды, соответствующие выделенному разделу. В начале панели расположены
	команды, позволяющие открыть какие-либо списки, а затем команды, позволяющие создать новые элементы данных,
	сформировать какой-нибудь отчет или выполнить обработку. </p>
<p>В окне настройки командного интерфейса подсистемы Оказа- ниеУслуг (см. рис. 3.24) в группе команд Панель
	навигации.Обычное мы оставили без изменения видимость команды для открытия справочника Клиенты. Также эта команда по
	умолчанию доступна и в подсистеме Бухгалтерия. Поэтому при выборе соответствующих разделов прикладного решения в
	панели команд этих разделов мы видим команду для открытия нашего первого списка – Клиенты.</p>
<p>Обратите внимание, что название команды Клиенты определяется свойством Представление списка, которое мы задали для
	этого справочника. Если это свойство не задано, то для представления списка используется значение синонима объекта
	конфигурации Справочник. </p>
<p>Команды, с помощью которых можно выполнить какие-то другие действия (кроме открытия списков) в данном разделе,
	объединены в стандартные группы, представленные в виде подменю: Создать, Отчеты, Сервис и группы, созданные
	разработчиком. Подменю Создать включает в себя команды создания новых объектов базы данных, например, документов или
	элементов справочников. </p>
<p>Мы видим, что в разделе Оказание услуг рядом с командой Клиенты появилось подменю Создать (см. рис. 3.26). В этом
	подменю содержится команда для создания элементов нашего первого справочника Клиенты, которую мы сделали видимой в
	интерфейсе этого раздела (в группе команд Панель действий.Создать, см. рис. 3.24). Этой командой мы и воспользуемся
	для создания новых элементов справочника, не открывая при этом списка клиентов. </p>
<p>Обратите внимание, что название стандартной команды создания нового элемента Клиент определяется свойством
	Представление объекта, которое мы задали для этого справочника. Если бы мы это свойство не задали, то в названии
	команды использовался бы синоним объекта конфигурации Справочник Клиенты – Клиенты. Это неудобно, так как ничем не
	отличается от команды открытия списка, и не совсем верно, ведь при создании элемента справочника мы создаем только
	одного нового клиента. </p>
<p>Заметьте, что у других разделов прикладного решения панель команд пуста, так как для этих подсистем мы не
	устанавливали возможность отображения справочника Клиенты.</p>
<p>Создание элементов справочника</p>
<p>Пока наш справочник пуст, поэтому добавим в него несколько элементов. Для этого в панели команд раздела Оказание
	услуг раскроем подменю Создать и выполним команду Клиент.</p>
<p>Перед нами откроется форма для создания элемента справочника </p>
<p>(рис. 3.27). </p>
<p>Внесем Ф. И. О. нового клиента Иванов Михаил Юрьевич. Код вносить не будем, так как он генерируется
	автоматически. </p>
<p>Нажмем Записать и закрыть. </p>
<p><strong>Рис. 3.27.</strong> Создание нового элемента справочника</p>
<p>При этом в правом нижнем углу экрана появится информационное сообщение о том, какой элемент был создан либо изменен.
	Это позволяет не пользоваться списком для того, чтобы убедиться, что нужный элемент записан.</p>
<p>Добавим еще одного клиента с Ф. И. О. Роман. </p>
<p>Последнего клиента с Ф. И. О. Спиридонова Галина добавим, пользуясь формой списка клиентов. </p>
<p>Для этого выполним команду Клиенты, расположенную в панели команд раздела Оказание услуг. После этого откроется форма
	списка клиентов (рис. 3.28).</p>
<p>Добавить новый элемент в справочник можно при помощи кнопки Создать в командной панели формы или клавишей
	Insert. </p>
<p>Нажмем кнопку Создать. </p>
<p>Обратите внимание, что поле Ф. И. О. при вводе нового клиента подсвечено красным пунктиром. Это значит, что для этого
	поля по умолчанию выполняется проверка заполнения. Если это поле оставить пустым и попытаться записать клиента, то
	будет получено сообщение об ошибке (рис. 3.29).</p>
<p><strong>Рис. 3.28.</strong> Основная форма списка клиентов</p>
<p><strong>Рис. 3.29.</strong> Сообщение об ошибке при вводе нового элемента справочника</p>
<p>Так происходит потому, что система автоматически устанавливает проверку заполнения у некоторых стандартных реквизитов
	объектов, например у наименования справочника (если основное представление справочника в виде наименования). </p>
<p>Внесем Ф. И. О. клиента – Спиридонова Галина. </p>
<p>После добавления элементов справочник будет выглядеть следующим образом (рис. 3.30). </p>
<p>Чтобы открыть существующий элемент справочника для редактирования, нужно дважды щелкнуть на нем мышью. </p>
<p>Для быстрого доступа к недавно открытым, созданным или отредактированным объектам базы данных (документам, элементам
	справочников и др.) можно воспользоваться историей работы пользователя, которую сохраняет «1С:Предприятие». Команда
	для открытия <em>панели истории</em> находится в <em>панели инструментов</em> (рис. 3.31). </p>
<p>Из панели истории можно быстро открыть недавно созданный объект базы данных (например, элемент справочника) или
	выполнить команду прикладного решения. Если список истории достаточно большой, то можно воспользоваться строкой
	поиска, находящейся вверху формы.</p>
<p><img src="3.jpeg"/></p>
<p><strong>Рис. 3.31.</strong> Форма истории работы пользователя</p>
<p>Однако для начинающих разработчиков может быть удобнее, чтобы панель истории была всегда открыта. </p>
<p>Настройка отображения панелей прикладного решения</p>
<p>По умолчанию панель истории не отображается в интерфейсе приложения. Пользователь может самостоятельно включить
	отображение этой панели в режиме 1С:Предприятие (Главное меню  Вид  Настройка панелей…). Или это может сделать
	разработчик в конфигураторе. Воспользуемся для примера второй возможностью.</p>
<p>В режиме «Конфигуратор»</p>
<p>Закроем приложение и вернемся в конфигуратор. Выделим корень дерева объектов конфигурации ПособиеДляНачинающих,
	нажатием правой кнопки мыши вызовем контекстное меню и выберем пункт Открыть интерфейс клиентского приложения (рис.
	3.32). </p>
<p>В появившемся окне Интерфейс клиентского приложения справа находится список всех стандартных панелей прикладного
	решения. Перетащим элемент Панель истории в левую часть окна, в группу Низ (рис. 3.33). </p>
<p><strong>Рис. 3.33.</strong> Настройка расположения панелей прикладного решения</p>
<p>Соответственно, если какая-то панель не должна отображаться в прикладном решении по замыслу разработчика, достаточно
	перетащить ее из левого списка направо или нажать кнопку Удалить в командной панели окна. Перетаскиванием мышью в
	различные группы (Лево, Право и т. п.) левого списка можно поменять расположение видимых панелей в окне прикладного
	решения.</p>
<p>В режиме «1С:Предприятие»</p>
<p>Запустим «1С:Предприятие» в режиме отладки и увидим, что в нижней части окна приложения отображается панель истории
	работы пользователя. Нажав на ссылку в этой панели, мы можем открыть для редактирования один из последних измененных
	элементов справочника (рис. 3.34).</p>
<p><strong>Рис. 3.34.</strong> Вызов клиентов из панели истории работы пользователя</p>
<p>Теперь уберем отображение этой панели в режиме 1С:Предприятие, так как постоянно панель истории на экране нам не
	нужна, она только будет занимать лишнее место. Для этого выполним команду главного меню приложения Вид  Настройка
	панелей… (рис. 3.35). </p>
<p>В открывшемся окне Редактор панелей перетащим мышью панель истории в невидимую область, выделенную серым цветом,
	внизу окна (рис. 3.36). </p>
<p><img src="4.jpeg"/></p>
<p><strong>Рис. 3.35.</strong> Вызов настройки расположения панелей прикладного решения</p>
<p>Нажмем ОК. В результате панель станет невидимой в окне прикладного решения, но она всегда может быть открыта в виде
	отдельной формы из панели инструментов при нажатии кнопки <img src="5.jpeg"/>. </p>
<p>Путем перетаскивания мышью можно не только изменить видимость любой панели, но и поменять ее расположение в окне
	прикладного решения.</p>
<p>Таким образом, на примере панели истории мы показали возможность настройки отображения панелей прикладного решения в
	режимах Конфигуратор и 1С:Предприятие. При этом необходимо иметь в виду, что настройка панелей в конфигураторе будет
	актуальна для всех пользователей прикладного решения, в то время как настройка панелей в режиме 1С:Предприятие будет
	доступна только тому пользователю, который ее выполнил.</p>
<h1><a id="_Toc454870649"></a>Лабораторная работа №4 Кассовые операции</h1>
<p><strong>Порядок выполнения работы </strong></p>
<p>1. Ознакомьтесь с теоретическими основами в настоящих указаниях и конспектах лекций. </p>
<p>2. Получите задание у преподавателя. </p>
<p>3. Сделайте скриншоты (кнопка клавиатуры PrtSc) выполненных заданий в текстовом (Word) файле <em>Фамилия_ЛР</em></p>
<p>4. Составьте отчет по лабораторной работе. </p>
<p>5. Отчитайте работу преподавателю.</p>
<p><strong>Справочник с табличной частью</strong></p>
<p>Теперь мы можем перейти к созданию второго справочника, который будет использоваться в нашей конфигурации, –
	справочника Сотрудники. </p>
<p>Этот справочник будет устроен несколько сложнее, чем справочник Клиенты. Дело в том, что в нем мы будем хранить не
	только фамилию, имя и отчество сотрудника, но и информацию о его прошлой трудовой деятельности. </p>
<p>Эта информация однородна по своей структуре (организация, начало, окончание работы, занимаемая должность), но
	количество предыдущих мест работы у разных сотрудников может быть различным. Поэтому для хранения такой информации
	мы будем использовать табличную часть справочника.</p>
<p>В режиме «Конфигуратор»</p>
<p>Добавим новый объект конфигурации Справочник. Назовем его Сотрудники. </p>
<p>На основании имени платформа автоматически заполнит его синоним. </p>
<p>Зададим Представление объекта как Сотрудник. </p>
<p>Представление списка устанавливать не будем, а Расширенное представление списка зададим как Список сотрудников (рис.
	3.37).</p>
<p><strong>Рис. 3.37.</strong> Установка основных свойств справочника </p>
<p>Нажмем кнопку Далее и перейдем на закладку Подсистемы. </p>
<p>По логике нашей конфигурации список сотрудников должен быть доступен в разделах Оказание услуг и Расчет зарплаты.
	Действительно, при оказании услуг должен быть указан сотрудник, оказавший эти услуги, и по результатам этой работы
	мы будем начислять зарплату каждому сотруднику. </p>
<p>Поэтому отметим в списке подсистем Оказание услуг и Расчет зарплаты (рис. 3.38).</p>
<p>Перейдем на закладку Данные. Оставим по умолчанию длину и тип кода, длину наименования справочника зададим равной 50
	символам. </p>
<p>Здесь, также как и для предыдущего справочника, изменим свойство Синоним стандартного реквизита Наименование, так как
	речь идет о сотрудниках.</p>
<p>Для этого нажмем внизу окна кнопку Стандартные реквизиты. Выделим в списке реквизит Наименование и двойным щелчком
	мыши откроем его палитру свойств. Установим свойство Синоним как Ф. И. О. (рис. 3.39).</p>
<p><strong>Рис. 3.38.</strong> Определение списка подсистем, в которых отображается справочник</p>
<p>Табличная часть</p>
<p>Наша задача – создать справочник, имеющий табличную часть. Поэтому добавим в справочник новую табличную часть с
	именем ТрудоваяДеятельность. </p>
<p>Для этого нажмем кнопку Добавить табличную часть над списком табличных частей справочника (рис. 3.40). </p>
<p>Зададим имя табличной части – ТрудоваяДеятельность (рис. 3.41).</p>
<p>Создадим реквизиты табличной части ТрудоваяДеятельность. </p>
<p>Для этого нажмем кнопку Добавить реквизит над списком табличных частей справочника (рис. 3.42):</p>
<p>Добавим следующие реквизиты:</p>
<ul>
	<li>Организация – тип Строка, длина 100;</li>
	<li>НачалоРаботы – тип Дата, состав даты – Дата;  ОкончаниеРаботы – тип Дата, состав даты – Дата;  Должность – тип
		Строка, длина 100.
	</li>
</ul>
<p><strong>Рис. 3.42.</strong> Добавление нового реквизита в табличную часть справочника</p>
<p>Для реквизитов НачалоРаботы и ОкончаниеРаботы мы выбрали состав даты – Дата (рис. 3.43), поскольку в системе
	«1С:Предприятие» значения типа Дата содержат как дату, так и время. В данном случае время начала и окончания работы
	нам безразлично.</p>
<p>В заключение отредактируем командный интерфейс раздела РасчетЗарплаты, чтобы нам было удобнее вводить новые элементы
	справочника. Сделаем видимой стандартную команду для создания новых сотрудников. </p>
<p>Для этого откроем окно редактирования объекта конфигурации Подсистема РасчетЗарплаты и нажмем кнопку Командный
	интерфейс. В открывшемся окне Командный интерфейс отразятся все команды этой подсистемы. </p>
<p>В группе Панель действий.Создать включим видимость у команды Сотрудник: создать. </p>
<p>Также мы видим, что в группу Панель навигации.Обычное добавилась команда Сотрудники для открытия этого списка. Она
	включена по умолчанию (рис. 3.44).</p>
<p>Для подсистемы ОказаниеУслуг никаких команд добавлять не будем, так как вряд ли понадобится пополнять список
	сотрудников, находясь в этом разделе.</p>
<p>На этом создание справочника Сотрудники завершено. </p>
<p>Закроем окно редактирования справочника Сотрудники и запустим «1С:Предприятие» в режиме отладки. </p>
<p><strong>Рис. 3.44.</strong> Окно настройки командного интерфейса подсистемы</p>
<p>Ответим утвердительно на запрос конфигуратора об обновлении конфигурации и увидим окно, содержащее список изменений в
	структуре конфигурации, автоматически сгенерированный платформой. </p>
<p>В данном случае мы добавили справочник Сотрудники. Нажмем кнопку Принять (рис. 3.45).</p>
<p><strong>Рис. 3.45.</strong> Список изменений в структуре конфигурации</p>
<p>В режиме «1С:Предприятие»</p>
<p>В открывшемся окне «1С:Предприятия» мы видим, что в панелях команд разделов Оказание услуг и Расчет зарплаты
	появилась команда Сотрудники для открытия списка сотрудников (рис. 3.46).</p>
<p>Название этой команды определяется синонимом объекта, так как Представление списка мы для этого справочника не
	задавали. </p>
<p>Кроме того, в панели команд раздела Расчет зарплаты появилось подменю Создать, содержащее команду Сотрудник, для
	создания новых сотрудников (см. рис. 3.46). Название этой команды определяется свойством Представление объекта,
	которое мы задали для этого справочника. </p>
<p>Этой командой мы и воспользуемся для создания новых элементов справочника, не открывая при этом списка
	сотрудников.</p>
<p>Заполнение табличной части</p>
<p>Выполним команду Сотрудник. </p>
<p>Перед нами откроется форма для создания элемента справочника. Заголовок этой формы определяется свойством
	Представление объекта. </p>
<p>Эта форма содержит табличную часть с реквизитами, которые мы описали в конфигураторе для этого справочника.</p>
<p>Создадим следующих сотрудников (рис. 3.47, 3.48, 3.49):</p>
<p> Гусаков Николай Дмитриевич. Трудовая деятельность:</p>
<p> □ Организация – ЗАО «НТЦ», </p>
<p>□ Начало работы – 01.02.2009, □ Окончание работы – 16.04.2012, □ Должность – Ведущий специалист.  Деловой Иван
	Сергеевич.</p>
<p>Трудовая деятельность:</p>
<p>□ 1:</p>
<p>○ Организация – ООО «Автоматизация», </p>
<p>○ Начало работы – 22.01.2006, ○ Окончание работы – 31.12.2012, </p>
<p>○ Должность – Инженер. □ 2:</p>
<p>○ Организация – ЗАО «НПО СпецСвязь», </p>
<p>○ Начало работы – 20.06.1996, ○ Окончание работы – 21.01.2005, </p>
<p>○ Должность – Начальник производства.  Симонов Валерий Михайлович.</p>
<p>Трудовая деятельность:</p>
<p> □ Организация – ООО «СтройМастер», </p>
<p>□ Начало работы – 06.02.2009, □ Окончание работы – 03.04.2012, □ Должность – Прораб.</p>
<p>Строки табличной части справочника можно добавлять кнопкой Добавить, Insert или просто перемещением курсора вниз из
	последней строки таблицы (рис. 3.47).</p>
<p><strong>Рис. 3.47.</strong> Заполнение элемента справочника «Сотрудники»</p>
<p>Если табличная часть состоит из нескольких строк, то расположить их в произвольном порядке можно путем перетаскивания
	мышью в нужное место или с помощью команд Переместить вверх, Переместить вниз из подменю Еще, находящегося в
	командной панели таблицы. Для того чтобы удалить только что созданную пустую строку табличной части, достаточно
	просто установить курсор на другую, заполненную строку таблицы.</p>
<p><strong>Рис. 3.48.</strong> Заполнение элемента справочника «Сотрудники»</p>
<p><strong>Рис. 3.49.</strong> Заполнение элемента справочника «Сотрудники»</p>
<p>Чтобы просмотреть список добавленных сотрудников, выполним команду Сотрудники. </p>
<p>Откроется форма списка сотрудников. </p>
<p>Обратите внимание, что заголовок этой формы определяется свойством Расширенное представление списка, которое мы
	задали </p>
<p><strong>Рис. 3.50.</strong> Список сотрудников</p>
<p>Теперь мы можем приступить к созданию следующего справочника – Номенклатура.</p>
<p><strong>Иерархический справочник</strong></p>
<p>Справочник Номенклатура будет содержать информацию об услугах, которые оказывает ООО «На все руки мастер», и о тех
	материалах, которые при этом могут быть использованы.</p>
<p>Этот справочник не будет сложным. Единственная особенность, которой он будет обладать, – наличие иерархической
	структуры. Для того чтобы справочником было удобно пользоваться, мы сгруппируем услуги в одну группу, а материалы –
	в другую. </p>
<p>Кроме этого, поскольку ООО «На все руки мастер» оказывает самые разные услуги, они также будут логически собраны в
	несколько групп. То же самое можно сказать и про материалы.</p>
<p>В режиме «Конфигуратор»</p>
<p>Создадим новый объект конфигурации Справочник и назовем его Номенклатура. На основании имени платформа автоматически
	заполнит его синоним. </p>
<p>Поскольку понятие Номенклатура не имеет единственного числа, больше никаких свойств, определяющих представление
	объекта в интерфейсе приложения, задавать не будем. Вместо Представления объекта и Представления списка будет
	использоваться Синоним объекта – Номенклатура.</p>
<p>Перейдем на закладку Подсистемы. </p>
<p>По логике нашей конфигурации список номенклатуры должен быть доступен в разделах Учет материалов, Оказание услуг и
	Бухгалтерия. Действительно, к первым двум разделам этот справочник имеет прямое отношение, а для бухгалтерского
	анализа всегда может понадобиться список материалов и услуг. Поэтому отметим в списке подсистем эти подсистемы (рис.
	3.51).</p>
<p>Наша задача состоит в создании иерархического справочника. Перейдем на закладку Иерархия и установим флажок
	Иерархический справочник (рис. 3.52).</p>
<p><strong>Рис. 3.51.</strong> Определение списка подсистем, в которых отображается справочник</p>
<p>На закладке Данные оставим по умолчанию длину и тип кода, длину наименования справочника зададим равной 100
	символам. </p>
<p>Здесь же изменим Синоним стандартного реквизита Родитель нашего справочника на более понятное обозначение. Для этого
	нажмем внизу окна кнопку Стандартные реквизиты. Выделим в списке реквизит Родитель и двойным щелчком мыши откроем
	его палитру свойств. Установим свойство Синоним как Группа номенклатуры </p>
<p>(рис. 3.53).</p>
<p>Прежде чем запускать «1С:Предприятие», настроим интерфейс приложения, чтобы нам было удобнее вводить новые элементы
	справочника. Сделаем доступной в панели команд разделов УчетМатериалов и ОказаниеУслуг стандартную команду для
	создания новых элементов списка номенклатуры. </p>
<p>Для этого в дереве объектов конфигурации выделим ветвь Подсистемы, вызовем ее контекстное меню и выберем пункт Все
	подсистемы (рис. 3.54).</p>
<p>В открывшемся окне слева в списке Подсистемы выделим подсистему УчетМатериалов. </p>
<p>Справа в списке Командный интерфейс отразятся все команды выбранной подсистемы. </p>
<p>В группе Панель действий.Создать включим видимость у команды Номенклатура: создать. </p>
<p>Также мы видим, что в группу Панель навигации.Обычное добавилась команда Номенклатура для открытия этого списка. Она
	включена по умолчанию (рис. 3.55).</p>
<p><strong>Рис. 3.55.</strong> Окно настройки подсистем</p>
<p>Выделив в списке подсистем ОказаниеУслуг, проделаем те же действия. </p>
<p>А для подсистемы Бухгалтерия никаких команд добавлять в панель действий не будем, так как вряд ли понадобится
	пополнять список номенклатуры, находясь в этом разделе.</p>
<p><strong>пРиМеЧАние</strong></p>
<p>Вызвать и настроить фрагмент командного интерфейса для конкретной подсистемы можно также из окна редактирования этой
	подсистемы, нажав кнопку Командный интерфейс. Но в случае, когда нужно настроить командный интерфейс сразу для
	нескольких подсистем, удобнее пользоваться редактором Все подсистемы.</p>
<p>Теперь заполним справочник Номенклатура. В процессе заполнения мы покажем, как создавать группы и переносить элементы
	из одной группы в другую. </p>
<p>Закроем окно редактирования справочника Номенклатура и запустим «1С:Предприятие» в режиме отладки. </p>
<p>Ответим утвердительно на запрос конфигуратора об обновлении конфигурации и увидим окно, содержащее список изменений в
	структуре конфигурации, автоматически сгенерированный платформой. В данном случае мы добавили справочник
	Номенклатура. </p>
<p>Нажмем кнопку Принять (рис. 3.56).</p>
<p><strong>Рис. 3.56.</strong> Список изменений в структуре конфигурации</p>
<p>В режиме «1С:Предприятие»</p>
<p>В открывшемся окне «1С:Предприятия» мы видим, что в панелях команд разделов Учет материалов, Оказание услуг и
	Бухгалтерия появилась команда Номенклатура для открытия списка номенклатуры </p>
<p>(рис. 3.57). </p>
<p>Название этой команды определяется синонимом объекта, так как других представлений мы для этого справочника не
	задавали. </p>
<p>Выполним команду Номенклатура в разделе Учет материалов. </p>
<p>Откроется форма списка номенклатуры. </p>
<p>Создание элементов в иерархическом справочнике </p>
<p>Создадим две группы в корне справочника: Материалы и Услуги. </p>
<p>Для этого нажмем кнопку Создать группу в командной панели формы списка (рис. 3.57).</p>
<p><strong>Рис. 3.57.</strong> Создание групп справочника «Номенклатура»</p>
<p>Зададим наименование групп: Материалы, Услуги. Поля Группа номенклатуры и Код заполнять не будем.</p>
<p>Затем двойным щелчком мыши раскроем группу Материалы и создадим в ней пять элементов:</p>
<ul>
	<li>Строчный трансформатор Samsung,</li>
	<li>Строчный трансформатор GoldStar,</li>
	<li>Транзистор Philips 2N2369,</li>
	<li>Шланг резиновый,</li>
	<li>Кабель электрический.</li>
</ul>
<p>Для добавления элемента в открытую группу справочника нажмем кнопку Создать в командной панели формы списка
	справочника. </p>
<p>Перед нами откроется форма для создания элемента справочника. Причем если новый элемент добавляется из формы списка в
	некоторую открытую группу, то система автоматически подставляет в качестве группы номенклатуры текущую группу (рис.
	3.58).</p>
<p><strong>Рис. 3.58.</strong> Создание элементов в группе «Материалы»</p>
<p>Для создания нового элемента справочника можно также воспользоваться командой Номенклатура, которая появилась в
	разделах Учет материалов и Оказание услуг в подменю Создать. </p>
<p>В этом случае, если элемент добавляется командой из панели команд текущего раздела, она никак не связана со списком
	номенклатуры. Поэтому система не знает, в какую группу добавлять элемент, и группу номенклатуры нужно указывать
	вручную (рис. 3.59).</p>
<p><strong>Рис. 3.59.</strong> Создание элементов в группе «Материалы»</p>
<p>Причем при выборе значения в поле Группа номенклатуры можно воспользоваться удобной возможностью поиска по строке
	нужного значения из справочника. Достаточно ввести первые несколько букв искомого наименования, и подходящее
	значение будет предложено для выбора.</p>
<p>При создании новых материалов или услуг список номенклатуры открывать необязательно. Факт добавления элемента в
	справочник отражается в сообщении в нижнем углу экрана.</p>
<p>Затем раскроем группу Услуги и тоже создадим в ней несколько элементов – услуги по ремонту телевизоров (рис.
	3.60). </p>
<ul>
	<li>Диагностика,</li>
	<li>Ремонт отечественного телевизора,  Ремонт импортного телевизора.</li>
</ul>
<p>И услуги по установке стиральных машин:</p>
<ul>
	<li>Подключение воды,</li>
</ul>
<p><strong>Рис. 3.60.</strong> Создание элементов в группе «Услуги»</p>
<p>Перенос элементов в другие группы</p>
<p>Теперь разнесем услуги по двум смысловым группам: услуги по ремонту телевизоров и услуги по установке стиральных
	машин. </p>
<p>Для этого в группе Услуги создадим еще две группы: Телевизоры и Стиральные машины (рис. 3.61).</p>
<p>Для того чтобы переместить услуги в соответствующие группы, можно мышью перетащить выделенный элемент справочника в
	нужную группу или выполнить команду Переместить в группу из подменю Еще, находящегося в командной панели формы
	списка. </p>
<p>Можно также открыть для редактирования выделенный элемент справочника и изменить поле Группа номенклатуры (рис.
	3.62).</p>
<p><strong>Рис. 3.61.</strong> Создание новых групп в группе «Услуги»</p>
<p>Переместим в группу Телевизоры услуги Диагностика, Ремонт отечественного телевизора и Ремонт импортного
	телевизора. </p>
<p>Услуги Подключение воды и Подключение электричества переместим в группу Стиральные машины.</p>
<p>Затем в группе Материалы создадим две группы: Радиодетали и Прочее. В группу Прочее поместим Кабель электрический и
	Шланг резиновый. Остальные материалы переместим в группу Радиодетали.</p>
<p>На этом примере покажем, как создавать недостающие элементы справочников во время их выбора в других полях. </p>
<p>Откроем элемент Кабель электрический из группы Материалы. Нам нужно заменить значение в поле Группа номенклатуры на
	Прочее. Но такой группы номенклатуры еще нет. В окне выбора значения нажмем кнопку Создать со знаком +. Таким
	образом, платформа «понимает», что мы хотим добавить новую группу, и открывает форму для создания группы справочника
	(рис. 3.63). </p>
<p>Введем в этой форме наименование группы Прочее, выберем в качестве поля Группа номенклатуры для новой группы уже
	имеющеюся группу Материалы и нажмем Записать и закрыть. После этого внутри группы Материалы будет создана группа
	Прочее, и ссылка на нее будет подставлена в поле Группа номенклатуры для элемента номенклатуры Кабель
	электрический.</p>
<p><img src="6.jpeg"/></p>
<p><strong>Рис. 3.63.</strong> Создание группы номенклатуры при выборе в поле «Группа номенклатуры»</p>
<p>Представим теперь список номенклатуры в виде дерева. Для этого из подменю Еще в командной панели формы списка
	номенклатуры вызовем пункт Режим просмотра и выберем режим Дерево. В результате список номенклатуры будет выглядеть
	следующим образом </p>
<p>(рис. 3.64).</p>
<p><strong>Рис. 3.64.</strong> Список номенклатуры в виде дерева</p>
<h1><a id="_Toc454870650"></a>Лабораторная работа № 5 Банковские операции</h1>
<p><strong>Порядок выполнения работы </strong></p>
<p>1. Ознакомьтесь с теоретическими основами в настоящих указаниях и конспектах лекций. </p>
<p>2. Получите задание у преподавателя. </p>
<p>3. Сделайте скриншоты (кнопка клавиатуры PrtSc) выполненных заданий в текстовом (Word) файле <em>Фамилия_ЛР</em></p>
<p>4. Составьте отчет по лабораторной работе. </p>
<p>5. Отчитайте работу преподавателю.</p>
<p><strong>Справочник с предопределенными элементами</strong></p>
<p>В заключение мы создадим справочник Склады, который будет содержать информацию о складах, используемых ООО «На все
	руки мастер». </p>
<p>Этот справочник будет включать в себя один предопределенный элемент – склад Основной, на который будут поступать все
	материалы. </p>
<p>Наша задача – создать справочник, содержащий предопределенные элементы. </p>
<p>В режиме «Конфигуратор»</p>
<p>Откроем конфигуратор и создадим новый объект конфигурации Справочник с именем Склады. На основании имени платформа
	автоматически заполнит его синоним. </p>
<p>Зададим Представление объекта как Склад. Вместо свойства Представления списка будет использоваться Синоним объекта –
	Склады (рис. 3.65).</p>
<p>Перейдем на закладку Подсистемы. </p>
<p>По логике нашей конфигурации список складов должен быть доступен в разделах Оказание услуг и Учет материалов, так как
	поступление материалов и оказание услуг, как правило, учитываются в разрезе складов. Поэтому отметим в списке
	подсистем эти подсистемы (рис. 3.66).</p>
<p><strong>Рис. 3.66.</strong> Определение списка подсистем, в которых отображается справочник</p>
<p>Свойство «Быстрый выбор»</p>
<p>Заполним еще одно свойство справочника Склады – Быстрый выбор. Для этого перейдем на закладку Поле ввода и установим
	соответствующий флажок (рис. 3.67).</p>
<p>Дело в том, что по умолчанию при нажатии кнопки выбора поле, содержащем ссылку на элемент справочника, открывается
	форма выбора элемента справочника. Она может быть не всегда удобна, особенно в том случае, когда справочник
	неиерархический и заведомо содержит небольшое количество элементов.</p>
<p>Свойство Быстрый выбор как раз позволяет выбирать элементы не из отдельной формы, а из небольшого выпадающего списка,
	заполненного элементами этого справочника (рис. 3.68).</p>
<p><img src="7.jpeg"/></p>
<p><strong>Рис. 3.68.</strong> Выбор склада из выпадающего списка</p>
<p>Этот вариант наиболее удобен для списка складов, так как их, вероятно, будет немного. </p>
<p>Для остальных справочников свойство Быстрый выбор мы не устанавливали, так как Номенклатура – иерархический
	справочник, и, следовательно, быстрый выбор для него не имеет смысла. А список сотрудников и, особенно, список
	клиентов может быть очень большим, и выпадающий список в этом случае будет неудобно прокручивать.</p>
<p>Предопределенные элементы</p>
<p>Перейдем на закладку Прочее и нажмем кнопку Предопределенные. Система откроет список предопределенных элементов
	справочника. </p>
<p>Сейчас он пуст, поэтому нажмем кнопку Добавить и создадим предопределенный элемент с именем Основной (рис. 3.69).</p>
<p>Обратите внимание на то, что помимо наименования мы задали еще и <em>имя</em> предопределенного элемента справочника.
</p>
<p><strong>Рис. 3.69.</strong> Заполнение предопределенного элемента справочника</p>
<p>В дальнейшем, когда мы будем использовать встроенный язык, мы сможем обратиться к этому элементу справочника,
	используя имя, присвоенное ему в конфигураторе. Дело в том, что наименование предопределенного элемента справочника
	пользователь может изменить, а имя пользователь не видит и изменить не может.</p>
<p>Прежде чем запускать «1С:Предприятие», настроим интерфейс приложения, чтобы нам было удобнее вводить новые элементы
	справочника. В разделе Учет материалов сделаем доступной стандартную команду для создания новых складов. </p>
<p>Для этого откроем окно редактирования объекта конфигурации Подсистема УчетМатериалов и нажмем кнопку Командный
	интерфейс. В открывшемся окне Командный интерфейс отразятся все команды этой подсистемы. </p>
<p>В группе Панель действий.Создать включим видимость у команды Склад: создать. </p>
<p>Также мы видим, что в группу Панель навигации.Обычное добавилась команда Склады для открытия этого списка. Она
	включена по умолчанию (рис. 3.70).</p>
<p>Закроем окно редактирования справочника Склады и запустим «1С:Предприятие» в режиме отладки. </p>
<p>Ответим утвердительно на запрос конфигуратора об обновлении конфигурации и увидим окно, содержащее список изменений в
	структуре конфигурации, автоматически сгенерированный платформой. В данном случае мы добавили справочник
	Склады. </p>
<p>Нажмем кнопку Принять (рис. 3.71).</p>
<p><strong>В режиме «1С:Предприятие»</strong></p>
<p>В открывшемся окне «1С:Предприятия» мы видим, что в разделе Учет материалов в подменю Создать добавилась команда
	Склад для создания новых складов (рис. 3.72).</p>
<p>Название этой команды определяется синонимом объекта конфигурации, так как Представление списка мы для этого
	справочника не задавали.</p>
<p>Кроме того, в разделах Оказание услуг и Учет материалов появилась команда Склады для открытия списка складов (см.
	рис. 3.72). Название этой команды определяется свойством Представление объекта, которое мы задали для этого
	справочника. </p>
<p>Выполним команду Склады в разделе Учет материалов. Откроется форма списка складов. </p>
<p>В списке складов уже есть один элемент с наименованием Основной. Это предопределенный элемент, который мы создали в
	конфигураторе. </p>
<p>Выполнив команду Склад из подменю Создать, добавим в справочник еще один склад, который назовем Розничный (рис.
	3.73).</p>
<p><strong>Рис. 3.73.</strong> Элементы справочника «Склады»</p>
<p>На этом мы завершим подготовительную работу по созданию справочников и сделаем теоретическое отступление, касающееся
	предопределенных элементов и тех вопросов, которые постоянно появляются у вас на экране при запуске и продолжении
	отладки.</p>
<h1><a id="_Toc454870651"></a>Лабораторная работа № 6 Учетные документы</h1>
<p><strong>Порядок выполнения работы </strong></p>
<p>1. Ознакомьтесь с теоретическими основами в настоящих указаниях и конспектах лекций. </p>
<p>2. Получите задание у преподавателя. </p>
<p>3. Сделайте скриншоты (кнопка клавиатуры PrtSc) выполненных заданий в текстовом (Word) файле <em>Фамилия_ЛР</em></p>
<p>4. Составьте отчет по лабораторной работе. </p>
<p>5. Отчитайте работу преподавателю.</p>
<p><strong>Документ «Приходная накладная»</strong></p>
<p>После того как мы познакомились с объектом конфигурации Документ, создадим несколько таких объектов, чтобы иметь
	возможность фиксировать события, происходящие в нашем ООО «На все руки мастер».</p>
<p>Одними из самых популярных услуг нашего предприятия является ремонт телевизоров и установка стиральных машин. И в
	том, и в другом случае требуются некоторые материалы, которые расходуются в процессе оказания этих услуг. Поэтому
	двумя важнейшими событиями в хозяйственной жизни нашей организации будут являться поступление материалов и оказание
	услуг. </p>
<p>Для отражения этих событий в базе данных мы создадим два документа: Приходная накладная и Оказание услуги. </p>
<p>Документ Приходная накладная будет фиксировать факт поступления в нашу организацию необходимых материалов, а документ
	Оказание услуги – фиксировать оказание услуг и расход материалов, которые используются при оказании этих услуг.</p>
<p>В режиме «Конфигуратор»</p>
<p>Добавление документа</p>
<p>Откроем конфигуратор и добавим новый объект конфигурации Документ. На закладке Основные зададим имя документа –
	ПриходнаяНакладная. На основании имени платформа автоматически заполнит его синоним. </p>
<p>Здесь же определим, как будет представлен документ в интерфейсе «1С:Предприятия». Представление объекта задавать не
	будем, вместо него будет использоваться Синоним объекта. Это нам вполне подходит, так как мы задали его имя в
	единственном числе. </p>
<p>Представление списка, наоборот, зададим во множественном числе как Приходные накладные (рис. 4.4).</p>
<p><strong>Рис. 4.4.</strong> Установка основных свойств документа</p>
<p>Нажмем Далее и перейдем на закладку Подсистемы. </p>
<p>По логике нашей конфигурации список приходных накладных должен быть доступен в разделах Учет материалов и
	Бухгалтерия. Действительно, к первому разделу этот документ имеет прямое отношение, а для бухгалтерского анализа
	всегда может понадобиться список документов, отражающих поступление материалов. </p>
<p>Поэтому отметим в списке подсистем эти подсистемы (рис. 4.5).</p>
<p>Перейдем на закладку Данные и создадим реквизит документа с именем Склад. Для этого нажмем кнопку Добавить над
	списком реквизитов документа (рис. 4.6).</p>
<p><strong>Рис. 4.5.</strong> Определение списка подсистем, в которых будет отражаться документ</p>
<p><strong>Рис. 4.6.</strong> Создание реквизита документа</p>
<p>Реквизиты ссылочного типа</p>
<p>Выберем для реквизита ссылочный тип данных СправочникСсылка.Склады. Этот тип стал доступен в конфигурации после
	создания объекта конфигурации Справочник Склады (рис. 4.7).</p>
<p><strong>Рис. 4.7.</strong> Свойства реквизита документа</p>
<p>Свойство «Значение заполнения» реквизита объекта конфигурации</p>
<p>Теперь покажем, как можно облегчить жизнь пользователя при приходовании материалов. Работа в автоматизируемой нами
	фирме построена таким образом, что, как правило, все поступающие товары приходуются на основной склад. </p>
<p>Поэтому в палитре свойств для созданного нами реквизита Склад документа найдем свойство Значение заполнения.</p>
<p>В качестве значения этого свойства выберем предопределенный элемент справочника Склады – Основной.</p>
<p>Таким образом, при создании нового документа склад будет сразу заполняться значением Основной, и пользователю не
	придется делать это вручную (рис. 4.8).</p>
<p><strong>Рис. 4.9.</strong> Создание новой табличной части документа</p>
<p>Проверка заполнения табличной части</p>
<p>Кроме имени табличной части установим свойство Проверка заполнения в значение Выдавать ошибку. Тем самым мы задаем
	условие, что документ Приходная накладная обязательно должен содержать табличную часть, то есть список приходуемых
	материалов. Иначе будет выдано сообщение об ошибке, и документ не будет сохранен.</p>
<p>Создадим реквизиты табличной части Материалы. Для этого нажмем кнопку Добавить реквизит в разделе описания табличных
	частей документа (рис. 4.10):</p>
<ul>
	<li>Материал, тип СправочникСсылка.Номенклатура;</li>
	<li>Количество, тип Число, длина 15, точность 3, неотрицательное;</li>
	<li>Цена, тип Число, длина 15, точность 2, неотрицательное;</li>
	<li>Сумма, тип Число, длина 15, точность 2, неотрицательное.</li>
</ul>
<p>Для каждого реквизита табличной части также установим свойство </p>
<p>Проверка заполнения в значение Выдавать ошибку. Тем самым при записи документа будет проверяться на заполнение не
	только табличная часть в целом, но и ее отдельные реквизиты.</p>
<p><strong>Рис. 4.10.</strong> Создание реквизитов табличной части документа</p>
<p>Перейдем на закладку Нумерация и убедимся, что свойство Автонумерация включено. Это обеспечит автоматическую
	генерацию уникальных номеров для создаваемых нами документов.</p>
<p>В заключение отредактируем командный интерфейс, чтобы в разделе Учет материалов была доступна команда создания новых
	документов. </p>
<p>Для этого откроем окно редактирования объекта конфигурации Подсистема УчетМатериалов и нажмем кнопку Командный
	интерфейс. В открывшемся окне Командный интерфейс отразятся все команды этой подсистемы. </p>
<p>В группе Панель действий.Создать включим видимость у команды Приходная накладная: создать (рис. 4.11).</p>
<p><strong>В режиме «1С:Предприятие»</strong></p>
<p>Запустим «1С:Предприятие» в режиме отладки и протестируем получившийся документ.</p>
<p>В открывшемся окне «1С:Предприятия» мы видим, что в разделах Бухгалтерия и Учет материалов появилась команда
	Приходные накладные для открытия списка приходных накладных (рис. 4.12). </p>
<p>Название этой команды определяется свойством Представление списка, которое мы задали для этого документа. </p>
<p>Кроме того, в разделе Учет материалов в подменю Создать добавилась команда Приходная накладная для создания новых
	документов этого вида. Название этой команды определяется синонимом, так как Представление объекта мы для этого
	документа не задавали (см. рис. 4.12).</p>
<p>Добавление приходных накладных</p>
<p>Пока в нашей базе данных нет ни одного документа Приходная накладная, поэтому выполним команду Приходная накладная из
	подменю Создать в разделе Учет материалов и создадим новую приходную накладную. </p>
<p>Откроется форма документа. Заголовок этой формы Приходная накладная совпадает с синонимом документа. </p>
<p>Система автоматически подставит текущую дату создания документа и нулевое время, так как документ еще не проведен. В
	качестве времени документа при оперативном проведении ему присваивается оперативная отметка времени. </p>
<p>Поле Номер не заполнено, но система сама сгенерирует для нового документа уникальный номер, так как свойство
	Автонумерация для документа включено по умолчанию. Новый номер будет сохранен в момент записи документа.</p>
<p>Обратите внимание, что склад уже заполнен значением Основной, как мы и задали в свойствах этого реквизита. </p>
<p>Нам осталось только заполнить табличную часть приходной накладной материалами для ремонта телевизоров так, как
	показано на рисунке (рис. 4.13).</p>
<p><strong>Рис. 4.13.</strong> Создание нового документа «Приходная накладная № 1»</p>
<p>Обратите внимание, что при переходе к еще незаполненной колонке Материал (в табличной части документа) автоматически
	открывается окно выбора значения из справочника Номенклатура, так как этот реквизит имеет ссылочный тип данных и
	ссылается на справочник Номенклатура (см. рис. 4.13). </p>
<p>Как только мы начнем вводить название материала в это поле, платформа автоматически найдет материалы, наименование
	которых начинается с введенных нами символов, и предложит их нам для выбора. А также при нажатии кнопки Показать все
	открывается форма для выбора элементов этого справочника.</p>
<p>Нажмем Провести и закрыть. </p>
<p>Документ будет сохранен и проведен, ему будет присвоен автоматически сгенерированный системой номер и текущее время
	проведения документа. </p>
<p>Аналогичным образом мы создадим второй документ, который будет приходовать на Основной склад материалы для установки
	стиральных машин (рис. 4.14).</p>
<p><strong>Рис. 4.14.</strong> Создание нового документа «Приходная накладная № 2»</p>
<p>Нажмем Провести и закрыть. </p>
<p>Документ будет сохранен и проведен, ему будет присвоен автоматически сгенерированный системой номер и текущее время
	проведения документа. </p>
<p>Обратите внимание, что при вводе нового документа табличная часть в целом и каждая ее колонка подсвечены красным
	пунктиром. Это значит, что для них выполняется проверка заполнения. Если не ввести ни одной строки в табличную часть
	документа или оставить незаполненной какую-либо колонку табличной части и попытаться провести документ, то будет
	получено сообщение об ошибке (рис. 4.15).</p>
<p>Чтобы просмотреть список созданных документов, выполним команду Приходные накладные. </p>
<p>В форме списка мы видим два созданных нами документа, отмеченных пиктограммой, указывающей на то, что документы
	проведены (зеленая галочка в пиктограмме документа, рис. 4.16).</p>
<p><strong>Рис. 4.15.</strong> Сообщение об ошибке при вводе нового элемента документа</p>
<p><strong>Рис. 4.16.</strong> Список приходных накладных</p>
<h1><a id="_Toc454870652"></a>Лабораторная работа № 7 Оформление банковского поручения</h1>
<p><strong>Порядок выполнения работы </strong></p>
<p>1. Ознакомьтесь с теоретическими основами в настоящих указаниях и конспектах лекций. </p>
<p>2. Получите задание у преподавателя. </p>
<p>3. Сделайте скриншоты (кнопка клавиатуры PrtSc) выполненных заданий в текстовом (Word) файле <em>Фамилия_ЛР</em></p>
<p>4. Составьте отчет по лабораторной работе. </p>
<p>5. Отчитайте работу преподавателю.</p>
<p><strong>Автоматический пересчет суммы в строках документа</strong></p>
<p>Наверняка вы обратили внимание на то, что при заполнении документа приходится вводить сумму в каждой строке. Это
	неудобно, и возникает естественное желание автоматизировать работу документа так, чтобы сумма вычислялась
	автоматически каждый раз при изменении цены или количества материалов в строке.</p>
<p>Это совсем не сложно, и для этого нам потребуется сначала создать собственную форму документа, а затем
	воспользоваться возможностями встроенного языка. </p>
<p>Дело в том, что до сих пор мы использовали предопределенные формы объектов, которые система «1С:Предприятие» по
	умолчанию создавала для нас сама. Теперь же у нас возникла необходимость слегка изменить логику работы формы
	документа, поэтому нам нужно создать свою собственную форму документа ПриходнаяНакладная для того, чтобы в ней с
	помощью встроенного языка описать тот алгоритм, который нам нужен. И система будет использовать нашу форму вместо
	формы по умолчанию.</p>
<p>В режиме «Конфигуратор»</p>
<p>Форма документа</p>
<p>Вернемся в конфигуратор и откроем окно редактирования объекта конфигурации Документ ПриходнаяНакладная. </p>
<p>В этом окне нас интересует закладка Формы. </p>
<p>Как мы видим, ни одна из основных форм документа пока не задана. </p>
<p>Для того чтобы создать форму документа, нажмем кнопку открытия <img src="8.jpeg"/> со значком лупы в поле ввода или
	кнопку Добавить над списком форм (рис. 4.17).</p>
<p><strong>Рис. 4.17.</strong> Создание формы документа</p>
<p>Система вызовет еще один полезный инструмент разработчика – <em>конструктор формы</em> (рис. 4.18).</p>
<p>Этот инструмент также построен по принципу «мастеров»: ввод данных в определенной последовательности и передвижение
	кнопками Далее и Назад. </p>
<p>Выберем тип формы Форма документа и нажмем кнопку Готово, согласившись тем самым со всем, что нам предложила
	система </p>
<p>(см. рис. 4.18).</p>
<p>Обратите внимание, что в дереве объектов конфигурации у объекта конфигурации Документ ПриходнаяНакладная появилась
	форма ФормаДокумента (рис. 4.19), а на экране открылось окно редактора форм, содержащее эту форму (рис. 4.20).</p>
<p><em>Редактор форм</em> объединяет несколько окон взаимосвязанных между собой редакторов. Мы не будем здесь разбирать
	подробно работу с редактором форм, а коснемся только тех моментов, которые нужны для выполнения простейших действий,
	связанных с нашей задачей. </p>
<p><strong>подРобнее</strong></p>
<p>За более подробной информацией о работе с редактором форм следует обратиться к документации «1С:Предприятие 8.3.
	Руководство разработчика», раздел 26.1 «Редактор формы».</p>
<p>Пока мы рассмотрим только окно формы документа в режиме просмотра, расположенное внизу, и окно редактора элементов
	формы, расположенное слева в верхней части окна редактора форм.</p>
<p>Прежде всего, необходимо понимать, что при разработке форм объектов конфигурации разработчик не имеет возможности
	нарисовать форму. Он может только указать, из каких элементов будет состоять форма, а система уже сама
	самостоятельно расположит эти элементы в форме.</p>
<p>Элементы формы в верхнем левом окне редактора форм образуют иерархическую структуру, из которой следует, что чем выше
	в списке находится элемент, тем выше и левее на форме он будет располагаться. </p>
<p>Эта структура редактируется на закладке Элементы и позволяет управлять отображением и редактированием данных в
	форме. </p>
<p>Мы видим, что на основе описания в конфигурации документа ПриходнаяНакладная система создала структуру элементов,
	которая определяет, как будет выглядеть форма. </p>
<p>Эти элементы имеют разное назначение и разное поведение. Однако все они служат для того, чтобы отображать информацию,
	хранящуюся в базе данных, и организовывать интерактивную работу с этой информацией.</p>
<p>Вы можете попробовать перетащить мышью поля в дереве элементов и поменять местами, например, реквизиты табличной
	части. Результат изменений сразу отразится в форме документа в нижней части редактора форм. При этом разработчику не
	нужно задумываться над вопросами конкретного (до пикселя) расположения того или иного элемента формы, его размеров и
	привязки к другим элементам. Эту работу берет на себя система.</p>
<p>Но разработчик может через палитру свойств изменить свойства элемента, которые повлияют на его отображение в форме.
	Он может также изменить структуру элементов формы – создать новое поле, группу полей, добавить табличную часть,
	связав эти элементы с данными формы. </p>
<p>Но пока нам ничего этого не нужно делать. Нас интересуют три элемента табличной части: МатериалыКоличество,
	МатериалыЦена и МатериалыСумма (см. рис. 4.20).</p>
<p>Мы хотим, чтобы каждый раз, когда меняется значение в поле Количество или в поле Цена, в поле Сумма автоматически
	устанавливалось значение, равное произведению значений полей Количество и Цена. </p>
<p>Очевидно, что для этого нужно написать на встроенном языке команду, похожую на Сумма = Количество*Цена, которая будет
	выполняться при изменении значения поля Количество или Цена. Но как «поймать» эти моменты изменения?</p>
<p>Обработчик события</p>
<p>Как мы уже видели, система сама умеет работать с теми объектами, которые описаны в дереве конфигурации: показывать их
	данные, добавлять новые элементы и пр. То есть у нее есть некие «стандартные представления» о том, как это все
	должно работать. </p>
<p>Но, как правило, разработчиков эти «стандартные представления» устраивают только в самых простых случаях. Реальные
	задачи гораздо разнообразнее. Поэтому у системы существуют <em>события</em>, которые связаны с самыми различными
	моментами ее «стандартного» функционирования. В том числе события, связанные с функционированием форм и элементов,
	расположенных в этих формах. </p>
<p>Используя встроенный язык, разработчик может «вклиниться» в эти события и описать собственный алгоритм того, что
	должно происходить при наступлении этого события. Что мы сейчас и сделаем.</p>
<p>Дважды щелкнем на элементе формы МатериалыКоличество или правой кнопкой мыши откроем для него палитру свойств (пункт
	контекстного меню Свойства). </p>
<p>Прокрутив список до конца, мы увидим перечень событий, которые могут быть связаны с этим полем. </p>
<p>Очевидно, что нам нужно событие ПриИзменении, которое возникает после изменения значения поля. Найдем его в списке
	событий и нажмем кнопку открытия <img src="9.jpeg"/> со значком лупы в поле ввода (рис. 4.21).</p>
<p>Система предложит окно для выбора типа обработчика события, который мы хотим создать (рис. 4.22).</p>
<p>Оставим без изменения вариант Создать на клиенте, предложенный по умолчанию. Пока мы не будем более подробно
	рассматривать этот момент.</p>
<p>поля табличной части «Количество»</p>
<p><strong>Рис. 4.22.</strong> Окно для выбора типа создаваемого обработчика события</p>
<p>После этого система создаст шаблон процедуры <em>обработчика</em> этого события в модуле<em> </em>нашей формы и
	откроет закладку Модуль редактора формы (рис. 4.23).</p>
<p><em>Модуль</em> – это «хранилище» для текста программы на встроенном языке. Модулей существует несколько, и каждый из
	них предназначен для описания алгоритмов, относящихся к тому или иному моменту работы программы. В данном случае это
	модуль формы, так как обработчики всех интерактивных событий, связанных с элементами формы, помещаются именно в
	модуль формы.</p>
<p><strong>Рис. 4.23.</strong> Шаблон обработчика события «ПриИзменении» поля табличной части «Количество»</p>
<p>В модуль формы, в процедуру МатериалыКоличествоПриИзменении() мы и добавим следующий текст (листинг 4.1).</p>
<p><strong>листинг 4.1.</strong> Процедура «МатериалыКоличествоПриИзменении()»</p>
<table>
	<tr>
		<td><p>СтрокаТабличнойЧасти = Элементы.Материалы.ТекущиеДанные;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>СтрокаТабличнойЧасти.Сумма = СтрокаТабличнойЧасти.Количество * СтрокаТабличнойЧасти.Цена;</p></td>
	</tr>
</table>
<p>Объясним назначение этих строк. </p>
<p>В первой строке мы сначала создаем переменную СтрокаТабличнойЧасти, в которую будет помещен объект, содержащий
	данные, находящиеся в строке табличной части, которую нам нужно пересчитать. </p>
<p>Мягкая типизация данных встроенного языка позволяет сделать это, не объявляя переменную и ее тип заранее. Мы создаем
	переменную прямо по ходу работы, и ее тип определяется типом значения, которое она содержит.</p>
<p>Поскольку мы находимся в модуле формы, то в нем доступны все свойства и методы объекта встроенного языка
	УправляемаяФорма. Поэтому мы можем обращаться к ним напрямую. В данном случае после знака равенства мы обращаемся к
	коллекции элементов формы, используя одно из свойств объекта УправляемаяФорма – свойство Элементы.</p>
<p>Коллекция элементов формы является объектом встроенного языка ВсеЭлементыФормы, содержащим все элементы формы. То
	есть это программный аналог корня дерева элементов формы. </p>
<p>Каждый элемент формы можно получить, указав его имя в качестве свойства этого объекта, то есть через точку от него. В
	данном случае мы обращаемся к табличной части документа Материалы (Элементы.Материалы).</p>
<p>Табличная часть документа представляет собой объект встроенного языка ТаблицаФормы. Получить ту строку, в которой в
	настоящее время осуществляется редактирование, можно при помощи свойства программного объекта ТаблицаФормы –
	ТекущиеДанные (Элементы.Материалы.ТекущиеДанные). </p>
<p>Таким образом, в результате выполнения первой строки процедуры обработчика переменная СтрокаТабличнойЧасти будет
	содержать объект ДанныеФормыСтруктура. Этот объект содержит данные, находящиеся в текущей строке табличной части
	документа (Элементы.Материалы.ТекущиеДанные).</p>
<p>Получив этот объект, мы можем обратиться к данным конкретной колонки табличной части, указав имя колонки в качестве
	свойства объекта. Например, используя обращение СтрокаТабличнойЧасти.Количество, мы получаем число, которое
	находится в редактируемой строке в колонке Количество. </p>
<p>Таким образом, во второй строке процедуры обработчика вычисляется значение колонки Сумма как произведение значений
	колонок Количество и Цена. </p>
<p><strong>В режиме «1С:Предприятие»</strong></p>
<p>Теперь посмотрим, как это работает. Запустим «1С:Предприятие» в режиме отладки, откроем список документов Приходные
	накладные и откроем любой из двух созданных нами документов. Если теперь вы поменяете количество в любой строке
	документа, то сумма в строке будет пересчитана автоматически.</p>
<p>Одна процедура для обработки нескольких событий</p>
<p>Итак, мы убедились, что при изменении количества в любой строке документа Приходная накладная сумма в этой строке
	пересчитывается автоматически. </p>
<p>Замечательно. Но теперь хотелось бы и для поля Цена сделать то же самое. А если заглянуть вперед, то мы увидим, что
	подобное автоматическое заполнение поля Сумма может нам понадобиться и в других документах. </p>
<p>Поэтому лучше будет поместить расчет суммы в некоторое «общедоступное» место, чтобы разные документы, имеющие
	аналогичные реквизиты табличной части, могли использовать этот алгоритм. </p>
<p>Для описания таких «общедоступных» мест служат объекты конфигурации <em>Общий модуль</em>, расположенные в ветке
	Общие  Общие модули. Процедуры и функции, содержащиеся в этих модулях, могут быть доступны для любых объектов
	конфигурации. </p>
<p>Поэтому создадим общий модуль и перенесем в него нашу процедуру расчета суммы. А в документе просто оставим вызовы
	этой процедуры из общего модуля.</p>
<p>В режиме «Конфигуратор»</p>
<p>Общий модуль</p>
<p>Добавим объект конфигурации Общий модуль. </p>
<p>Для этого раскроем ветвь Общие в дереве объектов конфигурации, нажав на + слева от нее. Затем выделим ветвь Общие
	модули и нажмем кнопку Добавить в командной панели окна конфигурации (рис. 4.24).</p>
<p>Откроется окно для ввода текста модуля и окно палитры его свойств. Дадим имя модулю – РаботаСДокументами и установим
	в его свойствах флажок Клиент (управляемое приложение), а флажок Сервер снимем. Это означает, что экземпляры этого
	модуля будут скомпилированы в контексте тонкого клиента и в контексте веб-клиента (рис. 4.25).</p>
<p>Внесем в модуль следующий текст (листинг 4.2).</p>
<p><strong>листинг 4.2.</strong> Процедура «РассчитатьСумму()»</p>
<table>
	<tr>
		<td><p>Процедура РассчитатьСумму(СтрокаТабличнойЧасти) Экспорт</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>СтрокаТабличнойЧасти.Сумма = </p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>СтрокаТабличнойЧасти.Количество * СтрокаТабличнойЧасти.Цена; </p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецПроцедуры </p></td>
	</tr>
</table>
<p>Прокомментируем этот код. В процедуру РассчитатьСумму() мы передаем переменную СтрокаТабличнойЧасти, которую мы
	определили в обработчике события ПриИзменении поля Количество. Она содержит данные редактируемой строки табличной
	части документа ПриходнаяНакладная. </p>
<p>Теперь, используя эту переменную, мы можем получить доступ к данным колонок табличной части и рассчитать сумму как
	произведение цены на количество. </p>
<p>Ключевое слово Экспорт в заголовке процедуры указывает на то, что эта процедура может быть доступна из других
	программных модулей. </p>
<p>Теперь в модуле нашей формы изменим текст обработчика МатериалыКоличествоПриИзменении (листинг 4.3).</p>
<p><strong>листинг 4.3.</strong> Процедура «МатериалыКоличествоПриИзменении()»</p>
<table>
	<tr>
		<td><p>&amp;НаКлиенте</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Процедура МатериалыКоличествоПриИзменении(Элемент)</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>СтрокаТабличнойЧасти = Элементы.Материалы.ТекущиеДанные;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>РаботаСДокументами.РассчитатьСумму(СтрокаТабличнойЧасти);</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецПроцедуры</p></td>
	</tr>
</table>
<p>Мы видим, что первая строка процедуры осталась без изменений. А во второй строке вместо непосредственного расчета
	суммы мы вызываем процедуру РассчитатьСумму() из общего модуля РаботаСДокументами и передаем ей в качестве параметра
	текущую строку табличной части.</p>
<p>Проверим, как это работает, и убедимся, что ничего не изменилось.</p>
<p>Теперь осталось и для поля Цена установить такой же обработчик. Так как однажды мы уже написали в модуле формы нужную
	нам процедуру, то мы просто могли бы сопоставить ее также и другому событию другого элемента управления,
	расположенного в форме. Однако стандарты разработки конфигураций фирмы «1С» не допускают такого решения.</p>
<p><strong>УзнАй больше!</strong></p>
<p><em>Согласно стандартам разработки фирмы «1С» у каждого события должен быть свой обработчик. Если одинаковые действия
	должны выполняться при изменении разных элементов управления (например, при нажатии нескольких кнопок), то в этом
	случае следует поступать следующим образом: </em></p>
<ul>
	<li><em>создается отдельная процедура (функция), выполняющая необходимые действия;</em></li>
	<li><em>для каждого элемента управления создается отдельный обработчик с именем, назначаемым по умолчанию;</em></li>
	<li><em>из каждого обработчика вызывается требуемая процедура</em></li>
</ul>
<p><em>(функция).</em></p>
<p>Поэтому мы создадим обработчик события ПриИзменении для поля табличной части МатериалыЦена так же, как мы делали это
	для поля МатериалыКоличество, и повторим в нем вызов процедуры РассчитатьСумму из общего модуля (листинг 4.4).</p>
<p><strong>листинг 4.4.</strong> Процедура «МатериалыЦенаПриИзменении()»</p>
<p>&amp;НаКлиенте</p>
<table>
	<tr>
		<td><p>Процедура МатериалыЦенаПриИзменении(Элемент)</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>СтрокаТабличнойЧасти = Элементы.Материалы.ТекущиеДанные;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>РаботаСДокументами.РассчитатьСумму(СтрокаТабличнойЧасти);</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецПроцедуры</p></td>
	</tr>
</table>
<p><strong>В режиме «1С:Предприятие»</strong></p>
<p>Запустим «1С:Предприятие» в режиме отладки и убедимся, что теперь сумма в строках табличной части документов
	ПриходнаяНакладная пересчитывается как при изменении количества, так и при изменении цены.</p>
<p>Документ «Оказание услуги»</p>
<p>Теперь мы аналогичным образом создадим второй документ, необходимый нам, – Оказание услуги. Для этого потребуется
	выполнить уже знакомые нам действия, которые мы выполняли по созданию документа Приходная накладная.</p>
<p>В режиме «Конфигуратор»</p>
<p>Добавим новый объект конфигурации Документ и назовем его ОказаниеУслуги. </p>
<p>На закладке Основные определим, как будет представлен документ в интерфейсе «1С:Предприятия». </p>
<p>Представление объекта задавать не будем, вместо него будет использоваться Синоним объекта. </p>
<p>Представление списка зададим как Оказание услуг. На закладке Подсистемы отметим, что документ будет доступен в
	подсистемах Оказание услуг и Бухгалтерия. На закладке Данные создадим реквизиты документа:</p>
<ul>
	<li>Склад, тип СправочникСсылка.Склады. Выберем для свойства Значение заполнения предопределенный элемент Основной
		справочника Склады;
	</li>
	<li>Клиент, тип СправочникСсылка.Клиенты. Установим свойство Проверка заполнения в значение Выдавать ошибку;</li>
	<li>Мастер, тип СправочникСсылка.Сотрудники. Установим свойство Проверка заполнения в значение Выдавать ошибку.</li>
</ul>
<p>Создадим табличную часть этого документа ПереченьНоменклатуры с реквизитами:</p>
<ul>
	<li>Номенклатура, тип СправочникСсылка.Номенклатура;</li>
	<li>Количество, тип Число, длина 15, точность 3, неотрицательное;</li>
	<li>Цена, тип Число, длина 15, точность 2, неотрицательное,</li>
	<li>Сумма, тип Число, длина 15, точность 2, неотрицательное.</li>
</ul>
<p>Установим для табличной части в целом и для каждого ее реквизита свойство Проверка заполнения в значение Выдавать
	ошибку.</p>
<p>На закладке Формы создадим основную форму документа. </p>
<p>Для поля ПереченьНоменклатурыКоличество создадим обработчик события ПриИзменении (выполняющийся на клиенте), в
	котором будем вызывать процедуру РассчитатьСумму из общего модуля РаботаСДокументами. </p>
<p>При этом откроется модуль формы с шаблоном обработчика события ПереченьНоменклатурыКоличествоПриИзменении, который мы
	пока заполнять не будем, а перейдем в окно элементов формы на закладку </p>
<p>Форма и аналогичным образом создадим обработчик события ПереченьНоменклатурыЦенаПриИзменении для поля
	ПереченьНоменклатурыЦена.</p>
<p>Далее модуль формы документа ОказаниеУслуги нужно заполнить следующим образом (листинг 4.5).</p>
<p><strong>листинг 4.5.</strong> Модуль формы документа «ОказаниеУслуги» </p>
<table>
	<tr>
		<td><p>&amp;НаКлиенте</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Процедура ПереченьНоменклатурыКоличествоПриИзменении(Элемент)</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>СтрокаТабличнойЧасти = Элементы.ПереченьНоменклатуры.ТекущиеДанные;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>РаботаСДокументами.РассчитатьСумму(СтрокаТабличнойЧасти);</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецПроцедуры</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>&amp;НаКлиенте</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Процедура ПереченьНоменклатурыЦенаПриИзменении(Элемент)</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>СтрокаТабличнойЧасти = Элементы.ПереченьНоменклатуры.ТекущиеДанные;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>РаботаСДокументами.РассчитатьСумму(СтрокаТабличнойЧасти);</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецПроцедуры </p></td>
	</tr>
</table>
<p>В заключение отредактируем командный интерфейс, чтобы в разделе Оказание услуг была доступна команда создания новых
	документов. </p>
<p>Для этого откроем окно редактирования объекта конфигурации Подсистема ОказаниеУслуг и нажмем кнопку Командный
	интерфейс. </p>
<p>В открывшемся окне отразятся все команды данной подсистемы. </p>
<p>В группе Панель действий.Создать включим видимость у команды Оказание услуги: создать (рис. 4.26).</p>
<p>lдействий будет </p>
<p>В режиме «1С:Предприятие»</p>
<p>Запустим «1С:Предприятие» в режиме отладки. </p>
<p>В разделе Оказание услуг выполним команду создания документа Оказание услуги из подменю Создать и заполним его
	следующим образом (рис. 4.28).</p>
<p><strong>Рис. 4.28.</strong> Создание документа «Оказание услуги № 1»</p>
<p>Обратите внимание, что склад Основной подставляется по умолчанию, а для полей Мастер и Клиент выполняется проверка
	заполнения. А также при вводе цены и количества в табличную часть документа Оказание услуги сумма пересчитывается по
	нашему алгоритму.</p>
<h1><a id="_Toc454870653"></a>Лабораторная работа № 8 Расчеты с поставщиками</h1>
<p><strong>Порядок выполнения работы </strong></p>
<p>1. Ознакомьтесь с теоретическими основами в настоящих указаниях и конспектах лекций. </p>
<p>2. Получите задание у преподавателя. </p>
<p>3. Сделайте скриншоты (кнопка клавиатуры PrtSc) выполненных заданий в текстовом (Word) файле <em>Фамилия_ЛР</em></p>
<p>4. Составьте отчет по лабораторной работе. </p>
<p>5. Отчитайте работу преподавателю.</p>
<p><strong>Добавление регистра накопления</strong></p>
<p>Теперь, когда мы знаем, для чего предназначены регистры накопления, посмотрим, как можно их использовать в нашем
	примере. </p>
<p>Прежде всего, нас интересует информация о том, сколько и каких материалов есть у нас на складах. Для накопления такой
	информации мы создадим регистр ОстаткиМатериалов.</p>
<p>В режиме «Конфигуратор»</p>
<p>Откроем в конфигураторе нашу учебную конфигурацию и добавим новый объект конфигурации Регистр накопления. </p>
<p>Для этого выделим в дереве объектов конфигурации ветвь Регистры накопления и нажмем кнопку Добавить в командной
	панели окна конфигурации.</p>
<p>В открывшемся окне редактирования объекта конфигурации на закладке Основные зададим имя регистра –
	ОстаткиМатериалов. </p>
<p>Также зададим и Расширенное представление списка как Движения по регистру Остатки материалов. Этот заголовок будет
	отображаться в окне списка записей регистра. </p>
<p>Нажмем Далее и перейдем на закладку Подсистемы. </p>
<p>По логике нашей конфигурации данный регистр должен быть доступен в разделах Учет материалов, Оказание услуг и
	Бухгалтерия. Поэтому отметим в списке подсистем эти подсистемы (рис. 6.3).</p>
<p><strong>Рис. 6.3.</strong> Определение списка подсистем, в которых будет отражаться регистр</p>
<p>Выделим закладку Данные и перейдем к созданию структуры регистра. Создадим измерения регистра:</p>
<p> Материал, тип СправочникСсылка.Номенклатура;  Склад, тип СправочникСсылка.Склады.</p>
<p>Для этого выделим ветвь Измерения и нажмем кнопку Добавить в командной панели окна (рис. 6.4).</p>
<p>Затем создадим ресурс Количество с длиной 15 и точностью 3. Для этого выделим ветвь Ресурсы и нажмем кнопку Добавить
	в командной панели окна (рис. 6.5).</p>
<p><strong>Рис. 6.5.</strong> Создание ресурсов регистра</p>
<p>В результате этих действий регистр ОстаткиМатериалов должен иметь следующий вид (рис. 6.6).</p>
<p><strong>Рис. 6.6.</strong> Регистр «ОстаткиМатериалов»</p>
<p>Если вы сейчас попытаетесь запустить «1С:Предприятие» в режиме отладки, то система выдаст сообщение об ошибке:
	«РегистрНакопления.ОстаткиМатериалов: Ни один из документов не является регистратором для регистра». Это сообщение
	еще раз подтверждает тот факт, что назначение регистра накопления в том, чтобы аккумулировать данные, поставляемые
	различными документами. </p>
<p>Поэтому мы сформируем движения регистра накопления ОстаткиМатериалов в процессе проведения двух созданных нами
	документов ПриходнаяНакладная и ОказаниеУслуг.</p>
<p>Движения документа</p>
<p><em>Движения документа</em> – это записи в регистрах, которые создаются в процессе проведения документа и отражают
	изменения, производимые документом. </p>
<p>Откроем окно редактирования объекта конфигурации Документ </p>
<p>ПриходнаяНакладная. Перейдем на закладку Движения, раскроем список Регистры накопления и отметим регистр
	накопления</p>
<p>ОстаткиМатериалов (рис. 6.7).</p>
<p>в регистре «ОстаткиМатериалов»</p>
<p>Обратите внимание, что сразу после отметки выбранного регистра становится доступной кнопка Конструктор движений.
	Нажмем ее и воспользуемся этим конструктором.</p>
<p>Конструктор устроен просто. В списке Регистры перечислены регистры, в которых документ может создавать движения. В
	нашем случае там пока один регистр ОстаткиМатериалов. </p>
<p>В списке Реквизиты документа должны находиться исходные данные для создания движений – реквизиты документа
	ПриходнаяНакладная. </p>
<p>А в таблице Поле – Выражение должны быть заданы формулы, по которым будут вычисляться значения измерений и ресурсов
	регистра при записи движений (рис. 6.8).</p>
<p>Обратите внимание, что по умолчанию конструктор предлагает нам создавать движения прихода (Тип движения регистра –
	Приход, символ + рядом с названием регистра) по регистру ОстаткиМатериалов. Это нас вполне устраивает, ведь документ
	ПриходнаяНакладная и должен приходовать материалы. </p>
<p><img src="10.jpeg"/></p>
<p><strong>Рис. 6.8.</strong> Конструктор движений</p>
<p>В поле выбора Табличная часть выберем табличную часть нашего документа – Материалы. </p>
<p>Список реквизитов документа, который уже заполнен реквизитами шапки документа, автоматически дополнится реквизитами
	нашей табличной части. </p>
<p>Теперь нажмем кнопку Заполнить выражения. </p>
<p>В нижнем окне сформируется соответствие полей (измерений и ресурсов) регистра и выражений для их расчета (рис.
	6.9).</p>
<p>Как видите, конструктор движений установил соответствия подходящим образом: в качестве материала в регистр будет
	записан материал из табличной части документа, в качестве склада – склад, указанный в шапке документа, а в качестве
	количества – количество из табличной части документа.</p>
<p>Нажмем кнопку OK и посмотрим, какой текст сформировал конструктор в модуле документа ПриходнаяНакладная (листинг
	6.1).</p>
<p>для расчета движений регистра</p>
<p><strong>листинг 6.1.</strong> Процедура «ОбработкаПроведения()»</p>
<table>
	<tr>
		<td><p>Процедура ОбработкаПроведения(Отказ, Режим)</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>//{{__КОНСТРУКТОР_ДВИЖЕНИЙ_РЕГИСТРОВ</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// Данный фрагмент построен конструктором.</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// При повторном использовании конструктора внесенные вручную изменения будут утеряны!!!</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// регистр ОстаткиМатериалов Приход</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движения.ОстаткиМатериалов.Записывать = Истина;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Для Каждого ТекСтрокаМатериалы Из Материалы Цикл</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение = Движения.ОстаткиМатериалов.Добавить();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.ВидДвижения = ВидДвиженияНакопления.Приход;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.Период = Дата;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.Материал = ТекСтрокаМатериалы.Материал;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.Склад = Склад;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.Количество = ТекСтрокаМатериалы.Количество;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецЦикла;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>//}}__КОНСТРУКТОР_ДВИЖЕНИЙ_РЕГИСТРОВ</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецПроцедуры</p></td>
	</tr>
</table>
<p>Конструктор создал обработчик события ОбработкаПроведения объекта конфигурации Документ ПриходнаяНакладная, поместил
	его в модуль объекта и открыл текст модуля. </p>
<p>Событие ОбработкаПроведения является одним из важнейших событий, связанных с документом. Это событие возникает при
	проведении документа. Основное назначение обработчика данного события – генерация движений по документу. Выполнение
	различных операций с данными в процедуре обработчика влияет на состояние учета. Таким образом, именно в эту
	процедуру разработчик должен поместить собственные алгоритмы преобразования данных, выполняемые в момент проведения
	документа.</p>
<p>Поясним текст процедуры обработчика.</p>
<p>Объект встроенного языка ДокументОбъект имеет свойство Движения. Оно возвращает объект КоллекцияДвижений, содержащий
	коллекцию наборов записей регистров, по которым этот документ может формировать движения. </p>
<p>К конкретному набору записей этой коллекции можно обратиться, указав через точку имя регистра, которому принадлежит
	этот набор записей. Например, Движения.ОстаткиМатериалов. </p>
<p>Затем через точку можно использовать различные методы набора записей регистра, например,
	Движения.ОстаткиМатериалов.Добавить(). Метод Добавить() добавляет новую запись в набор записей.</p>
<p>В первой строке процедуры мы устанавливаем свойство Записывать набора записей регистра в значение Истина. То есть в
	явном виде указываем, что после завершения обработки проведения платформа должна будет записать этот набор записей в
	базу данных.</p>
<p>Внутри обработчика расположен цикл Для Каждого … Из … Цикл. Он предназначен для перебора строк табличной части нашего
	документа. </p>
<p>В цикле обращение к табличной части документа происходит по имени (Материалы). Переменная ТекСтрокаМатериалы содержит
	объект с данными текущей строки табличной части документа. Эта переменная создается в начале цикла и меняется по
	мере его прохождения. </p>
<p>В первой строке тела цикла, используя метод Добавить(), мы добавляем к набору записей, который создает наш документ в
	регистре, новую запись. Тем самым мы создаем объект РегистрНакопленияЗапись и сохраняем его в переменной
	Движение. </p>
<p>Используя этот объект, мы можем обратиться к полям этой записи, указав имя поля через точку от этой переменной
	(например, Движение.Количество). </p>
<p>Причем Движение.Материал, Движение.Склад – это измерения регистра, Движение.Количество – это ресурс регистра, а
	Движение.ВидДвижения и Движение.Период – стандартные реквизиты регистра, которые создаются автоматически.</p>
<p>Чтобы присвоить полям новой записи регистра соответствующие значения полей документа, мы обращаемся к полям табличной
	части, указав имя поля через точку от переменной ТекСтрокаМатериалы (например, ТекСтрокаМатериалы.Материал). </p>
<p>Заметим, что Склад – это реквизит шапки документа, а Дата – стандартный реквизит документа, который создается
	автоматически. Причем в цикле меняются только значения полей табличной части документа – ТекСтрокаМатериалы.Материал
	и ТекСтрокаМатериалы.Количество. Остальные поля не меняются, так как относятся к документу в целом и не зависят от
	текущей строки табличной части документа. </p>
<p>ВидДвиженияНакопления.Приход – это значение системного перечисления, которое определяет вид движения регистра
	накопления как Приход.</p>
<p>Таким образом, мы присваиваем нужные значения всем полям новой записи. После перебора всех строк документа (после
	завершения цикла) в этом наборе записей (Движения.ОстаткиМатериалов) будет содержаться столько записей, сколько
	строк в табличной части проводимого документа. </p>
<p>Если мы теперь откроем окно редактирования объекта конфигурации Регистр накопления ОстаткиМатериалов и перейдем на
	закладку Регистраторы, то в списке документов, созданных в конфигурации, мы увидим отмеченный документ
	ПриходнаяНакладная, так как мы задали в модуле этого документа формирование движений в регистре ОстаткиМатериалов
	(рис. 6.10).</p>
<p>В заключение отредактируем командный интерфейс, чтобы в разделах Бухгалтерия, Оказание услуг и Учет материалов была
	доступна ссылка для просмотра записей нашего регистра накопления. </p>
<p>Дело в том, что команды открытия регистров также добавляются в панель команд разделов, но по умолчанию они невидимы,
	в отличие от команд открытия справочников и документов. </p>
<p>В дереве объектов конфигурации выделим ветвь Подсистемы, вызовем ее контекстное меню и выберем пункт Все подсистемы.
	В открывшемся окне слева в списке Подсистемы выделим подсистему УчетМатериалов. Справа в списке Командный интерфейс
	отразятся все команды выбранной подсистемы. </p>
<p>В группе Панель навигации.Обычное включим видимость у команды </p>
<p>Остатки материалов и мышью перетащим ее в группу Панель </p>
<p><strong>Рис. 6.11.</strong> Настройка командного интерфейса подсистем</p>
<p>Тем самым мы переносим команды открытия списка регистров накопления в конец списка подобных команд раздела, так как
	эти команды не так часто используются и их приоритет невысок.</p>
<p>Аналогично, выделив подсистемы ОказаниеУслуг и Бухгалтерия, в группе Панель навигации.Обычное включим видимость у
	команды Остатки материалов и перенесем ее в группу Панель навигации См.также.</p>
<p>В режиме «1С:Предприятие»</p>
<p>Запустим «1С:Предприятие» в режиме отладки и протестируем внесенные нами изменения. </p>
<p>В открывшемся окне «1С:Предприятия» мы видим, что в панели команд разделов Бухгалтерия, Оказание услуг и Учет
	материалов в конце списка команд для открытия различных списков, перед подменю Создать, Отчеты (если они есть)
	появилась команда для открытия списка регистра Остатки материалов (рис. 6.12).</p>
<p><strong>Рис. 6.12.</strong> Список регистра накопления «ОстаткиМатериалов»</p>
<p>Чтобы проследить связь между проведением документа и накоплением информации в регистре, откроем список приходных
	накладных, выполнив команду Приходные накладные в разделе Учет материалов. </p>
<p>Откроем Приходную накладную № 1 и нажмем Провести и закрыть, то есть перепроведем ее. То же самое сделаем для
	Приходной накладной № 2. </p>
<p>Перепровести документы можно и не открывая документов. Для этого следует выделить нужный документ в списке (или
	выделить мышью группу документов, удерживая клавишу Ctrl), раскрыть подменю Еще в командной панели формы списка и
	выбрать пункт Провести (рис. 6.13).</p>
<p>Теперь выполним команду Остатки материалов и откроем список нашего регистра накопления (рис. 6.14). </p>
<p>Мы видим, что при проведении приходных накладных появляются соответствующие записи в регистре накопления Остатки
	материалов. Обратите внимание, что добавилось пять записей – первые три после проведения первого документа, что
	соответствует количеству строк в его табличной части, и последние две после проведения второго документа. </p>
<p>Все поля регистра заполнились данными документов так, как мы задали в обработчике проведения документа
	ПриходнаяНакладная. Пиктограмма со знаком + слева от каждой записи указывает на тип движения – Приход. </p>
<p><strong>Рис. 6.14.</strong> Список регистра накопления «ОстаткиМатериалов»</p>
<p>Как мы видим, заголовок формы списка записей регистра соответствует заданному нами в свойстве Расширенное
	представление списка для этого регистра.</p>
<p><strong>Команда перехода к движениям в форме документа</strong></p>
<p>В режиме «Конфигуратор»</p>
<p>При реальной работе записей в регистре ОстаткиМатериалов будет много, и будет трудно понять, какие записи относятся к
	определенному документу. </p>
<p>Поэтому наряду с общим списком регистра хотелось бы иметь возможность вызывать из формы документа список регистра, в
	котором показаны движения, произведенные только этим документом. </p>
<p>Чтобы реализовать такую возможность, вернемся в конфигуратор и откроем форму документа ПриходнаяНакладная. </p>
<p>В левом верхнем окне перейдем на закладку Командный интерфейс. </p>
<p>В разделе Панель навигации раскроем группу Перейти и увидим команду для открытия списка регистра накопления Остатки
	материалов. Эта команда была автоматически помещена в панель навигации формы документа, так как он является
	регистратором, то есть создает движения в нашем регистре. </p>
<p>Установим свойство Видимость для этой команды (рис. 6.15).</p>
<p>В режиме «1С:Предприятие»</p>
<p>Запустим «1С:Предприятие» в режиме отладки и откроем Приходную накладную № 2 (рис. 6.16). </p>
<p><strong>Рис. 6.16.</strong> Панель навигации формы документа «Приходная накладная»</p>
<p>Под заголовком формы документа появилась панель навигации, в которой мы можем переходить к списку записей регистра
	Остатки Материалов, связанному с документом (рис. 6.17), и обратно к содержимому документа (ссылка Главное).</p>
<p><img src="11.png"/></p>
<p><strong>Рис. 6.17.</strong> Переход к регистру накопления из формы документа</p>
<p>Обратите внимание, что до этого панель навигации в форме приходной накладной была не видна, так как в ней не было
	отображено ни одной команды.</p>
<p><strong>Движения документа «Оказание услуги»</strong></p>
<p>Теперь мы аналогичным образом создадим движения документа ОказаниеУслуги. Для этого потребуется выполнить уже
	знакомые нам действия.</p>
<p>В режиме «Конфигуратор»</p>
<p>Откроем окно редактирования объекта конфигурации Документ ОказаниеУслуги. </p>
<p>Перейдем на закладку Движения и в списке регистров конфигурации отметим регистр накопления ОстаткиМатериалов. </p>
<p>Нажмем кнопку Конструктор движений.</p>
<p>В открывшемся окне конструктора изменим тип движения регистра на Расход, так как документ ОказаниеУслуги должен
	расходовать материалы. Пиктограмма слева от названия регистра изменится на знак –. В поле выбора Табличная часть
	выберем табличную часть нашего документа – ПереченьНоменклатуры. </p>
<p>Список реквизитов документа, который уже заполнен реквизитами шапки документа, автоматически дополнится реквизитами
	нашей табличной части. </p>
<p>Теперь нажмем кнопку Заполнить выражения. </p>
<p>В нижнем окне сформируется соответствие полей (измерений и ресурсов) регистра и выражений для их расчета. Однако при
	автоматическом заполнении поле Материал не заполнится. </p>
<p>Так происходит потому, что имя поля табличной части Номенклатура не совпадает с именем измерения регистра – Материал.
	Если мы оставим это так, как есть, то в регистре накопления в строках с типом Движение регистра – расход
	номенклатура фиксироваться не будет. </p>
<p>Чтобы избежать этого, нужно выделить поле регистра Материал и в окне Реквизиты документа дважды щелкнуть по строке
	ТекСтро- каПереченьНоменклатуры.Номенклатура. </p>
<p>Таким образом, номенклатура для движений регистра накопления будет выбираться из табличной части документа (рис.
	6.18).</p>
<p>для расчета движений регистра</p>
<p>Нажмем кнопку OK. </p>
<p>Конструктор создал обработчик события ОбработкаПроведения объекта конфигурации Документ ОказаниеУслуги и поместил его
	в модуль объекта (листинг 6.2).</p>
<p><strong>листинг 6.2.</strong> Процедура «ОбработкаПроведения()»</p>
<table>
	<tr>
		<td><p>Процедура ОбработкаПроведения(Отказ, Режим)</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>//{{__КОНСТРУКТОР_ДВИЖЕНИЙ_РЕГИСТРОВ</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// Данный фрагмент построен конструктором.</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// При повторном использовании конструктора внесенные вручную изменения будут утеряны!!!</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// регистр ОстаткиМатериалов Расход</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движения.ОстаткиМатериалов.Записывать = Истина;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Для Каждого ТекСтрокаПереченьНоменклатуры Из ПереченьНоменклатуры Цикл</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение = Движения.ОстаткиМатериалов.Добавить();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.ВидДвижения = ВидДвиженияНакопления.Расход;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.Период = Дата;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.Материал = ТекСтрокаПереченьНоменклатуры.Номенклатура;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.Склад = Склад;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.Количество = ТекСтрокаПереченьНоменклатуры.Количество;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецЦикла;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>//}}__КОНСТРУКТОР_ДВИЖЕНИЙ_РЕГИСТРОВ</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецПроцедуры</p></td>
	</tr>
</table>
<p>Обратите внимание, что строка Движение.ВидДвижения = ВидДвиженияНакопления.Расход определяет вид движения регистра
	накопления, производимый этим документом как Расход, а в остальном процедура обработчика ОбработкаПроведения
	документа ОказаниеУслуги идентична обработчику документа ПриходнаяНакладная (см. листинг 6.1), подробно разобранному
	нами ранее.</p>
<p>В заключение отредактируем командный интерфейс формы документа, чтобы в панели навигации формы иметь возможность
	переходить к списку записей регистра Остатки Материалов, связанному с документом. </p>
<p>Для этого откроем форму документа ОказаниеУслуги. В левом верхнем окне перейдем на закладку Командный интерфейс. </p>
<p>В разделе Панель навигации раскроем группу Перейти и установим видимость для команды открытия регистра накопления
	Остатки материалов. </p>
<p>В режиме «1С:Предприятие»</p>
<p>Запустим «1С:Предприятие» в режиме отладки. В разделе Оказание услуг откроем документ Оказание услуги № 1 и нажмем
	Провести и закрыть, то есть перепроведем его. </p>
<p>Теперь выполним команду Остатки материалов и откроем список нашего регистра накопления (рис. 6.19).</p>
<p><strong>Рис. 6.19.</strong> Список регистра накопления «ОстаткиМатериалов»</p>
<p>Мы видим, что в регистре накопления Остатки материалов появилась еще одна запись, что соответствует количеству строк
	в табличной части проведенного документа. </p>
<p>Все поля регистра заполнились данными документа так, как мы задали в обработчике проведения документа Оказание
	услуги. </p>
<p>Пиктограмма со знаком минус слева от записи указывает на тип движения – Расход (см. рис. 6.19).</p>
<p>Сейчас мы видим весь список движений регистра. Открыв этот список из формы документа, мы можем отфильтровать движения
	по документу-регистратору. </p>
<p>Для этого откроем еще раз документ Оказание услуги № 1. </p>
<p>В форме документа появилась панель навигации, в которой мы можем переходить к списку записей регистра Остатки
	материалов, связанному с документом, и обратно к содержимому документа (рис. 6.20).</p>
<p><strong>Рис. 6.20.</strong> Переход к регистру накопления из формы документа</p>
<p>Однако сформированные таким образом движения этого документа будут не совсем правильны. </p>
<p>Дело в том, что в документе Оказание услуги, в отличие от документа Приходная накладная, могут содержаться не только
	расходуемые материалы, но и услуги. Поэтому в регистр Остатки материалов будут попадать записи и о расходуемых
	услугах, что неправильно. </p>
<p>Пока мы ничего не будем делать с движениями, которые сформировал конструктор, но как только познакомимся с
	перечислениями, мы внесем в обработчик проведения необходимые изменения.</p>
<h1><a id="_Toc454870654"></a>Лабораторная работа № 9Поступление и учет ОС</h1>
<p><strong>Порядок выполнения работы </strong></p>
<p>1. Ознакомьтесь с теоретическими основами в настоящих указаниях и конспектах лекций. </p>
<p>2. Получите задание у преподавателя. </p>
<p>3. Сделайте скриншоты (кнопка клавиатуры PrtSc) выполненных заданий в текстовом (Word) файле <em>Фамилия_ЛР</em></p>
<p>4. Составьте отчет по лабораторной работе. </p>
<p>5. Отчитайте работу преподавателю.</p>
<p><strong>Добавление отчета</strong></p>
<p>В режиме «Конфигуратор»</p>
<p>Теперь у нас все готово для того, чтобы можно было получать выходные данные. Поэтому приступим к созданию отчета,
	который будет показывать нам приход, расход и остатки материалов (рис. 7.1).</p>
<p><strong>Рис. 7.1.</strong> Результат отчета</p>
<p>На этом примере мы покажем, как быстро и легко разработать отчет с использованием только визуальных средств
	разработки «без единой строчки кода».</p>
<p>Откроем в конфигураторе нашу учебную конфигурацию и добавим новый объект конфигурации Отчет. </p>
<p>Для этого выделим в дереве объектов конфигурации ветвь Отчеты и нажмем кнопку Добавить в командной панели окна
	конфигурации </p>
<p>(рис. 7.2).</p>
<p>В открывшемся окне редактирования объекта конфигурации на закладке Основные зададим имя отчета – Материалы. </p>
<p>Больше никаких свойств, определяющих представление объекта в интерфейсе приложения, задавать не будем. Вместо них
	будет использоваться Синоним объекта, который создается автоматически на основании имени объекта.</p>
<p>Создадим основу для построения любого отчета – <em>схему компоновки данных</em>. Для этого нажмем кнопку Открыть
	схему компоновки данных или кнопку открытия <img src="12.jpeg"/> со значком лупы (рис. 7.3).</p>
<p>Макет</p>
<p>Так как у отчета, который мы создаем, еще не существует схемы компоновки данных, платформа предложит создать новую
	схему. Схема компоновки данных с точки зрения конфигурации является макетом, поэтому будет открыт конструктор
	макета, предлагающий выбрать единст- венный тип макета – Схема компоновки данных </p>
<p>(рис. 7.4).</p>
<p><strong>Рис. 7.4.</strong> Создание схемы компоновки данных отчета</p>
<p>Нажмем кнопку Готово. </p>
<p>Схема компоновки данных</p>
<p>Платформа создаст новый макет, содержащий схему компоновки данных, и сразу же откроет конструктор схемы компоновки
	данных. </p>
<p>Конструктор обладает большим количеством возможностей для визуального проектирования отчетов, но мы сейчас
	воспользуемся только самыми простыми его возможностями и определим те данные, которые хотим видеть в результате
	работы нашего отчета. </p>
<p>Набор данных</p>
<p>Добавим новый набор данных – запрос. Для этого нажмем кнопку Добавить или вызовем контекстное меню ветки Наборы
	данных </p>
<p>(рис. 7.5).</p>
<p><strong>Рис. 7.5.</strong> Добавление набора данных в конструкторе схемы компоновки</p>
<p>Текст запроса</p>
<p>Для того чтобы создать текст запроса, запустим конструктор запроса – нажмем кнопку Конструктор запроса (рис.
	7.6).</p>
<p><em>Конструктор запроса</em> – инструмент, созданный для помощи разработчику, позволяющий визуально конструировать
	запрос. Даже пользователь, не знакомый с языком запросов, может с помощью конструктора создать синтаксически
	правильный запрос. </p>
<p>В окне конструктора запроса, в списке База данных представлены таблицы для создания запроса. На основе их данных мы
	имеем возможность построить отчет. </p>
<p>Если раскрыть ветку РегистрыНакопления, то мы увидим, что кроме таблицы регистра ОстаткиМатериалов в этой ветке
	присутствуют еще несколько <em>виртуальных таблиц</em>, которые формирует система </p>
<p>(рис. 7.7).</p>
<p>Эти виртуальные таблицы, создаваемые платформой для регистров, и используются в основном для построения различных
	отчетов. Поскольку мы хотим видеть как остатки материалов, так и информацию об их поступлении и расходовании, нас
	будет интересовать виртуальная таблица ОстаткиМатериалов.ОстаткиИОбороты. Перетащим мышью эту таблицу в список
	Таблицы и раскроем ее структуру </p>
<p>(рис. 7.8).</p>
<p><strong>Рис. 7.8.</strong> Таблица «ОстаткиМатериалов.</p>
<p>ОстаткиИОбороты»</p>
<p>Как вы видите, эта таблица содержит измерения регистра ОстаткиМатериалов – Материал, Склад и кроме этого начальные и
	конечные остатки, а также значения прихода, расхода и оборотов для всех ресурсов регистра ОстаткиМатериалов. </p>
<p>Начнем выбирать поля таблицы в нужном нам порядке двойным щелчком мыши. </p>
<p>Сначала выберем Склад и Материал. Затем выберем КоличествоНачальныйОстаток, КоличествоПриход, КоличествоРасход. В
	заключение выберем КоличествоКонечныйОстаток. </p>
<p>В результате окно Поля должно быть заполнено следующим образом </p>
<p>(рис. 7.9).</p>
<p><strong>Рис. 7.9.</strong> Выбранные поля </p>
<p>Нажмем OK и вернемся в конструктор схемы компоновки данных </p>
<p>(рис. 7.10).</p>
<p><strong>Рис. 7.10.</strong> Конструктор схемы компоновки данных</p>
<p>Текст запроса, который был создан с помощью конструктора, платформа поместит в поле Запрос. </p>
<p>Это поле представляет собой текстовый редактор, в котором можно вручную отредактировать существующий запрос. Кроме
	того, можно снова вызвать конструктор запроса и отредактировать запрос при помощи него. </p>
<p>Для упрощения восприятия материала мы не будем здесь приводить листинг запроса и разбирать его. Более подробно этот
	вопрос будет рассмотрен в разделе о языке запросов на занятии «Отчеты. В данном случае, как и для многих других
	отчетов, можно не анализировать и не редактировать текст запроса.</p>
<p>Обратите внимание на список полей системы компоновки данных, который платформа заполнила в верхней части
	конструктора. В нем отображаются поля, которые доступны у текущего набора данных. В нашем случае система
	«1С:Предприятие» заполнила данный список автоматически, из текста запроса, и нет необходимости в его ручной
	настройке.</p>
<p>Итак, мы описали, каким образом будут извлекаться данные для отчета. Но пока мы не создадим стандартных настроек
	нашего отчета, мы ничего не увидим в результате. Поэтому создадим самые простые настройки отчета для отображения
	обычных детальных записей информационной базы. </p>
<p>В нашем случае это будут записи виртуальной таблицы регистра накопления ОстаткиМатериалов, выбранные в линейном
	порядке по мере попадания их в эту таблицу.</p>
<p>Настройки отчета</p>
<p>Перейдем на закладку Настройки. В верхнем правом окне будет находиться иерархическая структура нашего отчета. </p>
<p>Для добавления нового элемента выделим в дереве структуры отчета корневой элемент Отчет и вызовем его контекстное
	меню. Можно также нажать кнопку Добавить в командной панели окна или нажать клавишу Ins. </p>
<p>Добавим в отчет группировку (контекстное меню – Новая группировка). При этом не станем указывать поле группировки, а
	просто нажмем OK. </p>
<p>Тем самым мы определили, что в отчет будут выводиться <em>детальные</em> записи из информационной базы – записи,
	получаемые в результате выполнения запроса без итогов (рис. 7.11).</p>
<p><img src="13.jpeg"/></p>
<p><strong>Рис. 7.11.</strong> Добавление новой группировки в отчет</p>
<p>В структуре отчета появится группировка Детальные записи. </p>
<p>Теперь настроим поля, которые будут выводиться в результат отчета. </p>
<p>Для этого перейдем в нижнем окне настроек на закладку Выбранные поля и перенесем мышью из списка доступных полей:</p>
<ul>
	<li>Склад,</li>
	<li>Материал,</li>
	<li>КоличествоНачальныйОстаток,</li>
	<li>КоличествоПриход,</li>
	<li>КоличествоРасход,</li>
	<li>КоличествоКонечныйОстаток.</li>
</ul>
<p>В результате окно настроек отчета должно иметь вид (рис. 7.12).</p>
<p>Затем перейдем на закладку Параметры и укажем, что параметры отчета Дата начала и Дата окончания будут включены в
	состав пользовательских настроек, и эти настройки будут находиться непосредственно в форме отчета, то есть будут
	быстрыми настройками. </p>
<p>Сначала укажем, что оба эти параметра будут использоваться в отчете – установим флажки в первой колонке. </p>
<p>Затем выделим каждый из параметров, нажмем кнопку Свойства элемента пользовательских настроек и установим флажок
	Включать в пользовательские настройки (рис. 7.13).</p>
<p><strong>Рис. 7.13.</strong> Окно настроек отчета</p>
<p>Таким образом, перед формированием отчета пользователь сможет задать отчетный период. Более подробно о параметрах и
	пользовательских настройках отчета будет рассказано позже на занятии. </p>
<p>В заключение определим, в каких подсистемах будет отображаться наш отчет. </p>
<p>Закроем конструктор схемы компоновки данных и в окне редактирования объекта конфигурации Отчет Материалы перейдем на
	закладку Подсистемы. </p>
<p>Отметим в списке подсистем конфигурации ветви Учет материалов, Оказание услуг и Бухгалтерия. </p>
<p>Таким образом, ссылка на наш отчет автоматически попадет в панель команд этих разделов, в подменю Отчеты (рис.
	7.14).</p>
<p>В режиме «1С:Предприятие»</p>
<p>Запустим «1С:Предприятие» в режиме отладки и посмотрим, как работает отчет. </p>
<p>В открывшемся окне «1С:Предприятия» мы видим, что в разделах Бухгалтерия, Оказание услуг и Учет материалов появилось
	новое подменю Отчеты, содержащее команды для выполнения отчетов, и в нем команда для формирования отчета Материалы
	(рис. 7.15).</p>
<p><strong>Рис. 7.15.</strong> Команда для формирования отчета «Материалы»</p>
<p>Выполним ее. Откроется автоматически сформированная системой форма отчета. </p>
<p>Зададим даты начала и окончания отчетного периода и нажмем кнопку Сформировать (рис. 7.16).</p>
<p>Как видите, наш отчет вполне презентабелен и полностью отражает движение материалов, произошедшее в нашей
	организации. </p>
<p><strong>Рис. 7.16.</strong> Отчет «Материалы»</p>
<h1><a id="_Toc454870655"></a>Лабораторная работа № 10 Учет материалов</h1>
<p><strong>Порядок выполнения работы </strong></p>
<p>1. Ознакомьтесь с теоретическими основами в настоящих указаниях и конспектах лекций. </p>
<p>2. Получите задание у преподавателя. </p>
<p>3. Сделайте скриншоты (кнопка клавиатуры PrtSc) выполненных заданий в текстовом (Word) файле <em>Фамилия_ЛР</em></p>
<p>4. Составьте отчет по лабораторной работе. </p>
<p>5. Отчитайте работу преподавателю.</p>
<p><strong>Макет печатной формы</strong></p>
<p>В режиме «Конфигуратор»</p>
<p>Наша цель будет заключаться в создании печатной формы документа Оказание услуги.</p>
<p>Откроем в конфигураторе окно редактирования объекта конфигурации Документ ОказаниеУслуги. </p>
<p>Перейдем на закладку Макеты, нажмем кнопку Конструкторы и запустим конструктор печати (рис. 8.1).</p>
<p>В открывшемся окне конструктора на первом шаге укажем, что будет создана новая команда Печать для формирования
	печатной формы документа (рис. 8.2).</p>
<p>Нажмем Далее. </p>
<p>На втором шаге нажатием кнопки <img src="14.jpeg"/> определим, что все реквизиты нашего документа будут отображены в
	шапке печатной формы </p>
<p>(рис. 8.3).</p>
<p>Нажмем Далее. </p>
<p>На третьем шаге точно так же определим, что все реквизиты табличной части документа будут отображены в печатной
	форме </p>
<p>(рис. 8.4).</p>
<p>Нажмем Далее. </p>
<p>На четвертом шаге конструктор предложит сформировать нам подвал (нижнюю часть) печатной формы. Мы не станем ничего
	указывать (подвал в данном случае использовать не будем), нажмем Далее и перейдем к пятому шагу (рис. 8.5).</p>
<p>Здесь ничего изменять не будем. Тем самым согласимся с тем, что команда для вызова процедуры формирования печатной
	формы будет помещена в командную панель формы, в раздел Важное. </p>
<p>Нажмем OK.</p>
<p>В конфигураторе откроется модуль команды Печать, модуль менеджера документа ОказаниеУслуги и макет этого
	документа </p>
<p>(рис. 8.6).</p>
<p><strong>Рис. 8.6.</strong> Макет документа «Оказание услуги»</p>
<p>Заметим, что разработчик может создать макет печатной формы с нуля и для ее вывода создать соответствующую команду и
	кнопку в форме документа, но в данном случае всю работу сделал за нас конструктор печати:</p>
<ul>
	<li>Создан макет печатной формы документа ОказаниеУслуги с именем Печать (см. рис. 8.6).</li>
	<li>Создана команда документа ОказаниеУслуги с именем Печать.</li>
</ul>
<p>В модуль этой команды помещен обработчик, вызывающий процедуру печати документа, выполняющуюся на сервере. Сама
	процедура печати помещена в модуль менеджера документа ОказаниеУслуги (рис. 8.7).</p>
<p><strong>Рис. 8.7.</strong> Структура документа </p>
<p>«Оказание услуги» в дереве объектов конфигурации</p>
<ul>
	<li>В командную панель формы документа ОказаниеУслуги помещена команда Печать для формирования печатной формы
		документа
	</li>
</ul>
<p>(рис. 8.8).</p>
<p>Причем поскольку команда Печать принадлежит документу ОказаниеУслуги в целом, а не конкретной его форме, эту команду
	можно будет помещать в любую форму, созданную для документа.</p>
<p>В будущем мы будем самостоятельно создавать процедуры обработчиков команд и размещать соответствующие им кнопки в
	форме, но пока воспользуемся результатами работы конструктора печати и проверим макет в работе.</p>
<p><strong>Рис. 8.8.</strong> Макет документа «Оказание услуги»</p>
<p>В режиме «1С:Предприятие»</p>
<p>Запустим «1С:Предприятие» в режиме отладки и откроем документ Оказание услуги № 1. </p>
<p>Обратите внимание, что в командной панели документа появилась новая кнопка Печать (рис. 8.9).</p>
<p><strong>Рис. 8.9.</strong> Форма документа «Оказание услуги» с новой кнопкой «Печать»</p>
<p>Кнопка Печать добавилась также и в командную панель формы списка документов Оказание услуги. Поэтому распечатать
	документ можно, не открывая его, а просто выделив в списке и нажав кнопку Печать.</p>
<p>Нажмем эту кнопку (в форме списка или в форме документа) и увидим печатную форму нашего документа (рис. 8.10).</p>
<p><strong>Рис. 8.10.</strong> Печатная форма документа «Оказание услуги» </p>
<p>Как видите, конструктор сформировал вполне подходящую печатную форму для нашего документа. Единственное, чего не
	хватает в данной форме, это итоговой суммы документа. </p>
<p>В следующем разделе на примере добавления итоговой суммы документа мы познакомимся с тем, как можно редактировать
	макеты и формы объектов конфигурации.</p>
<p><strong>Редактирование макета</strong></p>
<p>В режиме «Конфигуратор»</p>
<p>Прежде всего, добавим итоговую сумму в печатную форму документа ОказаниеУслуги.</p>
<p>Откроем конфигуратор, раскроем дерево документа Оказание Услуги и дважды щелкнем на макете Печать. </p>
<p>Как видите, макет документа состоит из именованных областей, которые в определенном порядке выводятся на печать. </p>
<p>Те именованные области, которые мы видим слева, были созданы с помощью конструктора. Но разработчик может сам
	создавать или удалять области, переименовывать их и т. п.</p>
<p>Добавим новую область для вывода итоговой суммы документа. Выделим мышью две пустые строки под табличной частью
	документа и выполним пункт главного меню Таблица  Имена  Назначить имя… (рис. 8.11).</p>
<p><strong>Рис. 8.11.</strong> Создание области ячеек для вывода итоговой строки</p>
<p>Назовем область Всего, нажмем ОК. </p>
<p>Чтобы формат добавленных нами строк совпадал с имеющимся форматом заголовка и табличной части документа, изменим
	ширину колонок.</p>
<p>Для этого потянем мышью в заголовке таблицы за правую границу колонки 2 так, чтобы ее ширина совпала с шириной
	колонки № в шапке таблицы документа. Отпустим мышь.</p>
<p>Платформа предложит создать новый формат для выделенных строк. Согласимся.</p>
<p>Аналогичные действия выполним и для колонок 3, 4, 5 и 6.</p>
<p>В созданной области, в колонке Цена напишем ВСЕГО, а в колонке Сумма напишем ВсегоПоДокументу (рис. 8.12).</p>
<p><strong>Рис. 8.12.</strong> Создание ячеек для вывода итога</p>
<p>Вызвав палитру свойств для ячейки ВсегоПоДокументу (контекстное меню – Свойства), в свойстве Заполнение укажем, что в
	этой ячейке будет находиться не текст, а параметр (рис. 8.13).</p>
<p>Каждая ячейка редактируемого нами табличного документа может содержать либо текст, либо некоторый параметр, либо
	шаблон. </p>
<p><em>Текст</em>, содержащийся в ячейке, будет показан на экране. </p>
<p><em>Параметр</em> будет заменен некоторым значением, которое может быть присвоено ему средствами встроенного языка.
	Текст, содержащийся в ячейке, является именем этого параметра.</p>
<p><em>Шаблон</em> представляет собой текстовую строку, в определенные места которой будут вставлены значения
	параметров.</p>
<p>Поэтому, указав для ячейки в качестве заполнения Параметр, мы определили параметр области с именем ВсегоПоДокументу,
	которому присвоим нужное нам значение при формировании печатной формы.</p>
<p>Откроем модуль менеджера документа ОказаниеУслуги. </p>
<p>Для этого перейдем на закладку Прочее окна редактирования объекта конфигурации Документ ОказаниеУслуги и нажмем
	кнопку Модуль менеджера (рис. 8.14).</p>
<p>Найдем в нем процедуру Печать и отредактируем ее следующим образом (новые строки выделены жирным шрифтом), листинг
	8.1. <strong>листинг 8.1.</strong> Печать формы документа (фрагмент)</p>
<table>
	<tr>
		<td><p>…</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ОбластьЗаголовок = Макет.ПолучитьОбласть(&quot;Заголовок&quot;);</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Шапка = Макет.ПолучитьОбласть(&quot;Шапка&quot;);</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ОбластьПереченьНоменклатурыШапка = Макет.ПолучитьОбласть(&quot;ПереченьНоменклатурыШапка&quot;);</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ОбластьПереченьНоменклатуры = Макет.ПолучитьОбласть(&quot;ПереченьНоменклатуры&quot;);</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>ОбластьИтог =
			Макет.ПолучитьОбласть(</strong>&quot;<strong>Всего</strong>&quot;<strong>);</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ТабДок.Очистить();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ВставлятьРазделительСтраниц = Ложь;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Пока Выборка.Следующий() Цикл</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Если ВставлятьРазделительСтраниц Тогда</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ТабДок.ВывестиГоризонтальныйРазделительСтраниц();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецЕсли;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ТабДок.Вывести(ОбластьЗаголовок);</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Шапка.Параметры.Заполнить(Выборка);</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ТабДок.Вывести(Шапка, Выборка.Уровень());</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ТабДок.Вывести(ОбластьПереченьНоменклатурыШапка);</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ВыборкаПереченьНоменклатуры = Выборка.ПереченьНоменклатуры.Выбрать();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>СуммаИтог = 0;</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Пока ВыборкаПереченьНоменклатуры.Следующий() Цикл</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ОбластьПереченьНоменклатуры.Параметры.Заполнить(ВыборкаПереченьНоменклатуры);</p></td>
	</tr>
</table>
<p>ТабДок.Вывести(ОбластьПереченьНоменклатуры, </p>
<p>ВыборкаПереченьНоменклатуры.Уровень());</p>
<table>
	<tr>
		<td><p><strong>СуммаИтог = СуммаИтог + ВыборкаПереченьНоменклатуры.Сумма;</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецЦикла;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>ОбластьИтог.Параметры.ВсегоПоДокументу = СуммаИтог;</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>ТабДок.Вывести(ОбластьИтог);</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ВставлятьРазделительСтраниц = Истина;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецЦикла;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>…</p></td>
	</tr>
</table>
<p>Смысл добавленного фрагмента прост. Мы обращаемся к макету документа ОказаниеУслуги по его имени – Макет. </p>
<p>Используя его метод ПолучитьОбласть(), получаем область Всего (ту, которую мы только что добавили к макету) и
	сохраняем ее в переменной ОбластьИтог. </p>
<p>В цикле обхода строк табличной части документа, полученных в результате выполнения запроса, мы накапливаем в
	переменной СуммаИтог значение суммы табличной части документа по колонке Сумма. </p>
<p>Затем мы обращаемся к параметру ВсегоПоДокументу (ОбластьИтог.Параметры.ВсегоПоДокументу), находящемуся в области
	Всего, и присваиваем ему значение переменной СуммаИтог.</p>
<p>В заключение мы выводим итоговую область в табличный документ, который будет показан на экране и распечатан
	пользователем – ТабДок.Вывести(ОбластьИтог). </p>
<p>Отображение табличного документа на экране выполняется в обработчике команды Печать, в модуле этой команды на
	клиенте, в то время как сама процедура заполнения печатной формы данными, описанная в модуле менеджера документа,
	выполняется на сервере.</p>
<p>В режиме «1С:Предприятие»</p>
<p>Запустим «1С:Предприятие» в режиме отладки и проверим результат наших изменений (рис. 8.15).</p>
<p><strong>Рис. 8.15.</strong> Печатная форма документа «Оказание услуги»</p>
<p>Подобным образом, создавая именованные области и ячейки макета, используя их свойства и управляя порядком их вывода c
	помощью встроенного языка, разработчик имеет возможность создать печатную форму любого дизайна.</p>
<h1><a id="_Toc454870656"></a>Лабораторная работа № 11 Монтажные и наладочные работы</h1>
<p><strong>Порядок выполнения работы </strong></p>
<p>1. Ознакомьтесь с теоретическими основами в настоящих указаниях и конспектах лекций. </p>
<p>2. Получите задание у преподавателя. </p>
<p>3. Сделайте скриншоты (кнопка клавиатуры PrtSc) выполненных заданий в текстовом (Word) файле <em>Фамилия_ЛР</em></p>
<p>4. Составьте отчет по лабораторной работе. </p>
<p>5. Отчитайте работу преподавателю.</p>
<p><strong>Добавление периодического регистра сведений </strong></p>
<p>Приступим к созданию периодического регистра сведений, который будет хранить развернутые во времени розничные цены
	материалов и стоимости услуг, оказываемых нашим ООО «На все руки мастер».</p>
<p>В режиме «Конфигуратор»</p>
<p>Откроем в конфигураторе нашу учебную конфигурацию и добавим новый объект конфигурации Регистр сведений. </p>
<p>Для этого выделим в дереве объектов конфигурации ветвь Регистры сведений и нажмем кнопку Добавить в командной панели
	окна конфигурации.</p>
<p>В открывшемся окне редактирования объекта конфигурации на закладке Основные зададим имя регистра – Цены. </p>
<p>Установим свойство Периодичность этого регистра – В пределах секунды. </p>
<p>Такую периодичность мы выбрали для того, чтобы иметь возможность отслеживать цены несколько раз в течение дня. Если
	же так часто не предполагается изменять цены, то можно выбрать, вообще говоря, в пределах дня.</p>
<p>Здесь же определим представление объекта в интерфейсе приложения. </p>
<p>Зададим свойства Представление записи как Цена, а Представление списка как Цены на номенклатуру (рис. 9.2).</p>
<p><strong>Рис. 9.2.</strong> Основные свойства регистра </p>
<p>сведений «Цены»</p>
<p>Обратите внимание на свойство Режим записи. По умолчанию оно имеет значение – Независимый, то есть мы создаем
	независимый регистр сведений и сможем в дальнейшем вводить в него данные без использования регистратора,
	вручную. </p>
<p>Нажмем Далее и перейдем на закладку Подсистемы. </p>
<p>По логике нашей конфигурации данный регистр должен быть доступен в разделах Учет материалов, Оказание услуг и
	Бухгалтерия. </p>
<p>Измерения и ресурсы</p>
<p>Перейдем на закладку Данные и создадим измерение Номенклатура с типом СправочникСсылка.Номенклатура. </p>
<p>Для этого выделим ветвь Измерения и нажмем кнопку Добавить в командной панели окна.</p>
<p>Укажем, что это измерение будет ведущим (рис. 9.4).</p>
<p><strong>Рис. 9.4.</strong> Создание ведущего измерения регистра сведений </p>
<p>Свойство Ведущее имеет смысл использовать лишь тогда, когда измерение имеет тип ссылки на объект базы данных.
	Установка свойства Ведущее будет говорить о том, что запись регистра сведений представляет интерес, пока существует
	тот объект, ссылка на который выбрана в качестве значения этого измерения в этой записи. При удалении объекта все
	записи регистра сведений по этому объекту тоже будут автоматически удалены. </p>
<p>Также в результате того, что это измерение регистра мы сделали ведущим, в форме элемента справочника Номенклатура, в
	панели навигации в группе Перейти появится ссылка. По ней возможен переход к записям этого регистра, которые
	содержат в измерении Номенклатура ссылку на этот элемент справочника.</p>
<p>Затем создадим ресурс Цена, тип Число, длина 15, точность 2, неотрицательное. </p>
<p>Для этого выделим ветвь Ресурсы и нажмем кнопку Добавить в командной панели окна (рис. 9.5).</p>
<p><strong>Рис. 9.5.</strong> Создание ресурса регистра сведений</p>
<p>В режиме «1С:Предприятие»</p>
<p>Теперь запустим «1С:Предприятие» в режиме отладки и посмотрим, как работает наш периодический регистр сведений
	Цены. </p>
<p>В открывшемся окне «1С:Предприятия» мы видим, что в разделах Бухгалтерия, Оказание услуг и Учет материалов появилась
	команда для открытия списка регистра Цены на номенклатуру (рис. 9.6).</p>
<p><strong>Рис. 9.6.</strong> Команда для открытия периодического регистра сведений «Цены»</p>
<p>Команда для открытия регистра сведений по умолчанию доступна в интерфейсе разделов, в которых отображается регистр,
	так как в отличие от регистров накопления предполагается изменение данных регистра пользователем. Но в данном случае
	она находится в подменю Еще вместе с другими командами, которые не помещаются на панели команд текущего раздела окна
	приложения.</p>
<p>Создание записей в регистре сведений</p>
<p>Выполним команду для открытия списка регистра Цены на номенклатуру. Чтобы добавить новую запись в регистр сведений,
	нажмем кнопку Создать.</p>
<p>Зададим стоимость услуг ООО «На все руки мастер» следующим образом (рис. 9.7). </p>
<p>При этом период зададим задним числом, так как он должен быть меньше или равен дате создания документа об оказании
	услуг, в нашем случае 08.07.2013.</p>
<p><img src="15.jpeg"/></p>
<p><strong>Рис. 9.7.</strong> Цены на услуги в регистре сведений «Цены»</p>
<p>После этого зададим розничные цены на материалы (рис. 9.8).</p>
<p><strong>Рис. 9.8.</strong> Цены на материалы в регистре сведений «Цены»</p>
<p>Итак, мы с вами имеем очень полезную возможность в нашей программе – установка цен на услуги и материалы. Поскольку
	цены хранятся с привязкой к дате, мы можем заранее установить новые цены и быть уверены в том, что новые цены
	вступят в действие не раньше указанного для них времени.</p>
<p><strong>Автоматическая подстановка цены в документ при выборе номенклатуры</strong></p>
<p>Наша задача заключается в следующем. Цена номенклатуры у нас теперь хранится в отдельном регистре сведений. Когда мы
	создаем или изменяем документ ОказаниеУслуги и добавляем в табличную часть какую-либо номенклатуру, нам хочется,
	чтобы одновременно с этим в документ подставлялась бы сразу и актуальная цена этой номенклатуры, полученная из
	регистра сведений и соответствующая дате документа. </p>
<p>Для этого нам нужно сделать две вещи. </p>
<p>Сначала написать некую функцию, которая будет возвращать нам актуальную цену номенклатуры, а затем вызвать эту
	функцию в тот момент, когда в документ добавляется номенклатура, и подставить в документ цену номенклатуры, которую
	вернет эта функция. </p>
<p>Поскольку такой сервис понадобится нам, скорее всего, не только в этом, но и в других документах, которые содержат в
	табличной части номенклатуру, мы поместим функцию в некоторое общедоступное место – в общий модуль.</p>
<p>В режиме «Конфигуратор»</p>
<p>Функция, возвращающая цену номенклатуры</p>
<p>Сначала мы создадим функцию РозничнаяЦена(), которая будет возвращать нам актуальную розничную цену номенклатуры, и
	поместим ее в общий модуль конфигурации.</p>
<p>Откроем конфигуратор, в ветке Общие  Общие модули добавим новый объект конфигурации Общий модуль и назовем его Рабо-
	таСоСправочниками. </p>
<p>В палитре этого свойств модуля мы видим, что у модуля по умолчанию установлен флажок Сервер. Это означает, что
	экземпляры этого модуля будут скомпилированы только на стороне сервера. </p>
<p>Кроме этого, установим флажок Вызов сервера для того, чтобы экспортные процедуры и функции этого модуля можно было
	вызывать с клиента (рис. 9.9).</p>
<p><strong>Рис. 9.9.</strong> Свойства общего модуля</p>
<p>Поместим в него следующий текст (листинг 9.1).</p>
<p><strong>листинг 9.1.</strong> Функция «РозничнаяЦена()»</p>
<table>
	<tr>
		<td><p>Функция РозничнаяЦена(АктуальнаяДата, ЭлементНоменклатуры) Экспорт </p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// Создать вспомогательный объект &quot;Отбор&quot;.</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Отбор = Новый Структура(&quot;Номенклатура&quot;, ЭлементНоменклатуры);</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// Получить актуальные значения ресурсов регистра.</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ЗначенияРесурсов = РегистрыСведений.Цены.ПолучитьПоследнее(АктуальнаяДата, Отбор);</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Возврат ЗначенияРесурсов.Цена;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецФункции</p></td>
	</tr>
</table>
<p>Поясним эту функцию.</p>
<p>Для получения розничной цены мы будем передавать в функцию два параметра:</p>
<ul>
	<li>АктуальнаяДата – параметр типа Дата, определяет точку на оси времени, в которой нас интересует значение
		розничной цены;
	</li>
	<li>ЭлементНоменклатуры – ссылка на элемент справочника Номенклатура, для которого мы хотим получить розничную
		цену.
	</li>
</ul>
<p>В теле функции мы сначала создаем вспомогательный объект Отбор. </p>
<p>Это структура, содержащая отбор по измерениям регистра. С его помощью определяем, что нас будут интересовать записи
	регистра, в которых измерение регистра Номенклатура равно переданной в функцию ссылке на элемент справочника. </p>
<p>Имя ключа структуры («Номенклатура») должно совпадать с именем измерения регистра, заданного в конфигураторе, а
	значение элемента структуры (ЭлементНоменклатуры) задает отбираемое по данному измерению значение.</p>
<p>Во второй строке мы обращаемся к менеджеру регистра сведений Цены (РегистрыСведений.Цены) и выполняем метод
	ПолучитьПоследнее(), который возвращает нам значения ресурсов самой поздней записи регистра, соответствующей
	передаваемой в функцию дате (АктуальнаяДата) и значениям измерений регистра (Отбор).</p>
<p>Метод ПолучитьПоследнее возвращает структуру, содержащую значения ресурсов, которая сохраняется в переменной
	ЗначенияРесурсов. Вообще говоря, у регистра может быть несколько ресурсов. В нашем регистре ресурс один, но все
	равно будет возвращена структура, содержащая единственный элемент.</p>
<p>Поэтому в следующей строке мы получаем искомую нами розничную цену, просто указав имя нужного нам ресурса регистра
	через точку (ЗначенияРесурсов.Цена), и возвращаем ее при выполнении функции.</p>
<p>Теперь эту функцию нужно вызвать в некоторый момент работы документа.</p>
<p>Вызов функции при выборе номенклатуры и заполнение цены в документе</p>
<p>Итак, задача, которая перед нами стоит, заключается в следующем. При редактировании документа ОказаниеУслуги нам
	необходимо обеспечить автоматическое заполнение поля Цена после того, как пользователь выберет услугу. Причем цена
	услуги должна определяться исходя из даты создаваемого документа.</p>
<p>Найдем в конфигураторе документ ОказаниеУслуги и откроем его форму ФормаДокумента. </p>
<p>Дважды щелкнем на элементе формы ПереченьНоменклатурыНоменклатура или правой кнопкой мыши откроем для него палитру
	свойств (пункт контекстного меню Свойства). Прокрутив список до конца, найдем событие ПриИзменении, которое
	возникает после изменения значения поля. </p>
<p>Нажмем кнопку открытия <img src="16.jpeg"/> со значком лупы в поле ввода. </p>
<p>На вопрос конфигуратора о типе обработчика события, создаваемого в форме, оставим без изменения предложенное значение
	Создать на клиенте, так как мы хотим создать клиентский обработчик события, являющегося результатом интерактивных
	действий пользователя </p>
<p>(рис. 9.10).</p>
<p>Система создаст шаблон процедуры обработчика этого события в модуле нашей формы и откроет закладку Модуль редактора
	формы. </p>
<p>Внесем в него следующий текст (листинг 9.2).</p>
<p><strong>листинг 9.2.</strong> Процедура </p>
<p>«ПереченьНоменклатурыНоменклатураПриИзменении()»</p>
<table>
	<tr>
		<td><p>// Получить текущую строку табличной части.</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>СтрокаТабличнойЧасти = Элементы.ПереченьНоменклатуры.ТекущиеДанные;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// Установить цену.</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>СтрокаТабличнойЧасти.Цена = РаботаСоСправочниками.РозничнаяЦена(</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Объект.Дата, СтрокаТабличнойЧасти.Номенклатура);</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// Пересчитать сумму строки</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>РаботаСДокументами.РассчитатьСумму(СтрокаТабличнойЧасти);</p></td>
	</tr>
</table>
<p>Прокомментируем содержимое обработчика.</p>
<p>Первая строка обработчика вам уже знакома по процедурам ПереченьНоменклатурыКоличествоПриИзменении и
	ПереченьНоменклатурыЦенаПриИзменении. Сначала мы получаем текущую строку табличной части документа, так как она нам
	понадобится в дальнейшем, и сохраняем ее в переменной СтрокаТабличнойЧасти.</p>
<p>Затем мы вызываем нашу функцию РозничнаяЦена() из общего модуля РаботаСоСправочниками. </p>
<p>Первым параметром мы передаем в эту функцию дату документа, на которую необходимо получить цену. Дату документа мы
	получаем из основного реквизита формы – Объект.Дата. </p>
<p>Вторым параметром мы передаем ссылку на элемент справочника Номенклатура, который содержится в текущей строке
	табличной части документа (СтрокаТабличнойЧасти.Номенклатура). </p>
<p>Функция возвращает последнее значение цены, и это значение мы присваиваем полю Цена в текущей строке табличной части
	документа (СтрокаТабличнойЧасти.Цена).</p>
<p>Затем мы вызываем процедуру РассчитатьСумму из общего модуля РаботаСДокументами. Эту процедуру мы создали с вами на
	предыдущих занятиях для того, чтобы при изменении цены или количества в документе пересчитывать сумму в строке
	документа.</p>
<p>Заметьте, что сама процедура ПереченьНоменклатурыНоменклатураПриИзменении() начинает работать в модуле формы на
	стороне клиента, так как это обработчик интерактивного события формы. Создавая заготовку этой процедуры, платформа
	автоматически разместила перед описанием процедуры директиву компиляции &amp;НаКлиенте.</p>
<p>Затем вызывается функция РозничнаяЦена(). Поскольку эта функция не будет найдена на стороне клиента, то исполнение
	будет передано в общий модуль РаботаСоСправочниками, который выполняется на сервере. После завершения функции
	программный код продолжит исполняться на клиенте.</p>
<p>Почему в данном случае использована такая хитрость? Зачем нужно было передавать исполнение кода на сервер?</p>
<p>Дело в том, что любая работа с базой данных (чтение данных, запись) возможна только на сервере. В данном случае нам
	необходимо было прочитать последние данные из регистра сведений для некоторой номенклатуры. </p>
<p>Такие действия можно выполнить только на сервере, и если посмотреть в синтакс-помощнике описание метода
	ПолучитьПоследнее() регистра сведений, то можно заметить, что этот метод доступен только на сервере, в толстом
	клиенте и во внешнем соединении. </p>
<p>Толстый клиент и внешнее соединение – это клиентские приложения прежней версии платформы, которые существуют для
	совместимости с прежними прикладными решениями.</p>
<p>Мы же с вами разрабатываем совершенно новое прикладное решение, которое работает в тонком клиенте или в веб-клиенте.
	Поэтому в нашем случае для получения каких-либо данных из базы данных нужно передать исполнение кода на сервер, там
	получить нужные данные и вернуть эти данные на клиента. Что мы и сделали.</p>
<p>В режиме «1С:Предприятие»</p>
<p>Проверим, как теперь работает наш документ. </p>
<p>Запустим «1С:Предприятие» в режиме отладки и откроем регистр сведений Цены. </p>
<p>Для транзистора Philips добавим другим числом новую цену </p>
<p>(рис. 9.11).</p>
<p>Теперь откроем документ Оказание услуги № 1. Как вы помните, этим документом мы как раз «израсходовали» один такой
	транзистор. </p>
<p>Оставим дату документа без изменения и повторим выбор транзистора в колонке Номенклатура табличной части документа.
	Автоматически установится значение цены транзистора от 06.07.2013. Это последнее значение цены на дату документа
	(рис. 9.12).</p>
<p>Теперь изменим дату документа на 10.07.2013 и снова повторим выбор транзистора. Будет установлено новое значение
	цены, последнее на эту дату (рис. 9.13).</p>
<p><strong>Рис. 9.12.</strong> Заполнение документа «Оказание услуги» </p>
<p><strong>Рис. 9.13.</strong> Заполнение документа «Оказание услуги»</p>
<p>Таким образом, в документе появляется актуальная на момент создания документа цена услуги.</p>
<h1><a id="_Toc454870657"></a>Лабораторная работа № 12 Оприходование МПЗ</h1>
<p><strong>Порядок выполнения работы </strong></p>
<p>1. Ознакомьтесь с теоретическими основами в настоящих указаниях и конспектах лекций. </p>
<p>2. Получите задание у преподавателя. </p>
<p>3. Сделайте скриншоты (кнопка клавиатуры PrtSc) выполненных заданий в текстовом (Word) файле <em>Фамилия_ЛР</em></p>
<p>4. Составьте отчет по лабораторной работе. </p>
<p>5. Отчитайте работу преподавателю.</p>
<p><strong>Добавление перечисления</strong></p>
<p>В режиме «Конфигуратор»</p>
<p>Откроем конфигуратор и создадим сначала новый объект конфигурации Перечисление с именем ВидыНоменклатуры.</p>
<p>На закладке Данные добавим два значения перечисления: Материал и Услуга. </p>
<p>Для этого нажмем кнопку Добавить над списком значений перечисления (рис. 10.1).</p>
<p><strong>Привязка номенклатуры к значениям перечисления «ВидНоменклатуры»</strong></p>
<p>Чтобы привязать номенклатуру к значениям перечисления, мы сделаем следующее:</p>
<ul>
	<li>в режиме Конфигуратор создадим у справочника Номенклатура реквизит, который будет хранить значение
		перечисления;
	</li>
	<li>в режиме 1С:Предприятие проставим нужные значения этого рек-</li>
</ul>
<p>визита для всех элементов справочника Номенклатура.</p>
<p>В режиме «Конфигуратор»</p>
<p>Добавим в справочник Номенклатура новый реквизит ВидНоменклатуры с типом ПеречислениеСсылка.ВидыНоменклатуры. </p>
<p>Для этого откроем окно редактирования объекта конфигурации Справочник Номенклатура и на закладке Данные нажмем кнопку
	Добавить над списком реквизитов справочника (рис. 10.2).</p>
<p><strong>Рис. 10.2.</strong> Данные справочника «Номенклатура» </p>
<p>В режиме «1С:Предприятие»</p>
<p>После этого запустим «1С:Предприятие» в режиме отладки. </p>
<p>В режиме 1С:Предприятие зададим для каждого элемента справочника Номенклатура соответствующее значение реквизита Вид
	номенклатуры (рис. 10.3).</p>
<p>Теперь посмотрим, как можно применить новые данные, полученные благодаря использованию перечисления
	ВидыНоменклатуры.</p>
<p><img src="17.jpeg"/></p>
<p><strong>Рис. 10.3.</strong> Данные справочника «Номенклатура» </p>
<p><strong>Произвольное представление номенклатуры</strong></p>
<p>Теперь, используя реквизит Вид номенклатуры, зададим произвольное представление номенклатуры в интерфейсе
	«1С:Предприятия». </p>
<p>Представление номенклатуры используется везде, где отображаются поля, ссылающиеся на элементы справочника
	Номенклатура. Такие поля мы видим в табличной части наших документов, в регистре сведений, регистре накопления и т.
	д.</p>
<p>Стандартное представление номенклатуры (как и любого другого элемента справочника) определяется свойством справочника
	Основное представление. По умолчанию это свойство установлено в значение В виде наименования (рис. 10.4).</p>
<p>Поэтому, например, в табличной части документов в колонке Номенклатура мы видим не ссылку на номенклатуру, а ее
	наименование </p>
<p>(рис. 10.5).</p>
<p><strong>Рис. 10.5.</strong> Документ «Оказание услуги»</p>
<p>Было бы удобно, чтобы при отображении ссылок на номенклатуру в интерфейсе «1С:Предприятия» рядом с наименованием
	номенклатуры показывался бы и ее вид (материал или услуга). </p>
<p>Выполним это изменение.</p>
<p>В режиме «Конфигуратор»</p>
<p>Механизм формирования представления объекта конфигурации состоит из двух этапов: определение реквизитов, участвующих
	в формировании представления, и собственно формирование представления. Для этого используются обработчики событий
	ОбработкаПолученияПолейПредставления и ОбработкаПолученияПредставления менеджера соответствующего объекта.</p>
<p>Вернемся в конфигуратор, выделим в дереве объектов конфигурации справочник Номенклатура, вызовем контекстное меню и
	выберем пункт Открыть модуль менеджера </p>
<p>Открывшийся модуль менеджера справочника заполним следующим образом (листинги 10.1, 10.2).</p>
<p><strong>листинг 10.1.</strong> Модуль менеджера справочника «Номенклатура» </p>
<table>
	<tr>
		<td><p>Процедура ОбработкаПолученияПолейПредставления(Поля, СтандартнаяОбработка)</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>СтандартнаяОбработка = Ложь;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Поля.Добавить(&quot;Наименование&quot;);</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Поля.Добавить(&quot;ВидНоменклатуры&quot;);</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецПроцедуры</p></td>
	</tr>
</table>
<p><strong>листинг 10.2.</strong> Модуль менеджера справочника «Номенклатура»</p>
<table>
	<tr>
		<td><p>Процедура ОбработкаПолученияПредставления(Данные, Представление, СтандартнаяОбработка)</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>СтандартнаяОбработка = Ложь;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Если ЗначениеЗаполнено(Данные.ВидНоменклатуры) Тогда </p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Представление = Данные.Наименование + &quot; (&quot; + </p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>НРег(Строка(Данные.ВидНоменклатуры)) + &quot;)&quot;;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Иначе</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Представление = Данные.Наименование;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецЕсли;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецПроцедуры</p></td>
	</tr>
</table>
<p>Прокомментируем этот код.</p>
<p>В обработчике события ОбработкаПолученияПолейПредставления мы описываем, какие реквизиты будут участвовать в
	формировании представления документа. Для этого сначала мы устанавливаем параметр СтандартнаяОбработка в значение
	Ложь, а затем добавляем в массив Поля нужные реквизиты справочника. Если параметр СтандартнаяОбработка в обработчике
	не установлен в значение Ложь, то массив Поля будет заполнен реквизитами, используемыми для формирования
	стандартного представления данного объекта (в нашем случае – это Наименование).</p>
<p>В обработчике события ОбработкаПолученияПредставления мы описываем алгоритм получения параметра Представление из
	массива полей, заданных нами в предыдущем обработчике. Данные, необходимые для формирования представления,
	передаются с помощью параметра Данные типа Структура. Для этого сначала мы устанавливаем параметр
	СтандартнаяОбработка в значение Ложь, а затем получаем представление номенклатуры путем добавления к ее наименованию
	вида номенклатуры, заключенного в скобки. Если параметр СтандартнаяОбработка в обработчике не установлен в значение
	Ложь, то система попытается сформировать стандартное представление объекта, исходя из переданных данных.</p>
<p>В режиме «1С:Предприятие»</p>
<p>Запустим «1С:Предприятие» в режиме отладки. </p>
<p>В результате при открытии документа Оказание услуги в табличной части мы видим заданное нами представление
	номенклатуры </p>
<p>(рис. 10.6).</p>
<p><strong>Рис. 10.6.</strong> Документ «Оказание услуги»</p>
<p>По аналогии с рассмотренным примером произвольные представления объектов конфигурации можно задавать не только для
	справочников, но и для документов, планов видов характеристик, планов счетов и т. п. </p>
<p><strong>Регистрация расхода только той номенклатуры, которая является материалом</strong></p>
<p>Если вы помните, на шестом занятии, когда создавались движения документа ОказаниеУслуги по регистру накопления
	ОстаткиМатериалов, мы сказали, что они не совсем правильные, поскольку в регистр будут попадать не только записи об
	израсходованных материалах, но и записи об оказанных услугах (листинг 10.3).</p>
<p><strong>листинг 10.3.</strong> Процедура «ОбработкаПроведения()» документа «ОказаниеУслуги»</p>
<table>
	<tr>
		<td><p>Процедура ОбработкаПроведения(Отказ, Режим)</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>//{{__КОНСТРУКТОР_ДВИЖЕНИЙ_РЕГИСТРОВ</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// Данный фрагмент построен конструктором.</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// При повторном использовании конструктора внесенные вручную изменения будут утеряны!!!</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// регистр ОстаткиМатериалов Расход</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движения.ОстаткиМатериалов.Записывать = Истина;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Для Каждого ТекСтрокаПереченьНоменклатуры Из ПереченьНоменклатуры Цикл</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение = Движения.ОстаткиМатериалов.Добавить();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.ВидДвижения = ВидДвиженияНакопления.Расход;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.Период = Дата;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.Материал = ТекСтрокаПереченьНоменклатуры.Номенклатура;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.Склад = Склад;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.Количество = ТекСтрокаПереченьНоменклатуры.Количество;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецЦикла;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>//}}__КОНСТРУКТОР_ДВИЖЕНИЙ_РЕГИСТРОВ</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецПроцедуры</p></td>
	</tr>
</table>
<p>Теперь мы доработаем документ таким образом, чтобы в регистре появлялись только записи, относящиеся к расходу
	материалов. </p>
<p>Для этого мы сначала в режиме Конфигуратор изменим процедуру проведения документа так, чтобы в регистр попадали
	записи только о той номенклатуре, которая является материалом, а потом в режиме 1С:Предприятие заново проведем
	(перепроведем) все документы Оказание услуги, чтобы данные в регистре изменились в соответствии с новым алгоритмом
	проведения документа.</p>
<p>Эта доработка будет не совсем эффективна с точки зрения производительности, зато позволит нам получить нужные данные
	в регистре ОстаткиМатериалов. </p>
<p>В режиме «Конфигуратор»</p>
<p>Скорректируем движения документа, исключив из обработки те строки табличной части, в которых находятся услуги.</p>
<p>Для этого откроем в конфигураторе модуль документа ОказаниеУслуги </p>
<p>(контекстное меню документа – Открыть модуль объекта) и добавим в обработчик события ОбработкаПроведения это
	условие. </p>
<p>Текст следует добавить в начало цикла обхода табличной части документа после строки Для Каждого
	ТекСтрокаПереченьНоменклатуры Из ПереченьНоменклатуры Цикл. </p>
<p>В результате процедура ОбработкаПроведения должна выглядеть следующим образом (листинг 10.4). <strong>листинг
	10.4.</strong> Движения документа «ОказаниеУслуги» </p>
<table>
	<tr>
		<td><p>Процедура ОбработкаПроведения(Отказ, Режим)</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>//{{__КОНСТРУКТОР_ДВИЖЕНИЙ_РЕГИСТРОВ</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// Данный фрагмент построен конструктором.</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// При повторном использовании конструктора внесенные вручную изменения будут утеряны!!!</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// регистр ОстаткиМатериалов Расход</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движения.ОстаткиМатериалов.Записывать = Истина;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Для Каждого ТекСтрокаПереченьНоменклатуры Из ПереченьНоменклатуры Цикл</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>Если ТекСтрокаПереченьНоменклатуры.Номенклатура.ВидНоменклатуры = </strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>Перечисления.ВидыНоменклатуры.Материал Тогда </strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение = Движения.ОстаткиМатериалов.Добавить();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.ВидДвижения = ВидДвиженияНакопления.Расход;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.Период = Дата;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.Материал = ТекСтрокаПереченьНоменклатуры.Номенклатура;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.Склад = Склад;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.Количество = ТекСтрокаПереченьНоменклатуры.Количество;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>КонецЕсли;</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецЦикла;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>//}}__КОНСТРУКТОР_ДВИЖЕНИЙ_РЕГИСТРОВ</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецПроцедуры</p></td>
	</tr>
</table>
<p>Добавленный текст исключает выполнение операторов цикла для тех строк табличной части документа, в которых
	номенклатура не является материалом. Поясним это условие.</p>
<p>В переменной ТекСтрокаПереченьНоменклатуры содержатся на каждом шаге цикла данные текущей строки табличной части
	ПереченьНоменклатуры. </p>
<p>Указывая через точку имя колонки Номенклатура (ТекСтрокаПереченьНоменклатуры.Номенклатура), мы обращаемся к ссылке на
	элемент номенклатуры, которая содержится в этой строке табличной части.</p>
<p>Затем, указывая через точку ВидНоменклатуры (ТекСтрокаПереченьНоменклатуры.Номенклатура.ВидНоменклатуры), мы
	обращаемся к реквизиту ВидНоменклатуры этого элемента справочника Номенклатура. </p>
<p>Полученное значение с помощью оператора сравнения (=) мы сравниваем со значением Материал перечисления
	ВидыНоменклатуры (Перечисления.ВидыНоменклатуры.Материал).</p>
<p>Если значения совпадают, операторы цикла выполняются. Если нет, мы переходим к следующей итерации цикла, к следующей
	строке табличной части.</p>
<p>В режиме «1С:Предприятие»</p>
<p>Запустим «1С:Предприятие» в режиме отладки и проверим работу процедуры проведения документа Оказание услуги. </p>
<p>Откроем список документов, выполнив команду Оказание услуг в разделе Оказание услуг. </p>
<p>Откроем документ Оказание услуги № 1 и внесем в него следующие изменения: </p>
<ul>
	<li>удалим из табличной части строку, содержащую Транзистор</li>
</ul>
<p>Philips;</p>
<ul>
	<li>добавим услугу – Подключение воды;</li>
	<li>добавим материал – Шланг резиновый (рис. 10.7).</li>
</ul>
<p><strong>Рис. 10.7.</strong> Измененный документ «Оказание услуги № 1»</p>
<p>Обратите внимание, что цены подставляются автоматически из регистра сведений Цены. </p>
<p>Нажмем кнопку Провести в командной панели формы документа. </p>
<p>Затем выполним команду Остатки материалов в панели навигации формы, чтобы перейти к записям регистра Остатки
	материалов, связанным с данным документом (рис. 10.8).</p>
<p><strong>Рис. 10.8.</strong> Записи регистра «Остатки материалов»</p>
<p>Как мы видим, в движения по регистру Остатки материалов включаются только строки, содержащие материалы. Запись про
	услугу Подключение воды в движения не попала.</p>
<p>Это особенно заметно, так как теперь в поле Материал регистра Остатки материалов представление номенклатуры включает
	также и вид номенклатуры, как мы задали в предыдущем разделе.</p>
<h1><a id="_Toc454870658"></a>Лабораторная работа № 13 Покупка МПЗ за наличный расчет</h1>
<p><strong>Порядок выполнения работы </strong></p>
<p>1. Ознакомьтесь с теоретическими основами в настоящих указаниях и конспектах лекций. </p>
<p>2. Получите задание у преподавателя. </p>
<p>3. Сделайте скриншоты (кнопка клавиатуры PrtSc) выполненных заданий в текстовом (Word) файле <em>Фамилия_ЛР</em></p>
<p>4. Составьте отчет по лабораторной работе. </p>
<p>5. Отчитайте работу преподавателю.</p>
<p><strong>Добавление еще одного регистра накопления</strong></p>
<p>В режиме «Конфигуратор»</p>
<p>Регистр СтоимостьМатериалов совсем не сложен, поэтому мы не будем подробно останавливаться на его создании. </p>
<p>Создадим новый объект конфигурации Регистр накопления с именем СтоимостьМатериалов. </p>
<p>Расширенное представление списка зададим как Движения по регистру Стоимость материалов. Этот заголовок будет
	отображаться в окне списка записей регистра.</p>
<p>На закладке Подсистемы отметим, что этот регистр будет отображаться в подсистемах Бухгалтерия, Учет материалов и
	Оказание услуг. </p>
<p>На закладке Данные создадим для регистра одно измерение – Материал типа СправочникСсылка.Номенклатура и один ресурс –
	Стоимость типа Число длиной 15 и точностью 2.</p>
<p>После создания регистр СтоимостьМатериалов должен выглядеть в дереве конфигурации следующим образом </p>
<p>(рис. 11.1).</p>
<p><strong>Рис. 11.1.</strong> Регистр накопления </p>
<p>«Стоимость материалов»</p>
<p>Теперь отредактируем командный интерфейс, чтобы в разделах Бухгалтерия, Оказание услуг и Учет материалов была
	доступна команда для просмотра нашего регистра накопления. </p>
<p>В дереве объектов конфигурации выделим ветвь Подсистемы, вызовем ее контекстное меню и выберем пункт Все
	подсистемы. </p>
<p>В открывшемся окне слева в списке Подсистемы выделим подсистему Бухгалтерия. </p>
<p>Справа в списке Командный интерфейс отразятся все команды выбранной подсистемы. </p>
<p>В группе Панель навигации.Обычное включим видимость у команды </p>
<p>Стоимость материалов и мышью перетащим ее в группу Панель </p>
<p><strong>Рис. 11.2.</strong> Настройка командного интерфейса подсистем</p>
<p>Аналогично, выделив подсистемы ОказаниеУслуг и УчетМатериалов, в группе Панель навигации.Обычное включим видимость у
	команды Стоимость материалов и перенесем ее в группу Панель навигации.См. также.</p>
<p>Теперь мы можем приступить к внесению изменений в процедуры проведения наших документов. </p>
<p>Начнем с самого простого – документа Приходная накладная.</p>
<p><strong>Проведение приходной накладной по двум регистрам</strong></p>
<p>В режиме «Конфигуратор»</p>
<p>Изменение процедуры проведения</p>
<p>Откроем в конфигураторе окно редактирования объекта конфигурации Документ ПриходнаяНакладная и перейдем на закладку
	Движения. </p>
<p>В списке регистров отметим, что документ будет создавать теперь движения и по регистру СтоимостьМатериалов (рис.
	11.3).</p>
<p>в регистре «Стоимость материалов»</p>
<p>Нажмем кнопку Конструктор движений. На вопрос системы о замещении процедуры проведения документа на новую,
	сформированную конструктором, ответим утвердительно. Мы ничего не потеряем, так как конструктор в обработке
	проведения сформирует движения уже по двум регистрам, а в прежнюю процедуру проведения мы никаких изменений не
	вносили. </p>
<p>В открывшемся окне конструктора движений мы увидим, что для регистра ОстаткиМатериалов все поля конструктора уже
	содержат информацию, которую мы задавали ранее при формировании движений для этого регистра. Над списком Регистры
	нажмем кнопку Добавить и добавим еще один регистр СтоимостьМатериалов (рис. 11.4).</p>
<p><strong>Рис. 11.4.</strong> Конструктор движений регистров</p>
<p>Тип движения регистра СтоимостьМатериалов по умолчанию будет установлен как Приход (пиктограмма со знаком + слева от
	имени регистра).</p>
<p>В поле выбора Табличная часть выберем табличную часть нашего документа – Материалы. </p>
<p>Список реквизитов документа, который уже заполнен реквизитами шапки документа, автоматически дополнится реквизитами
	нашей табличной части. </p>
<p>Теперь нажмем кнопку Заполнить выражения. В нижнем окне сформируется соответствие полей (измерений и ресурсов)
	регистра и выражений для их расчета.</p>
<p>Чтобы задать нужное соответствие для поля регистра Стоимость, нужно его выделить и в окне Реквизиты документа дважды
	щелкнуть по строке ТекСтрокаМатериалы.Сумма (рис. 11.5).</p>
<p>Нажмем ОК. После этого откроется модуль объекта документа Приходная накладная. Откроем процедуру обработчика события
	ОбработкаПроведения.</p>
<p><strong>Рис. 11.5.</strong> Конструктор движений регистров</p>
<p>Мы увидим, что конструктор сформировал новый текст обработчика, содержащий движения по двум регистрам (листинг 11.1).
	<strong>листинг 11.1.</strong> Движения документа «ПриходнаяНакладная»</p>
<table>
	<tr>
		<td><p>Процедура ОбработкаПроведения(Отказ, Режим)</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>//{{__КОНСТРУКТОР_ДВИЖЕНИЙ_РЕГИСТРОВ</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// Данный фрагмент построен конструктором.</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// При повторном использовании конструктора внесенные вручную изменения будут утеряны!!!</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// регистр ОстаткиМатериалов Приход</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движения.ОстаткиМатериалов.Записывать = Истина;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Для Каждого ТекСтрокаМатериалы Из Материалы Цикл</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение = Движения.ОстаткиМатериалов.Добавить();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.ВидДвижения = ВидДвиженияНакопления.Приход;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.Период = Дата;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.Материал = ТекСтрокаМатериалы.Материал;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.Склад = Склад;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.Количество = ТекСтрокаМатериалы.Количество;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецЦикла;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>// регистр СтоимостьМатериалов Приход</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>Движения.СтоимостьМатериалов.Записывать = Истина;</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>Для Каждого ТекСтрокаМатериалы Из Материалы Цикл</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>Движение = Движения.СтоимостьМатериалов.Добавить();</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>Движение.ВидДвижения = ВидДвиженияНакопления.Приход;</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>Движение.Период = Дата;</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>Движение.Материал = ТекСтрокаМатериалы.Материал;</strong></p></td>
	</tr>
</table>
<p>Движение.Стоимость = ТекСтрокаМатериалы.Сумма;</p>
<table>
	<tr>
		<td><p><strong>КонецЦикла;</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>//}}__КОНСТРУКТОР_ДВИЖЕНИЙ_РЕГИСТРОВ</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецПроцедуры</p></td>
	</tr>
</table>
<p>Мы видим, что фрагмент, добавленный конструктором в процедуру обработки проведения документа для регистра
	СтоимостьМатериалов, аналогичен фрагменту для формирования движений по регистру ОстаткиМатериалов. </p>
<p>Однако сразу бросается в глаза, что совершенно не нужно обходить два одинаковых цикла по элементам табличной части
	Материалы. Можно в одном цикле формировать движения сразу по двум регистрам.</p>
<p>Выполним эту небольшую оптимизацию. И еще удалим комментарии, внесенные конструктором.</p>
<p>В результате процедура ОбработкаПроведения будет выглядеть следующим образом (листинг 11.2). <strong>листинг
	11.2.</strong> Движения документа «ПриходнаяНакладная»</p>
<table>
	<tr>
		<td><p>Процедура ОбработкаПроведения(Отказ, Режим)</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движения.ОстаткиМатериалов.Записывать = Истина;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движения.СтоимостьМатериалов.Записывать = Истина;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Для Каждого ТекСтрокаМатериалы Из Материалы Цикл</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// Регистр ОстаткиМатериалов Приход</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение = Движения.ОстаткиМатериалов.Добавить();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.ВидДвижения = ВидДвиженияНакопления.Приход;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.Период = Дата;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.Материал = ТекСтрокаМатериалы.Материал;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.Склад = Склад;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.Количество = ТекСтрокаМатериалы.Количество;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// Регистр Стоимость Материалов Приход</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение = Движения.СтоимостьМатериалов.Добавить();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.ВидДвижения = ВидДвиженияНакопления.Приход;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.Период = Дата;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.Материал = ТекСтрокаМатериалы.Материал;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.Стоимость = ТекСтрокаМатериалы.Сумма;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецЦикла;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецПроцедуры</p></td>
	</tr>
</table>
<p>Команда перехода к записям регистра</p>
<p>В заключение отредактируем командный интерфейс формы документа, чтобы в панели навигации формы иметь возможность
	переходить к списку записей регистра СтоимостьМатериалов, связанному с документом. </p>
<p>Для этого откроем форму документа ПриходнаяНакладная. В левом верхнем окне перейдем на закладку Командный интерфейс.
	В разделе Панель навигации раскроем группу Перейти и увидим команду для открытия регистра накопления Стоимость
	материалов. Установим свойство Видимость для этой команды (рис. 11.6).</p>
<p>документа «ПриходнаяНакладная»</p>
<p>В режиме «1С:Предприятие»</p>
<p>В режиме 1С:Предприятие наша задача будет заключаться в том, чтобы провести еще раз (перепровести) все приходные
	накладные. Это необходимо для того, чтобы эти документы создали новые записи в регистрах в соответствии с алгоритмом
	проведения, который мы только что изменили. </p>
<p>Запустим «1С:Предприятие» в режиме отладки. Откроем список документов, выполнив команду Приходные накладные в разделе
	Учет материалов. </p>
<p>Выделим одновременно, используя клавишу Ctrl, все приходные накладные и перепроведем их, выполнив команду Провести из
	подменю Еще. </p>
<p>Затем откроем первый документ (рис. 11.7) и, выполнив команды перехода к регистрам Остатки материалов и Стоимость
	материалов, убедимся, что документ создает желаемые записи как в одном (рис. 11.8), так и в другом регистре
	накопления (рис. 11.9).</p>
<p><strong>Рис. 11.8.</strong> Записи регистра «Остатки материалов»</p>
<p><strong>Рис. 11.9.</strong> Записи регистра «Стоимость материалов»</p>
<h1><a id="_Toc454870659"></a>Лабораторная работа № 14 Учет затрат на производство</h1>
<p><strong>Порядок выполнения работы </strong></p>
<p>1. Ознакомьтесь с теоретическими основами в настоящих указаниях и конспектах лекций. </p>
<p>2. Получите задание у преподавателя. </p>
<p>3. Сделайте скриншоты (кнопка клавиатуры PrtSc) выполненных заданий в текстовом (Word) файле <em>Фамилия_ЛР</em></p>
<p>4. Составьте отчет по лабораторной работе. </p>
<p>5. Отчитайте работу преподавателю.</p>
<p><strong>Проведение документа «Оказание услуги» по двум регистрам</strong></p>
<p>В заключение мы внесем изменения в процедуру обработки проведения документа ОказаниеУслуги. </p>
<p>При этом мы будем исходить из пожелания, высказанного руководством ООО «На все руки мастер». Суть его заключается в
	том, что на первом этапе при списании материалов, израсходованных в процессе оказания услуги, должна быть
	возможность указывать различную стоимость для одного и того же материала, которая рассчитана руководством исходя из
	текущих конъюнктурных соображений.</p>
<p>Поскольку в документе ОказаниеУслуги у нас отражена только цена номенклатуры, нам понадобится:</p>
<ol>
	<li>Добавить в табличную часть документа еще один реквизит, в котором будет указываться стоимость номенклатуры.</li>
	<li>После этого изменить процедуру проведения документа ОказаниеУслуги.</li>
	<li>И в заключение в режиме 1С:Предприятие перепровести все эти документы, чтобы отработал новый измененный нами
		алгоритм проведения документов Оказание услуги.
	</li>
</ol>
<p>В режиме «Конфигуратор»</p>
<p>Новый реквизит документа</p>
<p>Откроем в конфигураторе окно редактирования объекта конфигурации Документ ОказаниеУслуги и перейдем на закладку
	Данные. </p>
<p>Создадим новый реквизит табличной части документа с именем Стоимость, типом Число, длиной 15 и точностью 2,
	неотрицательное (рис. 11.10).</p>
<p>После этого откроем форму ФормаДокумента документа Оказа- ниеУслуги и добавим в табличную часть ПереченьНоменклатуры
	поле, отображающее новый реквизит Стоимость. </p>
<p>Для этого в правом верхнем окне редактора форм на закладке Реквизиты раскроем реквизит формы Объект (рис.
	11.11). </p>
<p><strong>Рис. 11.11.</strong> Изменение формы документа «ОказаниеУслуги»</p>
<p>Мы видим, что он содержит все реквизиты документа ОказаниеУслуги. </p>
<p>Найдем в табличной части реквизит Стоимость и с помощью мыши перетащим его в окно элементов формы, расположенное
	слева в верхней части редактора форм. </p>
<p>Новый элемент расположим в структуре элементов формы после поля Номенклатура. Оставим свойства элемента формы,
	предложенные по умолчанию.</p>
<p>Новый реквизит сразу же отобразится в форме документа, расположенной в левом нижнем окне редактора форм (рис.
	11.12).</p>
<p><strong>Рис. 11.12.</strong> Изменение формы документа «ОказаниеУслуги»</p>
<p>Изменение процедуры проведения</p>
<p>Теперь создадим движения документа ОказаниеУслуги. </p>
<p>В окне редактирования объекта конфигурации Документ Оказа- ниеУслуги перейдем на закладку Движения. В списке
	регистров отметим, что документ будет создавать теперь движения и по регистру СтоимостьМатериалов. </p>
<p>Чтобы не потерять изменения, которые мы вносили в процедуру обработки проведения этого документа на предыдущем
	занятии, на этот раз мы не будем использовать конструктор движений документа, а внесем необходимые дополнения прямо
	в обработчик события ОбработкаПроведения документа ОказаниеУслуги. </p>
<p>Перейдем на закладку Прочее и откроем модуль объекта. Для этого нажмем кнопку Модуль объекта. Откроем процедуру
	обработчика события ОбработкаПроведения. </p>
<p>В самом конце цикла перед строкой КонецЕсли добавим строки кода, создающие движения регистра СтоимостьМатериалов,
	производимые документом ОказаниеУслуги (листинг 11.3).</p>
<p><strong>листинг 11.3.</strong> Движения документа «ОказаниеУслуги» (фрагмент)</p>
<table>
	<tr>
		<td><p><strong>// регистр СтоимостьМатериалов Расход</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>Движение = Движения.СтоимостьМатериалов.Добавить();</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>Движение.ВидДвижения = ВидДвиженияНакопления.Расход;</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>Движение.Период = Дата;</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>Движение.Материал = ТекСтрокаПереченьНоменклатуры.Номенклатура;</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>Движение.Стоимость = ТекСтрокаПереченьНоменклатуры.Количество * </strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>ТекСтрокаПереченьНоменклатуры.Стоимость;</strong></p></td>
	</tr>
</table>
<p>Перед началом цикла установим свойство Записывать набора записей движений по этому регистру в значение Истина. Удалим
	комментарии, внесенные конструктором.</p>
<p>В результате процедура ОбработкаПроведения будет выглядеть следующим образом (листинг 11.4). <strong>листинг
	11.4.</strong> Движения документа «ОказаниеУслуги»</p>
<table>
	<tr>
		<td><p>Процедура ОбработкаПроведения(Отказ, Режим)</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движения.ОстаткиМатериалов.Записывать = Истина;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>Движения.СтоимостьМатериалов.Записывать = Истина;</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Для Каждого ТекСтрокаПереченьНоменклатуры Из ПереченьНоменклатуры Цикл</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Если ТекСтрокаПереченьНоменклатуры.Номенклатура.ВидНоменклатуры = </p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Перечисления.ВидыНоменклатуры.Материал Тогда </p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// Регистр ОстаткиМатериалов Расход</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение = Движения.ОстаткиМатериалов.Добавить();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.ВидДвижения = ВидДвиженияНакопления.Расход;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.Период = Дата;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.Материал = ТекСтрокаПереченьНоменклатуры.Номенклатура;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.Склад = Склад;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.Количество = ТекСтрокаПереченьНоменклатуры.Количество;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>// Регистр СтоимостьМатериалов Расход</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>Движение = Движения.СтоимостьМатериалов.Добавить();</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>Движение.ВидДвижения = ВидДвиженияНакопления.Расход;</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>Движение.Период = Дата;</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>Движение.Материал = ТекСтрокаПереченьНоменклатуры.Номенклатура;</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>Движение.Стоимость = ТекСтрокаПереченьНоменклатуры.Количество </strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>* ТекСтрокаПереченьНоменклатуры.Стоимость;</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецЕсли;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецЦикла;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецПроцедуры</p></td>
	</tr>
</table>
<p>Обратите внимание, что измерение регистра Стоимость вычисляется как произведение стоимости и количества, указанных в
	табличной части документа.</p>
<p>В заключение отредактируем командный интерфейс формы документа, чтобы в панели навигации формы иметь возможность
	переходить к списку записей регистра Стоимость Материалов, связанному с документом. </p>
<p>Для этого откроем форму документа ОказаниеУслуги. В левом верхнем окне перейдем на закладку Командный интерфейс. В
	разделе Панель навигации раскроем группу Перейти и увидим команду для открытия регистра накопления Стоимость
	материалов. Установим свойство Видимость для этой команды.</p>
<p>В режиме «1С:Предприятие»</p>
<p>В режиме 1С:Предприятие наша задача будет заключаться в том, чтобы провести еще раз (перепровести) наш документ
	оказания услуги. Это необходимо для того, чтобы этот документ создал новые записи в регистрах в соответствии с
	алгоритмом проведения, который мы только что изменили. </p>
<p>Запустим «1С:Предприятие» в режиме отладки и откроем список документов, выполнив команду Оказание услуг в разделе
	Оказание услуг. </p>
<p>Откроем документ Оказание услуги № 1 и укажем в нем стоимость резинового шланга – 100 (рис. 11.13).</p>
<p><strong>Рис. 11.13.</strong> Документ «Оказание услуги № 1»</p>
<p>Проведем документ Оказание услуги № 1 и посмотрим на движения этого документа по регистру Стоимость материалов. </p>
<p>Для этого нажмем кнопку Провести и выполним команду перехода к регистру Стоимость материалов (рис. 11.14).</p>
<p><strong>Рис. 11.14.</strong> Записи регистра «Стоимость материалов»</p>
<p>Теперь создадим и проведем еще два документа Оказание услуги. </p>
<p>Для этого в форме списка документов нажмем кнопку Создать или в панели действий раздела Оказание услуг выполним
	команду </p>
<p><strong>Рис. 11.15.</strong> Создание новых документов</p>
<p>Эти документы понадобятся нам в дальнейшем, поэтому будьте внимательны и обратите внимание на то, что эти документы
	созданы другими датами (рис. 11.16, 11.17).</p>
<p><strong>Рис. 11.16.</strong> Документ «Оказание услуги № 2»</p>
<p><strong>Рис. 11.17.</strong> Документ «Оказание услуги № 3»</p>
<p>Движения документов Оказание услуги № 2 и № 3 по регистру Стоимость материалов должны выглядеть соответственно
	следующим образом (рис. 11.18, 11.19).</p>
<p><strong>Рис. 11.18.</strong> Движения документа «Оказание услуги № 2»</p>
<p><strong>Рис. 11.19.</strong> Движения документа «Оказание услуги № 3»</p>
<h1><a id="_Toc454870660"></a>Лабораторная работа № 15Учет НМА</h1>
<p><strong>Порядок выполнения работы </strong></p>
<p>1. Ознакомьтесь с теоретическими основами в настоящих указаниях и конспектах лекций. </p>
<p>2. Получите задание у преподавателя. </p>
<p>3. Сделайте скриншоты (кнопка клавиатуры PrtSc) выполненных заданий в текстовом (Word) файле <em>Фамилия_ЛР</em></p>
<p>4. Составьте отчет по лабораторной работе. </p>
<p>5. Отчитайте работу преподавателю.</p>
<p><strong>Добавление оборотного регистра накопления</strong></p>
<p>В режиме «Конфигуратор»</p>
<p>Теперь, когда мы знаем практически все о регистрах накопления, откроем конфигуратор и создадим новый объект
	конфигурации Регистр накопления. </p>
<p>Назовем его Продажи и определим вид регистра – Обороты. </p>
<p>Кроме этого, зададим Расширенное представление списка как Движения по регистру Продажи. Этот заголовок будет
	отображаться в окне списка записей регистра (рис. 12.1).</p>
<p>На закладке Подсистемы отметим, что этот регистр будет отображаться в подсистемах Бухгалтерия, Учет материалов и
	Оказание услуг.</p>
<p>На закладке Данные создадим измерения регистра:</p>
<ul>
	<li>Номенклатура, тип СправочникСсылка.Номенклатура;</li>
	<li>Клиент, тип СправочникСсылка.Клиенты;</li>
	<li>Мастер, тип СправочникСсылка.Сотрудники.</li>
</ul>
<p><strong>Рис. 12.1.</strong> Создание оборотного регистра накопления</p>
<p>У регистра будет три ресурса:</p>
<ul>
	<li>Количество, тип Число, длина 15, точность 3;</li>
	<li>Выручка, тип Число, длина 15, точность 2;</li>
	<li>Стоимость, тип Число, длина 15, точность 2.</li>
</ul>
<p>После создания регистр Продажи должен выглядеть в дереве конфи-</p>
<p> гурации следующим образом </p>
<p>(рис. 12.2).</p>
<p><strong>Рис. 12.2.</strong> Оборотный регистр накопления «Продажи»</p>
<p>Теперь отредактируем командный интерфейс, чтобы в подсистемах Бухгалтерия, Оказание услуг и Учет материалов была
	доступна команда для просмотра нашего оборотного регистра накопления. </p>
<p>В дереве объектов конфигурации выделим ветвь Подсистемы, вызовем ее контекстное меню и выберем пункт Все
	подсистемы. </p>
<p>В открывшемся окне слева в списке Подсистемы выделим подсистему Бухгалтерия. </p>
<p>Справа в списке Командный интерфейс отразятся все команды выбранной подсистемы. </p>
<p>В группе Панель навигации.Обычное включим видимость у команды Продажи и мышью перетащим ее в группу Панель
	навигации.См. также. </p>
<p>Аналогично, выделив подсистемы ОказаниеУслуг и УчетМатериалов, в группе Панель навигации.Обычное включим видимость у
	команды Продажи и перенесем ее в группу Панель навигации.См. также.</p>
<p><strong>Проведение документа «Оказание услуги» по трем регистрам</strong></p>
<p>В этом разделе мы сначала изменим процедуру проведения документа ОказаниеУслуги, а затем в режиме 1С:Предприятие
	перепроведем все эти документы, чтобы отработал новый, измененный нами алгоритм проведения документов Оказание
	услуги. </p>
<p>В режиме «Конфигуратор»</p>
<p>Откроем окно редактирования объекта конфигурации Документ ОказаниеУслуги и на закладке Движения укажем, что этот
	документ будет создавать движения еще и по регистру Продажи.</p>
<p>Перейдем на закладку Прочее и откроем модуль документа. Для этого нажмем кнопку Модуль объекта. </p>
<p>Откроем процедуру обработчика события ОбработкаПроведения. </p>
<p>В конце цикла после строки КонецЕсли и перед строкой КонецЦикла добавим строки кода, создающие движения регистра
	Продажи, производимые документом ОказаниеУслуги (листинг 12.1).</p>
<p><strong>листинг 12.1.</strong> Движения документа «ОказаниеУслуги» (фрагмент)</p>
<p><strong>// Регистр Продажи </strong></p>
<table>
	<tr>
		<td><p><strong>Движение = Движения.Продажи.Добавить();</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>Движение.Период = Дата;</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>Движение.Номенклатура = ТекСтрокаПереченьНоменклатуры.Номенклатура;</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>Движение.Клиент = Клиент;</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>Движение.Мастер = Мастер;</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>Движение.Количество = ТекСтрокаПереченьНоменклатуры.Количество;</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>Движение.Выручка = ТекСтрокаПереченьНоменклатуры.Сумма;</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>Движение.Стоимость = ТекСтрокаПереченьНоменклатуры.Стоимость * </strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>ТекСтрокаПереченьНоменклатуры.Количество;</strong></p></td>
	</tr>
</table>
<p>Перед началом цикла установим свойство Записывать набора записей движений по этому регистру в значение Истина.</p>
<p>В результате процедура ОбработкаПроведения будет выглядеть следующим образом (листинг 12.2). <strong>листинг
	12.2.</strong> Движения документа «ОказаниеУслуги»</p>
<table>
	<tr>
		<td><p>Процедура ОбработкаПроведения(Отказ, Режим)</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движения.ОстаткиМатериалов.Записывать = Истина;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движения.СтоимостьМатериалов.Записывать = Истина;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>Движения.Продажи.Записывать = Истина;</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Для Каждого ТекСтрокаПереченьНоменклатуры Из ПереченьНоменклатуры Цикл</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Если ТекСтрокаПереченьНоменклатуры.Номенклатура.ВидНоменклатуры = </p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Перечисления.ВидыНоменклатуры.Материал Тогда </p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// Регистр ОстаткиМатериалов Расход</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение = Движения.ОстаткиМатериалов.Добавить();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.ВидДвижения = ВидДвиженияНакопления.Расход;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.Период = Дата;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.Материал = ТекСтрокаПереченьНоменклатуры.Номенклатура;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.Склад = Склад;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.Количество = ТекСтрокаПереченьНоменклатуры.Количество;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// Регистр СтоимостьМатериалов Расход</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение = Движения.СтоимостьМатериалов.Добавить();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.ВидДвижения = ВидДвиженияНакопления.Расход;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.Период = Дата;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.Материал = ТекСтрокаПереченьНоменклатуры.Номенклатура;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.Стоимость = ТекСтрокаПереченьНоменклатуры.Количество * </p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ТекСтрокаПереченьНоменклатуры.Стоимость;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецЕсли;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>// Регистр Продажи </strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>Движение = Движения.Продажи.Добавить();</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>Движение.Период = Дата;</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>Движение.Номенклатура = ТекСтрокаПереченьНоменклатуры.Номенклатура;</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>Движение.Клиент = Клиент;</strong></p></td>
	</tr>
</table>
<p><strong>Движение.Мастер = Мастер;</strong></p>
<p><strong>Движение.Количество = ТекСтрокаПереченьНоменклатуры.Количество;</strong></p>
<table>
	<tr>
		<td><p><strong>Движение.Выручка = ТекСтрокаПереченьНоменклатуры.Сумма;</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>Движение.Стоимость = ТекСтрокаПереченьНоменклатуры.Стоимость * </strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>ТекСтрокаПереченьНоменклатуры.Количество;</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецЦикла;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецПроцедуры</p></td>
	</tr>
</table>
<p>Все добавленные конструкции вам уже хорошо известны. </p>
<p>Обратите внимание лишь на то, что у оборотного регистра отсутствует свойство ВидДвижения, поскольку отражение вида
	движения (приход или расход) имеет смысл лишь при учете остатков. В случае регистра оборотов нас интересует только
	значение, которое должно быть записано в ресурс регистра.</p>
<p>Также заметьте, что мы разместили команды, создающие движения в регистре Продажи, в конце цикла обхода строк
	табличной части документа, после условия выполнения цикла только для материалов. Это важно, так как движения в этом
	регистре создаются как для материалов, так и для услуг.</p>
<p>В заключение отредактируем командный интерфейс формы документа, чтобы в панели навигации формы иметь возможность
	переходить к списку записей регистра Продажи, связанному с документом. </p>
<p>Для этого откроем форму документа ОказаниеУслуги. В левом верхнем окне перейдем на закладку Командный интерфейс. В
	разделе Панель навигации раскроем группу Перейти и увидим команду для открытия регистра накопления Продажи. </p>
<p>Установим свойство Видимость для этой команды.</p>
<p>В режиме «1С:Предприятие»</p>
<p>В режиме 1С:Предприятие нам нужно перепровести все документы оказания услуг и проверить, что они создают правильные
	движения в регистре Продажи.</p>
<p>Запустим «1С:Предприятие» в режиме отладки и откроем по очереди каждый документ Оказание услуги. </p>
<p>Нажмем Провести и перейдем к списку движений этих документов по регистру Продажи. Они должны иметь следующий вид
	(рис. 12.3а, 12.3б, 12.4а, 12.4б, 12.5а, 12.5б).</p>
<p><strong>Рис. 12.3а.</strong> Движения документа «Оказание услуги № 1» в регистре «Продажи»</p>
<p><strong>Рис. 12.3б.</strong> Движения документа «Оказание услуги № 1» в регистре «Продажи»</p>
<p><strong>Рис. 12.4а.</strong> Движения документа «Оказание услуги № 2» в регистре «Продажи»</p>
<p><strong>Рис. 12.4б.</strong> Движения документа «Оказание услуги № 2» в регистре «Продажи»</p>
<p><strong>Рис. 12.5а.</strong> Движения документа «Оказание услуги № 3» в регистре «Продажи»</p>
<p><strong>Рис. 12.5б.</strong> Движения документа «Оказание услуги № 3» в регистре «Продажи»</p>
<p>На рисунках видно, что в регистр Продажи попадают записи о любой номенклатуре, которая является как материалом, так и
	услугой.</p>
<p>Теперь у нас есть практически вся необходимая информация для анализа деятельности ООО «На все руки мастер». </p>
<p>На следующем занятии мы займемся с вами тем, что создадим несколько отчетов, представляющих нам итоговую информацию о
	работе предприятия.</p>
<h1><a id="_Toc454870661"></a>Лабораторная работа № 16 Отпуск материалов</h1>
<p><strong>Порядок выполнения работы </strong></p>
<p>1. Ознакомьтесь с теоретическими основами в настоящих указаниях и конспектах лекций. </p>
<p>2. Получите задание у преподавателя. </p>
<p>3. Сделайте скриншоты (кнопка клавиатуры PrtSc) выполненных заданий в текстовом (Word) файле <em>Фамилия_ЛР</em></p>
<p>4. Составьте отчет по лабораторной работе. </p>
<p>5. Отчитайте работу преподавателю.</p>
<p><strong>Выбор данных из одной таблицы</strong></p>
<p>Создадим отчет Реестр документов оказание услуги, используя систему компоновки данных. </p>
<p>На примере этого отчета мы покажем, как выбрать данные из одной таблицы базы данных и как вывести их в определенном
	порядке. Также мы познакомимся с тем, как использовать расшифровку в готовом отчете.</p>
<p>Этот отчет будет выводить список существующих в базе данных документов ОказаниеУслуги в порядке их дат и номеров
	(рис. 13.7).</p>
<p><strong>Рис. 13.7.</strong> Результат отчета</p>
<p>В режиме «Конфигуратор»</p>
<p>Добавим в конфигураторе объект конфигурации Отчет. Повторим первые шаги по созданию отчета.</p>
<p>На закладке Основные зададим имя отчета – РеестрДокументовОказаниеУслуги. </p>
<p>Установим свойство Расширенное представление как Список оказанных услуг для представления отчета в интерфейсе
	программы. </p>
<p>В открывшемся диалоговом окне конструктора макета нажмем Готово. В конструкторе схемы компоновки данных создадим
	Набор данных – запрос (рис. 13.9).</p>
<p><strong>Рис. 13.9.</strong> Создание набора данных – запрос</p>
<p>Запрос для набора данных</p>
<p>Нажав кнопку Конструктор запроса, запустим конструктор запроса. </p>
<p>В качестве источника данных для запроса выберем объектную (ссылочную) таблицу документа ОказаниеУслуги. </p>
<p>Из этой таблицы выберем следующие поля (рис. 13.10):</p>
<ul>
	<li>Склад,</li>
	<li>Мастер,</li>
	<li>Клиент,</li>
</ul>
<p><strong>Рис. 13.10.</strong> Выбранные поля для запроса</p>
<p><strong>пРиМеЧАние</strong></p>
<p>Выделенные элементы можно перенести из одного списка в другой перетаскиванием мышью или двойным щелчком на них. Либо
	можно использовать кнопки .</p>
<p>Псевдонимы полей</p>
<p>Перейдем на закладку Объединения/Псевдонимы и укажем, что поле Ссылка будет иметь псевдоним Документ (рис.
	13.11).</p>
<p><strong>соВет</strong></p>
<p>Имена полей лучше изменять в запросе, так как в этом случае в схему компоновки данных они перенесутся сразу в три
	колонки: Поле, Путь и Заголовок, и не нужно будет лишний раз их изменять.</p>
<p><strong>Рис. 13.11.</strong> Установка псевдонимов полей запроса</p>
<p>Порядок записей</p>
<p>После этого перейдем на закладку Порядок и укажем, что результат запроса должен быть упорядочен по значению поля
	Документ </p>
<p>(рис. 13.12).</p>
<p>Нажмем ОK и посмотрим, какой запрос сформировал конструктор запроса (листинг 13.1). <strong>листинг 13.1.</strong>
	Текст запроса</p>
<table>
	<tr>
		<td><p>ВЫБРАТЬ</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ОказаниеУслуги.Склад,</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ОказаниеУслуги.Мастер,</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ОказаниеУслуги.Клиент,</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ОказаниеУслуги.Ссылка КАК Документ</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ИЗ</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Документ.ОказаниеУслуги КАК ОказаниеУслуги</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>УПОРЯДОЧИТЬ ПО</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Документ</p></td>
	</tr>
</table>
<p>Текст запроса начинается, как мы говорили выше, с <em>части описания запроса</em> (листинг 13.2).</p>
<p><strong>листинг 13.2.</strong> Описание запроса</p>
<table>
	<tr>
		<td><p>ВЫБРАТЬ</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ОказаниеУслуги.Склад,</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ОказаниеУслуги.Мастер,</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ОказаниеУслуги.Клиент,</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ОказаниеУслуги.Ссылка КАК Документ</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ИЗ</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Документ.ОказаниеУслуги КАК ОказаниеУслуги</p></td>
	</tr>
</table>
<p>Описание запроса начинается с обязательного ключевого слова ВЫБРАТЬ. </p>
<p>Затем следует <em>список полей выборки</em>. В нем описываются поля, которые должны содержаться в результате запроса.
	Этот список может содержать как собственно поля, так и некоторые выражения, вычисляемые на основе значений полей.
</p>
<p>После ключевого слова ИЗ указываются <em>источники данных</em> – исходные таблицы запроса, содержимое которых
	обрабатывается в запросе. </p>
<p>В данном случае это объектная (ссылочная) таблица Документ.ОказаниеУслуги. </p>
<p>После ключевого слова КАК указывается <em>псевдоним источника данных</em>. </p>
<p>В нашем случае это ОказаниеУслуги. В дальнейшем к этому источнику данных можно будет обращаться в тексте запроса,
	используя его псевдоним.</p>
<p>Такое обращение мы видим в описании полей выборки (листинг 13.3). <strong>листинг 13.3.</strong> Описание полей
	выборки</p>
<table>
	<tr>
		<td><p>ВЫБРАТЬ</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>ОказаниеУслуги</strong>.Склад,</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>ОказаниеУслуги</strong>.Мастер,</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>ОказаниеУслуги</strong>.Клиент,</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>ОказаниеУслуги</strong>.Ссылка КАК <strong>Документ</strong></p></td>
	</tr>
</table>
<p>Поля выборки также могут иметь псевдонимы, по которым в дальнейшем в тексте запроса можно обращаться к этому полю. В
	нашем случае это псевдоним Документ у поля Ссылка.</p>
<p>После части описания запроса в нашем примере следует <em>часть упорядочивания результатов</em> (листинг 13.4).
	<strong>листинг 13.4.</strong> Упорядочивание результатов запроса</p>
<table>
	<tr>
		<td><p>УПОРЯДОЧИТЬ ПО</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Документ</p></td>
	</tr>
</table>
<p>Предложение УПОРЯДОЧИТЬ ПО позволяет сортировать строки в результате запроса. После этого ключевого предложения
	располагается выражение упорядочивания, которое в общем случае представляет собой перечисление полей (выражений) и
	порядка вывода. </p>
<p>В нашем случае упорядочивание будет выполняться по полю Документ, оно же поле ОказаниеУслуги.Ссылка. Порядок
	сортировки будет по возрастанию (если порядок сортировки не указан явно, выполняется сортировка по
	возрастанию). </p>
<p>На этом закончим изучение текста запроса и перейдем к настройке схемы компоновки данных.</p>
<p>Настройки</p>
<p>Перейдем на закладку Настройки и создадим стандартные настройки, определяющие, как будет выводиться информация в
	отчет. </p>
<p>Иерархическая структура отчета может содержать в различных сочетаниях три основных элемента:</p>
<ul>
	<li><em>Группировка</em> – для вывода информации в виде обычного линейного отчета;</li>
	<li><em>Таблица</em> – для вывода информации в виде таблицы;</li>
	<li><em>Диаграмма</em> – для вывода информации в виде диаграммы.</li>
</ul>
<p>Для добавления нового элемента в нашем случае группировки выделим в дереве структуры отчета корневой элемент Отчет и
	вызовем его контекстное меню.</p>
<p>Можно также нажать кнопку Добавить, расположенную в командной панели окна, или нажать клавишу Ins. Выберем пункт меню
	Новая группировка (рис. 13.13).</p>
<p><strong>Рис. 13.13.</strong> Добавление новой группировки в отчет</p>
<p>В окне выбора поля группировки просто нажмем ОK (тем самым мы указываем, что в группировке будут выводиться детальные
	записи из информационной базы). </p>
<p>В структуре отчета появится группировка Детальные записи. </p>
<p>На закладке Выбранные поля перенесем мышью из списка доступных полей те поля, которые будут выводиться в отчет:</p>
<ul>
	<li>Документ,</li>
	<li>Склад,</li>
	<li>Мастер,  Клиент.</li>
</ul>
<p><strong>пРиМеЧАние</strong></p>
<p>Добавление доступных полей в список выбранных полей можно осуществить перетаскиванием мышью, двойным щелчком на
	доступных полях либо нажатием кнопки Добавить справа от списка выбранных полей. Порядок выбранных полей можно
	изменить позже кнопками Вверх, Вниз или перетаскиванием мышью.</p>
<p>В результате окно настроек отчета должно иметь вид (рис. 13.14).</p>
<p>На этом создание отчета закончено.</p>
<p>В заключение определим, в каких подсистемах будет отображаться наш отчет. Закроем конструктор схемы компоновки данных
	и в окне редактирования объекта конфигурации Отчет РеестрДокументовОказаниеУслуги перейдем на закладку Подсистемы.
	Отметим в списке подсистему Оказание услуг. </p>
<p>Таким образом, ссылка на наш отчет автоматически попадет в панель команд этого раздела, в подменю Отчеты (рис.
	13.15).</p>
<p><strong>Рис. 13.15.</strong> Определение списка подсистем, в которых будет отражаться отчет</p>
<p>В режиме «1С:Предприятие»</p>
<p>Запустим «1С:Предприятие» в режиме отладки и посмотрим, как работает отчет. </p>
<p>В открывшемся окне «1С:Предприятия» мы видим, что в разделе Оказание услуг в подменю Отчеты, содержащем команды для
	выполнения отчетов, появилась команда для формирования отчета Реестр документов оказание услуги. </p>
<p><strong>Рис. 13.16.</strong> Команда для формирования отчета </p>
<p>Откроется форма отчета, автоматически сформированная системой. </p>
<p>Заметьте, что заголовок этой формы представлен как Список оказанных услуг, так как он определяется свойством
	Расширенное представление, которое мы задали для отчета.</p>
<p>Нажмем кнопку Сформировать (рис. 13.17).</p>
<p>Мы видим, что отчет содержит реестр документов Оказание услуги. </p>
<p>Двойным щелчком мыши на поле Документ мы можем открыть исходный документ, а также правой кнопкой мыши вызвать
	контекстное меню «расшифровки», содержащие дополнительные действия по расшифровке (Открыть, Расшифровать и т. п.)
	значений, находящихся в этом поле.</p>
<p>Таким образом, на примере этого отчета мы продемонстрировали, как использовать конструктор схемы компоновки данных, и
	познакомились с некоторыми основными конструкциями языка запросов.</p>
<h1><a id="_Toc454870662"></a>Лабораторная работа № 17 Начисление зарплаты</h1>
<p><strong>Порядок выполнения работы </strong></p>
<p>1. Ознакомьтесь с теоретическими основами в настоящих указаниях и конспектах лекций. </p>
<p>2. Получите задание у преподавателя. </p>
<p>3. Сделайте скриншоты (кнопка клавиатуры PrtSc) выполненных заданий в текстовом (Word) файле <em>Фамилия_ЛР</em></p>
<p>4. Составьте отчет по лабораторной работе. </p>
<p>5. Отчитайте работу преподавателю.</p>
<p><strong>Выбор данных из двух таблиц</strong></p>
<p>Отчет Рейтинг услуг будет содержать информацию о том, выполнение каких услуг принесло ООО «На все руки мастер»
	наибольшую прибыль в указанном периоде (рис. 13.18).</p>
<p>На примере отчета Рейтинг услуг мы проиллюстрируем, как отбирать данные в некотором периоде, как задавать параметры
	запроса, как использовать в запросе данные из нескольких таблиц и как включать в результат запроса все данные одного
	из источников. </p>
<p>Также мы узнаем, как работать с параметрами системы компоновки данных, как использовать стандартные даты, и
	познакомимся с быстрыми пользовательскими настройками отчетов. </p>
<p>Кроме этого, мы научимся более детально настраивать отбор и условное оформление в отчетах.</p>
<p>В режиме «Конфигуратор»</p>
<p>Добавим новый объект конфигурации Отчет. </p>
<p>Назовем его РейтингУслуг и запустим конструктор схемы компоновки данных. </p>
<p>Добавим новый Набор данных – запрос и вызовем конструктор запроса.</p>
<p>Запрос для набора данных</p>
<p>Левое соединение двух таблиц</p>
<p>В качестве источника данных для запроса выберем объектную (ссылочную) таблицу Номенклатура и виртуальную таблицу
	регистра накопления Продажи.Обороты. </p>
<p>Чтобы исключить неоднозначность имен в запросе, переименуем таблицу Номенклатура в спрНоменклатура. </p>
<p>Для этого выделим ее в списке Таблицы, вызовем ее контекстное меню и выберем пункт Переименовать таблицу (рис.
	13.19).</p>
<p><img src="18.jpeg"/><strong>Рис. 13.19.</strong> Переименование таблицы в запросе</p>
<p>В список полей перенесем поля СпрНоменклатура.Ссылка и Прода- жиОбороты.ВыручкаОборот из этих таблиц (рис.
	13.20).</p>
<p><img src="19.jpeg"/> <strong>Рис. 13.20.</strong> Выбранные поля Перейдем на закладку Связи. </p>
<p>Так как в запросе теперь участвуют несколько таблиц, требуется определить связь между ними. </p>
<p>По умолчанию платформой уже будет создана связь по полю Номенклатура. То есть значение измерения Номенклатура
	регистра Продажи должно быть равно ссылке на элемент справочника Номенклатура. </p>
<p>Но нам нужно снять флажок Все у таблицы ПродажиОбороты и установить его у таблицы спрНоменклатура. </p>
<p>Тем самым мы задаем тип связи как Левое соединение, то есть в результат запроса будут включены все записи справочника
	Номенклатура и те записи регистра Продажи, которые удовлетворяют условию связи по полю Номенклатура. </p>
<p>Таким образом, в результате запроса будут присутствовать все услуги, и для некоторых из них будут указаны обороты
	выручки. Для тех услуг, которые не производились в выбранном периоде, не будет указано ничего.</p>
<p>Описанную связь двух таблиц схематично можно представить следующим примером (рис. 13.21).</p>
<p><img src="20.png"/></p>
<p><strong>Рис. 13.21.</strong> Связь записей таблиц в запросе</p>
<p>В результате описанных выше действий закладка Связи будет иметь следующий вид (рис. 13.22).</p>
<p><strong>Рис. 13.22.</strong> Определение связи между таблицами</p>
<p>Условие отбора записей</p>
<p>Перейдем на закладку Условия и установим отбор, чтобы группы справочника Номенклатура не попадали в отчет. </p>
<p>Для этого раскроем таблицу спрНоменклатура, перетащим мышью поле ЭтоГруппа в список условий, установим флажок
	Произвольное и напишем в поле Условие следующий текст (листинг 13.5).</p>
<p><strong>листинг 13.5.</strong> Условие запроса</p>
<p>спрНоменклатура.ЭтоГруппа = ЛОЖЬ</p>
<p>Тем самым мы указали, что из базы данных нужно выбрать только те записи справочника Номенклатура, которые не являются
	группами.</p>
<p>Работу этого условия можно проиллюстрировать на следующем примере. Слева – исходная таблица справочника Номенклатура,
	а справа – записи, которые будут выбраны из этой таблицы (рис. 13.23).</p>
<p><img src="21.png"/></p>
<p><strong>Рис. 13.23.</strong> Отбор записей номенклатуры в запросе</p>
<p>Вторым условием должно быть то, что выбранный элемент является услугой. Это Простое условие. Чтобы его создать,
	перетащим мышью поле ВидНоменклатуры в список условий. </p>
<p>Платформа автоматически сформирует условие, согласно которому вид номенклатуры должен быть равен значению параметра
	ВидНоменклатуры.</p>
<p>В дальнейшем перед выполнением запроса мы передадим в параметр ВидНоменклатуры значение перечисления – Услуга.</p>
<p>Работу этого условия тоже можно проиллюстрировать на примере. Слева – записи справочника Номенклатура, выбранные
	согласно первому условию. Справа – только те записи, которые являются услугами (рис. 13.24).</p>
<p><img src="22.png"/></p>
<p><strong>Рис. 13.24.</strong> Отбор записей номенклатуры в запросе</p>
<p>В результате закладка Условия примет вид (рис. 13.25).</p>
<p><strong>Рис. 13.25.</strong> Создание условия запроса</p>
<p><strong>соВет</strong></p>
<p>Отбор можно применять и в самом запросе, и в настройках отчета. То же касается сортировки и группировки. Отбор лучше
	применять в запросе, если записи, не удовлетворяющие условию запроса, наверняка не понадобятся в отчете. Сортировку
	и группировку лучше применять уже в настройках отчета, чтобы сделать его более гибким.</p>
<p>Псевдонимы полей</p>
<p>Перейдем на закладку Объединения/Псевдонимы и укажем, что представление элемента справочника (поле Ссылка) будет
	иметь псевдоним Услуга, а поле регистра будет иметь псевдоним Выручка (рис. 13.26).</p>
<p><strong>Рис. 13.26.</strong> Установка псевдонимов полей запроса</p>
<p>Порядок записей</p>
<p>Перейдем на закладку Порядок и укажем, что результат запроса должен быть отсортирован по убыванию значения поля
	Выручка </p>
<p>(рис. 13.27).</p>
<p>Создание запроса закончено, нажмем кнопку ОK. Вернемся в конструктор схемы компоновки данных. </p>
<p>Анализ текста запроса</p>
<p>Текст запроса, сформированный платформой, примет вид (листинг 13.6).</p>
<p><strong>листинг 13.6.</strong> Текст запроса</p>
<table>
	<tr>
		<td><p>ВЫБРАТЬ</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>СпрНоменклатура.Ссылка КАК Услуга,</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ПродажиОбороты.ВыручкаОборот КАК Выручка</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ИЗ</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Справочник.Номенклатура КАК СпрНоменклатура</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.Продажи.Обороты КАК ПродажиОбороты</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ПО ПродажиОбороты.Номенклатура = СпрНоменклатура.Ссылка</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ГДЕ</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>СпрНоменклатура.ЭтоГруппа = ЛОЖЬ</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>И СпрНоменклатура.ВидНоменклатуры = &amp;ВидНоменклатуры</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>УПОРЯДОЧИТЬ ПО</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Выручка УБЫВ</p></td>
	</tr>
</table>
<p>Сначала, как обычно, идет часть описания запроса, и в ней есть новые для нас конструкции.</p>
<p>При описании источников запроса (после ключевого слова ИЗ) использована возможность определения нескольких источников
	запроса (листинг 13.7).</p>
<p><strong>листинг 13.7.</strong> Определение нескольких источников запроса</p>
<table>
	<tr>
		<td><p>ИЗ</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Справочник.Номенклатура КАК СпрНоменклатура</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.Продажи.Обороты КАК ПродажиОбороты</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ПО ПродажиОбороты.Номенклатура = СпрНоменклатура.Ссылка</p></td>
	</tr>
</table>
<p>В данном случае выбираются записи из двух источников: СпрНоменклатура и ПродажиОбороты, причем ключевым предложением
	ЛЕВОЕ СОЕДИНЕНИЕ … ПО описан способ, которым будут скомбинированы между собой записи этих двух источников.</p>
<p>ЛЕВОЕ СОЕДИНЕНИЕ означает, что в результат запроса нужно включить комбинации записей из обоих источников, которые
	соответствуют указанному после ключевого слова ПО условию. Кроме этого, в результат запроса нужно включить еще и
	записи из первого (указанного слева от слова СОЕДИНЕНИЕ) источника, для которых не найдено соответствующих условию
	записей из второго источника.</p>
<p>Продолжим рассматривать текст запроса. В части описания запроса есть еще одна новая для нас конструкция – задание
	условий отбора данных из исходных таблиц (листинг 13.8).</p>
<p><strong>листинг 13.8.</strong> Задание условий отбора</p>
<p>ГДЕ</p>
<table>
	<tr>
		<td><p>СпрНоменклатура.ЭтоГруппа = ЛОЖЬ</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>И СпрНоменклатура.ВидНоменклатуры = &amp;ВидНоменклатуры</p></td>
	</tr>
</table>
<p>Условию отбора всегда предшествует ключевое слово ГДЕ. После него описывается само условие. Обратите внимание, что
	поля исходных таблиц, на которые накладывается условие, могут и не входить в список выборки (как в нашем случае).
	Кроме того, в нашем условии использован параметр запроса ВидНоменклатуры (перед именем параметра указывается символ
	&amp; – амперсанд).</p>
<p>Теперь, когда мы закончили знакомиться с текстом запроса, продолжим формирование нашей схемы компоновки данных.</p>
<p>Ресурсы</p>
<p>В нашем отчете мы хотим видеть итоговые значения выручки для каждой услуги. Для этого нам нужно определить поля
	ресурсов отчета. </p>
<p>Под <em>ресурсами</em> в системе компоновки данных подразумеваются поля, значения которых рассчитываются на основании
	детальных записей, входящих в группировку. По сути ресурсы являются групповыми или общими итогами отчета. </p>
<p>Итоговые данные формируются на закладке Ресурсы. </p>
<p>Перейдем на эту закладку и нажмем кнопку <img src="23.jpeg"/>, чтобы конструктор выбрал все доступные ресурсы, по
	которым можно вычислять итоги. В нашем случае это единственный ресурс Выручка. </p>
<p>Платформа автоматически предложить рассчитывать сумму значений этого поля, что нам и нужно (рис. 13.28).</p>
<p><strong>Рис. 13.28.</strong> Ресурсы схемы компоновки данных</p>
<p>Параметры</p>
<p>Пользователя, как правило, интересуют данные о хозяйственной деятельности за определенный период. Поэтому практически
	в любом отчете используются параметры, задающие начало и конец отчетного периода. </p>
<p><em>Параметры</em> отчета задают условия отбора записей в отчет. В схеме компоновки данных параметры отчета задаются
	на закладке </p>
<p>Параметры (рис. 13.29).</p>
<p><strong>Рис. 13.29.</strong> Параметры компоновки данных</p>
<p>На этой закладке мы увидим три параметра: НачалоПериода,</p>
<p>КонецПериода и ВидНоменклатуры. Вы можете спросить: почему параметра три, хотя в запросе мы задавали всего один –
	ВидНоменклатуры? </p>
<p>Все дело в том, что система компоновки данных самостоятельно анализирует текст запроса и помимо тех параметров,
	которые указаны в нем в явном виде (ВидНоменклатуры), предоставляет возможность настроить также и параметры
	виртуальных таблиц, которые участвуют в запросе. </p>
<p>Такими параметрами являются НачалоПериода и КонецПериода. Это первые два параметра виртуальной таблицы
	РегистрНакопле- ния.Продажи.Обороты, которую мы использовали в запросе, в левом соединении. </p>
<p>Если в конструкторе запроса выделить в списке таблиц эту таблицу и нажать кнопку Параметры виртуальной таблицы, то
	появится диалог, где мы увидим параметры НачалоПериода и КонецПериода (рис. 13.30).</p>
<p><strong>Рис. 13.30.</strong> Параметры виртуальной таблицы</p>
<p>Первым параметром передается начало периода расчета итогов, вторым – конец периода. В результате исходная таблица
	будет содержать только обороты, рассчитанные в переданном периоде. </p>
<p>Здесь всегда следует помнить, что если мы передаем в качестве этих параметров дату (а в нашем случае так и будет), то
	дата содержит и время с точностью до секунды.</p>
<p>Допустим, заранее известно, что пользователя не будут интересовать результаты работы отчета в периодах, указанных с
	точностью до секунды. В этом случае следует учесть две особенности.</p>
<p>Во-первых, пользователя нужно избавить от необходимости указывать время при вводе даты периода, за который
	формируется отчет. </p>
<p>Для этого мы изменим существующее описание типа для параметра НачалоПериода. </p>
<p>Вернемся на закладку Параметры схемы компоновки данных и дважды щелкнем в ячейке Тип, соответствующей параметру
	НачалоПериода.</p>
<p>Затем нажмем кнопку выбора <img src="24.jpeg"/> и в нижней части окна редактирования типа данных установим Состав
	даты в значение Дата. Нажмем ОK (рис. 13.31).</p>
<p>Вторая особенность заключается в том, что по умолчанию время в дате установлено 00:00:00. Поэтому если пользователь
	задаст период отчета с 01.06.2013 по 11.06.2013, итоги регистра будут рассчитаны с начала дня 01.06.2013 00:00:00 по
	начало дня 11.06.2013, 00:00:00. Таким образом, данные за 11-е число, отличные от начала дня, в расчет не войдут,
	что сильно удивит пользователя.</p>
<p>Для того чтобы исключить эту ситуацию, мы добавим еще один параметр ДатаОкончания, в который пользователь будет
	вводить дату окончания. А значение параметра КонецПериода будем рассчитывать автоматически таким образом, чтобы оно
	указывало на конец дня даты, введенной пользователем. </p>
<p>Поэтому для параметра КонецПериода установим флажок Ограни-</p>
<p><strong>Рис. 13.32.</strong> Добавление параметра «ДатаОкончания»</p>
<p>Если этот флажок не установлен, то параметр будет доступен для настройки пользователем. Если же установить этот
	флажок, то пользователь не увидит этот параметр. </p>
<p>Затем с помощью кнопки Добавить в командной панели добавим новый параметр с именем ДатаОкончания (см. рис. 13.32).
	Для этого параметра платформа автоматически сформирует заголовок – Дата окончания. Оставим его без изменений. </p>
<p>Зададим тип значения параметра – Дата. При этом, как и для параметра Начало Периода, укажем состав даты – Дата (см.
	рис. 13.31). А также для параметра НачалоПериода зададим заголовок, который будет отображаться пользователю, – Дата
	начала.</p>
<p>Обратите внимание, что по умолчанию добавленный нами параметр доступен для пользователя (ограничение доступности в
	колонке снято). Нас это вполне устраивает.</p>
<p>Перейдем к параметру КонецПериода. Для него мы установили флажок Ограничение доступности, поскольку значение этого
	параметра мы собираемся вычислять на основании значения, установленного пользователем для параметра
	ДатаОкончания.</p>
<p>Чтобы задать формулу, по которой будет вычисляться значение параметра КонецПериода, воспользуемся языком выражений
	системы компоновки данных. </p>
<p>В нем есть функция КонецПериода(), которая позволяет получить дату, соответствующую концу какого-либо периода,
	например, указанного дня. </p>
<p>В ячейке Выражение зададим для параметра КонецПериода следующее выражение (листинг 13.9).</p>
<p><strong>листинг 13.9.</strong> Выражение для расчета значения параметра «КонецПериода»</p>
<p>КонецПериода(&amp;ДатаОкончания, &quot;День&quot;)</p>
<p><strong>пРиМеЧАние</strong></p>
<p>Подробное описание языка выражений системы компоновки данных содержится во встроенной справке системы в разделе
	Справка  Содержание справки  Встроенный язык  Общие объекты  Система компоновки данных  Язык выражений системы
	компоновки данных.</p>
<p>В результате перечисленных действий параметры компоновки будут иметь следующий вид (рис. 13.33).</p>
<p><strong>Рис. 13.33.</strong> Параметры системы компоновки</p>
<p>И в заключение настроим параметр ВидНоменклатуры. </p>
<p>Поскольку отчет должен отображать выручку, полученную только от реализации услуг, значение параметра ВидНоменклатуры
	пользователь изменять не должен. Оно должно быть задано непосредственно в схеме компоновки как
	Перечисление.ВидыНоменклатуры.Услуга. </p>
<p>Флажок Ограничение доступности у параметра ВидНоменклатуры платформа установила по умолчанию, поэтому нам остается
	только указать нужное значение перечисления ВидыНоменклатуры в ячейке Значение, соответствующей параметру
	ВидНоменклатуры. </p>
<p>Воспользуемся кнопкой выбора и выберем это значение из списка перечисления видов номенклатуры – Услуга (рис.
	13.34).</p>
<p><strong>Рис. 13.34.</strong> Установка значения параметра «ВидНоменклатуры»</p>
<p>Настройки</p>
<p>Перейдем к формированию структуры отчета. На закладке Настройки добавим группировку и снова не укажем поле
	группировки. На закладке Выбранные поля укажем поля Услуга и Выручка (рис. 13.35).</p>
<p><strong>Рис. 13.35.</strong> Структура отчета «РейтингУслуг»</p>
<p>Затем перейдем на закладку Другие настройки и зададим заголовок отчета – Рейтинг услуг (рис. 13.36).</p>
<p><strong>пРиМеЧАние</strong></p>
<p>При изменении параметров настроек, которые предполагают выбор некоторого значения, нужно выделить двойным щелчком
	поле Значение и, нажав кнопку выбора <img src="25.jpeg"/>, выбрать из списка значений нужный вариант. При этом
	флажок использования значения появится автоматически. </p>
<p>Этот флажок можно также снять и установить вручную.</p>
<p>Быстрые пользовательские настройки</p>
<p>В заключение мы должны предоставить пользователю возможность задавать отчетный период перед формированием отчета. То
	есть параметры Дата начала и Дата окончания должны быть включены в состав пользовательских настроек. </p>
<p>Причем поскольку задавать отчетный период требуется практически всегда, эти настройки должны находиться
	непосредственно в форме отчета. </p>
<p>На закладке Параметры мы видим параметры, для которых мы установили возможность их изменения пользователем, то есть
	сняли флажок Ограничение доступности.</p>
<p>Выделим по очереди каждый из параметров и нажмем кнопку Свойства элемента пользовательских настроек, расположенную в
	правом нижнем углу окна настроек. </p>
<p>Установим флажок Включать в пользовательские настройки и оставим предложенное по умолчанию для свойства Режим
	редактирования значение Быстрый доступ (рис. 13.37). </p>
<p><strong>Рис. 13.37.</strong> Определение пользовательских настроек</p>
<p>Поясним, что флажок Включать в пользовательские настройки означает, что эта настройка будет доступна пользователю в
	отдельном окне (2) при вызове из подменю Еще команды Настройки… (то есть такая настройка, которой он может
	пользоваться, но не очень часто, рис. </p>
<p>13.38).</p>
<p><img src="26.jpeg"/></p>
<p><strong>Рис. 13.38.</strong> Быстрые (1) и обычные (2) пользовательские настройки</p>
<p>А режим редактирования, установленный в значение Быстрый доступ, означает, что эта настройка также будет
	автоматически отображаться непосредственно в отчетной форме (1). Это <em>быстрая пользовательская настройка</em> –
	такая настройка, которая нужна пользователю постоянно, чуть ли не при каждом запуске отчета. Поэтому она должна быть
	всегда «под рукой».</p>
<p>Кроме того, чтобы улучшить интерфейс пользователя, зададим для параметров Дата начала и Дата окончания в качестве
	начальных значений соответственно Начало этого месяца и Начало этого дня (см. рис. 13.37). </p>
<p>Таким образом, при выполнении отчета даты начала и окончания отчетного периода будут динамически меняться и
	показывать период с начала текущего месяца по сегодняшнее число, и пользователю, возможно, не придется менять их
	вручную.</p>
<p>В заключение определим, в каких подсистемах будет отображаться наш отчет. </p>
<p>Закроем конструктор схемы компоновки данных и в окне редактирования объекта конфигурации Отчет РейтингУслуг перейдем
	на закладку Подсистемы. Отметим в списке подсистем конфигурации подсистемы Оказание услуг и Бухгалтерия. </p>
<p>Таким образом, ссылка на наш отчет автоматически попадет в панель команд этих разделов (рис. 13.39).</p>
<p>В режиме «1С:Предприятие»</p>
<p>Запустим «1С:Предприятие» в режиме отладки и посмотрим, как работает отчет. </p>
<p>В открывшемся окне «1С:Предприятия» мы видим, что в разделах Оказание услуг и Бухгалтерия в подменю Отчеты появилась
	команда для формирования отчета Рейтинг услуг (рис. 13.40). </p>
<p>Выполним эту команду.</p>
<p>Откроется форма отчета, автоматически сформированная системой. </p>
<p><strong>Рис. 13.40.</strong> Команда для формирования отчета</p>
<p>В окне отчета мы видим параметры, определяющие отчетный период. Он по умолчанию задан – с начала месяца по
	сегодняшнее число. Но можно при желании изменить его, воспользовавшись кнопкой календаря. </p>
<p>Нажмем кнопку Сформировать. Результат будет выглядеть следующим образом (рис. 13.41).</p>
<p><strong>Рис. 13.41.</strong> Результат выполнения отчета</p>
<p>Мы видим, что выручка от услуг из всех трех введенных нами документов Оказание услуги попала в отчет, так как даты
	создания этих документов входят в отчетный период. </p>
<p>Заметьте, что вверху окна результата отчета выводится заданный нами заголовок и параметры, определяющие отчетный
	период.</p>
<p>Обратите внимание, что при прокручивании отчета вниз положение шапки отчета остается зафиксированным. Для удобства
	пользователя платформа автоматически фиксирует сверху табличный документ, в который выводится результат отчета.
	Можно также вручную управлять фиксацией строк и столбцов отчета с помощью параметров вывода ФиксацияСлева и
	ФиксацияСверху.</p>
<p>Также заметьте, что название услуг (поле Ссылка справочника Номенклатура) включает как наименование, так и вид
	номенклатуры соответственно заданному нами представлению ссылок на номенклатуру.</p>
<p>Теперь изменим дату окончания на 10.07.2013. Данные за 10 июля из документа Оказание услуги № 1 попадают в отчет
	(рис. 13.42).</p>
<p><strong>Рис. 13.42.</strong> Результат выполнения отчета</p>
<p>То есть, как и требовалось, благодаря использованию функции КонецПериода() данные за последнее число отчетного
	периода включены в отчет.</p>
<p>Причем поскольку в запросе данных для отчета таблица номенклатуры связана левым соединением с таблицей регистра
	продаж, то услуги, для которых нет данных о продажах, все равно показаны в отчете.</p>
<p>Настройки в конфигураторе и в режиме «1С:Предприятие»</p>
<p>Теперь на примере этого отчета покажем создание и использование других настроек отчета – Условное оформление и
	Отбор. </p>
<p>В процессе создания этих настроек мы будем выполнять некоторые действия в конфигураторе и затем переходить в режим
	1С:Предприятие, чтобы посмотреть, что получилось. </p>
<p>На самом деле все то же самое, что мы будем настраивать в режиме Конфигуратор, можно настроить и в режиме
	1С:Предприятие по команде Еще  Изменить вариант... При этом пользователю открывается окно настроек отчета, очень
	похожее на закладку Настройки в схеме компоновки данных. </p>
<p>Различие состоит в том, что настройки, сделанные в конфигураторе, называются <em>стандартными настройками</em> и
	будут сохранены в самой схеме компоновки данных, то есть будут являться частью конфигурации. Это означает, что любой
	пользователь конфигурации будет видеть отчет именно в таком виде, как мы его настроили в конфигураторе.</p>
<p>Все то же самое можно настроить и в режиме 1С:Предприятие, но эта настройка уже не будет являться частью конфигурации
	и будет доступна только одному конкретному пользователю конкретной информационной базы, который эту настройку
	произвел.</p>
<p>Возможность изменения варианта отчета в режиме 1С:Предприятие не предназначена для рядового пользователя (для него –
	быстрые настройки и пользовательские настройки). Она предназначена для разработчика, осуществляющего внедрение, или
	для администратора, или для очень опытного пользователя.</p>
<p>Настройки, сделанные в режиме 1С:Предприятие, естественно «перекрывают» стандартные настройки. И если пользователь
	все перестроил в отчете так, что его не узнать, всегда можно вернуться к стандартным настройкам по команде Еще 
	Установить стандартные настройки.</p>
<p>Итак, сейчас мы хотим настроить отчет для любых пользователей, которые будут им пользоваться, поэтому делаем это в
	конфигураторе. </p>
<p>Но если завтра главный бухгалтер попросит вас «сделать отчет красивым», вы сможете повторить все то же самое, не
	меняя конфигурацию и прямо у нее на глазах.</p>
<p>Условное оформление </p>
<p>В таком отчете, как Рейтинг услуг, было бы удобно выделять цветом записи отчета, содержащие услуги с наименьшей или с
	наибольшей выручкой, или еще по какому-либо условию. </p>
<p>В режиме «Конфигуратор»</p>
<p>Для этого вернемся в конфигуратор и откроем схему компоновки данных на закладке Настройки. </p>
<p>В нижней части окна перейдем на закладку Условное оформление и нажмем кнопку Добавить, расположенную в правом верхнем
	углу окна настроек (рис. 13.43). </p>
<p>Сначала укажем Оформление, то есть то, каким образом должны выделяться интересующие нас поля. </p>
<p>Нажмем кнопку выбора <img src="27.jpeg"/> в поле Оформление и установим красный цвет текста (см. рис. 13.43). Нажмем
	ОК. </p>
<p>Затем укажем Условие, при наступлении которого будет применяться оформление, то есть когда в нашем случае текст будет
	становиться красным. </p>
<p>Нажмем кнопку выбора <img src="28.jpeg"/> в поле Условие и в появившемся окне добавим Новый элемент отбора. </p>
<p>Каждый элемент отбора задает одно условие. Условий может быть несколько (рис. 13.44). </p>
<p><strong>Рис. 13.44.</strong> Настройка условного оформления</p>
<p>Для этого нажмем кнопку Добавить и укажем в графе Левое значение – поле Выручка, в графе Вид сравнения – Меньше, а в
	графе Правое значение – 700. Нажмем ОК. </p>
<p>То есть когда в поле Выручка окажется значение меньше 700, «что-то» будет выделено красным цветом текста. </p>
<p>Теперь укажем это «что-то», то есть зададим список <em>оформляемых полей</em>. </p>
<p>Если мы хотим выделять всю строку отчета, то можно оставить этот список пустым. Или же нажать кнопку выбора <img
		src="29.jpeg"/> в поле Оформляемые поля, и в появившемся окне, нажимая кнопку Добавить, можно выбрать поля
	Услуга и Выручка (рис. 13.45).</p>
<p><strong>Рис. 13.45.</strong> Настройка условного оформления</p>
<p>В нашем случае можно было бы этого не делать, так как Услуга и Выручка и есть все поля отчета. Нажмем ОК. </p>
<p>В заключение зададим Представление условного оформления как </p>
<p><strong>Рис. 13.46.</strong> Настройка условного оформления</p>
<p>Непопулярная услуга – это то, что увидит пользователь в своих настройках. То есть вместо пугающей строки «Выручка
	меньше 700…» пользователь увидит осмысленное выражение, которое задано в поле Представление.</p>
<p>Итак, мы задали условное оформление отчета, по которому все услуги с выручкой менее 700 руб. будут считаться
	«непопулярными» и выделяться красным цветом. </p>
<p>Теперь добавим это условие в пользовательские настройки. Нажмем кнопку Свойства элемента пользовательских настроек,
	расположенную в правом нижнем углу окна настроек (см. рис. 13.46). Установим флажок Включать в пользовательские
	настройки и установим свойство Режим редактирования в значение Обычный. </p>
<p>Тем самым мы включили созданную нами настройку условного оформления в обычные пользовательские настройки. Эти
	настройки, в отличие от быстрых настроек, расположены не в форме отчета, а вызываются по команде Еще  Настройки… и
	появляются в отдельном окне, так эти настройки используются значительно реже, чем, например, настройки отчетного
	периода. В режиме «1С:Предприятие»</p>
<p>Перейдем в режим 1С:Предприятие. Вызовем отчет.</p>
<p>Зададим Дату окончания отчетного периода как Начало этого дня и<strong> </strong>нажмем кнопку Сформировать (рис.
	13.47).</p>
<p><strong>Рис. 13.47.</strong> Результат выполнения отчета</p>
<p>Мы видим, что суммы услуг менее 700 руб. выделены красным цветом. Выполним команду Еще  Настройки… </p>
<p>Перед нами появится окно пользовательских настроек отчета, содержащее параметры отчетного периода и настройку
	условного оформления Непопулярная услуга. Мы можем снять флажок использования этой настройки, нажать кнопку
	Завершить редактирование (рис. 13.48) и снова сформировать отчет.</p>
<p><strong>Рис. 13.48.</strong> Окно пользовательских настроек</p>
<p>Выделение цветом исчезнет. Настройка Непопулярная услуга не видна в форме отчета, так как мы установили для нее в
	качестве режима редактирования Обычный, а не Быстрый доступ. </p>
<p>Однако данная настройка условного оформления задана жестко, и пользователь может лишь включить или выключить признак
	ее использования. Для неопытных пользователей этого, как правило, вполне достаточно. </p>
<p>Но для более подготовленных пользователей мы можем предоставить более полную свободу в использовании настроек, то
	есть возможность, например, самостоятельно задавать настройки отчета: отбор, порядок, условное оформление и пр. </p>
<p>Рассмотрим это в следующем примере.</p>
<p>Пользовательские настройки</p>
<p>В режиме «Конфигуратор»</p>
<p>Вернемся в конфигуратор. </p>
<p>На закладке Настройки схемы компоновки данных содержатся полные настройки отчета, которые задает разработчик. Часть
	из них может быть представлена пользователю для создания произвольного отбора, условного оформления отчета и
	пр. </p>
<p>Для этого нажмем кнопку Свойства элемента пользовательских настроек, расположенную вверху в командной панели окна
	настроек (рис. 13.49). </p>
<p><strong>Рис. 13.49.</strong> Состав пользовательских настроек</p>
<p>В появившемся окне мы можем редактировать состав пользовательских настроек отчета. </p>
<p>Установим признак использования для настроек Отбор и Условное оформление и установим для них свойство Режим
	редактирования в значение Обычный.</p>
<p>Таким образом, мы включили настройки отбора и условного оформления в состав пользовательских настроек и предоставили
	пользователю возможность задавать их в отдельном окне по команде Еще  Настройки…</p>
<p>Отбор </p>
<p>В режиме «Конфигуратор»</p>
<p>Теперь создадим настройку отбора в отчете. Для этого в нижней части окна настроек перейдем на закладку Отбор. Слева
	мы видим список доступных полей отчета. Раскроем поле Услуга и двойным щелчком мыши на поле Родитель перенесем его в
	список условий отбора в правой части окна (рис. 13.50).</p>
<p>Таким образом, мы создали возможность отбора по группам услуг, которые пользователь может задать в режиме
	1С:Предприятие.</p>
<p>В режиме «1С:Предприятие»</p>
<p>Откроем отчет в режиме 1С:Предприятие и выполним команду Еще  Настройки… </p>
<p>В окне пользовательских настроек отчета появились настройки Отбор и Условное оформление, которые мы только что
	отметили (рис. 13.51).</p>
<p><strong>Рис. 13.51.</strong> Окно пользовательских настроек</p>
<p>На самом деле здесь присутствуют две настройки условного оформления. </p>
<p>Настройку Непопулярная услуга мы заранее создали в конфигураторе. А теперь, добавив настройку условного оформления
	«вообще», мы предоставили пользователю возможность создавать любое количество собственных условий для условного
	оформления аналогично тому, как мы это делали в конфигураторе. Сейчас мы это делать не будем, но самостоятельно вы
	можете попробовать.</p>
<p>Сейчас мы зададим отбор в отчете так, чтобы в него попадали только услуги, относящиеся к установке стиральных машин.
	Для этого нажмем кнопку выбора <img src="30.jpeg"/> в окне пользовательских настроек в строке Отбор (см. рис.
	13.51). </p>
<p>В открывшемся окне Редактирование отбора мы видим созданное нами ранее в конфигураторе условие отбора. Нам остается
	только нажать кнопку выбора в строке Значение, ввести первые несколько символов наименования нужной группы
	номенклатуры и выбрать строку Стиральные машины из выпадающего списка под окном ввода значения (рис. 13.52).</p>
<p>Нажмем ОК. </p>
<p>Таким образом, мы задали отбор по услугам, родителем которых является группа Стиральные машины справочника
	Номенклатура.</p>
<p>В окне пользовательских настроек нажмем кнопку Завершить редактирование и выполним отчет, нажав кнопку Сформировать
	(рис. 13.53).</p>
<p><strong>Рис. 13.53.</strong> Результат выполнения отчета</p>
<p>Мы видим, что в отчет включены только услуги по установке стиральных машин и в заголовке отчета отражена информация
	об отборе. </p>
<p>При закрытии окна отчета настройки, сделанные пользователем, запоминаются и становятся настройками по умолчанию для
	текущего пользователя.</p>
<p><strong>Рис. 13.54.</strong> Окно пользовательских настроек</p>
<p>Таким образом, пользователь сможет при наличии определенной квалификации задавать многие настройки по своему
	желанию. </p>
<p>Если же такого желания или соответствующих знаний у него нет, лучше задавать эти настройки жестко, а пользователю
	останется только включать или выключать их использование. </p>
<p>Да, собственно, часто достаточно только отчетного периода или еще какой-то жизненно важной настройки, и такие
	настройки, конечно, нужно размещать непосредственно в отчетной форме.</p>
<p>Если приоритеты пользователя по использованию настроек отличаются от того, как они заданы разработчиком в схеме
	компоновки данных, то пользователь может изменить состав настроек, выполнив команду Еще  Изменить состав настроек…
	(рис. 13.55).</p>
<p><strong>Рис. 13.55.</strong> Окно пользовательских настроек отчета в режиме «1С:Предприятие»</p>
<p>В открывшемся окне Состав настроек пользователь может указать, какие настройки будут редактироваться в форме отчета
	(правый список), то есть будут быстрыми, а какие будут доступны по команде Еще  Настройки… (левый список). Кнопками
	Добавить, Удалить или двойным щелчком мыши можно перенести настройки из левого списка в правый и наоборот. Например,
	перенесем в список быстрых настроек настройку отбора (рис. 13.56).</p>
<p><strong>Рис. 13.56.</strong> Редактирование состава настроек в режиме «1С:Предприятие»</p>
<p>В результате настройка отбора будет доступна непосредственно в отчетной форме.</p>
<p>Теперь очистим условие отбора в окне отчета, затем вернемся в конфигуратор и снимем признак использования у настройки
	отбора. Это нам понадобится в дальнейших примерах.</p>
<h1><a id="_Toc454870663"></a>Лабораторная работа № 18 Прием на работу</h1>
<p><strong>Порядок выполнения работы </strong></p>
<p>1. Ознакомьтесь с теоретическими основами в настоящих указаниях и конспектах лекций. </p>
<p>2. Получите задание у преподавателя. </p>
<p>3. Сделайте скриншоты (кнопка клавиатуры PrtSc) выполненных заданий в текстовом (Word) файле <em>Фамилия_ЛР</em></p>
<p>4. Составьте отчет по лабораторной работе. </p>
<p>5. Отчитайте работу преподавателю.</p>
<p><strong>Вывод данных по всем дням в выбранном периоде</strong></p>
<p>Следующий отчет, который мы добавим, будет называться Выручка мастеров.</p>
<p>Он будет содержать информацию о том, какая выручка была получена ООО «На все руки мастер» благодаря работе каждого из
	мастеров, с детализацией по всем дням в выбранном периоде и разворотом по клиентам, обслуженным в каждый из дней
	(рис. 13.57).</p>
<p>На примере этого отчета мы проиллюстрируем, как строить многоуровневые группировки в запросе и как обходить все даты
	в выбранном периоде. </p>
<p>Также продемонстрируем настройку отдельных элементов структуры отчета, научимся выводить данные в диаграмму и
	создавать несколько вариантов отчета в конфигураторе.</p>
<p>В режиме «Конфигуратор»</p>
<p>Добавим новый объект конфигурации Отчет. Назовем его ВыручкаМастеров и запустим конструктор схемы компоновки
	данных.</p>
<p>Добавим новый Набор данных – запрос и вызовем конструктор запроса. </p>
<p>В качестве источника данных для запроса выберем виртуальную таблицу регистра накопления Продажи.Обороты.</p>
<p>Запрос для набора данных</p>
<p>Параметры виртуальной таблицы</p>
<p>Зададим один из параметров этой виртуальной таблицы – Периодичность.</p>
<p>Для этого перейдем в поле Таблицы, выделим таблицу и нажмем кнопку Параметры виртуальной таблицы (рис. 13.58).</p>
<p><strong>Рис. 13.58.</strong> Изменение параметров виртуальной таблицы</p>
<p>В открывшемся окне параметров зададим значение параметра Периодичность – День (рис. 13.59). </p>
<p><strong>Рис. 13.59.</strong> Параметры виртуальной таблицы</p>
<p>Нажмем OK. После этого выберем из таблицы следующие поля </p>
<p>(рис. 13.60):</p>
<ul>
	<li>ПродажиОбороты.Мастер,</li>
	<li>ПродажиОбороты.Период,</li>
	<li>ПродажиОбороты.Клиент,</li>
	<li>ПродажиОбороты.ВыручкаОборот.</li>
</ul>
<p><strong>Рис. 13.60.</strong> Выбранные поля</p>
<p>Теперь перейдем на закладку Объединения/Псевдонимы и зададим псевдоним Выручка для поля
	ПродажиОбороты.ВыручкаОборот </p>
<p><strong>Рис. 13.61.</strong> Объединения/Псевдонимы</p>
<p>Анализ текста запроса</p>
<p>Нажмем ОК и рассмотрим текст запроса, сформированный конструктором (листинг 13.10).</p>
<p><strong>листинг 13.10.</strong> Текст запроса</p>
<table>
	<tr>
		<td><p>ВЫБРАТЬ</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ПродажиОбороты.Мастер,</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ПродажиОбороты.Период,</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ПродажиОбороты.Клиент,</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ПродажиОбороты.ВыручкаОборот КАК Выручка</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ИЗ</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>РегистрНакопления.Продажи.Обороты( , , День, ) КАК ПродажиОбороты </p></td>
	</tr>
</table>
<p>В части описания запроса обратите внимание, что у источника данных задана периодичность выбираемых данных – День
	(листинг 13.11).</p>
<p><strong>листинг 13.11.</strong> Задание периодичности виртуальной таблицы</p>
<table>
	<tr>
		<td><p>ИЗ</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>РегистрНакопления.Продажи.Обороты( , , День, ) КАК ПродажиОбороты</p></td>
	</tr>
</table>
<p>Именно благодаря этому у нас появляется возможность описать среди выбранных полей поле Период.
	<strong>Ресурсы</strong></p>
<p>Теперь перейдем к редактированию схемы компоновки данных. </p>
<p>На закладке Ресурсы нажмем кнопку <img src="31.jpeg"/> и убедимся, что конструктор выбрал единственный имеющийся у
	нас ресурс – Выручка. </p>
<p>Параметры</p>
<p>На закладке Параметры выполним те же действия, что и при создании предыдущего отчета. </p>
<p>Для параметров НачалоПериода и КонецПериода в поле Тип зададим состав даты – Дата. </p>
<p>Для параметра КонецПериода зададим Выражение (листинг 13.12).</p>
<p><strong>листинг 13.12.</strong> Выражение для расчета значения параметра «КонецПериода»</p>
<p>КонецПериода(&amp;КонецПериода, &quot;День&quot;)</p>
<p>В результате перечисленных действий параметры компоновки данных будут иметь следующий вид (рис. 13.62).</p>
<p><strong>Рис. 13.62.</strong> Параметры компоновки данных</p>
<p>Настройки</p>
<p>Теперь создадим структуру отчета. </p>
<p>На закладке Настройки последовательно создадим две вложенные группировки:</p>
<p> верхнего уровня – по полю Мастер;  вложенная в нее – по полю Период. </p>
<p>Для этого сначала выделим корневой элемент Отчет в структуре отчета, нажмем кнопку Добавить в командной панели окна
	настроек, добавим новую группировку и укажем поле группировки Мастер </p>
<p>(рис. 13.63).</p>
<p><strong>Рис. 13.63.</strong> Поле группировки</p>
<p>Затем добавим в группировку Мастер вложенную группировку по полю Период. </p>
<p>Для этого выделим группировку Мастер, нажмем кнопку Добавить, добавим новую группировку и укажем поле группировки
	Период. </p>
<p>Затем добавим еще одну группировку, вложенную в группировку по полю Период, – Детальные записи (без указания
	группировочного поля). Для этого выделим группировку Период, нажмем кнопку Добавить и добавим новую группировку без
	указания группировочного поля. После этого перейдем на закладку Выбранные поля и добавим в список выбранных полей
	поля Клиент и Выручка. </p>
<p>Поля Мастер и Период мы не задаем, так как по этим полям производится группировка данных и их значение будет выведено
	автоматически. </p>
<p>В результате структура отчета будет иметь вид (рис. 13.64).</p>
<p>В заключение перейдем на закладку Другие настройки и изменим следующие параметры. </p>
<p>Для параметра Расположение полей группировок установим значение Отдельно и только в итогах. </p>
<p>По умолчанию поля группировок в отчете располагаются вертикально друг под другом (рис. 13.65).</p>
<p><strong>Рис. 13.65.</strong> Расположение полей группировок и итогов по вертикали по умолчанию</p>
<p>Установка этого свойства в значение Отдельно и только в итогах означает, что каждая группировка будет располагаться в
	отдельной области отчета слева направо и ее наименование будет выводиться только в данной группировке (рис.
	13.66).</p>
<p>Для параметра Расположение общих итогов по вертикали зададим значение Начало. </p>
<p>По умолчанию итоги по вертикали располагаются в конце (см. рис. 13.66). Установка этого свойства означает, что общие
	итоги будут отображаться в начале перед строками группировки (рис. 13.67).</p>
<p><strong>Рис. 13.67.</strong> Расположение итогов по вертикали в начале</p>
<p>В результате другие настройки отчета примут вид (рис. 13.68).</p>
<p><strong>Рис. 13.68.</strong> Параметры настроек вывода отчета</p>
<p>Здесь же для параметра Заголовок зададим значение Выручка мастеров.</p>
<p>Затем укажем, что параметры Начало периода и Конец периода будут включены в состав пользовательских настроек, и эти
	настройки будут находиться непосредственно в отчетной форме, то есть будут «быстрыми» настройками. </p>
<p>Таким образом, перед формированием отчета пользователь сможет задать отчетный период (рис. 13.69).</p>
<p><strong>Рис. 13.69.</strong> Создание быстрых настроек отчетного периода</p>
<p>В заключение определим, в каких подсистемах будет отображаться наш отчет. </p>
<p>Закроем конструктор схемы компоновки данных и в окне редактирования объекта конфигурации Отчет ВыручкаМастеров
	перейдем на закладку Подсистемы. </p>
<p>Отметим в списке подсистем конфигурации подсистемы Оказание услуг и Расчет зарплаты. Таким образом, ссылка на наш
	отчет автоматически попадет в панель команд этих разделов.</p>
<p>В режиме «1С:Предприятие»</p>
<p>Запустим «1С:Предприятие» в режиме отладки и посмотрим, как работает отчет. </p>
<p>В открывшемся окне «1С:Предприятия» мы видим, что в разделах Оказание услуг и Расчет зарплаты в подменю Отчеты
	появилась команда для формирования отчета Выручка мастеров. </p>
<p>Выполним эту команду. Зададим отчетный период с 10.07.2013 по 15.07.2013 и сформируем отчет (рис. 13.70).</p>
<p><strong>Рис. 13.70.</strong> Результат выполнения отчета</p>
<p>Если отчетный период для пользователя не важен, то он может снять признак использования параметров (флажок слева от
	параметра). В этом случае отчет будет формироваться по всем записям регистра Продажи, находящимся в базе данных, то
	есть в данном случае результат отчета будет таким же. </p>
<p>Вывод всех дат в выбранном периоде</p>
<p>Если вы помните, в начале раздела мы говорили, что этот отчет должен показывать данные с детализацией по всем дням в
	выбранном периоде. </p>
<p>У нас же отображаются только те дни, для которых существуют ненулевые записи в таблице регистра накопления
	Продажи. </p>
<p>Для детализации данных в отчете система компоновки данных позволяет указывать для группировок <em>дополнение</em>
	периодов с заданной периодичностью в указанном интервале. </p>
<p>Поэтому сейчас мы изменим настройки отчета таким образом, чтобы в отчет попадала каждая дата из периода, за который
	сформирован отчет. </p>
<p>В режиме «Конфигуратор»</p>
<p>Вернемся в режим Конфигуратор и выполним более тонкую настройку структуры отчета. Откроем схему компоновки данных на
	закладке Настройки. </p>
<p>До сих пор все настройки структуры, которые мы выполняли, относились ко всему отчету в целом. Но система компоновки
	данных позволяет настраивать также и каждый элемент структуры в отдельности. </p>
<p>В нашем случае потребуется изменить настройку группировки Период. </p>
<p>Для того чтобы перейти к настройкам именно этой группировки, в поле структуры отчета установим курсор на эту
	группировку, а затем нажмем кнопку Период в средней части окна, под деревом структуры отчета. </p>
<p>В нижней части окна будут отображены настройки, доступные для данной группировки. </p>
<p>Перейдем на закладку Поля группировки. Для поля Период установим </p>
<p><strong>Рис. 13.71.</strong> Установка типа дополнения периода</p>
<p>Тем самым мы укажем, что для этой группировки существующие записи с ненулевым значением ресурса будут дополняться
	записями для каждого из дней. </p>
<p>После этого следует указать, в каком именно периоде будет выполняться такое дополнение. </p>
<p>В поля, расположенные строчкой ниже, можно ввести даты начала и окончания этого периода. Но указание дат в явном виде
	нас не устраивает, так как пользователь может сформировать отчет за произвольный период. И нам нужно, чтобы
	дополнение дат выполнялось не в некотором фиксированном периоде, а именно в том периоде, который выбрал пользователь
	для всего отчета.</p>
<p>Для того чтобы обеспечить именно такую работу отчета, войдем в режим редактирования поля Начальная дата периода,
	дважды кликнув на поле, и нажмем кнопку очистки <img src="32.jpeg"/>. </p>
<p>После этого, нажав кнопку выбора типа данных <img src="33.jpeg"/>, мы сможем выбрать тип данных, отображаемых в этом
	поле. Выберем Поле </p>
<p><strong>Рис. 13.72.</strong> Выбор типа данных</p>
<p>Нажмем OK. </p>
<p>Теперь нажмем в поле ввода кнопку выбора <img src="34.jpeg"/> и в открывшемся окне выбора поля отметим параметр
	НачалоПериода (рис. 13.73). Нажмем OK.</p>
<p>Для второго поля ввода аналогичным образом укажем, что дата окончания периода будет получена из параметра
	КонецПериода </p>
<p>(рис. 13.74).</p>
<p><strong>Рис. 13.74.</strong> Настройки группировки «Период»</p>
<p>В режиме «1С:Предприятие»</p>
<p>Запустим «1С:Предприятие» в режиме отладки и выполним отчет Выручка мастеров за период с 10.07.2013 по 15.07.2013
	(рис. 13.75).</p>
<p><strong>Рис. 13.75.</strong> Результат выполнения отчета</p>
<p>В результате будет произведена детализация данных из регистра накопления Продажи с разбивкой по дням в указанном
	периоде, то есть в отчете будут отображаться и те дни, за которые не оказывались услуги.</p>
<p>Новый вариант отчета</p>
<p>Для анализа работы мастеров за определенный период может понадобиться представить ту же информацию в другом, более
	наглядном виде. Например, директору при начислении зарплаты, чтобы понять, какой из мастеров лучше работает, вполне
	может понадобиться увидеть диаграмму, отражающую вклад каждого мастера в общую выручку предприятия за период. </p>
<p>Поэтому мы создадим другой вариант отчета ВыручкаМастеров, представляющий данные в виде диаграммы.</p>
<p>Диаграмма</p>
<p>Диаграмма предназначена для размещения в таблицах и формах диаграмм и графиков различного вида. </p>
<p>Логически диаграмма является совокупностью точек, серий и значений серий в точке (рис. 13.76).</p>
<p><img src="35.png"/> <strong>Рис. 13.76.</strong> Пример диаграммы</p>
<p>Как правило, в качестве <em>точек</em> используются моменты или объекты, для которых мы получаем значения
	характеристик, а в качестве <em>серий</em> – характеристики, значения которых нас интересуют. На пересечении серии и
	точки находится <em>значение</em> диаграммы.</p>
<p>Например, диаграмма продаж видов номенклатуры по месяцам будет состоять из точек – месяцев, серий – видов
	номенклатуры и значений – оборотов продаж.</p>
<p>Диаграмма как объект встроенного языка имеет три области, которые позволяют управлять оформлением диаграммы: область
	построения, область заголовка и область легенды (рис. 13.77).</p>
<p><img src="36.png"/> <strong>Рис. 13.77.</strong> Области диаграммы</p>
<p>Диаграмма может быть вставлена в структуру отчета как отдельный элемент. В следующем варианте настроек отчета
	ВыручкаМастеров мы будем использовать диаграмму в структуре настроек схемы компоновки данных.</p>
<p>В режиме «Конфигуратор»</p>
<p>Вернемся в конфигуратор и откроем схему компоновки данных на закладке Настройки. </p>
<p>В левой части окна находится список вариантов отчета. </p>
<p>При создании настроек отчета в первый раз система компоновки данных по умолчанию создает Основной вариант настроек. И
	мы видим его в списке вариантов нашего отчета. Чтобы добавить новый вариант, нажмем кнопку Добавить над этим
	списком. Зададим имя варианта – ОбъемВыручки, а представление варианта отчета в интерфейсе как Объем выручки (рис.
	13.78).</p>
<p>Мы видим, что структура отчета и все его настройки очистились. </p>
<p>Но они не пропали, а стали невидимы, так как относятся к Основному варианту настроек. </p>
<p>Если у отчета есть несколько вариантов, то мы видим и можем изменять настройки того варианта, который выделен в
	данный момент. Причем вся остальная информация в схеме компоновки данных (ресурсы, параметры, наборы данных)
	осталась без изменений. Данные для отчета будут получены с помощью того же запроса к базе данных. Изменятся лишь
	настройки, которые определят, как будет представлен отчет.</p>
<p>Добавим в структуру отчета диаграмму. Для этого выделим корневой элемент Отчет, вызовем его контекстное меню и
	добавим диаграмму (рис. 13.79).</p>
<p><img src="37.jpeg"/></p>
<p><strong>Рис. 13.79.</strong> Добавление диаграммы в структуру отчета</p>
<p>Затем выделим ветку Точки и добавим в нее группировку по полю Мастер. Серии диаграммы оставим без изменений. </p>
<p>Для демонстрации вклада мастеров в общий объем выручки хорошо подойдет измерительная диаграмма, которую мы хотим
	показать. Для этого вида диаграммы достаточно задать только точки, поэтому серии мы не задаем. </p>
<p>В значения диаграммы выводится один или сразу несколько ресурсов отчета. У нас всего один ресурс – Выручка (поле
	ресурса помечено соответствующей пиктограммой и отличается от обычных полей). </p>
<p>Поэтому перейдем на закладку Выбранные поля и выберем поле Выручка для вывода в отчет. </p>
<p>Структура отчета должна принять следующий вид (рис. 13.80).</p>
<p><strong>ВниМАние!</strong></p>
<p>В диаграмме обязательно должен выводиться один или несколько ресурсов отчета, иначе будет получена ошибка.</p>
<p><strong>Рис. 13.80.</strong> Структура отчета и настройки диаграммы</p>
<p>На закладке Другие настройки выберем тип диаграммы – Измерительная (рис. 13.81).</p>
<p>Прокрутив вниз список свойств измерительной диаграммы, зададим ее полосы – Плохо, Хорошо и Отлично (рис. 13.82).</p>
<p>В заключение включим параметры Начало периода и Конец периода в состав пользовательских настроек и установим для них
	Режим редактирования – Быстрый доступ. </p>
<p><strong>ВниМАние!</strong></p>
<p>Состав пользовательских настроек для каждого варианта отчета нужно настраивать заново, поскольку у каждого варианта
	отчета – свои пользовательские настройки.</p>
<p><strong>Рис. 13.82.</strong> Настройка полос измерительной диаграммы</p>
<p>В режиме «1С:Предприятие»</p>
<p>Запустим «1С:Предприятие» в режиме отладки и выполним команду Выручка мастеров в разделе Расчет зарплаты. В
	открывшемся окне отчета нажмем кнопку Выбрать вариант (рис. 13.83). </p>
<p>В окне вариантов отчета мы видим теперь два варианта – Основной и только что созданный нами вариант Объем выручки.
	Выделим его и нажмем кнопку Выбрать. Нажмем кнопку Сформировать (рис. 13.84).</p>
<p><strong>Рис. 13.84.</strong> Результат выполнения отчета</p>
<p>В результате мы видим те же данные, что и в основном варианте отчета, представленные в виде измерительной диаграммы.
	На диаграмме хорошо видна доля каждого мастера в общем объеме выручки. Обратите внимание, что при наведении курсора
	на стрелку диаграммы появляется подсказка.</p>
<p>Заметьте, что мы сформировали отчет, не задавая отчетный период. Но все данные об оказании услуг все равно попали в
	отчет. В реальной жизни документов будет, конечно, не три, а намного больше. Поэтому возможность указывать отчетный
	период нужна, чтобы просматривать диаграммы о работе мастеров, например, за месяц и т. п.</p>
<p>Если же понадобится просмотреть данные о работе какого-либо мастера с разбивкой по дням и клиентам, достаточно
	выбрать Основной вариант отчета и переформировать отчет.</p>
<p>Таким образом, на примере отчета Выручка мастеров мы показали создание и использование различных вариантов отчета в
	целях наилучшего представления информации о работе мастеров.</p>
<h1><a id="_Toc454870664"></a>Лабораторная работа № 19 Передача готовой продукции</h1>
<p><strong>Порядок выполнения работы </strong></p>
<p>1. Ознакомьтесь с теоретическими основами в настоящих указаниях и конспектах лекций. </p>
<p>2. Получите задание у преподавателя. </p>
<p>3. Сделайте скриншоты (кнопка клавиатуры PrtSc) выполненных заданий в текстовом (Word) файле <em>Фамилия_ЛР</em></p>
<p>4. Составьте отчет по лабораторной работе. </p>
<p>5. Отчитайте работу преподавателю.</p>
<p><strong>Получение актуальных значений из периодического регистра сведений</strong></p>
<p>Следующий отчет – Перечень услуг – будет содержать информацию о том, какие услуги и по какой цене оказывает ООО «На
	все руки мастер» (рис. 13.85).</p>
<p>На его примере мы познакомимся с возможностью получения последних значений из периодического регистра сведений и с
	возможностью вывода иерархических справочников.</p>
<p>В режиме «Конфигуратор»</p>
<p>Добавим новый объект конфигурации Отчет. Назовем его ПереченьУслуг и запустим конструктор схемы компоновки данных.
	Добавим новый Набор данных – запрос и вызовем конструктор запроса. </p>
<p>Запрос для набора данных</p>
<p>В качестве источника данных для запроса выберем объектную (ссылочную) таблицу справочника Номенклатура и виртуальную
	таблицу регистра сведений Цены.СрезПоследних. </p>
<p>Для того чтобы исключить неоднозначность имен в запросе, переименуем таблицу Номенклатура в СпрНоменклатура. Для
	этого выделим ее в списке Таблицы, вызовем ее контекстное меню и выберем пункт Переименовать таблицу.</p>
<p>Параметры виртуальной таблицы</p>
<p>Вызовем диалог ввода параметров виртуальной таблицы</p>
<p>Цены.СрезПоследних и укажем, что период будет передан в параметре ДатаОтчета. Для этого выделим эту таблицу в списке
	Таблицы и нажмем кнопку Параметры виртуальной таблицы (рис. 13.86).</p>
<p>Затем выберем из таблиц следующие поля (рис. 13.87):</p>
<ul>
	<li>СпрНоменклатура.Родитель,</li>
	<li>СпрНоменклатура.Ссылка,</li>
	<li>ЦеныСрезПоследних.Цена.</li>
</ul>
<p>Левое соединение таблиц</p>
<p>Перейдем на закладку Связи. Мы видим, что платформа автоматически добавила условие связи таблиц, при котором значение
	измерения Номенклатура регистра сведений должно быть равно ссылке на элемент справочника Номенклатура. Нас это
	устраивает.</p>
<p>Снимем флажок Все у таблицы регистра и установим его у таблицы справочника, тем самым установив вид связи как левое
	соединение для таблицы справочника (рис. 13.88).</p>
<p>На закладке Условия зададим условие выбора элементов справочника Номенклатура – выбираемые элементы должны
	соответствовать виду номенклатуры, переданному в параметре запроса ВидНоменклатуры (рис. 13.89).</p>
<p>Псевдонимы полей </p>
<p>На закладке Объединения/Псевдонимы укажем, что поле Родитель будет иметь псевдоним ГруппаУслуг, а поле Ссылка –
	Услуга (рис. 13.90).</p>
<p>На этом создание запроса завершено, нажмем OK. </p>
<p>Анализ текста запроса</p>
<p>Теперь рассмотрим текст запроса, сформированный конструктором (листинг 13.13).</p>
<p><strong>листинг 13.13.</strong> Текст запроса</p>
<table>
	<tr>
		<td><p>ВЫБРАТЬ</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>СпрНоменклатура.Родитель КАК ГруппаУслуг,</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>СпрНоменклатура.Ссылка КАК Услуга,</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ЦеныСрезПоследних.Цена</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ИЗ</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Справочник.Номенклатура КАК СпрНоменклатура</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.Цены.СрезПоследних(&amp;ДатаОтчета, ) </p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p> КАК ЦеныСрезПоследних</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ПО ЦеныСрезПоследних.Номенклатура = СпрНоменклатура.Ссылка</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ГДЕ</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>СпрНоменклатура.ВидНоменклатуры = &amp;ВидНоменклатуры</p></td>
	</tr>
</table>
<p>Практически все конструкции, использованные в этом запросе, нам уже известны. Перейдем к редактированию схемы
	компоновки данных. </p>
<p>Ресурсы</p>
<p>На закладке Ресурсы нажатием кнопки <img src="38.jpeg"/> выберем единственный доступный ресурс – Цена. В колонке
	Рассчитывать по нажмем кнопку </p>
<p><strong>Рис. 13.91.</strong> Ресурсы схемы компоновки</p>
<p>Это сделано для того, чтобы итоги по цене выводились для конкретной услуги, так как для группировок и общих итогов
	рассчитывать цену не имеет смысла.</p>
<p>Параметры</p>
<p>На закладке Параметры зададим значение параметра ВидНоменклатуры как Перечисление.ВидыНоменклатуры.Услуга. </p>
<p>Кроме этого, снимем ограничение доступности для параметра ДатаОтчета. </p>
<p>В поле Тип этого параметра зададим состав даты – Дата. Для параметра Период, наоборот, установим ограничение
	доступности (рис. 13.92).</p>
<p><strong>Рис. 13.92.</strong> Параметры схемы компоновки</p>
<p>Настройки</p>
<p>Приступим к созданию структуры отчета. Перейдем на закладку Настройки и создадим группировку по полю ГруппаУслуг,
	указав тип группировки Иерархия (рис. 13.93).</p>
<p><strong>Рис. 13.93.</strong> Выбор поля и типа группировки</p>
<p>До сих пор мы использовали тип иерархии по умолчанию – Без иерархии. Существуют следующие типы иерархии для
	группировок отчета:</p>
<ul>
	<li>Без иерархии – в группировке выводятся только неиерархические записи;</li>
	<li>Иерархия – в группировке выводятся как неиерархические, так и иерархические записи;</li>
	<li>Только иерархия – в группировке выводятся только иерархические записи.</li>
</ul>
<p>Внутри этой группировки создадим еще одну группировку без указания группового поля. Она будет содержать детальные
	записи отчета. </p>
<p>Перейдем на закладку Выбранные поля и укажем, что в отчет будут выводиться поля Услуга и Цена (рис. 13.94).</p>
<p>Теперь настроим внешний вид отчета на закладке Другие настройки. </p>
<p>Чтобы запретить вывод общих итогов в отчете, установим параметр Расположение общих итогов по вертикали в значение
	Нет. Для параметра Расположение полей группировок укажем значение Отдельно и только в итогах (так наш отчет будет
	лучше читаться). </p>
<p>Также зададим заголовок отчета – Перечень услуг (рис. 13.95).</p>
<p><strong>Рис. 13.95.</strong> Параметры настроек вывода отчета</p>
<p>В заключение включим параметр Дата отчета в состав пользовательских настроек и установим для него Режим
	редактирования – Быстрый доступ. Также определим, в каких подсистемах будет отображаться наш отчет. </p>
<p>Закроем конструктор схемы компоновки данных и в окне редактирования объекта конфигурации Отчет ПереченьУслуг перейдем
	на закладку Подсистемы. Отметим в списке подсистем конфигурации подсистемы Оказание услуг и Бухгалтерия. </p>
<p>В режиме «1С:Предприятие»</p>
<p>Запустим «1С:Предприятие» в режиме отладки и прежде всего откроем периодический регистр Цены. </p>
<p>Добавим в него еще одно значение для услуги Диагностика: новая цена услуги на 10.07.2013 – 350 (рис. 13.96). Это
	позволит нам протестировать отчет.</p>
<p>для услуги «Диагностика»</p>
<p>Теперь выполним отчет Перечень услуг по состоянию на 07.07.2013 (рис. 13.97).</p>
<p>Наш отчет правильно отражает цену услуги Диагностика на </p>
<p>07.07.2013 – 200 руб.</p>
<p>Еще раз выполним отчет, но теперь уже на другую дату – 10.07.2013 (рис. 13.98).</p>
<p>Как видите, показана новая цена услуги Диагностика – 350 руб.</p>
<p><strong>Рис. 13.97.</strong> Результат выполнения отчета</p>
<p><strong>Рис. 13.98.</strong> Результат выполнения отчета</p>
<p>Таким образом, на примере этого отчета мы показали, как система компоновки данных получает последние значения из
	периодического регистра сведений и как вывести группировки по иерархии справочника.</p>
<p><strong>Использование вычисляемого поля в отчете</strong></p>
<p>Следующий отчет – Рейтинг клиентов – будет показывать в графическом виде, каков доход от оказания услуг каждому из
	клиентов за все время работы ООО «На все руки мастер» (рис. 13.99).</p>
<p>На его примере мы продемонстрируем возможность использования вычисляемого поля и вывод результата в виде круговой
	диаграммы и в виде гистограммы.</p>
<p>В режиме «Конфигуратор»</p>
<p>Добавим новый объект конфигурации Отчет. Назовем его РейтингКлиентов и запустим конструктор схемы компоновки данных.
	Создадим новый Набор данных – запрос и вызовем конструктор запроса. </p>
<p>Запрос для набора данных</p>
<p>В качестве источника данных для запроса выберем виртуальную таблицу регистра накопления Продажи.Обороты. Затем
	выберем из нее следующие поля (рис. 13.100):</p>
<ul>
	<li>ПродажиОбороты.Клиент,  ПродажиОбороты.ВыручкаОборот,</li>
	<li>ПродажиОбороты.СтоимостьОборот.</li>
</ul>
<p><strong>Рис. 13.100.</strong> Выбранные поля</p>
<p>На закладке Объединения/Псевдонимы укажем, что поле Выруч- каОборот будет иметь псевдоним Выручка, а поле
	СтоимостьОборот – Стоимость. На этом создание запроса завершено, нажмем OK. </p>
<p>Ничего нового и непонятного в этом запросе для нас нет, поэтому не будем его подробно рассматривать. Перейдем к
	редактированию схемы компоновки данных. </p>
<p>Вычисляемые поля</p>
<p>На этом этапе мы столкнулись с необходимостью отразить в отчете поле, которого нет в наборе данных. Раньше мы
	использовали в отчете те поля, которые описывались в наборе данных. Теперь, чтобы отобразить доход от оказания услуг
	в разрезе клиентов, нам необходимо дополнительное поле, рассчитанное как разница между выручкой и стоимостью
	оказания услуг.</p>
<p>Для этого в системе компоновки данных есть возможность определения вычисляемого поля.</p>
<p><em>Вычисляемые поля</em> представляют собой дополнительные поля схемы компоновки данных, значения которых будут
	вычисляться по некоторой формуле.</p>
<p>Перейдем на закладку Вычисляемые поля схемы компоновки данных и, нажав кнопку Добавить, добавим вычисляемое
	поле. </p>
<p>400 1С:Предприятие 8.3. Практическое пособие разработчика</p>
<p>Дадим ему имя (Путь к данным) – Доход, в колонку Выражение введем выражение для расчета вычисляемого поля (листинг
	13.14).</p>
<p><strong>листинг 13.14.</strong> Выражение для расчета вычисляемого поля «Доход»</p>
<p>Выручка - Стоимость</p>
<p>Заголовок вычисляемого поля, который будет отображаться в шапке отчета, задается по умолчанию, но можно его изменить
	(рис. 13.101).</p>
<p><strong>Рис. 13.101.</strong> Создание вычисляемого поля</p>
<p>Вычисляемое поле можно добавить в ресурсы отчета, чтобы вычислять по нему групповые и общие итоги.</p>
<p>Ресурсы</p>
<p>На закладке Ресурсы нажатием кнопки <img src="39.jpeg"/> выберем все доступные ресурсы отчета. Как мы видим,
	вычисляемое поле Доход также добавилось в список ресурсов (рис. 13.102).</p>
<p><strong>Рис. 13.102.</strong> Ресурсы схемы компоновки данных</p>
<p>Настройки</p>
<p>На закладке Настройки добавим в структуру отчета диаграмму. Для этого нажмем кнопку Добавить в командной панели окна
	настроек и добавим диаграмму (рис. 13.103).</p>
<p><strong>Рис. 13.103.</strong> Добавление диаграммы в структуру отчета</p>
<p>Затем выделим ветку Точки и добавим в нее группировку по полю Клиент. </p>
<p>Серии диаграммы оставим без изменений. </p>
<p>Дело в том, что для демонстрации рейтинга клиентов хорошо подойдет круговая диаграмма, которую мы хотим показать. Для
	этого вида диаграммы достаточно задать только точки, поэтому серии мы не задаем. </p>
<p>В значения диаграммы всегда выводится один или сразу несколько ресурсов отчета. Перейдем на закладку Выбранные поля и
	выберем поле Доход для вывода в отчет. </p>
<p>Структура отчета должна принять следующий вид (рис. 13.104).</p>
<p><strong>Рис. 13.104.</strong> Структура отчета и настройки диаграммы</p>
<p>На закладке Другие настройки выберем тип диаграммы – Круговая объемная и включим эту настройку в состав быстрых
	пользовательских настроек (рис. 13.105). Также зададим заголовок отчета – </p>
<p><strong>Рис. 13.105.</strong> Круговая объемная диаграмма</p>
<p>В заключение определим, в каких подсистемах будет отображаться наш отчет. В окне редактирования объекта конфигурации
	Отчет РейтингКлиентов перейдем на закладку Подсистемы. Отметим в списке подсистем конфигурации подсистемы Оказание
	услуг и Бухгалтерия. </p>
<p>В режиме «1С:Предприятие»</p>
<p>Запустим «1С:Предприятие» в режиме отладки и выполним команду Рейтинг клиентов в разделе Бухгалтерия. Нажмем
	Сформировать. </p>
<p>Мы видим данные о доходе от оказания услуг по каждому из клиентов, представленные в виде круговой диаграммы (рис.
	13.106).</p>
<p>Воспользуемся настройкой типа диаграммы, представленной в форме отчета, и изменим тип диаграммы на Гистограмма
	объемная. Заново сформируем отчет (рис. 13.107).</p>
<p>Таким образом, мы продемонстрировали, как можно использовать различные виды диаграмм для визуализации данных
	отчета.</p>
<p><strong>Рис. 13.106.</strong> Круговая объемная диаграмма</p>
<p><strong>Рис. 13.107.</strong> Гистограмма объемная</p>
<p><strong>Вывод данных в таблицу</strong></p>
<p>На примере создания универсального отчета мы продемонстрируем вывод данных в таблицу (рис. 13.108).</p>
<p>Мы покажем, как сделать отчет максимально универсальным, чтобы позволить пользователю в режиме 1С:Предприятие, не
	обращаясь к полным настройкам отчета (не выполняя Еще  Изменить вариант…), изменять его структуру и внешний вид.
	Например, поменять местами строки и колонки таблицы или изменить данные, выводящиеся в ячейках таблицы. </p>
<p>В режиме «Конфигуратор»</p>
<p>Добавим новый объект конфигурации Отчет. Назовем его Универсальный и запустим конструктор схемы компоновки данных.
	Создадим новый Набор данных – запрос и вызовем конструктор запроса. </p>
<p>Запрос для набора данных</p>
<p>В качестве источника данных для запроса выберем виртуальную таблицу регистра накопления Продажи.Обороты. Затем
	выберем из нее все поля (рис. 13.109).</p>
<p><strong>Рис. 13.109.</strong> Выбранные поля</p>
<p>Анализ текста запроса</p>
<p>Нажмем OK и посмотрим на текст, сформированный конструктором запроса (листинг 13.15). <strong>листинг 13.15.</strong>
	Текст запроса</p>
<table>
	<tr>
		<td><p>ВЫБРАТЬ</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ПродажиОбороты.Номенклатура,</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ПродажиОбороты.Клиент,</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ПродажиОбороты.Мастер,</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ПродажиОбороты.КоличествоОборот,</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ПродажиОбороты.ВыручкаОборот,</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ПродажиОбороты.СтоимостьОборот</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ИЗ</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>РегистрНакопления.Продажи.Обороты КАК ПродажиОбороты </p></td>
	</tr>
</table>
<p>Ресурсы</p>
<p>На закладке Ресурсы нажатием кнопки <img src="40.jpeg"/> выберем все доступные ресурсы отчета. </p>
<p>Настройки</p>
<p>На закладке Настройки добавим в структуру отчета таблицу. Для этого нажмем кнопку Добавить в командной панели окна
	настроек и добавим таблицу (рис. 13.110).</p>
<p><strong>Рис. 13.110.</strong> Добавление таблицы в структуру отчета</p>
<p>Мы не будем здесь задавать строки и колонки этой таблицы, а также список выбранных полей, так как хотим предоставить
	полную свободу пользователю в этих действиях. Для этого выделим в структуре элементов отчета элемент Таблица и
	нажмем кнопку Свойства элемента пользовательских настроек, расположенную вверху в командной панели окна
	настроек. </p>
<p>В появившемся окне мы можем редактировать состав пользовательских настроек таблицы. </p>
<p>Установим признак использования для настроек Выбранные поля, Группировки строк и Группировки колонок и оставим для
	них по умолчанию свойство Режим редактирования в значении Быстрый доступ (рис. 13.111).</p>
<p><strong>Рис. 13.111.</strong> Состав пользовательских настроек</p>
<p>Таким образом, мы предоставили пользователю возможность самостоятельно определять состав выбранных полей, группировок
	строк и колонок таблицы непосредственно в отчетной форме перед формированием отчета.</p>
<p>В заключение определим, в каких подсистемах будет отображаться наш отчет. </p>
<p>Закроем конструктор схемы компоновки данных и в окне редактирования объекта конфигурации Отчет Универсальный перейдем
	на закладку Подсистемы. Отметим в списке подсистем конфигурации подсистему Оказание услуг. </p>
<p>В режиме «1С:Предприятие»</p>
<p>Запустим «1С:Предприятие» в режиме отладки и выполним команду Универсальный в разделе ОказаниеУслуг. </p>
<p>Если мы сейчас нажмем Сформировать, то ничего не увидим в результате, так как список выбранных полей, группировок
	строк и колонок таблицы пуст. Заполним эти быстрые пользовательские настройки.</p>
<p>Нажмем кнопку выбора в строке Выбранные поля и выберем из доступных полей поле ВыручкаОборот. Нажмем кнопку выбора в
	строке Строки и добавим в строки таблицы группировку по полю Номенклатура с типом Иерархия. Нажмем кнопку выбора в
	строке Колонки и добавим в колонки таблицы группировку по полю Мастер. Нажмем Сформировать. </p>
<p>Отчет примет следующий вид (рис. 13.112).</p>
<p>Заметьте, что при прокручивании отчета вниз и вправо положение шапки отчета и самой левой колонки таблицы остается
	зафиксированным. Для удобства пользователя платформа автоматически фиксирует сверху и слева табличный документ, в
	который выводится результат отчета. Можно также вручную управлять фиксацией строк и столбцов отчета с помощью
	параметров вывода ФиксацияСлева и ФиксацияСверху.</p>
<p>Теперь добавим в список выбранных полей поле СтоимостьОборот. В строки таблицы вместо группировки по полю
	Номенклатура поместим группировку по полю Клиент. </p>
<p>В результате отчет примет следующий вид (рис. 13.113).</p>
<p>Теперь исключим из списка выбранных полей поле СтоимостьОборот. В строках таблицы заменим прежнюю группировку на
	группировку по полю Номенклатура с типом ТолькоИерархия. В колонки таблицы добавим группировку по полю Клиент и
	поместим ее первой в списке группировок. </p>
<p>В результате отчет примет следующий вид (рис. 13.114).</p>
<p>Таким образом, используя этот отчет, мы предоставили пользователю альтернативную возможность самостоятельно
	формировать отчет по регистру Продажи.</p>
<h1><a id="_Toc454870665"></a>Лабораторная работа № 20 Реализация по безналу</h1>
<p><strong>Порядок выполнения работы </strong></p>
<p>1. Ознакомьтесь с теоретическими основами в настоящих указаниях и конспектах лекций. </p>
<p>2. Получите задание у преподавателя. </p>
<p>3. Сделайте скриншоты (кнопка клавиатуры PrtSc) выполненных заданий в текстовом (Word) файле <em>Фамилия_ЛР</em></p>
<p>4. Составьте отчет по лабораторной работе. </p>
<p>5. Отчитайте работу преподавателю.</p>
<p><strong>Повышение скорости проведения</strong></p>
<p>Первое, чем мы займемся на этом занятии, – избавимся от «вредной» конструкции
	ТекСтрокаПереченьНоменклатуры.Номенклатура.ВидНоменклатуры. </p>
<p><strong>В режиме «Конфигуратор»</strong></p>
<p>Откроем модуль документа ОказаниеУслуги. </p>
<p>Напомним, как выглядит сейчас процедура проведения этого документа (листинг 14.3). <strong>листинг 14.3.</strong>
	Процедура «ОбработкаПроведения»</p>
<table>
	<tr>
		<td><p>Движения.ОстаткиМатериалов.Записывать = Истина;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движения.СтоимостьМатериалов.Записывать = Истина;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движения.Продажи.Записывать = Истина;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Для Каждого ТекСтрокаПереченьНоменклатуры Из ПереченьНоменклатуры Цикл</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Если ТекСтрокаПереченьНоменклатуры.Номенклатура.ВидНоменклатуры = </p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Перечисления.ВидыНоменклатуры.Материал Тогда </p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// Регистр ОстаткиМатериалов Расход</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение = Движения.ОстаткиМатериалов.Добавить();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.ВидДвижения = ВидДвиженияНакопления.Расход;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.Период = Дата;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.Материал = ТекСтрокаПереченьНоменклатуры.Номенклатура;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.Склад = Склад;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.Количество = ТекСтрокаПереченьНоменклатуры.Количество;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// Регистр СтоимостьМатериалов Расход</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение = Движения.СтоимостьМатериалов.Добавить();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.ВидДвижения = ВидДвиженияНакопления.Расход;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.Период = Дата;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.Материал = ТекСтрокаПереченьНоменклатуры.Номенклатура;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.Стоимость = ТекСтрокаПереченьНоменклатуры.Количество * </p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ТекСтрокаПереченьНоменклатуры.Стоимость;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецЕсли;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// Регистр Продажи </p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение = Движения.Продажи.Добавить();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.Период = Дата;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.Номенклатура = ТекСтрокаПереченьНоменклатуры.Номенклатура;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.Клиент = Клиент;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.Мастер = Мастер;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.Количество = ТекСтрокаПереченьНоменклатуры.Количество;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.Выручка = ТекСтрокаПереченьНоменклатуры.Сумма;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.Стоимость = ТекСтрокаПереченьНоменклатуры.Стоимость * </p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ТекСтрокаПереченьНоменклатуры.Количество;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецЦикла;</p></td>
	</tr>
</table>
<p>Другими словами, все данные, необходимые для проведения документа, мы получаем из самого документа, и только для
	определения того, чем является номенклатура (товаром или услугой), мы обращаемся к базе данных, читая данные всего
	объекта Номенклатура (листинг 14.4).</p>
<p><strong>листинг 14.4.</strong> Обращение к объекту «Номенклатура»</p>
<p>Если ТекСтрокаПереченьНоменклатуры.Номенклатура.ВидНоменклатуры</p>
<p>Забегая вперед, скажем, что это не единственные данные, которые не содержатся в самом документе и которые в то же
	время будут нужны нам для правильного его проведения.</p>
<p>Поэтому поступим следующим образом: все данные, связанные с номенклатурой, которая содержится в табличной части
	документа, мы будем получать с помощью запроса к базе данных. А данные, связанные с самим документом (например, дата
	документа, склад), мы по-прежнему будем получать из документа. Такой подход позволит нам читать только нужные данные
	и за счет этого максимально ускорить проведение документа.</p>
<p>Итак, запросом мы будем получать:</p>
<ul>
	<li>номенклатуру,</li>
	<li>количество,</li>
	<li>сумму,</li>
	<li>стоимость.</li>
</ul>
<p>Из документа мы возьмем следующие данные:</p>
<ul>
	<li>дата,</li>
	<li>клиент,  мастер,  склад.</li>
</ul>
<p>Приступим к созданию запроса. Установим курсор перед циклом обхода табличной части документа и из контекстного меню
	выберем пункт Конструктор запроса с обработкой результата (рис. 14.4).</p>
<p>Подтвердим, что мы хотим создать новый запрос.</p>
<p>В окне конструктора запросов перейдем на закладку Таблицы и поля и выберем таблицу ОказаниеУслугиПереченьНоменклатуры
	– это табличная часть документа ОказаниеУслуги. </p>
<p>Из этой таблицы нам нужны поля – Номенклатура, Номенклату- раВидНоменклатуры, Количество, Сумма и Стоимость (рис.
	14.5).</p>
<p>Но нам нужны не все записи этой таблицы, а только те, которые относятся к нашему документу. </p>
<p>Поэтому перейдем на закладку Условия и зададим условие отбора из таблицы документа только строк проводимого
	документа. </p>
<p>Для этого перетащим поле Ссылка в список условий запроса (листинг 14.5).</p>
<p><strong>листинг 14.5.</strong> Условие отбора из таблицы документа</p>
<p>ОказаниеУслугиПереченьНоменклатуры.Ссылка = &amp;Ссылка</p>
<p>Ссылка на этот документ будет передана в параметр запроса Ссылка (рис. 14.6).</p>
<p><strong>Рис. 14.6.</strong> Условие отбора из таблицы документа</p>
<p>Также следует учесть, что в табличной части документа одна и та же номенклатура может встречаться несколько раз. </p>
<p>Поэтому на закладке Группировка сгруппируем наши записи по полям Номенклатура и НоменклатураВидНоменклатуры, а
	рассчитывать будем сумму значений для полей Количество и Сумма. </p>
<p>Благодаря этому в результате значения номенклатуры повторяться не будут, и для каждого из них будут посчитаны
	суммарные значения по полям Количество и Сумма, если в табличной части документа содержится несколько строк с
	одинаковой номенклатурой.</p>
<p>Также в состав суммируемых полей включим и поле Стоимость. По нему будем рассчитывать, например, функцию
	Максимум. </p>
<p>Мы подразумеваем, что для разных строк одной и той же номенклатуры стоимость будет одинаковой, поэтому функция
	Максимум нужна нам лишь для того, чтобы получить одно из имеющихся значений стоимости (рис. 14.7).</p>
<p><strong>Рис. 14.7.</strong> Группировка строк таблицы документа</p>
<p>На закладке Объединения/Псевдонимы зададим псевдонимы для полей Количество и Сумма – КоличествоВДокументе и
	СуммаВДокументе, а для поля НоменклатураВидНоменклатуры зададим псевдоним ВидНоменклатуры просто для облегчения
	чтения запроса (рис. 14.8).</p>
<p>Нажмем ОК и посмотрим, какой текст запроса сформировал конструктор (листинг 14.6). <strong>листинг 14.6.</strong>
	Текст запроса</p>
<table>
	<tr>
		<td><p>//{{КОНСТРУКТОР_ЗАПРОСА_С_ОБРАБОТКОЙ_РЕЗУЛЬТАТА</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// Данный фрагмент построен конструктором.</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// При повторном использовании конструктора внесенные вручную изменения будут утеряны!!!</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Запрос = Новый Запрос;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Запрос.Текст = </p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>&quot;ВЫБРАТЬ</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p> | ОказаниеУслугиПереченьНоменклатуры.Номенклатура,</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p> | ОказаниеУслугиПереченьНоменклатуры.Номенклатура.ВидНоменклатуры </p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p> | КАК ВидНоменклатуры,</p></td>
	</tr>
</table>
<p> | СУММА(ОказаниеУслугиПереченьНоменклатуры.Количество) </p>
<p> | КАК КоличествоВДокументе,</p>
<p> | СУММА(ОказаниеУслугиПереченьНоменклатуры.Сумма) КАК СуммаВДокументе,</p>
<table>
	<tr>
		<td><p> | МАКСИМУМ(ОказаниеУслугиПереченьНоменклатуры.Стоимость) КАК Стоимость</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>|ИЗ</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p> | Документ.ОказаниеУслуги.ПереченьНоменклатуры </p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p> | КАК ОказаниеУслугиПереченьНоменклатуры</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>|ГДЕ</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p> | ОказаниеУслугиПереченьНоменклатуры.Ссылка = &amp;Ссылка</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p> |</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>|СГРУППИРОВАТЬ ПО</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p> | ОказаниеУслугиПереченьНоменклатуры.Номенклатура,</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p> | ОказаниеУслугиПереченьНоменклатуры.Номенклатура.ВидНоменклатуры&quot;;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Запрос.УстановитьПараметр(&quot;Ссылка», Ссылка);</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>РезультатЗапроса = Запрос.Выполнить();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ВыборкаДетальныеЗаписи = РезультатЗапроса.Выбрать();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Пока ВыборкаДетальныеЗаписи.Следующий() Цикл</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// Вставить обработку выборки ВыборкаДетальныеЗаписи</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецЦикла;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>//}}КОНСТРУКТОР_ЗАПРОСА_С_ОБРАБОТКОЙ_РЕЗУЛЬТАТА</p></td>
	</tr>
</table>
<p>Комментарии конструктора запроса в начале и конце фрагмента можно удалить.</p>
<p>Поскольку для построения запроса мы использовали Конструктор запроса с обработкой результата, конструктор написал за
	нас код для выполнения и обхода записей запроса. Прокомментируем этот код.</p>
<p>Как вы уже знаете, для работы с запросами используется объект встроенного языка Запрос. Вначале создается новый
	объект Запрос и помещается в переменную Запрос. Затем в свойство Текст объекта Запрос помещается сам текст запроса
	(Запрос.Текст = …). </p>
<p>После этого устанавливается значение параметра запроса &amp;Ссылка как ссылка на тот документ, в модуле которого мы
	сейчас находимся (листинг 14.7).</p>
<p><strong>листинг 14.7.</strong> Установка параметра запроса</p>
<p>Запрос.УстановитьПараметр(&quot;Ссылка&quot;, Ссылка);</p>
<p>Затем запрос выполняется (Запрос.Выполнить()), получается объект РезультатЗапроса, и выполняется его метод Выбрать(),
	который формирует выборку записей из результата запроса. </p>
<p>Таким образом, получается объект ВыборкаИзРезультатаЗапроса, который помещается в переменную
	ВыборкаДетальныеЗаписи. </p>
<p>Далее, используя метод этого объекта Следующий() (ВыборкаДетальныеЗаписи.Следующий()), мы будем в цикле обходить
	выборку записей запроса.</p>
<p>Выполняя метод выборки запроса ВыборкаДетальныеЗаписи.Следующий(), мы на каждом шаге цикла позиционируем указатель на
	следующую запись выборки, пока не будет достигнут конец выборки. </p>
<p>Чтобы в цикле получить значение какого-либо поля выборки из результата запроса, мы будем обращаться к полям запроса
	через точку от переменной ВыборкаДетальныеЗаписи, которая содержит текущую строку выборки запроса. Например, так:
	ВыборкаДетальныеЗаписи.Номенклатура.</p>
<p>Теперь нам осталось перенести существовавшие ранее в этом модуле строки, описывающие движения регистров, внутрь цикла
	обхода результата запроса (листинг 14.8).</p>
<p><strong>листинг 14.8.</strong> Цикл обхода записей запроса</p>
<table>
	<tr>
		<td><p>Пока ВыборкаДетальныеЗаписи.Следующий() Цикл</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// Вставить обработку выборки ВыборкаДетальныеЗаписи</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецЦикла;</p></td>
	</tr>
</table>
<p>Сначала вместо комментария «// Вставить обработку выборки ВыборкаДетальныеЗаписи» перенесем условие проверки и весь
	код, формирующий движения по регистрам ОстаткиМатериалов и СтоимостьМатериалов (листинг 14.9). <strong>листинг
		14.9.</strong> Формирование движений регистров</p>
<table>
	<tr>
		<td><p>Пока ВыборкаДетальныеЗаписи.Следующий() Цикл</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>Если ТекСтрокаПереченьНоменклатуры.Номенклатура.ВидНоменклатуры = </strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>Перечисления.ВидыНоменклатуры.Материал Тогда </strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>// Регистр ОстаткиМатериалов Расход</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>Движение = Движения.ОстаткиМатериалов.Добавить();</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>Движение.ВидДвижения = ВидДвиженияНакопления.Расход;</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>Движение.Период = Дата;</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>Движение.Материал = ТекСтрокаПереченьНоменклатуры.Номенклатура;</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>Движение.Склад = Склад;</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>Движение.Количество = ТекСтрокаПереченьНоменклатуры.Количество;</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>// Регистр СтоимостьМатериалов Расход</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>Движение = Движения.СтоимостьМатериалов.Добавить();</strong></p></td>
	</tr>
</table>
<p><strong>Движение.ВидДвижения = ВидДвиженияНакопления.Расход;</strong></p>
<p><strong>Движение.Период = Дата;</strong></p>
<p><strong>Движение.Материал = ТекСтрокаПереченьНоменклатуры.Номенклатура;</strong></p>
<table>
	<tr>
		<td><p><strong>Движение.Стоимость = ТекСтрокаПереченьНоменклатуры.Количество * </strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>ТекСтрокаПереченьНоменклатуры.Стоимость;</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>КонецЕсли;</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецЦикла;</p></td>
	</tr>
</table>
<p>В условии заменим ТекСтрокаПереченьНоменклатуры.Номенклатура на ВыборкаДетальныеЗаписи, так как вид номенклатуры мы
	теперь получаем из запроса. </p>
<p>В движениях также заменим ТекСтрокаПереченьНоменклатуры на ВыборкаДетальныеЗаписи (листинг 14.10).</p>
<p><strong>листинг 14.10.</strong> Формирование движений регистров</p>
<table>
	<tr>
		<td><p>Пока ВыборкаДетальныеЗаписи.Следующий() Цикл</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Если <strong>ВыборкаДетальныеЗаписи.</strong>ВидНоменклатуры = </p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Перечисления.ВидыНоменклатуры.Материал Тогда </p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// Регистр ОстаткиМатериалов Расход</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение = Движения.ОстаткиМатериалов.Добавить();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.ВидДвижения = ВидДвиженияНакопления.Расход;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.Период = Дата;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.Материал = <strong>ВыборкаДетальныеЗаписи</strong>.Номенклатура;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.Склад = Склад;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.Количество = <strong>ВыборкаДетальныеЗаписи</strong>.Количество;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// Регистр СтоимостьМатериалов Расход</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение = Движения.СтоимостьМатериалов.Добавить();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.ВидДвижения = ВидДвиженияНакопления.Расход;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.Период = Дата;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.Материал = <strong>ВыборкаДетальныеЗаписи</strong>.Номенклатура;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.Стоимость = <strong>ВыборкаДетальныеЗаписи</strong>.Количество * </p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>ВыборкаДетальныеЗаписи</strong>.Стоимость;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецЕсли;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецЦикла;</p></td>
	</tr>
</table>
<p><strong>пРиМеЧАние</strong></p>
<p>Для упрощения восприятия новый текст в листингах выделен жирным шрифтом.</p>
<p>Не забудем, что для поля Количество мы задали псевдоним в запросе, поэтому заменим его на КоличествоВДокументе
	(листинг 14.11).</p>
<p><strong>листинг 14.11.</strong> Формирование движений регистров</p>
<p>Пока ВыборкаДетальныеЗаписи.Следующий() Цикл</p>
<table>
	<tr>
		<td><p>Если ВыборкаДетальныеЗаписи<strong>.</strong>ВидНоменклатуры = </p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Перечисления.ВидыНоменклатуры.Материал Тогда </p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// Регистр ОстаткиМатериалов Расход</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение = Движения.ОстаткиМатериалов.Добавить();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.ВидДвижения = ВидДвиженияНакопления.Расход;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.Период = Дата;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.Материал = ВыборкаДетальныеЗаписи.Номенклатура;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.Склад = Склад;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.Количество = ВыборкаДетальныеЗаписи.<strong>КоличествоВДокументе</strong>;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// Регистр СтоимостьМатериалов Расход</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение = Движения.СтоимостьМатериалов.Добавить();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.ВидДвижения = ВидДвиженияНакопления.Расход;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.Период = Дата;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.Материал = ВыборкаДетальныеЗаписи.Номенклатура;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.Стоимость = ВыборкаДетальныеЗаписи.<strong>КоличествоВДокументе</strong> * </p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ВыборкаДетальныеЗаписи.Стоимость;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецЕсли;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецЦикла;</p></td>
	</tr>
</table>
<p>Теперь перенесем формирование движений по регистру Продажи (листинг 14.12). <strong>листинг 14.12.</strong>
	Формирование движений регистров</p>
<table>
	<tr>
		<td><p>Пока ВыборкаДетальныеЗаписи.Следующий() Цикл</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Если ВыборкаДетальныеЗаписи<strong>.</strong>ВидНоменклатуры = </p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Перечисления.ВидыНоменклатуры.Материал Тогда </p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// Регистр ОстаткиМатериалов Расход</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение = Движения.ОстаткиМатериалов.Добавить();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.ВидДвижения = ВидДвиженияНакопления.Расход;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.Период = Дата;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.Материал = ВыборкаДетальныеЗаписи.Номенклатура;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.Склад = Склад;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.Количество = ВыборкаДетальныеЗаписи.КоличествоВДокументе;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// Регистр СтоимостьМатериалов Расход</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение = Движения.СтоимостьМатериалов.Добавить();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.ВидДвижения = ВидДвиженияНакопления.Расход;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.Период = Дата;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.Материал = ВыборкаДетальныеЗаписи.Номенклатура;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.Стоимость = ВыборкаДетальныеЗаписи.КоличествоВДокументе * </p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ВыборкаДетальныеЗаписи.Стоимость;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецЕсли;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>// Регистр Продажи </strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>Движение = Движения.Продажи.Добавить();</strong></p></td>
	</tr>
</table>
<p><strong>Движение.Период = Дата;</strong></p>
<p><strong>Движение.Номенклатура = ТекСтрокаПереченьНоменклатуры.Номенклатура; Движение.Клиент = Клиент;</strong></p>
<table>
	<tr>
		<td><p><strong>Движение.Мастер = Мастер;</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>Движение.Количество = ТекСтрокаПереченьНоменклатуры.Количество;</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>Движение.Выручка = ТекСтрокаПереченьНоменклатуры.Сумма;</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>Движение.Стоимость = ТекСтрокаПереченьНоменклатуры.Стоимость * </strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>ТекСтрокаПереченьНоменклатуры.Количество;</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецЦикла;</p></td>
	</tr>
</table>
<p>Здесь произведем аналогичные замены. ТекСтрокаПереченьНоменклатуры заменим на ВыборкаДетальныеЗаписи (листинг
	14.13).</p>
<p><strong>листинг 14.13.</strong> Формирование движений регистров</p>
<table>
	<tr>
		<td><p>Пока ВыборкаДетальныеЗаписи.Следующий() Цикл</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Если ВыборкаДетальныеЗаписи.ВидНоменклатуры = </p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Перечисления.ВидыНоменклатуры.Материал Тогда </p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// Регистр ОстаткиМатериалов Расход</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение = Движения.ОстаткиМатериалов.Добавить();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.ВидДвижения = ВидДвиженияНакопления.Расход;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.Период = Дата;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.Материал = ВыборкаДетальныеЗаписи.Номенклатура;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.Склад = Склад;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.Количество = ВыборкаДетальныеЗаписи.КоличествоВДокументе;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// Регистр СтоимостьМатериалов Расход</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение = Движения.СтоимостьМатериалов.Добавить();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.ВидДвижения = ВидДвиженияНакопления.Расход;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.Период = Дата;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.Материал = ВыборкаДетальныеЗаписи.Номенклатура;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.Стоимость = ВыборкаДетальныеЗаписи.КоличествоВДокументе * </p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p> ВыборкаДетальныеЗаписи.Стоимость;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецЕсли;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// Регистр Продажи </p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение = Движения.Продажи.Добавить();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.Период = Дата;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.Номенклатура = <strong>ВыборкаДетальныеЗаписи</strong>.Номенклатура;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.Клиент = Клиент;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.Мастер = Мастер;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.Количество = <strong>ВыборкаДетальныеЗаписи</strong>.Количество;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.Выручка = <strong>ВыборкаДетальныеЗаписи</strong>.Сумма;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.Стоимость = <strong>ВыборкаДетальныеЗаписи</strong>.Стоимость * </p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>ВыборкаДетальныеЗаписи</strong>.Количество;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецЦикла;</p></td>
	</tr>
</table>
<p>Поля запроса Сумма и Количество заменим на СуммаВДокументе и КоличествоВДокументе (листинг 14.14).</p>
<p><strong>листинг 14.14.</strong> Формирование движений регистров</p>
<p>Пока ВыборкаДетальныеЗаписи.Следующий() Цикл</p>
<table>
	<tr>
		<td><p>Если ВыборкаДетальныеЗаписи.ВидНоменклатуры = </p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Перечисления.ВидыНоменклатуры.Материал Тогда </p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// Регистр ОстаткиМатериалов Расход</p></td>
	</tr>
	<tr>
		<td><p>Движение = Движения.ОстаткиМатериалов.Добавить();</p></td>
	</tr>
	<tr>
		<td><p>Движение.ВидДвижения = ВидДвиженияНакопления.Расход;</p></td>
	</tr>
	<tr>
		<td><p>Движение.Период = Дата;</p></td>
	</tr>
	<tr>
		<td><p>Движение.Материал = ВыборкаДетальныеЗаписи.Номенклатура;</p></td>
	</tr>
	<tr>
		<td><p>Движение.Склад = Склад;</p></td>
	</tr>
	<tr>
		<td><p>Движение.Количество = ВыборкаДетальныеЗаписи.КоличествоВДокументе;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// Регистр СтоимостьМатериалов Расход</p></td>
	</tr>
	<tr>
		<td><p>Движение = Движения.СтоимостьМатериалов.Добавить();</p></td>
	</tr>
	<tr>
		<td><p>Движение.ВидДвижения = ВидДвиженияНакопления.Расход;</p></td>
	</tr>
	<tr>
		<td><p>Движение.Период = Дата;</p></td>
	</tr>
	<tr>
		<td><p>Движение.Материал = ВыборкаДетальныеЗаписи.Номенклатура;</p></td>
	</tr>
	<tr>
		<td><p>Движение.Стоимость = ВыборкаДетальныеЗаписи.КоличествоВДокументе * </p></td>
	</tr>
	<tr>
		<td><p>ВыборкаДетальныеЗаписи.Стоимость;</p></td>
	</tr>
	<tr>
		<td><p>КонецЕсли;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// Регистр Продажи </p></td>
	</tr>
	<tr>
		<td><p>Движение = Движения.Продажи.Добавить();</p></td>
	</tr>
	<tr>
		<td><p>Движение.Период = Дата;</p></td>
	</tr>
	<tr>
		<td><p>Движение.Номенклатура = ВыборкаДетальныеЗаписи.Номенклатура;</p></td>
	</tr>
	<tr>
		<td><p>Движение.Клиент = Клиент;</p></td>
	</tr>
	<tr>
		<td><p>Движение.Мастер = Мастер;</p></td>
	</tr>
	<tr>
		<td><p>Движение.Количество = ВыборкаДетальныеЗаписи.<strong>КоличествоВДокументе</strong>;</p></td>
	</tr>
	<tr>
		<td><p>Движение.Выручка = ВыборкаДетальныеЗаписи.<strong>СуммаВДокументе</strong>;</p></td>
	</tr>
	<tr>
		<td><p>Движение.Стоимость = ВыборкаДетальныеЗаписи.Стоимость * </p></td>
	</tr>
	<tr>
		<td><p>ВыборкаДетальныеЗаписи.<strong>КоличествоВДокументе</strong>;</p></td>
	</tr>
	<tr>
		<td><p>КонецЦикла;</p></td>
	</tr>
</table>
<p>Оставшийся цикл обхода табличной части можно удалить (листинг 14.15).</p>
<p><strong>листинг 14.15.</strong> Ненужные строки</p>
<table>
	<tr>
		<td><p>Для Каждого ТекСтрокаПереченьНоменклатуры Из ПереченьНоменклатуры Цикл</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецЦикла;</p></td>
	</tr>
</table>
<p>В результате процедура проведения примет следующий вид (листинг 14.16).</p>
<p><strong>листинг 14.16.</strong> Процедура «ОбработкаПроведения»</p>
<table>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Процедура ОбработкаПроведения(Отказ, Режим)</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движения.ОстаткиМатериалов.Записывать = Истина;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движения.СтоимостьМатериалов.Записывать = Истина;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движения.Продажи.Записывать = Истина;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Запрос = Новый Запрос;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Запрос.Текст = </p></td>
	</tr>
</table>
<p>&quot;ВЫБРАТЬ</p>
<p> | ОказаниеУслугиПереченьНоменклатуры.Номенклатура,</p>
<table>
	<tr>
		<td><p> | ОказаниеУслугиПереченьНоменклатуры.Номенклатура.ВидНоменклатуры </p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p> | КАК ВидНоменклатуры,</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p> | СУММА(ОказаниеУслугиПереченьНоменклатуры.Количество) </p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p> | КАК КоличествоВДокументе,</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p> | СУММА(ОказаниеУслугиПереченьНоменклатуры.Сумма) КАК СуммаВДокументе,</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p> | МАКСИМУМ(ОказаниеУслугиПереченьНоменклатуры.Стоимость) КАК Стоимость </p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>|ИЗ</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p> | Документ.ОказаниеУслуги.ПереченьНоменклатуры </p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p> | КАК ОказаниеУслугиПереченьНоменклатуры</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>|ГДЕ</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p> | ОказаниеУслугиПереченьНоменклатуры.Ссылка = &amp;Ссылка</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p> |</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>|СГРУППИРОВАТЬ ПО</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p> | ОказаниеУслугиПереченьНоменклатуры.Номенклатура,</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p> | ОказаниеУслугиПереченьНоменклатуры.Номенклатура.ВидНоменклатуры&quot;;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Запрос.УстановитьПараметр(&quot;Ссылка&quot;, Ссылка);</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>РезультатЗапроса = Запрос.Выполнить();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ВыборкаДетальныеЗаписи = РезультатЗапроса.Выбрать();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Пока ВыборкаДетальныеЗаписи.Следующий() Цикл</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Если ВыборкаДетальныеЗаписи.ВидНоменклатуры = </p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Перечисления.ВидыНоменклатуры.Материал Тогда </p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// Регистр ОстаткиМатериалов Расход</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение = Движения.ОстаткиМатериалов.Добавить();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.ВидДвижения = ВидДвиженияНакопления.Расход;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.Период = Дата;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.Материал = ВыборкаДетальныеЗаписи.Номенклатура;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.Склад = Склад;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.Количество = ВыборкаДетальныеЗаписи.КоличествоВДокументе;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// Регистр СтоимостьМатериалов Расход</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение = Движения.СтоимостьМатериалов.Добавить();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.ВидДвижения = ВидДвиженияНакопления.Расход;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.Период = Дата;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.Материал = ВыборкаДетальныеЗаписи.Номенклатура;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.Стоимость = ВыборкаДетальныеЗаписи.КоличествоВДокументе * </p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ВыборкаДетальныеЗаписи.Стоимость;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецЕсли;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// Регистр Продажи </p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение = Движения.Продажи.Добавить();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.Период = Дата;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.Номенклатура = ВыборкаДетальныеЗаписи.Номенклатура;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.Клиент = Клиент;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.Мастер = Мастер;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.Количество = ВыборкаДетальныеЗаписи.КоличествоВДокументе;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.Выручка = ВыборкаДетальныеЗаписи.СуммаВДокументе;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.Стоимость = ВыборкаДетальныеЗаписи.Стоимость * </p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ВыборкаДетальныеЗаписи.КоличествоВДокументе;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецЦикла;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецПроцедуры</p></td>
	</tr>
</table>
<p><strong>В режиме «1С:Предприятие»</strong></p>
<p>Теперь нужно запустить «1С:Предприятие» в режиме отладки, перепровести документы Оказание услуги и проверить, что
	ничего не изменилось.</p>
<p>Таким образом, мы выполнили первый пункт нашего «плана» – избавились в процедуре проведения от считывания всех данных
	объекта Номенклатура и тем самым оптимизировали выполнение процедуры проведения.</p>
<h1><a id="_Toc454870666"></a>Лабораторная работа № 21 Закрытие месяца</h1>
<p><strong>Порядок выполнения работы </strong></p>
<p>1. Ознакомьтесь с теоретическими основами в настоящих указаниях и конспектах лекций. </p>
<p>2. Получите задание у преподавателя. </p>
<p>3. Сделайте скриншоты (кнопка клавиатуры PrtSc) выполненных заданий в текстовом (Word) файле <em>Фамилия_ЛР</em></p>
<p>4. Составьте отчет по лабораторной работе. </p>
<p>5. Отчитайте работу преподавателю.</p>
<p><strong>Автоматический расчет стоимости</strong></p>
<p>Теперь приступим ко второму этапу нашего плана.</p>
<p>До сих пор стоимость расходуемых материалов мы вписывали в документ Оказание услуги вручную, при его создании. </p>
<p>Теперь же будем определять стоимость номенклатуры по среднему: для каждой номенклатуры делить ее общую, суммарную
	стоимость на то количество этой номенклатуры, которое у нас имеется, и таким образом получать среднюю стоимость
	одной единицы этой номенклатуры. </p>
<p>Чтобы выполнить такой расчет, нам понадобятся дополнительные данные, которых у нас сейчас нет. </p>
<p>Для каждой номенклатуры из табличной части нам понадобятся: </p>
<ul>
	<li>ее стоимость, хранящаяся в регистре СтоимостьМатериалов;</li>
	<li>общее ее количество на всех складах, хранящееся в регистре ОстаткиМатериалов.</li>
</ul>
<p>Поэтому нам нужно будет доработать наш запрос таким образом, чтобы он получал из базы данных и эти данные тоже. </p>
<p>Таким образом, нам хотелось бы, чтобы запрос возвращал следующие поля для каждой номенклатуры, которая есть в
	документе (рис. 14.9).</p>
<p><img src="41.jpeg"/></p>
<p><strong>Рис. 14.9.</strong> Описание полей запроса</p>
<p>Первые четыре поля мы можем получить (и уже получаем) из табличной части самого документа, а вот последние два нужно
	будет получить из других таблиц базы данных: </p>
<ul>
	<li>стоимость – из регистра СтоимостьМатериалов;</li>
	<li>остатки на всех складах – из регистра ОстаткиМатериалов</li>
</ul>
<p>(рис. 14.10).</p>
<p><img src="42.jpeg"/></p>
<p><strong>Рис. 14.10.</strong> Описание полей и таблиц запроса</p>
<p>Это значит, что наш запрос должен содержать два левых соединения таблицы документа с другими таблицами: одно – с
	таблицей РегистрНакопления.СтоимостьМатериалов.Остатки, другое – с таблицей
	РегистрНакопления.ОстаткиМатериалов.Остатки.</p>
<p>Казалось бы, все готово для того, чтобы составить запрос.</p>
<p>Но обратите внимание на важную деталь: в предложенной схеме виртуальные таблицы будут возвращать стоимость и остатки
	номенклатуры абсолютно для всей номенклатуры. А нас интересует только та номенклатура, которая указана в нашем
	документе. </p>
<p>На маленькой базе эта особенность может почти не проявляться – количество различных элементов номенклатуры в
	справочнике сравнимо с количеством различных элементов номенклатуры в документе. </p>
<p>Но представьте реальную базу. В справочнике Номенклатура – 15 000 наименований, например. А в документе – всего 5
	наименований. Получится, что сначала виртуальная таблица остатков будет усиленно трудиться и рассчитывать нам
	стоимость (или остатки) по всем 15 000 наименованиям номенклатуры, а в результате, когда мы левым соединением станем
	соединять ее с таблицей документа, мы из этих 15 000 строк стоимости (или остатков) возьмем всего лишь 5 строк – для
	той номенклатуры, которая указана в документе. Остальные 14 995 строк будут просто отброшены – система напрасно их
	рассчитывала.</p>
<p>Естественно, такая расточительность непозволительна в реальных условиях, и такой запрос является очень неоптимальным.
	Поэтому во все виртуальные таблицы, которые мы будем использовать, нужно добавить условие отбора только той
	номенклатуры, которая содержится в табличной части нашего документа. В этом случае стоимость и остатки будут
	рассчитаны не для всей номенклатуры вообще, а только для нужной нам номенклатуры.</p>
<p>В результате схема нашего запроса будет выглядеть следующим образом (рис. 14.11).</p>
<p><img src="43.jpeg"/></p>
<p><strong>Рис. 14.11.</strong> Схема запроса</p>
<p>Обратите внимание, что в обеих виртуальных таблицах используется список номенклатуры из табличной части документа (по
	нему ограничиваются рассчитываемые данные). </p>
<p>Кроме этого, из таблиц документа тоже берутся не все данные, а только данные, относящиеся к одному нашему конкретному
	документу. Чтобы не получать этот список три раза (для документа и в каждой виртуальной таблице заново), мы можем
	сформировать его заранее и затем уже использовать в нужных нам условиях запроса. </p>
<p>Выполнить эту задачу нам помогут временные таблицы. </p>
<p><em>Временные таблицы</em> – это программные объекты, которые разработчик может создать и заполнить данными, а
	запросы могут использовать данные временных таблиц для своих нужд. Например, для наложения некоторого сложного
	условия, как в нашем случае.</p>
<p>Таким образом, схема нашего запроса приобретает следующий вид (рис. 14.12).</p>
<p><img src="44.jpeg"/></p>
<p><strong>Рис. 14.12.</strong> Схема запроса</p>
<p>Итак, приступим.</p>
<p><strong>В режиме «Конфигуратор»</strong></p>
<p>Первое, что мы сделаем, – удалим реквизит табличной части Стоимость документа ОказаниеУслуги, который нам больше не
	понадобится.</p>
<p>Для этого откроем в конфигураторе окно редактирования объекта конфигурации Документ ОказаниеУслуги, перейдем на
	закладку Данные, раскроем список реквизитов табличной части документа, выделим реквизит Стоимость и нажмем кнопку
	Удалить в командной панели (рис. 14.13).</p>
<p>Также следует удалить соответствующее поле из таблицы Пере- ченьНоменклатуры, расположенной в форме. </p>
<p>Для этого откроем форму ФормаДокумента документа ОказаниеУслуги и в окне структуры элементов формы выделим поле
	таблицы ПереченьНоменклатурыСтоимость и нажмем кнопку Удалить в командной панели (рис. 14.14).</p>
<p><strong>Рис. 14.14.</strong> Удаление поля табличной части</p>
<p>Теперь займемся запросом. </p>
<p>Временную таблицу мы сформируем с помощью того запроса, который у нас уже написан. </p>
<p>Откроем модуль документа ОказаниеУслуги.</p>
<p>В процедуре ОбработкаПроведения() перед созданием запроса создадим менеджер временных таблиц и укажем, что этот
	запрос будет использовать созданный менеджер временных таблиц (листинг 14.17).</p>
<p><strong>листинг 14.17.</strong> Использование менеджера временных таблиц</p>
<table>
	<tr>
		<td><p>Движения.ОстаткиМатериалов.Записывать = Истина;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движения.СтоимостьМатериалов.Записывать = Истина;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движения.Продажи.Записывать = Истина;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>// Создать менеджер временных таблиц</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>МенеджерВТ = Новый МенеджерВременныхТаблиц;</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Запрос = Новый Запрос;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>// Укажем, какой менеджер временных таблиц использует этот запрос</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>Запрос.МенеджерВременныхТаблиц = МенеджерВТ;</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Запрос.Текст = </p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p> &quot;ВЫБРАТЬ</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p> | ОказаниеУслугиПереченьНоменклатуры.Номенклатура,</p></td>
	</tr>
</table>
<p>Теперь изменим запрос таким образом, чтобы он создавал временную таблицу, которая будет храниться в нашем менеджере
	временных таблиц МенеджерВТ.</p>
<p>Чтобы конструктор запроса смог открыть наш запрос, удалим из него строку (поля Стоимость у нас больше нет), листинг
	14.18.</p>
<p><strong>листинг 14.18.</strong> Изменение запроса</p>
<table>
	<tr>
		<td><p>| </p></td>
		<td><p>МАКСИМУМ(ОказаниеУслугиПереченьНоменклатуры.Стоимость) КАК Стоимость</p></td>
	</tr>
</table>
<p>Также удалим запятую в конце предыдущей строки (листинг 14.19). <strong>листинг 14.19.</strong> Изменение запроса</p>
<table>
	<tr>
		<td><p>| </p></td>
		<td><p>СУММА(ОказаниеУслугиПереченьНоменклатуры.Сумма) КАК СуммаВДокументе</p></td>
	</tr>
</table>
<p>Теперь установим курсор внутрь текста запроса, например на слове ВЫБРАТЬ, и выполним команду контекстного меню
	Конструктор запроса. Существующий текст запроса будет показан в форме конструктора запросов (рис. 14.15).</p>
<p>Чтобы результат запроса поместить во временную таблицу, перейдем на закладку Дополнительно и отметим пункт Создание
	временной таблицы. </p>
<p> Зададим имя временной таблицы – НоменклатураДокумента </p>
<p>(рис. 14.16).</p>
<p><strong>Рис. 14.16.</strong> Создание временной таблицы</p>
<p>Нажмем ОК и посмотрим, какой текст сформировал конструктор запроса (листинг 14.20). <strong>листинг 14.20.</strong>
	Текст запроса</p>
<table>
	<tr>
		<td><p>&quot;ВЫБРАТЬ</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>| ОказаниеУслугиПереченьНоменклатуры.Номенклатура,</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>| ОказаниеУслугиПереченьНоменклатуры.Номенклатура.ВидНоменклатуры </p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>| КАК ВидНоменклатуры,</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>| СУММА(ОказаниеУслугиПереченьНоменклатуры.Количество) КАК КоличествоВДокументе,</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>| СУММА(ОказаниеУслугиПереченьНоменклатуры.Сумма) КАК СуммаВДокументе</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>|ПОМЕСТИТЬ НоменклатураДокумента</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>|ИЗ</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>| Документ.ОказаниеУслуги.ПереченьНоменклатуры КАК ОказаниеУслугиПереченьНоменклатуры</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>|ГДЕ</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>| ОказаниеУслугиПереченьНоменклатуры.Ссылка = &amp;Ссылка</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>|СГРУППИРОВАТЬ ПО</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>| ОказаниеУслугиПереченьНоменклатуры.Номенклатура,</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>| ОказаниеУслугиПереченьНоменклатуры.Номенклатура.ВидНоменклатуры&quot;;</p></td>
	</tr>
</table>
<p>Новым здесь является только строка (листинг 14.21).</p>
<p><strong>листинг 14.21.</strong> Создание временной таблицы</p>
<p>|ПОМЕСТИТЬ НоменклатураДокумента</p>
<p>Это означает, что результат запроса будет сохранен во временной таблице НоменклатураДокумента. </p>
<p>Теперь если мы для другого запроса укажем этот же самый менеджер временных таблиц МенеджерВТ, то в этом другом
	запросе мы сможем обратиться к данным этой временной таблицы.</p>
<p>Таким образом, мы выполнили первую часть нашего плана – создали запрос, помещающий данные табличной части документа
	во временную таблицу (рис. 14.17).</p>
<p><img src="45.jpeg"/></p>
<p><strong>Рис. 14.17.</strong> Создание первого запроса</p>
<p>Теперь займемся конструированием второго запроса. </p>
<p>Установим курсор на следующую строку после оператора РезультатЗапроса = Запрос.Выполнить(); (именно здесь выполняется
	создание временной таблицы) и напишем заготовку будущего запроса (листинг 14.22).</p>
<p><strong>листинг 14.22.</strong> Создание второго запроса</p>
<p>Запрос2 = Новый Запрос;</p>
<table>
	<tr>
		<td><p>Запрос2.МенеджерВременныхТаблиц = МенеджерВТ;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Запрос2.Текст = &quot;&quot;;</p></td>
	</tr>
</table>
<p>Мы создали новый объект Запрос и назначили ему тот же самый менеджер временных таблиц, чтобы иметь возможность
	обращаться к созданной нами ранее временной таблице.</p>
<p>Теперь установим курсор внутрь кавычек и выполним команду контекстного меню Конструктор запроса. Согласимся на
	создание нового запроса.</p>
<p>Поскольку мы собираемся выбирать данные из нашей временной таблицы, создадим в запросе описание этой временной
	таблицы. Для этого над списком Таблицы нажмем кнопку Создать описание </p>
<p><strong>Рис. 14.18.</strong> Создание описания временной таблицы</p>
<p>В открывшемся окне введем имя нашей временной таблицы НоменклатураДокумента и добавим описание полей:</p>
<ul>
	<li>Номенклатура, тип СправочникСсылка.Номенклатура;</li>
	<li>ВидНоменклатуры, тип ПеречислениеСсылка.ВидыНоменклатуры;</li>
	<li>КоличествоВДокументе, тип Число, 15, 3;  СуммаВДокументе, тип Число, 15, 2.</li>
</ul>
<p>Нажмем ОК. </p>
<p>В результате у нас получится следующее описание временной таблицы (рис. 14.19).</p>
<p>Нажмем ОК. Выберем из этой таблицы все поля (рис. 14.20) и нажмем кнопку Запрос в левом нижнем углу окна конструктора
	запроса.</p>
<p>Текст запроса будет иметь вид (листинг 14.23).</p>
<p><strong>листинг 14.23.</strong> Текст второго запроса</p>
<table>
	<tr>
		<td><p>ВЫБРАТЬ</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>НоменклатураДокумента.Номенклатура,</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>НоменклатураДокумента.ВидНоменклатуры,</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>НоменклатураДокумента.КоличествоВДокументе,</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>НоменклатураДокумента.СуммаВДокументе</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ИЗ</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>НоменклатураДокумента КАК НоменклатураДокумента</p></td>
	</tr>
</table>
<p>Итак, мы создали первую часть второго запроса – выбрали информацию из временной таблицы (рис. 14.21).</p>
<p><img src="46.jpeg"/></p>
<p><strong>Рис. 14.21.</strong> Создание второго запроса</p>
<p>Теперь будем соединять эту конструкцию левыми соединениями с таблицами остатков.</p>
<p>Начнем со стоимости материалов. </p>
<p>Добавим в список таблиц запроса виртуальную таблицу РегистрНакопления.СтоимостьМатериалов.Остатки. Из нее выберем
	поле СтоимостьОстаток. Перейдем на закладку Связи и зададим связь между таблицами. </p>
<p>Из временной таблицы будем выбирать все записи, и поле Номенклатура временной таблицы должно быть равно полю Материал
	таблицы остатков (рис. 14.22).</p>
<p><strong>Рис. 14.22.</strong> Связи между таблицами</p>
<p>Нужно не забыть ограничить виртуальную таблицу только той номенклатурой, которая есть в нашей временной таблице.</p>
<p>Поэтому вернемся на закладку Таблицы и поля, выделим в списке таблиц таблицу СтоимостьМатериаловОстатки и нажмем
	кнопку Параметры виртуальной таблицы, расположенную над списком таблиц. </p>
<p>Зададим параметр Условие следующим образом (листинг 14.24).</p>
<p><strong>листинг 14.24.</strong> Условие виртуальной таблицы</p>
<p>Материал В (ВЫБРАТЬ НоменклатураДокумента.Номенклатура ИЗ НоменклатураДокумента)</p>
<p>То есть материал должен быть среди номенклатуры, выбранной из временной таблицы.</p>
<p><strong>УзнАй больше!</strong></p>
<p><em>Следует внимательно подходить к использованию виртуальных таблиц запросов. В частности, необходимо уделять особое
	внимание максимально возможному использованию параметров этих таблиц. </em></p>
<p><em>Например, в нашем случае можно было бы и не использовать параметр </em>Условие<em>, а ограничить выбранные поля
	уже в самом запросе, указав в условии </em>ПО<em> равенство номенклатуры из документа и материала из таблицы
	остатков. Формально мы получили бы тот же самый результат, однако по производительности этот способ сильно отличался
	бы от того, который мы используем. </em></p>
<p><em>В самом деле в нашем варианте виртуальная таблица предоставит нам ровно столько записей, сколько различных
	элементов номенклатуры содержится в проводимом документе. Если же не указывать условие, виртуальная таблица
	предоставит нам записи по абсолютно всем элементам номенклатуры, информация о которых есть в регистре накопления. И
	уже в самом нашем запросе мы будем отбирать из этой огромной массы записей лишь несколько, которые нам действительно
	нужны.</em></p>
<p><em>Очевидно, что второй вариант будет работать дольше, и время выполнения такого запроса будет зависеть в основном
	не от количества данных, содержащихся в документе (т. е. реального количества обрабатываемой информации), а от
	размера регистра накопления.</em></p>
<p><em>Кроме того что подобный вариант снижает производительность конфигурации, могут возникать ситуации, когда
	результаты, полученные одним и другим способом, будут различны. Такое, например, вполне возможно при использовании
	виртуальной таблицы регистра сведений </em>СрезПоследних<em>. Подробнее можно прочитать об этом на диске ИТС
	(информационно-технологического сопровождения) в статье «Использование отборов в запросах с виртуальными
	таблицами».</em></p>
<p>Нажмем кнопку Запрос и посмотрим, какой текст запроса сформировал конструктор (листинг 14.25).</p>
<p><strong>листинг 14.25.</strong> Текст запроса</p>
<table>
	<tr>
		<td><p>ВЫБРАТЬ</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>НоменклатураДокумента.Номенклатура,</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>НоменклатураДокумента.ВидНоменклатуры,</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>НоменклатураДокумента.КоличествоВДокументе,</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>НоменклатураДокумента.СуммаВДокументе,</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>СтоимостьМатериаловОстатки.СтоимостьОстаток</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ИЗ</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>НоменклатураДокумента КАК НоменклатураДокумента</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.СтоимостьМатериалов.Остатки( , Материал В</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>(ВЫБРАТЬ</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>НоменклатураДокумента.Номенклатура</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>ИЗ</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>НоменклатураДокумента)) КАК СтоимостьМатериаловОстатки</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>ПО НоменклатураДокумента.Номенклатура = СтоимостьМатериаловОстатки.Материал</strong></p></td>
	</tr>
</table>
<p>Тем самым мы добавили к выбранным ранее полям стоимость номенклатуры (рис. 14.23).</p>
<p><img src="47.jpeg"/></p>
<p><strong>Рис. 14.23.</strong> Создание второго запроса</p>
<p>Теперь добавим виртуальную таблицу остатков регистра ОстаткиМатериалов.Остатки, из которой выберем поле
	КоличествоОстаток.</p>
<p>Перейдем на закладку Связи и зададим связь между таблицами. </p>
<p>Из временной таблицы будем выбирать все записи, и поле Номенклатура временной таблицы должно быть равно полю Материал
	таблицы остатков (рис. 14.24).</p>
<p>Также зададим параметры виртуальной таблицы ОстаткиМатериа- ловОстатки. </p>
<p>В параметр Условие внесем следующий текст (листинг 14.26).</p>
<p><strong>листинг 14.26.</strong> Условие виртуальной таблицы</p>
<p>Материал В (ВЫБРАТЬ НоменклатураДокумента.Номенклатура ИЗ НоменклатураДокумента)</p>
<p>В результате мы получим следующий текст запроса (листинг 14.27). <strong>листинг 14.27.</strong> Текст запроса</p>
<table>
	<tr>
		<td><p>ВЫБРАТЬ</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>НоменклатураДокумента.Номенклатура,</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>НоменклатураДокумента.ВидНоменклатуры,</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>НоменклатураДокумента.КоличествоВДокументе,</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>НоменклатураДокумента.СуммаВДокументе,</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>СтоимостьМатериаловОстатки.СтоимостьОстаток,</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ОстаткиМатериаловОстатки.КоличествоОстаток</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ИЗ</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>НоменклатураДокумента КАК НоменклатураДокумента</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.СтоимостьМатериалов.Остатки( , Материал В (</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ВЫБРАТЬ</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>НоменклатураДокумента.Номенклатура</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ИЗ</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>НоменклатураДокумента)) КАК СтоимостьМатериаловОстатки</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ПО НоменклатураДокумента.Номенклатура = СтоимостьМатериаловОстатки.Материал</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.ОстаткиМатериалов.Остатки( , Материал В (</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>ВЫБРАТЬ</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>НоменклатураДокумента.Номенклатура</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>ИЗ</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>НоменклатураДокумента)) КАК ОстаткиМатериаловОстатки</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>ПО НоменклатураДокумента.Номенклатура = ОстаткиМатериаловОстатки.Материал</strong></p></td>
	</tr>
</table>
<p>Тем самым мы добавили к выбранным ранее полям остатки номенклатуры на всех складах (рис. 14.25).</p>
<p><img src="48.jpeg"/></p>
<p><strong>Рис. 14.25.</strong> Создание второго запроса</p>
<p>В заключение перейдем на закладку Объединения/Псевдонимы и зададим следующие псевдонимы полей (рис. 14.26):</p>
<p> СтоимостьОстаток – Стоимость;</p>
<p><strong>Рис. 14.26.</strong> Псевдонимы полей</p>
<p>В результате мы получим следующий текст запроса (листинг 14.28).</p>
<p><strong>листинг 14.28.</strong> Текст запроса</p>
<p>ВЫБРАТЬ</p>
<table>
	<tr>
		<td><p>НоменклатураДокумента.Номенклатура,</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>НоменклатураДокумента.ВидНоменклатуры,</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>НоменклатураДокумента.КоличествоВДокументе,</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>НоменклатураДокумента.СуммаВДокументе,</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>СтоимостьМатериаловОстатки.СтоимостьОстаток <strong>КАК Стоимость,</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ОстаткиМатериаловОстатки.КоличествоОстаток <strong>КАК Количество</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ИЗ</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>НоменклатураДокумента КАК НоменклатураДокумента</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.СтоимостьМатериалов.Остатки( , Материал В (</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ВЫБРАТЬ</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>НоменклатураДокумента.Номенклатура</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ИЗ</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>НоменклатураДокумента)) КАК СтоимостьМатериаловОстатки</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ПО НоменклатураДокумента.Номенклатура = СтоимостьМатериаловОстатки.Материал</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.ОстаткиМатериалов.Остатки( , Материал В (</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ВЫБРАТЬ</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>НоменклатураДокумента.Номенклатура</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ИЗ</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>НоменклатураДокумента)) КАК ОстаткиМатериаловОстатки</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ПО НоменклатураДокумента.Номенклатура = ОстаткиМатериаловОстатки.Материал</p></td>
	</tr>
</table>
<p>В качестве последнего штриха нашей работы с запросом нужно предусмотреть тот случай, когда номенклатура в справочнике
	есть, но у нее нет ни остатков, ни стоимости. Это может быть, например, в том случае, когда номенклатуру создали в
	справочнике, но она еще не поступала в нашу фирму. </p>
<p>В такой ситуации левые соединения с виртуальными таблицами не вернут ничего. На языке запросов это значит, что в
	полях Стоимость и Количество будут значения NULL. </p>
<p>Чтобы в дальнейшем нам было удобно работать с результатом нашего запроса, сразу же в самом запросе избавимся от этих
	значений. </p>
<p>Для этого мы применим функцию ЕСТЬNULL() к полям Стоимость и Количество. Если значение этого поля будет NULL, функция
	вернет 0. В остальных случаях функция вернет само значение этого поля.</p>
<p>Перейдем на закладку Таблицы и поля, выделим поле СтоимостьМатериаловОстатки.СтоимостьОстаток и нажмем кнопку
	Изменить текущий элемент (рис. 14.27).</p>
<p>В открывшемся окне отредактируем значение поля следующим образом (листинг 14.29), рис. 14.28.</p>
<p><strong>Рис. 14.27.</strong> Изменение значения поля в запросе</p>
<p><strong>листинг 14.29.</strong> Выражение для расчета поля в запросе</p>
<p>ЕСТЬNULL(СтоимостьМатериаловОстатки.СтоимостьОстаток, 0)</p>
<p><strong>Рис. 14.28.</strong> Изменение значения поля в запросе</p>
<p>Аналогично поступим и с другим полем: ОстаткиМатериаловОстат- ки.КоличествоОстаток.</p>
<p>Нажмем ОК – текст запроса будет вставлен в модуль (листинг 14.30). <strong>листинг 14.30.</strong> Текст запроса</p>
<table>
	<tr>
		<td><p>Запрос2.Текст = &quot;ВЫБРАТЬ</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p> | НоменклатураДокумента.Номенклатура,</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p> | НоменклатураДокумента.ВидНоменклатуры,</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p> | НоменклатураДокумента.КоличествоВДокументе,</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p> | НоменклатураДокумента.СуммаВДокументе,</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p> | <strong>ЕСТЬNULL(СтоимостьМатериаловОстатки.СтоимостьОстаток, 0)</strong> КАК Стоимость,</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p> | <strong>ЕСТЬNULL(ОстаткиМатериаловОстатки.КоличествоОстаток, 0)</strong> КАК Количество</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>|ИЗ</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p> | НоменклатураДокумента КАК НоменклатураДокумента</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p> | ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.СтоимостьМатериалов.Остатки( , Материал В (</p></td>
	</tr>
</table>
<p> | ВЫБРАТЬ</p>
<p> | НоменклатураДокумента.Номенклатура</p>
<table>
	<tr>
		<td><p>| </p></td>
		<td><p>ИЗ</p></td>
	</tr>
	<tr>
		<td></td>
		<td></td>
	</tr>
	<tr>
		<td><p>| </p></td>
		<td><p>НоменклатураДокумента)) КАК СтоимостьМатериаловОстатки</p></td>
	</tr>
	<tr>
		<td></td>
		<td></td>
	</tr>
	<tr>
		<td><p>| </p></td>
		<td><p>ПО НоменклатураДокумента.Номенклатура = СтоимостьМатериаловОстатки.Материал</p></td>
	</tr>
	<tr>
		<td></td>
		<td></td>
	</tr>
	<tr>
		<td><p>| </p></td>
		<td><p>ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.ОстаткиМатериалов.Остатки( , Материал В (</p></td>
	</tr>
	<tr>
		<td></td>
		<td></td>
	</tr>
	<tr>
		<td><p>| </p></td>
		<td><p>ВЫБРАТЬ</p></td>
	</tr>
	<tr>
		<td></td>
		<td></td>
	</tr>
	<tr>
		<td><p>| </p></td>
		<td><p>НоменклатураДокумента.Номенклатура</p></td>
	</tr>
	<tr>
		<td></td>
		<td></td>
	</tr>
	<tr>
		<td><p>| </p></td>
		<td><p>ИЗ</p></td>
	</tr>
	<tr>
		<td></td>
		<td></td>
	</tr>
	<tr>
		<td><p>| </p></td>
		<td><p>НоменклатураДокумента)) КАК ОстаткиМатериаловОстатки</p></td>
	</tr>
	<tr>
		<td></td>
		<td></td>
	</tr>
	<tr>
		<td><p>| </p></td>
		<td><p>ПО НоменклатураДокумента.Номенклатура = ОстаткиМатериаловОстатки.Материал&quot;;</p></td>
	</tr>
</table>
<p>Нам останется всего лишь дописать после него оператор выполнения запроса (листинг 14.31).</p>
<p><strong>листинг 14.31.</strong> Фрагмент процедуры «ОбработкаПроведения()»</p>
<table>
	<tr>
		<td><p>…</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Запрос2 = Новый Запрос;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Запрос2.МенеджерВременныхТаблиц = МенеджерВТ;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Запрос2.Текст = &quot;ВЫБРАТЬ</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p> | НоменклатураДокумента.Номенклатура,</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>…</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p> | ПО НоменклатураДокумента.Номенклатура = СтоимостьМатериаловОстатки.Материал&quot;;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>РезультатЗапроса = Запрос2.Выполнить(); </strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ВыборкаДетальныеЗаписи = РезультатЗапроса.Выбрать();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>…</p></td>
	</tr>
</table>
<p>Теперь разберемся с записью движений. </p>
<p>Все операторы, которые были написаны нами ранее, будут работать без изменений. </p>
<p>Единственное, что потребуется изменить, – это способ получения стоимости. Раньше мы просто брали ее из документа,
	теперь же нам нужно ее рассчитать на основании тех данных, которые мы получили запросом.</p>
<p>Стоимость материала равна частному от деления всей стоимости, полученной запросом (Стоимость), на общее количество
	материала на всех складах (Количество).</p>
<p>Но, как мы уже сказали, возможна ситуация, когда поле Количество у нас будет равно 0, а на 0 делить нельзя. Поэтому
	сразу после начала цикла обхода результата запроса рассчитаем стоимость для текущей номенклатуры (листинг
	14.32).</p>
<p><strong>листинг 14.32.</strong> Фрагмент процедуры «ОбработкаПроведения()»</p>
<table>
	<tr>
		<td><p>Пока ВыборкаДетальныеЗаписи.Следующий() Цикл</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>Если ВыборкаДетальныеЗаписи.Количество = 0 Тогда</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>СтоимостьМатериала = 0;</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>Иначе</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>СтоимостьМатериала = </strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>ВыборкаДетальныеЗаписи.Стоимость / ВыборкаДетальныеЗаписи.Количество;</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>КонецЕсли;</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Если ВыборкаДетальныеЗаписи.ВидНоменклатуры = </p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Перечисления.ВидыНоменклатуры.Материал Тогда </p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>…</p></td>
	</tr>
</table>
<p>Теперь заменим расчет стоимости в движениях регистров Стои- мостьМатериалов и Продажи (листинг 14.33). <strong>листинг
	14.33.</strong> Фрагмент процедуры «ОбработкаПроведения()»</p>
<table>
	<tr>
		<td><p>Пока ВыборкаДетальныеЗаписи.Следующий() Цикл</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Если ВыборкаДетальныеЗаписи.Количество = 0 Тогда</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>СтоимостьМатериала = 0;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Иначе</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>СтоимостьМатериала = </p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ВыборкаДетальныеЗаписи.Стоимость / ВыборкаДетальныеЗаписи.Количество;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецЕсли;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Если ВыборкаДетальныеЗаписи.ВидНоменклатуры = </p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Перечисления.ВидыНоменклатуры.Материал Тогда </p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// Регистр ОстаткиМатериалов Расход</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение = Движения.ОстаткиМатериалов.Добавить();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.ВидДвижения = ВидДвиженияНакопления.Расход;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.Период = Дата;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.Материал = ВыборкаДетальныеЗаписи.Номенклатура;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.Склад = Склад;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.Количество = ВыборкаДетальныеЗаписи.Количество;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// Регистр СтоимостьМатериалов Расход</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение = Движения.СтоимостьМатериалов.Добавить();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.ВидДвижения = ВидДвиженияНакопления.Расход;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.Период = Дата;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.Материал = ВыборкаДетальныеЗаписи.Номенклатура;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.Стоимость = ВыборкаДетальныеЗаписи.КоличествоВДокументе * </p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>СтоимостьМатериала</strong>;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецЕсли;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// Регистр Продажи </p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение = Движения.Продажи.Добавить();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.Период = Дата;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.Номенклатура = ВыборкаДетальныеЗаписи.Номенклатура;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.Клиент = Клиент;</p></td>
	</tr>
</table>
<p>Движение.Мастер = Мастер;</p>
<p>Движение.Количество = ВыборкаДетальныеЗаписи.КоличествоВДокументе; Движение.Выручка =
	ВыборкаДетальныеЗаписи.СуммаВДокументе;</p>
<table>
	<tr>
		<td><p>Движение.Стоимость = <strong>СтоимостьМатериала</strong> * </p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ВыборкаДетальныеЗаписи.КоличествоВДокументе;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецЦикла;</p></td>
	</tr>
</table>
<p>Теперь все вроде бы хорошо, но остался один важный момент.</p>
<p>Если проводить этот документ в первый раз, то результат получится правильный. </p>
<p>Однако если документ был проведен ранее и мы заново решим провести его, мы получим неправильный результат.</p>
<p>Дело в том, что когда мы находимся в обработчике проведения документа и этот документ был уже проведен ранее, то в
	базе данных существуют движения этого документа.</p>
<p>Таким образом, читая из базы данных стоимость и остатки материалов, мы прочитаем их с учетом тех движений, которые
	документ выполнил ранее. А это неправильно.</p>
<p>Чтобы в обработчике проведения документа прочитать данные базы данных без учета предыдущих движений, которые мог
	выполнять документ, нужно перед чтением записать пустые наборы записей в те регистры, из которых мы собираемся
	читать.</p>
<p>В нашем случае такими регистрами являются регистры накопления СтоимостьМатериалов и ОстаткиМатериалов.</p>
<p>Поэтому перед выполнением второго запроса добавим следующие две строки: <strong>листинг 14.33а.</strong> Фрагмент
	процедуры «ОбработкаПроведения()»</p>
<table>
	<tr>
		<td><p>…</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>| ПО НоменклатураДокумента.Номенклатура = СтоимостьМатериаловОстатки.Материал&quot;;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>// Запишем пустые наборы записей, чтобы читать остатки без учета данных в документе</strong></p>
		</td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>Движения.СтоимостьМатериалов.Записать();</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>Движения.ОстаткиМатериалов.Записать();</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>РезультатЗапроса = Запрос2.Выполнить();</p></td>
	</tr>
</table>
<p><strong>В режиме «1С:Предприятие»</strong></p>
<p>Теперь нужно запустить «1С:Предприятие» в режиме отладки, перепровести все документы Оказание услуги и проверить, что
	данные правильно заносятся в регистры.</p>
<h1><a id="_Toc454870667"></a>Лабораторная работа № 22 Защита отчетов</h1>
<p><strong>Порядок выполнения работы </strong></p>
<p>1. Ознакомьтесь с теоретическими основами в настоящих указаниях и конспектах лекций. </p>
<p>2. Получите задание у преподавателя. </p>
<p>3. Сделайте скриншоты (кнопка клавиатуры PrtSc) выполненных заданий в текстовом (Word) файле <em>Фамилия_ЛР</em></p>
<p>4. Составьте отчет по лабораторной работе. </p>
<p>5. Отчитайте работу преподавателю.</p>
<p><strong>Контроль остатков</strong></p>
<p>Общая методика контроля остатков при проведении документа заключается в следующем: сначала, не глядя ни на что, нужно
	записать движения документа, а затем, когда движения уже записаны, прочитать из базы данных остатки. </p>
<p>Если появились отрицательные остатки, значит, такой документ проводить нельзя. Нужно сообщить пользователю, каких
	материалов не хватает, и отменить проведение документа. </p>
<p>Если же отрицательных остатков не появилось, тогда можно смело проводить документ.</p>
<p>Полдела у нас уже сделано: мы формируем движения документа и записываем их. Единственное, что нам осталось, – в
	случае оперативного проведения проконтролировать, что получилось, и, если появились отрицательные остатки, отменить
	проведение документа.</p>
<p><strong>В режиме «Конфигуратор»</strong></p>
<p>Сделаем заготовку. После цикла обхода результата запроса и перед концом процедуры напишем следующие строки (листинг
	14.35).</p>
<p><strong>листинг 14.35.</strong> Фрагмент процедуры «ОбработкаПроведения()»</p>
<table>
	<tr>
		<td><p>…</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецЦикла;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>Движения.Записать();</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>Если Режим = РежимПроведенияДокумента.Оперативный Тогда</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>// Проверить отрицательные остатки</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>КонецЕсли;</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецПроцедуры</p></td>
	</tr>
</table>
<p>Сначала мы записываем движения в регистры. </p>
<p>Затем определяем режим проведения документа. При выполнении процедуры ОбработкаПроведения() вторым параметром (Режим)
	в нее передается режим проведения документа, и значение этой переменной сравнивается со значением системного
	перечисления РежимПроведенияДокумента. В случае оперативного проведения мы будем выполнять контроль остатков.</p>
<p>Теперь сделаем заготовку запроса для проверки отрицательных остатков. </p>
<p>Так как нам придется снова получать остатки только для той номенклатуры, которая в документе, укажем, что этот запрос
	будет использовать тот же самый менеджер временных таблиц МенеджерВТ (листинг 14.36).</p>
<p><strong>листинг 14.36.</strong> Фрагмент процедуры «ОбработкаПроведения()»</p>
<table>
	<tr>
		<td><p>Если Режим = РежимПроведенияДокумента.Оперативный Тогда</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// Проверить отрицательные остатки</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>Запрос3 = Новый Запрос;</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>Запрос3.МенеджерВременныхТаблиц = МенеджерВТ;</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>Запрос3.Текст = &quot;&quot;;</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецЕсли;</p></td>
	</tr>
</table>
<p>Установим курсор внутрь кавычек и вызовем конструктор запроса. Подтвердим создание нового запроса.</p>
<p>Выберем таблицу ОстаткиМатериалов.Остатки и из нее два поля: Материал и КоличествоОстаток. </p>
<p>Зададим параметры этой таблицы. В параметре Условие напишем: <strong>листинг 14.37.</strong> Условие виртуальной
	таблицы</p>
<table>
	<tr>
		<td><p>Материал В (</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ВЫБРАТЬ</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>НоменклатураДокумента.Номенклатура</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ИЗ</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>НоменклатураДокумента)</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>И Склад = &amp;Склад</p></td>
	</tr>
</table>
<p>То есть мы получаем итоги только для той номенклатуры, которая содержится в нашей временной таблице, и только по
	складу, который указан в документе.</p>
<p>Затем на закладке Условия перенесем в список условий поле Коли- чествоОстаток, установим флажок Произвольное и
	укажем, что нас интересуют только отрицательные остатки (листинг 14.38).</p>
<p><strong>листинг 14.38.</strong> Условие запроса</p>
<p>ОстаткиМатериаловОстатки.КоличествоОстаток &lt; 0</p>
<p>Нажмем ОК. Текст запроса будет выглядеть следующим образом (листинг 14.39).</p>
<p><strong>листинг 14.39.</strong> Текст запроса</p>
<p>// Проверить отрицательные остатки</p>
<table>
	<tr>
		<td><p>Запрос3 = Новый Запрос;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Запрос3.МенеджерВременныхТаблиц = МенеджерВТ;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Запрос3.Текст = &quot;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>|ВЫБРАТЬ</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p> | ОстаткиМатериаловОстатки.Материал,</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p> | ОстаткиМатериаловОстатки.КоличествоОстаток</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>|ИЗ</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p> | РегистрНакопления.ОстаткиМатериалов.Остатки( , Материал В (</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p> | ВЫБРАТЬ</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p> | НоменклатураДокумента.Номенклатура</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p> | ИЗ</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p> | НоменклатураДокумента)</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p> | И Склад = &amp;Склад) КАК ОстаткиМатериаловОстатки</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>|ГДЕ</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p> | ОстаткиМатериаловОстатки.КоличествоОстаток &lt; 0&quot;;</p></td>
	</tr>
</table>
<p>Теперь осталось только установить параметр запроса, обойти результат запроса и вывести сообщения об отрицательных
	остатках (листинг 14.40).</p>
<p><strong>листинг 14.40.</strong> Фрагмент процедуры «ОбработкаПроведения()»</p>
<table>
	<tr>
		<td><p>// Проверить отрицательные остатки</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Запрос3 = Новый Запрос;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Запрос3.МенеджерВременныхТаблиц = МенеджерВТ;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Запрос3.Текст = &quot;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>|ВЫБРАТЬ</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p> | ОстаткиМатериаловОстатки.Материал,</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>…</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>|ГДЕ</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p> | ОстаткиМатериаловОстатки.КоличествоОстаток &lt; 0&quot;;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>Запрос3.УстановитьПараметр(</strong>&quot;<strong>Склад</strong>&quot;<strong>, Склад);</strong>
		</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>РезультатЗапроса = Запрос3.Выполнить();</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>ВыборкаДетальныеЗаписи = РезультатЗапроса.Выбрать();</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>Пока ВыборкаДетальныеЗаписи.Следующий() Цикл</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>Сообщение = Новый СообщениеПользователю();</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>Сообщение.Текст = </strong>&quot;<strong>Не хватает </strong>&quot;<strong> + Строка(-
			ВыборкаДетальныеЗаписи.КоличествоОстаток) + </strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong> </strong>&quot;<strong> единиц материала </strong>&quot;&quot;&quot;<strong> +
			ВыборкаДетальныеЗаписи.Материал + </strong>&quot;&quot;&quot;&quot;<strong>;</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>Сообщение.Сообщить();</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>Отказ = Истина;</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>КонецЦикла;</strong></p></td>
	</tr>
</table>
<p>Кратко поясним добавленный текст. </p>
<p>При выполнении проверки в запрос в параметре Склад передается склад, указанный в документе. </p>
<p>Затем выполняется запрос для получения отрицательных остатков номенклатуры, содержащейся во временной таблице и на
	складе, указанном в параметре Склад. </p>
<p>После этого выборка записей запроса обходится в цикле, и, если есть такие записи, они выводятся в сообщениях
	пользователю. </p>
<p>При этом параметру Отказ процедуры проведения документа присваивается значение Истина, то есть документ не
	проводится, начатая транзакция отменяется, и состояние данных, измененных в процессе проведения, возвращается в
	исходное, до начала проведения документа.</p>
<p><strong>Блокировка данных, которые читаются и изменяются при проведении</strong></p>
<p>Казалось бы, это все? Но нет, есть очень важный момент, о котором мы не позаботились.</p>
<p>Сейчас схема нашей процедуры такова:</p>
<ol>
	<li>Выполняем первый запрос с именем Запрос. В результате мы формируем временную таблицу из перечня номенклатуры
		документа.
	</li>
	<li>Выполняем второй запрос с именем Запрос2. В результате мы читаем стоимость и остатки для номенклатуры,
		содержащейся в табличной части документа.
	</li>
	<li>Записываем движения регистров (Движения.Записать()).</li>
	<li>Выполняем третий запрос с именем Запрос3. Тем самым мы проверяем наличие отрицательных остатков.</li>
</ol>
<p>Обратите внимание, что, начиная с выполнения второго запроса и до конца процедуры, нам необходимо обеспечить
	неизменность стоимости и остатков номенклатуры, с которой мы работаем, и запретить другим транзакциям даже читать
	эти данные. Сама система, естественно, заблокирует изменение этих данных, но лишь начиная с того момента, когда мы
	запишем движения.</p>
<p>Однако может возникнуть следующая ситуация. Выполняя второй запрос, мы прочитали, что есть 2 шт. некоторого
	материала. И другая транзакция (другой пользователь), которая собирается списывать материалы, тоже прочитала, что
	есть 2 шт. этого материала. После этого мы записали движения, и система заблокировала эти данные. </p>
<p>Другая транзакция ждет, когда мы освободим данные. Мы провели документ, списали 2 шт. материала и освободили данные.
	Другая транзакция пытается тоже списать 2 шт. материала, но его уже нет!</p>
<p>Аналогичная ситуация может возникнуть и между п. 3 и п. 4, в результате чего контроль остатков будет работать
	неверно. </p>
<p>Поэтому, чтобы не происходило таких коллизий, нам необходимо заблокировать остатки от чтения другими транзакциями еще
	до выполнения второго запроса. То есть прежде чем читать что-то, что мы собираемся изменять, нужно запретить чтение
	этих данных другими транзакциями до тех пор, пока мы не закончим свои изменения (или пока не откажемся от проведения
	документа).</p>
<p><strong>В режиме «Конфигуратор»</strong></p>
<p>Как это сделать? Хороший вопрос. Давайте посмотрим на свойство Режим управления блокировкой данных нашей
	конфигурации. Оно установлено в значение Управляемый (рис. 14.31).</p>
<p>в свойствах конфигурации</p>
<p>Это значит, что нам нужно использовать управляемые блокировки, которые устанавливаются средствами встроенного
	языка. </p>
<p>Необходимо заблокировать те данные, которые мы собираемся читать и впоследствии изменять. Для этого у наборов записей
	регистров есть свойство БлокироватьДляИзменения, которым мы и воспользуемся.</p>
<p> Вставим этот код перед записью пустых наборов записей </p>
<p>(листинг 14.41).</p>
<p><strong>листинг 14.41.</strong> Фрагмент процедуры «ОбработкаПроведения()»</p>
<table>
	<tr>
		<td><p>…</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>| ПО НоменклатураДокумента.Номенклатура = СтоимостьМатериаловОстатки.Материал&quot;;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>// Установим необходимость блокировки данных в регистрах СтоимостьМатериалов </strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>// и ОстаткиМатериалов</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>Движения.СтоимостьМатериалов.БлокироватьДляИзменения = Истина;</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>Движения.ОстаткиМатериалов.БлокироватьДляИзменения = Истина;</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// Запишем пустые наборы записей, чтобы читать остатки без учета данных в документе</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движения.СтоимостьМатериалов.Записать();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движения.ОстаткиМатериалов.Записать();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>РезультатЗапроса = Запрос2.Выполнить(); </p></td>
	</tr>
</table>
<p>Управляемая блокировка будет установлена в момент записи этих наборов записей, то есть как раз перед выполнением
	второго запроса. Что нам и требовалось.</p>
<p><strong>Выделение произвольных областей модуля</strong></p>
<p>Итак, мы закончили редактирование процедуры ОбработкаПроведения() в модуле документа ОказаниеУслуги. Хотя модуль
	содержит всего одну процедуру, эта процедура довольно объемная (особенно для неопытного разработчика), и ее нельзя
	«охватить одним взглядом». Это затрудняет процесс восприятия и понимания текста процедуры, поиск в ней ошибок и т.
	д.</p>
<p>Для удобства разработчика в редакторе модуля существует возможность выделять произвольные области текста,
	группировать и сворачивать их подобно тому, как сворачиваются инструкции циклов, условий, процедур и функций. Каждой
	области текста разработчик может дать собственное имя и таким образом выделить часть модуля, имеющую определенное
	назначение. </p>
<p>Например, в нашей процедуре можно выделить три логические части: в первой части формируется временная таблица,
	содержащая перечень номенклатуры документа; во второй части рассчитывается стоимость номенклатуры и формируются
	движения в регистрах накопления; и в третьей части производится контроль остатков номенклатуры при оперативном
	проведении документа. </p>
<p>Выделим эти три области в тексте процедуры, используя инструкции препроцессору #Область &lt;имя области&gt; и
	#КонецОбласти </p>
<p>(листинг 14.42). <strong>листинг 14.42.</strong> Процедура «ОбработкаПроведения()»</p>
<table>
	<tr>
		<td><p>Процедура ОбработкаПроведения(Отказ, Режим)</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движения.ОстаткиМатериалов.Записывать = Истина;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движения.СтоимостьМатериалов.Записывать = Истина;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движения.Продажи.Записывать = Истина;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// Создать менеджер временных таблиц</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>МенеджерВТ = Новый МенеджерВременныхТаблиц;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>#Область НоменклатураДокумента</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Запрос = Новый Запрос;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// Укажем, какой менеджер временных таблиц использует этот запрос</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Запрос.МенеджерВременныхТаблиц = МенеджерВТ;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Запрос.Текст = </p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>&quot;ВЫБРАТЬ</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p> | ОказаниеУслугиПереченьНоменклатуры.Номенклатура,</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p> | ОказаниеУслугиПереченьНоменклатуры.Номенклатура.ВидНоменклатуры </p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p> | КАК ВидНоменклатуры,</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p> | СУММА(ОказаниеУслугиПереченьНоменклатуры.Количество) </p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p> | КАК КоличествоВДокументе,</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p> | СУММА(ОказаниеУслугиПереченьНоменклатуры.Сумма) КАК СуммаВДокументе</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>|ПОМЕСТИТЬ НоменклатураДокумента</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>|ИЗ</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p> | Документ.ОказаниеУслуги.ПереченьНоменклатуры </p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p> | КАК ОказаниеУслугиПереченьНоменклатуры</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>|ГДЕ</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p> | ОказаниеУслугиПереченьНоменклатуры.Ссылка = &amp;Ссылка</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>|</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>|СГРУППИРОВАТЬ ПО</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p> | ОказаниеУслугиПереченьНоменклатуры.Номенклатура,</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p> | ОказаниеУслугиПереченьНоменклатуры.Номенклатура.ВидНоменклатуры&quot;;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Запрос.УстановитьПараметр(&quot;Ссылка&quot;, Ссылка);</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>РезультатЗапроса = Запрос.Выполнить();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>#КонецОбласти</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>#Область ДвиженияДокумента</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Запрос2 = Новый Запрос;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Запрос2.МенеджерВременныхТаблиц = МенеджерВТ;</p></td>
	</tr>
</table>
<p>Запрос2.Текст = &quot;ВЫБРАТЬ</p>
<p>| НоменклатураДокумента.Номенклатура,</p>
<table>
	<tr>
		<td><p>| НоменклатураДокумента.ВидНоменклатуры,</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>| НоменклатураДокумента.КоличествоВДокументе,</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>| НоменклатураДокумента.СуммаВДокументе,</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>| ЕСТЬNULL(СтоимостьМатериаловОстатки.СтоимостьОстаток, 0) КАК Стоимость,</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>| ЕСТЬNULL(ОстаткиМатериаловОстатки.КоличествоОстаток, 0) КАК Количество</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>|ИЗ</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>| НоменклатураДокумента КАК НоменклатураДокумента</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p> | ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.СтоимостьМатериалов.Остатки(</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p> | ,</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p> | Материал В</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p> | (ВЫБРАТЬ</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p> | НоменклатураДокумента.Номенклатура</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p> | ИЗ</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p> | НоменклатураДокумента)) </p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p> | КАК СтоимостьМатериаловОстатки</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p> | ПО НоменклатураДокумента.Номенклатура = </p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p> | СтоимостьМатериаловОстатки.Материал</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p> | ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.ОстаткиМатериалов.Остатки(</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p> | ,</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p> | Материал В</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p> | (ВЫБРАТЬ</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p> | НоменклатураДокумента.Номенклатура</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p> | ИЗ</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p> | НоменклатураДокумента)) </p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p> | КАК ОстаткиМатериаловОстатки</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p> | ПО НоменклатураДокумента.Номенклатура = </p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p> | ОстаткиМатериаловОстатки.Материал&quot;;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// Установим необходимость блокировки данных в регистрах СтоимостьМатериалов </p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// и ОстаткиМатериалов</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движения.СтоимостьМатериалов.БлокироватьДляИзменения = Истина;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движения.ОстаткиМатериалов.БлокироватьДляИзменения = Истина;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// Запишем пустые наборы записей, чтобы читать остатки без учета данных в документе</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движения.СтоимостьМатериалов.Записать();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движения.ОстаткиМатериалов.Записать();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>РезультатЗапроса = Запрос2.Выполнить(); </p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// ТЗ = РезультатЗапроса.Выгрузить();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ВыборкаДетальныеЗаписи = РезультатЗапроса.Выбрать();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Пока ВыборкаДетальныеЗаписи.Следующий() Цикл</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Если ВыборкаДетальныеЗаписи.Количество = 0 Тогда</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>СтоимостьМатериала = 0;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Иначе</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>СтоимостьМатериала = ВыборкаДетальныеЗаписи.Стоимость </p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>/ ВыборкаДетальныеЗаписи.Количество;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецЕсли;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Если ВыборкаДетальныеЗаписи.ВидНоменклатуры = </p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Перечисления.ВидыНоменклатуры.Материал Тогда </p></td>
	</tr>
</table>
<p>// Регистр ОстаткиМатериалов Расход</p>
<p>Движение = Движения.ОстаткиМатериалов.Добавить();</p>
<table>
	<tr>
		<td><p>Движение.ВидДвижения = ВидДвиженияНакопления.Расход;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.Период = Дата;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.Материал = ВыборкаДетальныеЗаписи.Номенклатура;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.Склад = Склад;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.Количество = ВыборкаДетальныеЗаписи.КоличествоВДокументе;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// Регистр СтоимостьМатериалов Расход</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение = Движения.СтоимостьМатериалов.Добавить();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.ВидДвижения = ВидДвиженияНакопления.Расход;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.Период = Дата;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.Материал = ВыборкаДетальныеЗаписи.Номенклатура;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.Стоимость = ВыборкаДетальныеЗаписи.КоличествоВДокументе </p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>* СтоимостьМатериала;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецЕсли;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// Регистр Продажи </p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение = Движения.Продажи.Добавить();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.Период = Дата;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.Номенклатура = ВыборкаДетальныеЗаписи.Номенклатура;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.Клиент = Клиент;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.Мастер = Мастер;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.Количество = ВыборкаДетальныеЗаписи.КоличествоВДокументе;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.Выручка = ВыборкаДетальныеЗаписи.СуммаВДокументе;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.Стоимость = СтоимостьМатериала * </p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ВыборкаДетальныеЗаписи.КоличествоВДокументе;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецЦикла;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движения.Записать();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>#КонецОбласти</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>#Область КонтрольОстатков</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Если Режим = РежимПроведенияДокумента.Оперативный Тогда</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// Проверить отрицательные остатки</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Запрос3 = Новый Запрос;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Запрос3.МенеджерВременныхТаблиц = МенеджерВТ;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Запрос3.Текст = &quot;ВЫБРАТЬ</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>| ОстаткиМатериаловОстатки.Материал,</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>| ОстаткиМатериаловОстатки.КоличествоОстаток</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>|ИЗ</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>| РегистрНакопления.ОстаткиМатериалов.Остатки(</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p> | ,</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p> | Материал В</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p> | (ВЫБРАТЬ</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p> | НоменклатураДокумента.Номенклатура</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p> | ИЗ</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p> | НоменклатураДокумента)</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p> | И Склад = &amp;Склад) КАК ОстаткиМатериаловОстатки</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>|ГДЕ</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>| ОстаткиМатериаловОстатки.КоличествоОстаток &lt; 0&quot;;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Запрос3.УстановитьПараметр(&quot;Склад&quot;, Склад);</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
</table>
<p>РезультатЗапроса = Запрос3.Выполнить();</p>
<p>ВыборкаДетальныеЗаписи = РезультатЗапроса.Выбрать();</p>
<table>
	<tr>
		<td><p>Пока ВыборкаДетальныеЗаписи.Следующий() Цикл</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Сообщение = Новый СообщениеПользователю();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Сообщение.Текст = &quot;Не хватает &quot; + Строка(- </p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ВыборкаДетальныеЗаписи.КоличествоОстаток) + </p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>&quot; единиц материала &quot;&quot;&quot; + ВыборкаДетальныеЗаписи.Материал + &quot;&quot;&quot;;</p>
		</td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Сообщение.Сообщить();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Отказ = Истина;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецЦикла;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецЕсли;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>#КонецОбласти</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецПроцедуры</p></td>
	</tr>
</table>
<p>В результате мы можем свернуть выделенные программные области в тексте процедуры (рис. 14.32).</p>
<p><strong>Рис. 14.32.</strong> Выделение произвольных областей в модуле</p>
<p>Затем можно развернуть только нужную область модуля и работать с ней. Текст процедуры станет более компактным и
	читаемым.</p>
<p>В нашем примере мы разбили одну процедуру модуля на три логические части. Но чаще наоборот: когда модуль содержит
	много различных процедур, сходные по назначению процедуры можно объединить в группы. Например, в модуле формы можно
	выделить такие области, как ПрограммныйИнтерфейс, ОбработчикиСобытий, СлужебныеПроцедурыИФункции. Название этих
	областей задается самим разработчиком и говорит само за себя.</p>
<p>Области могут быть вложены друг в друга или в другие группируемые конструкции языка. При расстановке областей в
	модуле нужно следить за тем, чтобы области не пересекались между собой и с другими группируемыми конструкциями.
	Потому что группировка по таким областям работать не будет.</p>
<p><strong>В режиме «1С:Предприятие»</strong></p>
<p>Запустим «1С:Предприятие» в режиме отладки и проверим работу нового обработчика события ОбработкаПроведения,
	перепроведя все документы Оказание услуги. </p>
<p>В результате все работает точно так же, с точки зрения пользователя, но проведение документов организовано
	методически правильно и более эффективно с точки зрения доступа к данным.</p>
<h1><a id="_Toc454870668"></a>Лабораторная работа № 23 Учет фирмы в 1С</h1>
<p><strong>Порядок выполнения работы </strong></p>
<p>1. Ознакомьтесь с теоретическими основами в настоящих указаниях и конспектах лекций. </p>
<p>2. Получите задание у преподавателя. </p>
<p>3. Сделайте скриншоты (кнопка клавиатуры PrtSc) выполненных заданий в текстовом (Word) файле <em>Фамилия_ЛР</em></p>
<p>4. Составьте отчет по лабораторной работе. </p>
<p>5. Отчитайте работу преподавателю.</p>
<p><strong>Создание новых объектов конфигурации</strong></p>
<p><strong>В режиме «Конфигуратор»</strong></p>
<p>Как мы уже говорили, нам понадобится создать несколько новых объектов конфигурации:</p>
<ul>
	<li>справочник ВариантыНоменклатуры, чтобы описывать партии материалов;</li>
	<li>справочник ДополнительныеСвойстваНоменклатуры, чтобы задавать значения видов характеристик, для которых нет
		подходящих типов в конфигурации;
	</li>
	<li>план видов характеристик СвойстваНоменклатуры, чтобы создавать виды характеристик;</li>
	<li>регистр сведений ЗначенияСвойствНоменклатуры, чтобы хранить значения видов характеристик для различных партий
		материалов.
	</li>
</ul>
<p>Сначала создадим объект конфигурации Справочник с именем</p>
<p>ВариантыНоменклатуры и укажем, что он будет подчинен справочнику Номенклатура. Для этого на закладке Владельцы
	добавим справочник Номенклатура в список владельцев справочника ВариантыНоменклатуры.</p>
<p>Затем создадим еще один объект конфигурации Справочник с именем ДополнительныеСвойстваНоменклатуры.</p>
<p>После этого создадим объект конфигурации План видов характеристик с именем СвойстваНоменклатуры. </p>
<p>Установим его свойство Тип значения характеристик. </p>
<p>Для этого нажмем кнопку выбора <img src="49.jpeg"/> и зададим составной тип данных следующим образом (рис. 15.5):</p>
<ul>
	<li>Число, длина 15, точность 3;</li>
	<li>Строка, длина 25;</li>
	<li>Дата;</li>
	<li>Булево;</li>
	<li>СправочникСсылка.ДополнительныеСвойстваНоменклатуры.</li>
</ul>
<p><strong>Рис. 15.5.</strong> Определение составного типа данных для типа значения характеристик плана видов
	характеристик</p>
<p>Затем справочнику ДополнительныеСвойстваНоменклатуры укажем владельца – план видов характеристик
	СвойстваНоменклатуры </p>
<p>(рис. 15.6).</p>
<p><strong>Рис. 15.6.</strong> Установка владельца справочника</p>
<p>После этого определим, что дополнительные значения характеристик плана видов характеристик будут располагаться в
	справочнике ДополнительныеСвойстваНоменклатуры (рис. 15.7).</p>
<p><strong>Рис. 15.7.</strong> Окно редактирования плана видов характеристик</p>
<p>Теперь создадим объект конфигурации Регистр сведений с именем ЗначенияСвойствНоменклатуры. </p>
<p>На закладке Данные создадим измерения регистра:</p>
<ul>
	<li>НаборСвойств, Ведущее, тип СправочникСсылка.ВариантыНоменклатуры;</li>
	<li>ВидСвойства, тип ПланВидовХарактеристикСсылка.СвойстваНоменклатуры.</li>
</ul>
<p>Затем создадим ресурс регистра (рис. 15.8):</p>
<ul>
	<li>Значение, тип Характеристика.СвойстваНоменклатуры.</li>
</ul>
<p><strong>Рис. 15.8.</strong> Окно редактирования регистра сведений</p>
<p>Обратите внимание, что мы имеем возможность определить тип значения ресурса регистра как Характеристика.&lt;имя&gt;.
	По сути, это определение представляет собой составной тип данных, как он задан в типе значения соответствующего
	плана видов характеристик. То есть ресурс регистра может иметь значение любого типа из тех, которые описаны в типе
	значения плана видов характеристик.</p>
<p>Кроме этого, зададим в свойстве Связь по типу этого ресурса измерение регистра ВидСвойства. Связь по типу будет
	обеспечивать нам соответствие типа значений, вводимых в это поле, и типа характеристики, выбранной в поле Вид
	свойства. А также заполним еще одно свойство – Связи параметров выбора. </p>
<p>Для этого нажмем кнопку выбора <img src="50.jpeg"/> у этого свойства и перенесем из списка доступных реквизитов в
	список параметров измерение регистра ВидСвойства. </p>
<p>Установка свойства Связи параметров выбора обеспечит нам то, что при выборе значений, содержащихся в справочнике
	Дополнительные свойства номенклатуры, для выбора будут предлагаться только те значения, которые относятся к
	выбранной характеристике, а не все, которые есть в этом справочнике (рис. 15.9).</p>
<p><strong>Рис. 15.9.</strong> Свойство ресурса «Значение регистра сведений»</p>
<p><strong>Описание характеристик вариантов номенклатуры</strong></p>
<p>В заключение для справочника ВариантыНоменклатуры опишем, где хранятся свойства вариантов номенклатуры и как получить
	значения этих свойств. Это описание платформа будет использовать автоматически при выполнении отчетов и при
	формировании различных динамических списков, в которых задействуются варианты номенклатуры. </p>
<p>В контекстном меню справочника ВариантыНоменклатуры выберем команду Характеристики (рис. 15.10).</p>
<p><strong>Рис. 15.10.</strong> Переход к характеристикам справочника </p>
<p>«ВариантыНоменклатуры»</p>
<p>Откроется диалог описания характеристик. С помощью кнопки Добавить в командной панели добавим в него новую запись. В
	качестве источника характеристик выберем план видов характеристик СвойстваНоменклатуры. Платформа автоматически
	определит, что полем ключа будет являться поле Ссылка этого объекта конфигурации (рис. 15.11).</p>
<p>Два оставшихся поля, Поле отбора видов и Значение отбора, оставим пустыми. В нашем случае эти поля не
	понадобятся.</p>
<p>Перейдем к описанию того, где и как хранятся значения наших свойств. В качестве источника значений характеристик
	выберем регистр сведений ЗначенияСвойствНоменклатуры. Платформа автоматически определит, что в этом регистре полем
	объекта является измерение НаборСвойств, а полем вида – измерение ВидСвойства. </p>
<p><strong>Рис. 15.11.</strong> Описание источника видов характеристик</p>
<p>Поэтому единственное, что нам останется указать самостоятельно, что значения свойств хранятся в ресурсе Значение. В
	результате описание характеристик для справочника ВариантыНоменклатуры будет выглядеть следующим образом (рис.
	15.12).</p>
<p><strong>Рис. 15.12.</strong> Описание характеристик для справочника </p>
<p>«ВариантыНоменклатуры»</p>
<p><strong>Доработка объектов конфигурации</strong></p>
<p>Итак, мы создали новые объекты конфигурации и задали их основные свойства, необходимые для реализации нашей
	задачи. </p>
<p>Но, как мы дальше увидим, не все свойства нас полностью устраивают. И вообще при разработке невозможно предусмотреть
	все заранее. Часто какие-то недочеты становятся видны лишь в процессе работы. То есть, увидев промежуточный
	результат в режиме 1С:Предприятие, важно уметь оценить недостатки и исправить их прямо по ходу работы.</p>
<p>Поэтому на этом занятии мы продемонстрируем процесс разработки от обратного. Это тоже очень ценный опыт, который, мы
	надеемся, будет полезен читателю.</p>
<p>Итак, запустим «1С:Предприятие» в режиме отладки и посмотрим, как взаимодействуют логически связанные объекты
	конфигурации Справочник Номенклатура, Справочник ВариантыНоменклатуры, План видов характеристик СвойстваНоменклатуры
	и Регистр сведений ЗначенияСвойствНоменклатуры.</p>
<p>Обратите внимание, что мы не указывали для этих объектов подсистем, к которым они относятся. Дело в том, что
	отображение этих объектов вне их логической связи друг с другом не имеет особого смысла. Поскольку мы задали
	владельцев справочников, ведущее измерение регистра сведений и т. п., то нужные объекты автоматически попадут в
	панель навигации форм своих владельцев как подчиненная информация. </p>
<p>Поэтому проигнорируем появившееся системное сообщение об отсутствии привязки созданных нами объектов к
	подсистемам.</p>
<p><strong>Справочник «Варианты номенклатуры»</strong></p>
<p><strong>В режиме «1С:Предприятие»</strong></p>
<p>Итак, по условию нашей задачи мы хотим создать наборы свойств и составляющие их характеристики для отдельных
	элементов номенклатуры. Наборы свойств, как мы уже говорили, будут храниться в справочнике ВариантыНоменклатуры,
	подчиненном справочнику Номенклатура. </p>
<p>Сначала мы хотим создать набор свойств для элемента номенклатуры Кабель электрический. </p>
<p>В разделе Учет материалов откроем справочник Номенклатура и его элемент Кабель электрический из группы Материалы 
	Прочее.</p>
<p>Поскольку справочник Номенклатура является владельцем справочника ВариантыНоменклатуры, мы видим в панели навигации
	формы ссылку для перехода к подчиненному списку. Это значит, что при открытии этого списка мы будем видеть только
	наборы свойств, относящиеся к редактируемому элементу справочника Номенклатура. </p>
<p>Для этого выполним команду Варианты номенклатуры для перехода к списку, где будут храниться наборы свойств элементов
	номенклатуры (рис. 15.13).</p>
<p><img src="51.jpeg"/></p>
<p><strong>Рис. 15.13.</strong> Список вариантов номенклатуры</p>
<p>Открывшаяся форма списка вариантов номенклатуры не совсем нас устраивает – столбцы Код и Владелец явно лишние. </p>
<p>Код нового варианта номенклатуры генерируется автоматически и ни о чем пользователю не говорит. </p>
<p>Владелец варианта номенклатуры отражен в заголовке формы и тоже в списке не имеет смысла.</p>
<p>Чтобы сделать эти колонки невидимыми, нам нужно создать форму списка справочника ВариантыНоменклатуры и при ее
	создании проанализировать, откуда она открывается (это можно понять по значению параметра формы Отбор). </p>
<p>Если установлен отбор по владельцу (то есть она открывается из списка номенклатуры), то мы будем в ней скрывать
	колонки Код и Владелец. </p>
<p>Если же форма открывается другими способами, то эти колонки могут понадобиться, поэтому просто удалить их из формы
	было бы неправильно. </p>
<p>Поскольку форма создается на сервере, делать это нужно в обработчике события формы ПриСозданииНаСервере. </p>
<p><strong>В режиме «Конфигуратор»</strong></p>
<p>Вернемся в конфигуратор и устраним недостатки формы списка.</p>
<p>Для создания формы откроем окно редактирования объекта конфигурации Справочник ВариантыНоменклатуры, перейдем на
	закладку </p>
<p><strong>Рис. 15.14.</strong> Создание основной формы списка </p>
<p>В открывшемся окне конструктора нажмем Готово. </p>
<p>Форма, созданная конструктором, в отличие от автогенерируемой формы, не содержит поля Владелец. Поэтому наша задача
	даже упрощается: нам нужно будет скрыть только одно поле – Код.</p>
<p>В открывшемся окне редактора форм вверху слева расположено окно элементов формы. Выделим в нем элемент Форма
	(поскольку нам нужно событие формы в целом) и двойным щелчком мыши откроем палитру свойств этого элемента. </p>
<p>Прокрутив вниз список свойств формы, найдем событие ПриСозда-</p>
<p>В модуле формы будет создан обработчик события формы ПриСозданииНаСервере, в который мы внесем следующий текст
	(листинг </p>
<p>15.1). </p>
<p><strong>листинг 15.1.</strong> Обработчик события формы «ПриСозданииНаСервере()»</p>
<table>
	<tr>
		<td><p>Если Параметры.Отбор.Свойство(&quot;Владелец&quot;) Тогда</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Элементы.Код.Видимость = Ложь;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецЕсли;</p></td>
	</tr>
</table>
<p>Прокомментируем этот код. </p>
<p>Параметры – это свойство управляемой формы, в модуле которой мы находимся. Используя это свойство, мы получаем
	объект, который содержит коллекцию параметров формы. </p>
<p>К элементу этой коллекции Отбор мы обращаемся по имени. Используя метод Свойство() структуры элементов отбора, мы
	определяем, установлен ли отбор по полю Владелец. </p>
<p>Если такой отбор установлен, то мы устанавливаем видимость поля Код в значение Ложь, то есть скрываем это поле. Здесь
	Элементы – это свойство управляемой формы, которое позволяет получить доступ ко всем элементам формы.</p>
<p><strong>В режиме «1С:Предприятие»</strong></p>
<p>Проверим результат изменений в режиме 1С:Предприятие. </p>
<p>Форма списка вариантов номенклатуры будет иметь следующий вид (рис. 15.16).</p>
<p><strong>Рис. 15.16.</strong> Список вариантов номенклатуры</p>
<p>Мы видим, что добились желаемого результата (см. рис. 15.13): было три колонки, а теперь только одна –
	Наименование.</p>
<p>Теперь нажмем кнопку Создать, чтобы создать новый набор свойств для элемента номенклатуры. </p>
<p>Откроется форма элемента справочника ВариантыНоменклатуры </p>
<p>(рис. 15.17).</p>
<p>Эта форма сгенерирована системой автоматически. Но в ней также есть недостатки:</p>
<ul>
	<li>заголовок формы должен быть задан в единственном числе;</li>
	<li>лишние поля Код и Владелец;</li>
	<li>команду перехода к подчиненной информации нужно переименовать в более понятную.</li>
</ul>
<p>Вернемся в конфигуратор и исправим их.</p>
<p><strong>В режиме «Конфигуратор»</strong></p>
<p>Во-первых, нужно переименовать заголовок формы, чтобы было понятно, что мы создаем в данный момент один вариант
	номенклатуры. </p>
<p>Для этого в окне редактирования объекта конфигурации Справочник </p>
<p>ВариантыНоменклатуры на закладке Основные зададим Представление объекта в единственном числе как Вариант номенклатуры
	(рис. 15.18).</p>
<p><strong>Рис. 15.18.</strong> Установка представления объекта</p>
<p>Это свойство будет использоваться в интерфейсе «1С:Предприятия» как заголовок формы элемента справочника.</p>
<p>Во-вторых, нужно убрать поля Код и Владелец из этой формы. </p>
<p>Для этого в окне редактирования объекта конфигурации Справочник ВариантыНоменклатуры перейдем на закладку Формы,
	нажмем кнопку открытия и создадим основную форму элемента. </p>
<p>В окне структуры элементов формы выделим поочередно эти элементы и, нажимая кнопку Удалить в командной панели, удалим
	их из формы (рис. 15.19).</p>
<p><strong>Рис. 15.19.</strong> Удаление элементов формы</p>
<p>В результате в форме элемента будет отображен только один реквизит справочника – Наименование. </p>
<p>Его представление мы тоже немного поправим. </p>
<p>На закладке Данные в окне редактирования объекта конфигурации Справочник ВариантыНоменклатуры нажмем кнопку
	Стандартные реквизиты, в списке этих реквизитов дважды щелкнем на реквизите Наименование и в открывшейся палитре
	свойств зададим Синоним реквизита – Название.</p>
<p>В-третьих, не вяжутся друг с другом заголовок формы Вариант </p>
<p>Поэтому в окне редактирования объекта конфигурации Регистр сведений ЗначенияСвойствНоменклатуры на закладке Основные
	зададим Представление списка как Состав варианта номенклатуры (рис. 15.20).</p>
<p>Это свойство будет использоваться в интерфейсе «1С:Предприятия» как заголовок формы списка регистра. </p>
<p><strong>В режиме «1С:Предприятие»</strong></p>
<p>Проверим результат изменений в режиме 1С:Предприятие. </p>
<p>Итак, в разделе Учет материалов откроем справочник Номенклатура и его элемент Кабель электрический из группы
	Материалы  Прочее. </p>
<p>В форме элемента выполним команду Варианты номенклатуры для перехода к списку наборов свойств данного элемента
	номенклатуры. Пока этот список пуст. </p>
<p>Нажмем кнопку Создать. Теперь в открывшейся форме варианта номенклатуры нас все устраивает. </p>
<p><strong>Регистр сведений «Значения свойств номенклатуры»</strong></p>
<p><strong>В режиме «1С:Предприятие»</strong></p>
<p>Создадим вариант номенклатуры Белые кабели (рис. 15.21).</p>
<p>Выполним команду Состав варианта номенклатуры для перехода к составу редактируемого варианта номенклатуры. </p>
<p><strong>подскАзкА</strong></p>
<p>Как показывает опыт многих читателей, при выполнении данного занятия может возникнуть проблема – в панели навигации
	формы варианта номенклатуры не видна команда для перехода к связанным записям регистра сведений
	ЗначенияСвойствНоменклатуры (Состав варианта номенклатуры). В этом случае, скорее всего, вы забыли установить
	свойство Ведущее для измерения этого регистра НаборСвойств, имеющего тип СправочникСсылка.ВариантыНоменклатуры.</p>
<p>В результате того, что измерение регистра является ведущим, в панели навигации формы элемента справочника
	ВариантыНоменклатуры появляется ссылка, по которой возможен переход к записям регистра, содержащим в измерении
	НаборСвойств ссылку на текущий вариант номенклатуры.</p>
<p>Если новый вариант номенклатуры еще не записан, то появится вопрос о записи данных, на который мы ответим
	утвердительно </p>
<p>(рис. 15.22).</p>
<p><strong>Рис. 15.22.</strong> Подтверждение записи данных</p>
<p>После этого откроется форма списка регистра Значения свойств номенклатуры, которая также генерируется по умолчанию
	(рис. 15.23).</p>
<p>В этой форме нас также не все устраивает:</p>
<ul>
	<li>заголовок колонки ВидСвойства лучше переименовать,</li>
	<li>лишняя колонка НаборСвойств.</li>
</ul>
<p>Вернемся в конфигуратор и устраним недостатки формы списка.</p>
<p><strong>В режиме «Конфигуратор»</strong></p>
<p>Во-первых, название колонки Вид свойства лучше переименовать в Свойство. </p>
<p>Для этого в окне редактирования объекта конфигурации Регистр сведений ЗначенияСвойствНоменклатуры на закладке Данные
	откроем палитру свойств измерения ВидСвойства и зададим его Синоним как Свойство (рис. 15.24).</p>
<p><strong>Рис. 15.24.</strong> Установка синонима для измерения регистра</p>
<p>Во-вторых, поскольку регистр имеет ведущее измерение</p>
<p>НаборСвойств типа СправочникСсылка.ВариантыНоменклатуры, поле </p>
<p>Набор свойств – лишнее, так как владелец данного набора свойств отражен в заголовке формы. </p>
<p>Поэтому создадим обработчик события ПриСозданииНаСервере формы списка регистра и в нем сделаем колонку НаборСвойств
	невидимой в случае открытия формы с отбором по этому полю, то есть если форма списка регистра открыта из формы
	элемента справочника Варианты номенклатуры.</p>
<p>Для создания этого обработчика откроем окно редактирования объекта конфигурации Регистр сведений
	ЗначенияСвойствНоменклатуры, перейдем на закладку Формы, нажмем кнопку открытия <img src="52.jpeg"/>
	и<strong> </strong>создадим основную форму списка.</p>
<p>Затем создадим для формы обработчик события формы ПриСозданииНаСервере, в который мы внесем следующий текст
	(листинг </p>
<p>15.2). </p>
<p><strong>листинг 15.2.</strong> Обработчик события формы «ПриСозданииНаСервере()»</p>
<table>
	<tr>
		<td><p>Если Параметры.Отбор.Свойство(&quot;НаборСвойств&quot;) Тогда</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Элементы.НаборСвойств.Видимость = Ложь;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецЕсли;</p></td>
	</tr>
</table>
<p>Этот код аналогичен коду, приведенному выше в листинге 15.1, поэтому в комментариях не нуждается.</p>
<p><strong>В режиме «1С:Предприятие»</strong></p>
<p>Проверим результат изменений в режиме 1С:Предприятие. </p>
<p>В результате форма списка регистра Состав варианта номенклатуры примет вид (рис. 15.25).</p>
<p>Теперь, если нажать кнопку Создать, чтобы ввести новую запись в состав варианта номенклатуры, откроется форма записи
	регистра ЗначенияСвойствНоменклатуры (рис. 15.26).</p>
<p>Эта форма сгенерирована системой автоматически. Но в ней также есть недостатки:</p>
<p> заголовок формы должен быть задан в единственном числе,  лишняя колонка НаборСвойств. </p>
<p>Вернемся в конфигуратор и исправим их.</p>
<p><strong>В режиме «Конфигуратор»</strong></p>
<p>Во-первых, нужно переименовать заголовок формы, чтобы было понятно, что мы создаем в данный момент одно свойство и
	его значение в составе варианта номенклатуры. </p>
<p>Для этого в окне редактирования объекта конфигурации Регистр сведений ЗначенияСвойствНоменклатуры на закладке
	Основные зададим Представление записи как Свойство и значение (рис. 15.27).</p>
<p>Это свойство будет использоваться в интерфейсе «1С:Предприятия» как заголовок формы записи регистра.</p>
<p>Во-вторых, нужно убрать поле НаборСвойств из этой формы. Для этого в окне редактирования объекта конфигурации Регистр
	сведений ЗначенияСвойствНоменклатуры перейдем на закладку Формы, нажмем кнопку открытия <img src="53.jpeg"/> и
	создадим основную форму записи. </p>
<p><strong>Рис. 15.27.</strong> Установка представления записи регистра</p>
<p>В окне структуры элементов формы выделим этот элемент и, нажав кнопку Удалить в командной панели, удалим его из
	формы.</p>
<p><strong>В режиме «1С:Предприятие»</strong></p>
<p>Проверим результат изменений в режиме 1С:Предприятие. В результате форма записи регистра ЗначенияСвойствНоменклатуры
	примет вид (рис. 15.28).</p>
<h1><a id="_Toc454870669"></a>Лабораторная работа № 24 Пакетная печать документа</h1>
<p><strong>Порядок выполнения работы </strong></p>
<p>1. Ознакомьтесь с теоретическими основами в настоящих указаниях и конспектах лекций. </p>
<p>2. Получите задание у преподавателя. </p>
<p>3. Сделайте скриншоты (кнопка клавиатуры PrtSc) выполненных заданий в текстовом (Word) файле <em>Фамилия_ЛР</em></p>
<p>4. Составьте отчет по лабораторной работе. </p>
<p>5. Отчитайте работу преподавателю.</p>
<p><strong>Создание видов характеристик номенклатуры</strong></p>
<p><strong>В режиме «1С:Предприятие»</strong></p>
<p>Теперь создадим различные варианты номенклатуры в режиме 1С:Предприятие. </p>
<p>Итак, в разделе Учет материалов откроем справочник Номенклатура и его элемент Кабель электрический из группы
	Материалы  Прочее. </p>
<p>В форме элемента номенклатуры выполним команду Варианты номенклатуры для перехода к списку наборов свойств данного
	элемента номенклатуры. </p>
<p>В форме списка вариантов номенклатуры откроем набор свойств Белые кабели, который мы создали ранее. </p>
<p>В форме варианта номенклатуры выполним команду Состав варианта номенклатуры для перехода к составу редактируемого
	варианта номенклатуры. Этот список пока пуст. </p>
<p>Нажмем кнопку Создать. В открывшейся форме (см. рис. 15.28) создадим свойство Цвет со значением Белый. Для этого
	нажмем кнопку выбора <img src="54.jpeg"/> в поле Свойство и в выпадающем списке нажмем на ссылку Показать все. </p>
<p>Измерение ВидСвойства(Свойство) регистра ЗначенияСвойствНоменклатуры имеет тип
	ПланВидовХарактеристикСсылка.СвойстваНоменклатуры. Поэтому перед нами появится форма выбора этого плана видов
	характеристик. Список видов характеристик пока пуст. </p>
<p>Нажмем кнопку Создать. В открывшемся окне формы элемента плана видов характеристик введем наименование вида
	характеристики – Цвет. Тип значения этого вида характеристики оставим по умолчанию – Дополнительные свойства
	номенклатуры (рис. 15.29).</p>
<p>Обратите внимание, что в форме элемента плана видов характеристик (см. рис. 15.29) и в форме элемента справочника
	дополнительных характеристик номенклатуры (см. рис. 15.30) также есть лишнее поле Код. Кроме того, заголовок этих
	форм желательно задать в единственном числе.</p>
<p><img src="55.jpeg"/></p>
<p><strong>Рис. 15.29.</strong> Создание вида характеристики в плане видов характеристик</p>
<p>Мы не стали дорабатывать эти формы, так как уже показывали подобные действия ранее. Вы можете сделать это
	самостоятельно аналогично тому, как это показано для формы элемента справочника ВариантыНоменклатуры.</p>
<p>Нажмем Записать и закрыть. В окне выбора плана видов характеристик появится созданный нами вид характеристики. </p>
<p>Нажмем кнопку Выбрать. В результате мы вернемся в форму записи состава варианта номенклатуры с заголовком Свойство и
	значение. </p>
<p>Нажмем кнопку выбора <img src="56.jpeg"/> в поле Значение и в выпадающем списке нажмем кнопку Создать (+).</p>
<p>Ресурс Значение регистра ЗначенияСвойствНоменклатуры имеет тип Характеристика.СвойстваНоменклатуры. Это составной тип
	данных, который описан в свойстве Тип значения характеристик плана видов характеристик СвойстваНоменклатуры. </p>
<p>Так как для вида характеристики Цвет мы задали тип значения СправочникСсылка.ДополнительныеСвойстваНоменклатуры, то
	перед нами появится форма ввода нового элемента этого справочника.</p>
<p>В открывшемся окне формы элемента дополнительных свойств номенклатуры введем тип значения Белый, в поле Владелец
	оставим имеющееся значение – Цвет (рис. 15.30).</p>
<p><img src="57.jpeg"/></p>
<p><strong>Рис. 15.30.</strong> Создание дополнительных свойств номенклатуры</p>
<p>Нажмем Записать и закрыть. </p>
<p>Мы вернемся в форму записи состава варианта номенклатуры с заголовком Свойство и значение и увидим там созданное нами
	свойство Цвет со значением Белый (рис. 15.31).</p>
<p>Нажмем Записать и закрыть. Мы вернемся в форму списка состава варианта номенклатуры. </p>
<p>Создадим еще одно свойство – Сечение, мм2 – в составе варианта номенклатуры Белые кабели. Для этого повторим только
	что выполненные действия.</p>
<p>Нажмем кнопку Создать (рис. 15.32).</p>
<p>нажмем на ссылку Показать все. </p>
<p>В форме выбора плана видов характеристик нажмем кнопку Создать. </p>
<p>В открывшемся окне формы элемента плана видов характеристик введем наименование вида характеристики – Сечение, мм2 и
	выберем Тип значения этого вида характеристики – Число, длина 15, точность 3 (рис. 15.33).</p>
<p>Нажмем Записать и закрыть. В окне выбора плана видов характеристик появится созданный нами вид характеристики. </p>
<p>Нажмем кнопку Выбрать. Мы вернемся в форму записи состава варианта номенклатуры с заголовком Свойство и
	значение. </p>
<p>Введем число 2,5 в поле Значение (рис. 15.34).</p>
<p>Нажмем Записать и закрыть. Мы вернемся в форму списка состава варианта номенклатуры. </p>
<p>Итак, мы видим два свойства и их значения, которые мы создали для варианта номенклатуры Белые кабели (рис.
	15.35).</p>
<p>Теперь аналогичным образом создадим набор свойств для элемента справочника Номенклатура – Шланг резиновый. </p>
<p>Этот набор свойств будет называться Польша (рис. 15.36) и состоять из следующих свойств (рис. 15.37):</p>
<ul>
	<li>Цвет – Черный;</li>
	<li>Производитель – Fagumit.</li>
</ul>
<p><strong>Рис. 15.36.</strong> Вариант номенклатуры для элемента номенклатуры </p>
<p>«Шланг резиновый»</p>
<p>При создании свойства Цвет выберем его из уже имеющихся свойств в плане видов характеристик. </p>
<p>Значение этого вида характеристики – Черный, сначала добавим в справочник дополнительных свойств номенклатуры и затем
	выберем из него.</p>
<p>При создании свойства Производитель с типом значения Дополнительные свойства номенклатуры сначала добавим это
	свойство в план видов характеристик (тип значения – Дополнительные свойства номенклатуры), а затем выберем из
	него. </p>
<p>Значение этого вида характеристики – Fagumit, сначала добавим в справочник дополнительных свойств номенклатуры и
	затем выберем из него.</p>
<p>Теперь посмотрим на все, что мы создали, не с точки зрения пользователя, а с точки зрения разработчика.</p>
<p><strong>Рис. 15.37.</strong> Свойства и значения в составе варианта номенклатуры «Польша»</p>
<p>Перейдем в главное меню программы. Для этого нажмем кнопку с пиктограммой в виде черного треугольника <img
		src="58.jpeg"/>, расположенную в панели системных команд приложения рядом с символом «1С». Выполним команду
	главного меню Все функции. Поочередно откроем все объекты конфигурации, в которых хранится информация о созданных
	нами характеристиках номенклатуры.</p>
<p>В справочнике Варианты номенклатуры хранятся созданные нами наборы свойств номенклатуры. При этом каждый набор
	свойств подчинен конкретному элементу номенклатуры.</p>
<p>В плане видов характеристик Свойства номенклатуры хранятся созданные нами виды характеристик номенклатуры:</p>
<ul>
	<li>Цвет, тип значения СправочникСсылка.ДополнительныеСвойстваНоменклатуры;</li>
	<li>Сечение, мм2, тип значения Число;</li>
	<li>Производитель, тип значения СправочникСсылка.ДополнительныеСвойстваНоменклатуры.</li>
</ul>
<p>В справочнике Дополнительные свойства номенклатуры хранятся значения этих видов характеристик (за исключением вида
	характеристики Сечение типа Число). А в регистре сведений Значе- нияСвойствНоменклатуры хранятся соответствия видов
	характеристик и их значений в разрезе наборов свойств.</p>
<p>Взаимодействие этих объектов конфигурации представлено на следующей схеме (рис. 15.38).</p>
<p><img src="59.jpeg"/></p>
<p><strong>Рис. 15.38.</strong> Объекты конфигурации, в которых хранится информация </p>
<p>о характеристиках номенклатуры</p>
<p><strong>Доработка учетных механизмов</strong></p>
<p>Итак, мы добавили возможность указывать произвольные характеристики для номенклатуры и создали несколько таких
	характеристик – вариантов номенклатуры.</p>
<p>Но это лишь часть работы. Теперь хотелось бы иметь возможность еще и учитывать номенклатуру в разрезе этих
	характеристик. А именно:</p>
<ul>
	<li>приходовать товар, указывая характеристики;</li>
	<li>расходовать товар, указывая характеристики;</li>
	<li>получать отчеты не просто по номенклатуре, а по номенклатуре с определенными характеристиками.</li>
</ul>
<p>Для этого потребуется доработать имеющиеся регистры и создать новый отчет, который позволит получать данные в разрезе
	свойств номенклатуры.</p>
<p><strong>Регистр «Остатки материалов»</strong></p>
<p><strong>В режиме «Конфигуратор»</strong></p>
<p>Для обеспечения учета материалов по значениям характеристик необходимо изменить структуру регистра накопления
	ОстаткиМатериалов, чтобы хранить в нем данные еще и в разрезе наборов свойств номенклатуры.</p>
<p>Для этого откроем окно редактирования объекта конфигурации Регистр накопления ОстаткиМатериалов и на закладке Данные
	добавим в него новое измерение НаборСвойств с типом СправочникСсылка.ВариантыНоменклатуры (рис. 15.39).</p>
<p><strong>Рис. 15.39.</strong> Новое измерение «НаборСвойств»</p>
<p><strong>Документ «Приходная накладная»</strong></p>
<p><strong>В режиме «Конфигуратор»</strong></p>
<p>Теперь нам нужно доработать документ ПриходнаяНакладная, чтобы при приходовании материалов можно было указать набор
	свойств и чтобы этот набор свойств записывался в регистры при проведении документа.</p>
<p>Для этого откроем окно редактирования объекта конфигурации Документ ПриходнаяНакладная и на закладке Данные добавим в
	табличную часть документа новый реквизит НаборСвойств с типом СправочникСсылка.ВариантыНоменклатуры (рис.
	15.40).</p>
<p><strong>Рис. 15.40.</strong> Новый реквизит «НаборСвойств»</p>
<p>У этого реквизита необходимо заполнить свойство Связи параметров выбора, чтобы после выбора номенклатуры в этом
	свойстве выбирать только среди тех наборов свойств, которые относятся к данной номенклатуре.</p>
<p>Найдем в палитре свойств свойство Связи параметров выбора и нажмем кнопку выбора <img src="60.jpeg"/>. </p>
<p>Перенесем из списка доступных реквизитов в список параметров реквизит Материалы.Материал (рис. 15.41).</p>
<p>Тем самым мы задали, что при выборе в поле НаборСвойств будет всегда открываться список элементов справочника
	Варианты номенклатуры, подчиненных материалу, выбранному в колонке Материал.</p>
<p>После этого расположим этот реквизит в табличной части формы документа. </p>
<p>Для этого перейдем на закладку Формы и двойным щелчком мыши на строке ФормаДокумента в списке форм откроем форму
	документа. </p>
<p>Затем в правом верхнем окне редактора форм на закладке Реквизиты раскроем реквизит формы Объект. </p>
<p>Мы видим, что он содержит все реквизиты документа ПриходнаяНакладная. </p>
<p>Найдем в табличной части реквизит НаборСвойств и с помощью мыши перетащим его в окно элементов формы, расположенное
	слева в верхней части редактора форм, в таблицу Материалы. </p>
<p>Новый элемент расположим в структуре элементов формы после поля Материал (рис. 15.42).</p>
<p><strong>Рис. 15.42.</strong> Изменение формы документа «Приходная накладная»</p>
<p>Обратите внимание, что в открывшейся палитре свойств элемента формы НаборСвойств в свойстве ПутьКДанным уже указан
	реквизит табличной части НаборСвойств, так как мы перетаскивали реквизит в форму с помощью мыши, и оно заполнилось
	автоматически. </p>
<p>Свойство ПутьКДанным устанавливает связь элемента формы с реквизитом формы, то есть с отображаемыми данными. Это
	свойство обязательно должно быть заполнено, иначе элемент формы не будет показан!</p>
<p><strong>пРиМеЧАние</strong></p>
<p>При добавлении элемента формы с помощью кнопки Добавить свойство ПутьКДанным, устанавливающее связь элемента с
	реквизитом формы, необходимо заполнять вручную.</p>
<p>В заключение в окне редактирования объекта конфигурации Документ ПриходнаяНакладная на закладке Прочее откроем модуль
	объекта. </p>
<p>Откроем процедуру обработчика события ОбработкаПроведения и добавим к формируемым движениям присвоение значения
	измерению НаборСвойств регистра ОстаткиМатериалов (листинг 15.3). </p>
<p><strong>листинг 15.3.</strong> Фрагмент процедуры «ОбработкаПроведения()»</p>
<p>…</p>
<table>
	<tr>
		<td><p>// регистр ОстаткиМатериалов Приход</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>…</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.Материал = ТекСтрокаМатериалы.Материал;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>Движение.НаборСвойств = ТекСтрокаМатериалы.НаборСвойств;</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.Склад = Склад;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>…</p></td>
	</tr>
</table>
<p><strong>Документ «Оказание услуги»</strong></p>
<p><strong>В режиме «Конфигуратор»</strong></p>
<p>Теперь аналогичным образом доработаем документ ОказаниеУслуги. </p>
<p>Для того чтобы при расходовании материалов пользователь мог указывать набор свойств для каждого расходуемого
	материала, откроем окно редактирования объекта конфигурации Документ ОказаниеУслуги и на закладке Данные добавим в
	табличную часть документа новый реквизит НаборСвойств с типом СправочникСсылка.ВариантыНоменклатуры.</p>
<p>У этого реквизита заполним свойство Связи параметров выбора. Перенесем из списка доступных реквизитов в список
	параметров реквизит ПереченьНоменклатуры.Номенклатура. Тем самым мы задали, что при выборе в поле НаборСвойств будет
	всегда открываться список элементов справочника Варианты номенклатуры, подчиненных материалу, выбранному в колонке
	Номенклатура.</p>
<p>После этого расположим этот реквизит в табличной части формы документа. Откроем форму документа и с помощью мыши
	перетащим его из окна реквизитов формы в окно элементов формы. Новый элемент расположим в структуре элементов формы
	после поля Номенклатура.</p>
<p>В заключение в окне редактирования объекта конфигурации Документ ОказаниеУслуги на закладке Прочее откроем модуль
	объекта. </p>
<p>Откроем процедуру обработчика события ОбработкаПроведения и добавим к формируемым движениям присвоение значения
	измерению НаборСвойств регистра ОстаткиМатериалов (листинг 15.4). </p>
<p><strong>листинг 15.4.</strong> Фрагмент процедуры «ОбработкаПроведения()»</p>
<p>…</p>
<table>
	<tr>
		<td><p>// регистр ОстаткиМатериалов Расход</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>…</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.Материал = ВыборкаДетальныеЗаписи.Номенклатура;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>Движение.НаборСвойств = ВыборкаДетальныеЗаписи.НаборСвойств;</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.Склад = Склад;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>…</p></td>
	</tr>
</table>
<p>Поскольку на предыдущем занятии мы оптимизировали процедуру проведения документа и получали все данные документа с
	помощью запроса, то в текст запроса нужно также добавить строки для получения нового реквизита документа (листинг
	15.5). <strong>листинг 15.5.</strong> Фрагмент процедуры «ОбработкаПроведения()»</p>
<table>
	<tr>
		<td><p>…</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Запрос = Новый Запрос;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// Укажем, какой менеджер временных таблиц использует этот запрос</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Запрос.МенеджерВременныхТаблиц = МенеджерВТ;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Запрос.Текст = </p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>&quot;ВЫБРАТЬ</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p> | ОказаниеУслугиПереченьНоменклатуры.Номенклатура,</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p> | ОказаниеУслугиПереченьНоменклатуры.Номенклатура.ВидНоменклатуры </p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p> | КАК ВидНоменклатуры,</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>| ОказаниеУслугиПереченьНоменклатуры.НаборСвойств,</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p> | СУММА(ОказаниеУслугиПереченьНоменклатуры.Количество) </p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p> | КАК КоличествоВДокументе,</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p> | СУММА(ОказаниеУслугиПереченьНоменклатуры.Сумма) КАК СуммаВДокументе</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>|ПОМЕСТИТЬ НоменклатураДокумента</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>|ИЗ</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p> | Документ.ОказаниеУслуги.ПереченьНоменклатуры </p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p> | КАК ОказаниеУслугиПереченьНоменклатуры</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>|ГДЕ</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p> | ОказаниеУслугиПереченьНоменклатуры.Ссылка = &amp;Ссылка</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>|СГРУППИРОВАТЬ ПО</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p> | ОказаниеУслугиПереченьНоменклатуры.Номенклатура,</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p> | ОказаниеУслугиПереченьНоменклатуры.Номенклатура.ВидНоменклатуры<strong>,</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>| ОказаниеУслугиПереченьНоменклатуры.НаборСвойств</strong>&quot;<strong>;</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>...</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Запрос2 = Новый Запрос;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Запрос2.МенеджерВременныхТаблиц = МенеджерВТ;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Запрос2.Текст = &quot;ВЫБРАТЬ</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p> | НоменклатураДокумента.Номенклатура,</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p> | НоменклатураДокумента.ВидНоменклатуры,</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>| НоменклатураДокумента.НаборСвойств,</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p> | НоменклатураДокумента.КоличествоВДокументе,</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p> | НоменклатураДокумента.СуммаВДокументе,</p></td>
	</tr>
</table>
<p>| ЕСТЬNULL(СтоимостьМатериаловОстатки.СтоимостьОстаток, 0) КАК Стоимость, |
	ЕСТЬNULL(ОстаткиМатериаловОстатки.КоличествоОстаток, 0) КАК Количество |ИЗ</p>
<table>
	<tr>
		<td><p>| </p></td>
		<td><p>НоменклатураДокумента КАК НоменклатураДокумента</p></td>
	</tr>
	<tr>
		<td></td>
		<td></td>
	</tr>
	<tr>
		<td><p>…</p></td>
		<td></td>
	</tr>
</table>
<p>Кроме этого, понадобится изменить последний запрос, который при оперативном проведении проверяет, не появились ли
	отрицательные остатки. Теперь мы будем получать остатки не «вообще» для номенклатуры из табличной части документа, а
	для номенклатуры именно с тем набором свойств, который указан в строках документа (листинг 15.6). </p>
<p><strong>листинг 15.6.</strong> Контроль отрицательных остатков </p>
<p>при оперативном проведении</p>
<table>
	<tr>
		<td><p>…</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Запрос3.Текст = &quot;ВЫБРАТЬ</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p> | ОстаткиМатериаловОстатки.Материал,</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>| ОстаткиМатериаловОстатки.НаборСвойств,</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p> | ОстаткиМатериаловОстатки.КоличествоОстаток</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>|ИЗ</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p> | РегистрНакопления.ОстаткиМатериалов.Остатки( , (Материал<strong>, НаборСвойств</strong>) В</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p> | (ВЫБРАТЬ</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p> | НоменклатураДокумента.Номенклатура,</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>| НоменклатураДокумента.НаборСвойств</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p> | ИЗ</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p> | НоменклатураДокумента) И Склад = &amp;Склад) </p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p> | КАК ОстаткиМатериаловОстатки</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>|ГДЕ</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p> | ОстаткиМатериаловОстатки.КоличествоОстаток &lt; 0&quot;;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Запрос3.УстановитьПараметр(&quot;Склад&quot;, Склад);</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>РезультатЗапроса = Запрос3.Выполнить();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ВыборкаДетальныеЗаписи = РезультатЗапроса.Выбрать();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Пока ВыборкаДетальныеЗаписи.Следующий() Цикл</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Сообщение = Новый СообщениеПользователю();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Сообщение.Текст = &quot;Не хватает &quot; + Строка(- ВыборкаДетальныеЗаписи.КоличествоОстаток) + </p>
		</td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>&quot; единиц материала &quot;&quot;&quot; + ВыборкаДетальныеЗаписи.Материал + &quot;&quot;&quot;&quot;
			+</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong> </strong>&quot;<strong> из набора свойств </strong>&quot;&quot;&quot;<strong> +
			ВыборкаДетальныеЗаписи.НаборСвойств + </strong>&quot;&quot;&quot;&quot;<strong>;</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Сообщение.Сообщить();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Отказ = Истина;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецЦикла;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>…</p></td>
	</tr>
</table>
<h1><a id="_Toc454870670"></a>Лабораторная работа № 25 Создание БД учета кадров</h1>
<p><strong>Порядок выполнения работы </strong></p>
<p>1. Ознакомьтесь с теоретическими основами в настоящих указаниях и конспектах лекций. </p>
<p>2. Получите задание у преподавателя. </p>
<p>3. Сделайте скриншоты (кнопка клавиатуры PrtSc) выполненных заданий в текстовом (Word) файле <em>Фамилия_ЛР</em></p>
<p>4. Составьте отчет по лабораторной работе. </p>
<p>5. Отчитайте работу преподавателю.</p>
<p><strong>Добавление плана видов характеристик </strong></p>
<p><strong>В режиме «Конфигуратор»</strong></p>
<p>Приступим к созданию плана видов характеристик, который будет содержать описания разрезов аналитического учета –
	видов субконто.</p>
<p>Откроем конфигуратор и добавим новый объект конфигурации План видов характеристик. Зададим его имя – ВидыСубконто. На
	закладке Подсистемы укажем, что план счетов будет отображаться в подсистеме Бухгалтерия.</p>
<p>Поскольку нам понадобится некий вспомогательный справочник, в котором пользователи будут осуществлять «свободное
	творчество» по созданию значений новых объектов аналитического учета, добавим объект конфигурации Справочник и
	назовем его Субконто. </p>
<p>Затем на закладке Владельцы укажем, что этот справочник будет подчинен плану видов характеристик ВидыСубконто. </p>
<p>Для этого на закладке Владельцы нажмем кнопку Редактировать элемент списка и выберем в качестве владельца справочника
	план видов характеристик ВидыСубконто (рис. 16.1).</p>
<p>Закроем окно редактирования справочника и вернемся к нашему плану видов характеристик. </p>
<p>На закладке Основные установим свойство Тип значения характеристик. Нажмем кнопку выбора и зададим составной тип
	данных следующим образом (рис. 16.2):  СправочникСсылка.Клиенты,</p>
<p> СправочникСсылка.Номенклатура,  СправочникСсылка.Субконто.</p>
<p>Бухгалтерия нашего ООО «На все руки мастер» ведет учет движения денежных средств только в разрезе материалов и
	клиентов, но не исключено, что в дальнейшем понадобится дополнительная аналитика (поэтому мы и используем справочник
	Субконто). </p>
<p>Обратите внимание, что тот справочник, который будет использован в качестве дополнительных значений характеристик,
	тоже должен входить в составной тип данных типа значений характеристик, иначе конфигуратор выдаст сообщение об
	ошибке.</p>
<p>Затем укажем, что дополнительные значения характеристик будут находиться в справочнике Субконто. </p>
<p>После этого перейдем на закладку Прочее и, нажав кнопку Предопределенные, начнем ввод предопределенных значений плана
	видов характеристик (рис. 16.3). То есть тех видов аналитического учета, в разрезе которых мы будем вести учет.</p>
<p><strong>Рис. 16.3.</strong> Предопределенные виды характеристик</p>
<p>Нажимая кнопку Добавить, создадим предопределенный вид субконто Материалы с кодом 000000001 и типом
	СправочникСсылка.Номенклатура. </p>
<p>Затем создадим вид субконто Клиенты с кодом 000000002 и типом СправочникСсылка.Клиенты.</p>
<p>На этом создание видов субконто завершено, и мы можем перейти к знакомству со следующим объектом конфигурации,
	который будет использован нами, – План счетов.</p>
<p><strong>Что такое «План счетов»</strong></p>
<p>Объект конфигурации <em>План счетов</em> предназначен для описания структуры хранения информации о совокупности
	синтетических счетов предприятия, которые созданы для группировки данных о его хозяйственной деятельности. </p>
<p>На основе объекта конфигурации План счетов платформа создает в базе данных таблицы, в которых будет храниться
	информация о том, какие счета и каким образом будет использовать предприятие. </p>
<p>Это может быть система бухгалтерских счетов, установленная государством, план управленческих счетов или произвольный
	набор счетов, используемых для анализа тех или иных видов деятельности предприятия.</p>
<p>План счетов в системе «1С:Предприятие» поддерживает иерархию субсчетов: к каждому счету первого уровня может быть
	открыто несколько субсчетов, которые, в свою очередь, могут иметь свои субсчета, и так далее. </p>
<p>Например, законодательно утвержденный план счетов для ведения бухучета в России имеет следующий вид (рис. 16.4).</p>
<p><strong>Рис. 16.4.</strong> Российский план счетов</p>
<p>По любому счету или субсчету может вестись аналитический учет в разрезе субконто, описанных в плане видов
	характеристик. Связь между планом счетов и планом видов характеристик задается разработчиком на этапе
	конфигурирования. </p>
<p>Для описания используемых субконто система создает в плане счетов специальную табличную часть ВидыСубконто, которая
	не видна в конфигураторе (но доступна средствами встроенного языка).</p>
<p>Для каждого счета есть возможность задать несколько видов учета (например, количественный и валютный). Виды учета
	задаются при помощи подчиненных объектов конфигурации <em>признак учета</em>.</p>
<p>Также существует возможность определить несколько видов учета субконто (например, суммовой, валютный или
	количественный). Виды учета субконто задаются при помощи подчиненных объектов конфигурации <em>признак учета
		субконто</em>.</p>
<p>Помимо всего вышеперечисленного каждый счет может иметь набор свойств, которые задаются в качестве реквизитов объекта
	конфигурации План счетов. Они позволяют определять уникальные свойства элементов плана счетов (например, реквизит
	ЗапретитьИспользо- ватьВПроводках).</p>
<p><strong>Добавление плана счетов</strong></p>
<p><strong>В режиме «Конфигуратор»</strong></p>
<p>Приступим к созданию плана счетов ООО «На все руки мастер». </p>
<p>Как мы говорили в начале этого занятия, бухгалтерский учет в нашем ООО «На все руки мастер» сильно упрощен. Поэтому
	план счетов, по которому работает бухгалтерия, содержит всего четыре счета: </p>
<ul>
	<li>Товары,</li>
	<li>РасчетыСПоставщиками,</li>
	<li>Капитал,</li>
	<li>Дебиторская задолженность.</li>
</ul>
<p>Добавим новый объект конфигурации План счетов. Присвоим ему имя – Основной. Свойство Представление списка зададим как
	Основной план счетов. На закладке Подсистемы укажем, что план счетов будет отображаться в подсистеме Бухгалтерия. На
	закладке Данные выделим группу реквизитов Признаки учета и, нажав кнопку Добавить, создадим признак учета
	Количественный (рис. 16.5).</p>
<p>Перейдем на закладку Субконто и укажем, что виды субконто для этого плана счетов будут находиться в плане видов
	характеристик ВидыСубконто. </p>
<p>Максимальное количество субконто на счете установим равным двум. </p>
<p>Также создадим признак учета субконто Количественный (рис. 16.6).</p>
<p>Затем откроем закладку Прочее. Нажмем кнопку Предопределенные и создадим четыре предопределенных счета (при создании
	каждого счета, перед тем как нажать кнопку Добавить, нужно выделить корень структуры счетов – строку Счета):</p>
<ul>
	<li>Товары, код 41, активный, с количественным учетом в разрезе материалов (рис. 16.7).</li>
</ul>
<p><strong>Рис. 16.7.</strong> Предопределенный счет «Товары»</p>
<ul>
	<li>РасчетыСПоставщиками, код 60, активный/пассивный (рис. 16.8).</li>
	<li>ДебиторскаяЗадолженность, код 62, активный/пассивный, в раз-</li>
</ul>
<p>резе клиентов (рис. 16.9).</p>
<ul>
	<li>Капитал, код 90, активный/пассивный (рис. 16.10).</li>
</ul>
<p><strong>Рис. 16.10.</strong> Предопределенный счет «Капитал»</p>
<p>В результате план счетов нашего ООО «На все руки мастер» будет выглядеть следующим образом (рис. 16.11).</p>
<p>Теперь мы можем перейти к знакомству с последним объектом конфигурации, который понадобится нам для организации
	бухгалтерского учета, – <em>Регистром бухгалтерии</em>.</p>
<h1><a id="_Toc454870671"></a>Лабораторная работа № 26 Работа с БД учета кадров</h1>
<p><strong>Порядок выполнения работы </strong></p>
<p>1. Ознакомьтесь с теоретическими основами в настоящих указаниях и конспектах лекций. </p>
<p>2. Получите задание у преподавателя. </p>
<p>3. Сделайте скриншоты (кнопка клавиатуры PrtSc) выполненных заданий в текстовом (Word) файле <em>Фамилия_ЛР</em></p>
<p>4. Составьте отчет по лабораторной работе. </p>
<p>5. Отчитайте работу преподавателю.</p>
<p><strong>Добавление регистра бухгалтерии</strong></p>
<p><strong>В режиме «Конфигуратор»</strong></p>
<p>Создадим новый объект конфигурации Регистр бухгалтерии. Зададим его имя – Управленческий. Свойство Расширенное
	представление списка зададим как Движения в регистре Управленческий. Укажем, что с ним будет связан план счетов
	Основной. Установим флажок Корреспон-</p>
<p>Флажок Корреспонденция будет говорить о том, что создаваемый нами регистр поддерживает корреспонденцию. Это означает,
	что каждая запись регистра имеет дебетовую и кредитовую часть, что позволит нам получать информацию не только об
	остатках и оборотах по счетам, но и о корреспонденциях между счетами. </p>
<p>Регистры, не поддерживающие корреспонденцию, применяются тогда, когда не нужно использовать принцип двойной записи,
	регламентированный в бухгалтерском учете, и, соответственно, контролировать баланс хозяйственных средств и их
	источников.</p>
<p>На закладке Подсистемы укажем, что регистр будет отображаться в подсистеме Бухгалтерия.</p>
<p>Теперь перейдем на закладку Данные и создадим два ресурса:</p>
<ul>
	<li>Сумма, длина 15, точность 2, Балансовый;</li>
	<li>Количество, длина 15, точность 3, Небалансовый, признак учета – Количественный, признак учета субконто –
		Количественный
	</li>
</ul>
<p><strong>Рис. 16.13.</strong> Свойства ресурса </p>
<p>«Количество» регистра бухгалтерии</p>
<p>В заключение сделаем видимой команду для открытия списка регистра в разделе Бухгалтерия и расположим ее после всех
	созданных нами ранее регистров. </p>
<p>Откроем командный интерфейс подсистемы Бухгалтерия из контекстного меню этой подсистемы, выделив ее в списке
	подсистем в дереве объектов конфигурации. В группе Панель навигации.Обычное включим видимость у команды
	Управленческий и мышью перетащим ее в группу Панель навигации.См. также. </p>
<p>На этом создание нашего регистра бухгалтерии завершено. </p>
<p>Теперь настало время познакомиться с тем, каким образом используется созданный нами регистр бухгалтерии
	Управленческий.</p>
<p><strong>Доработка приходной накладной</strong></p>
<p>Что нас ждет дальше? </p>
<p>Сначала мы доработаем оба наши документа (ПриходнаяНакладная и ОказаниеУслуги) так, чтобы они «поставляли» данные не
	только для регистров накопления, но и для регистра бухгалтерии. </p>
<p>Затем мы создадим бухгалтерский отчет Оборотно-сальдовая ведомость, который будет показывать нам состояние
	товародвижения в ООО «На все руки мастер», основываясь на данных регистра бухгалтерии.</p>
<p>При проведении наши документы будут создавать следующие бухгалтерские проводки – записи в регистре бухгалтерии
	(таблица 16.1).</p>
<p><strong>таблица 16.1.</strong> Проводки, создаваемые документами</p>
<table>
	<tr>
		<td rowspan="2"><p><strong>документы</strong></p></td>
		<td colspan="2"><p><strong>проводки</strong></p></td>
		<td colspan="2"></td>
		<td></td>
	</tr>
	<tr>
		<td colspan="2"><p><strong>дебет</strong></p></td>
		<td colspan="2"><p><strong>кредит</strong></p></td>
		<td><p><strong>сумма</strong></p></td>
	</tr>
	<tr>
		<td><p>Приходная накладная</p></td>
		<td><p>41</p></td>
		<td><p>Товары</p></td>
		<td><p>60</p></td>
		<td><p>Расчеты с поставщиками</p></td>
		<td><p>Стоимость</p></td>
	</tr>
	<tr>
		<td rowspan="2"><p>Оказание услуги</p></td>
		<td><p>62</p></td>
		<td><p>Дебиторская задолженность</p></td>
		<td><p>90</p></td>
		<td><p>Капитал</p></td>
		<td><p>Выручка</p></td>
	</tr>
	<tr>
		<td><p>90</p></td>
		<td><p>Капитал</p></td>
		<td><p>41</p></td>
		<td><p>Товары</p></td>
		<td><p>Стоимость</p></td>
	</tr>
</table>
<p>Эти проводки мы отразим при создании движений документов в регистре бухгалтерии.</p>
<p>Итак, сначала изменим процедуру проведения документа ПриходнаяНакладная, а затем в режиме 1С:Предприятие перепроведем
	все эти документы, чтобы отработал новый, измененный нами алгоритм проведения документа ПриходнаяНакладная. </p>
<p><strong>В режиме «Конфигуратор»</strong></p>
<p>В окне редактирования объекта конфигурации Документ ПриходнаяНакладная перейдем на закладку Движения. В списке
	регистров отметим, что документ будет создавать теперь движения и по регистру бухгалтерии Управленческий. Перейдем
	на закладку Прочее и откроем модуль объекта. Откроем процедуру обработчика события ОбработкаПроведения. В самом
	конце цикла перед строкой КонецЦикла добавим строки кода, создающие движения регистра Управленческий (листинг
	16.1).</p>
<p><strong>листинг 16.1.</strong> Движения документа «ПриходнаяНакладная» (фрагмент)</p>
<table>
	<tr>
		<td><p><strong>// Регистр Управленческий </strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>Движение = Движения.Управленческий.Добавить();</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>Движение.СчетДт = ПланыСчетов.Основной.Товары;</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>Движение.СчетКт = ПланыСчетов.Основной.РасчетыСПоставщиками;</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>Движение.Период = Дата;</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>Движение.Сумма = ТекСтрокаМатериалы.Сумма;</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>Движение.КоличествоДт = ТекСтрокаМатериалы.Количество;</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>Движение.СубконтоДт[ПланыВидовХарактеристик.ВидыСубконто.Материалы] = </strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>ТекСтрокаМатериалы.Материал;</strong></p></td>
	</tr>
</table>
<p>Перед началом цикла установим свойство Записывать набора записей регистра Управленческий в значение Истина для записи
	изменений регистра в базу данных. </p>
<p>В результате процедура ОбработкаПроведения будет выглядеть следующим образом (листинг 16.2). <strong>листинг
	16.2.</strong> Движения документа «ПриходнаяНакладная»</p>
<table>
	<tr>
		<td><p>Процедура ОбработкаПроведения(Отказ, Режим)</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движения.ОстаткиМатериалов.Записывать = Истина;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движения.СтоимостьМатериалов.Записывать = Истина;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>Движения.Управленческий.Записывать = Истина;</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Для Каждого ТекСтрокаМатериалы Из Материалы Цикл</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// Регистр ОстаткиМатериалов Приход</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение = Движения.ОстаткиМатериалов.Добавить();</p></td>
	</tr>
</table>
<p>Движение.ВидДвижения = ВидДвиженияНакопления.Приход;</p>
<p>Движение.Период = Дата;</p>
<p>Движение.Материал = ТекСтрокаМатериалы.Материал;</p>
<table>
	<tr>
		<td><p>Движение.НаборСвойств = ТекСтрокаМатериалы.НаборСвойств;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.Склад = Склад;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.Количество = ТекСтрокаМатериалы.Количество;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// Регистр Стоимость Материалов Приход</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение = Движения.СтоимостьМатериалов.Добавить();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.ВидДвижения = ВидДвиженияНакопления.Приход;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.Период = Дата;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.Материал = ТекСтрокаМатериалы.Материал;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.Стоимость = ТекСтрокаМатериалы.Сумма;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>// Регистр Управленческий </strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>Движение = Движения.Управленческий.Добавить();</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>Движение.СчетДт = ПланыСчетов.Основной.Товары;</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>Движение.СчетКт = ПланыСчетов.Основной.РасчетыСПоставщиками;</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>Движение.Период = Дата;</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>Движение.Сумма = ТекСтрокаМатериалы.Сумма;</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>Движение.КоличествоДт = ТекСтрокаМатериалы.Количество;</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>Движение.СубконтоДт[ПланыВидовХарактеристик.ВидыСубконто.Материалы] = </strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>ТекСтрокаМатериалы.Материал;</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецЦикла;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецПроцедуры</p></td>
	</tr>
</table>
<p>Прокомментируем этот код.</p>
<p>Как видите, движения для регистра бухгалтерии формируются таким же образом, как и для регистра накопления. </p>
<p>Но платформа (при создании таблицы хранения данных) добавила к созданным нами реквизитам регистра еще ряд полей,
	которые явились следствием использования плана счетов Основной. </p>
<p>Прежде всего, это поля СчетДт и СчетКт. В этих полях указываются счета, дебет и кредит которых затрагивает данная
	проводка. </p>
<p>Кроме этого, для измерений и ресурсов регистра, связанных с признаками учета, платформа создает пару полей для
	хранения значения каждого ресурса отдельно по дебету и отдельно по кредиту проводки – КоличествоДт и КоличествоКт. А
	также для счетов, по которым ведется учет в разрезе субконто, платформа создает коллекции СубконтоДт и
	СубконтоКт.</p>
<p>Если обратиться к таблице 16.1, то при проведении приходной накладной счетом по дебету должен быть счет Товары (41),
	а счетом по кредиту – счет РасчетыСПоставщиками (60). </p>
<p>К счету мы обращаемся с помощью свойства глобального контекста ПланыСчетов. Оно предоставляет доступ ко всем планам
	счетов, созданным в конфигурации. Через точку от него мы указываем имя нужного нам плана счетов – Основной. А далее,
	тоже через точку, указываем имя предопределенного счета в этом плане счетов – Товары. Этот счет (и три других) мы
	создали в конфигураторе.</p>
<p>Так как количественный учет у нас ведется только для счета Товары (41), то поле регистра КоличествоДт заполняется
	количеством товара из табличной части документа. Поле регистра КоличествоКт не заполняется, так как по счету кредита
	проводки (РасчетыСПоставщиками) количественный учет не ведется.</p>
<p>Теперь рассмотрим последнюю строку цикла, в которой присваивается значение субконто дебета.</p>
<p>Дело в том, что количество субконто на счете дебета и на счете кредита в каждой проводке будет различное, в
	зависимости от того, как определены счета в используемом плане счетов. Поэтому для каждой записи движения регистра
	бухгалтерии платформа хранит две коллекции значений: коллекцию субконто дебета и коллекцию субконто кредита. Каждая
	из них содержит ровно столько элементов, сколько видов субконто указано использовать для соответствующего счета
	(дебета или кредита) в плане счетов. </p>
<p>Обратиться к элементу коллекции можно, указав в квадратных скобках ссылку на соответствующий вид субконто
	(ПланыВидовХарактеристик.ВидыСубконто.Материалы). </p>
<p>Другой способ – в явном виде указать имя предопределенного вида субконто через точку от коллекции субконто
	дебета.</p>
<p>Другими словами, запись Движение.СубконтоДт[ПланыВидовХарактеристик.ВидыСубконто.Материалы] равносильна записи
	Движение.СубконтоДт.Материалы.</p>
<p>Коллекция регистра СубконтоКт не заполняется, так как по счету кредита проводки (РасчетыСПоставщиками) учет в разрезе
	субконто у нас не ведется.</p>
<p>В заключение отредактируем командный интерфейс формы документа, чтобы в панели навигации формы иметь возможность
	переходить к списку записей регистра Управленческий, связанному с документом. </p>
<p>Для этого откроем форму документа ПриходнаяНакладная. В левом верхнем окне перейдем на закладку Командный интерфейс.
	В разделе Панель навигации раскроем группу Перейти и установим видимость для команды открытия регистра бухгалтерии
	Управленческий. </p>
<p><strong>В режиме «1С:Предприятие»</strong></p>
<p>Запустим «1С:Предприятие» в режиме отладки. </p>
<p>Платформа предупредит нас, что регистр бухгалтерии Управленческий и справочник Субконто не включены ни в одну
	подсистему. Проигнорируем это сообщение.</p>
<p>Откроем документ Приходная накладная № 1 и нажмем Провести. </p>
<p>Выполним команду перехода к регистру Управленческий и посмотрим, какие движения сформировал документ в регистре
	бухгалтерии </p>
<p>(рис. 16.14, 16.15). </p>
<p><strong>Рис. 16.14.</strong> Движения документа «Приходная накладная № 1» в регистре бухгалтерии «Управленческий»</p>
<p><strong>Рис. 16.15.</strong> Движения документа «Приходная накладная № 1» в регистре бухгалтерии «Управленческий»</p>
<p>Обратите внимание: поскольку на счете 60 (РасчетыСПоставщиками) отсутствует аналитика и ведется только суммовой учет,
	в записях движений регистра Субконто1Кт, Субконто2Кт и КоличествоКт не указаны.</p>
<p>После этого перепроведем документ Приходная накладная № 2 и убедимся, что он тоже формирует правильные проводки по
	регистру бухгалтерии Управленческий.</p>
<p>Теперь перейдем к более сложной задаче: добавлению движений по регистру Управленческий в документ ОказаниеУслуги.
	<strong>Доработка документа «Оказание услуги» </strong></p>
<p>Сначала мы изменим процедуру проведения документа ОказаниеУслуги, а затем в режиме 1С:Предприятие перепроведем все
	эти документы, чтобы отработал новый, измененный нами алгоритм проведения документов Оказание услуги. </p>
<p><strong>В режиме «Конфигуратор»</strong></p>
<p>В отличие от документа ПриходнаяНакладная, который создавал всего одну бухгалтерскую проводку, документ
	ОказаниеУслуги будет создавать уже две.</p>
<p>Напомним, что бухгалтерия нашего ООО «На все руки мастер» не совсем похожа на настоящую, потому что для облегчения
	своей работы она учитывает только движения материалов. Услуги, которые оказывает организация, для нее как бы не
	существуют. </p>
<p>Поэтому документ ОказаниеУслуги будет формировать движения по регистру бухгалтерии только в той части, которая
	касается расходования материалов.</p>
<p>В окне редактирования объекта конфигурации Документ ОказаниеУслуги перейдем на закладку Движения. В списке регистров
	отметим, что документ будет создавать теперь движения и по регистру Управленческий. Перейдем на закладку Прочее и
	откроем модуль объекта. Откроем процедуру обработчика события ОбработкаПроведения. </p>
<p>Поскольку нас интересует только движение материалов, для внесения дополнений подойдет тело условия Если…, в котором
	мы формировали движения по регистрам ОстаткиМатериалов и СтоимостьМатериалов. </p>
<p>Добавим в конец условия, перед строкой КонецЕсли, движения по регистру бухгалтерии Управленческий (листинг 16.3).</p>
<p>В первой проводке мы указываем розничную сумму материала из документа и субконто дебета, поскольку на счете
	Дебиторская задолженность ведется учет в разрезе клиентов.</p>
<p><strong>листинг 16.3.</strong> Движения документа «ОказаниеУслуги» (фрагмент)</p>
<p>…</p>
<table>
	<tr>
		<td><p>Если ВыборкаДетальныеЗаписи.ВидНоменклатуры = </p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Перечисления.ВидыНоменклатуры.Материал Тогда </p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// Регистр ОстаткиМатериалов Расход</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p> …</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// Регистр СтоимостьМатериалов Расход</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p> …</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>// Регистр Управленческий </strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>// Первая проводка: Д 62(ДебиторскаяЗадолженность) – К 90 (Капитал) Розничная сумма</strong></p>
		</td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>Движение = Движения.Управленческий.Добавить();</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>Движение.СчетДт = ПланыСчетов.Основной.ДебиторскаяЗадолженность;</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>Движение.СчетКт = ПланыСчетов.Основной.Капитал;</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>Движение.Период = Дата;</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>Движение.Сумма = ВыборкаДетальныеЗаписи.СуммаВДокументе;</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>Движение.СубконтоДт[ПланыВидовХарактеристик.ВидыСубконто.Клиенты] = Клиент;</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>// Вторая проводка: Д 90 (Капитал) – К 41 (Товары) – себестоимость</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>Движение = Движения.Управленческий.Добавить();</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>Движение.СчетДт = ПланыСчетов.Основной.Капитал;</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>Движение.СчетКт = ПланыСчетов.Основной.Товары;</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>Движение.Период = Дата;</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>Движение.Сумма = СтоимостьМатериала * ВыборкаДетальныеЗаписи.КоличествоВДокументе;</strong></p>
		</td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>Движение.КоличествоКт = ВыборкаДетальныеЗаписи.КоличествоВДокументе;</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>Движение.СубконтоКт[ПланыВидовХарактеристик.ВидыСубконто.Материалы] = </strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>ВыборкаДетальныеЗаписи.Номенклатура;</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецЕсли;</p></td>
	</tr>
	<tr>
		<td><p>…</p></td>
	</tr>
</table>
<p>Во второй проводке мы указываем стоимость материала, количество и субконто кредита, поскольку на счете Товары ведется
	количественный учет в разрезе материалов.</p>
<p>Теперь в самом начале процедуры установим свойство Записывать регистра бухгалтерии в значение Истина для записи
	изменений регистров в базу данных (листинг 16.4). <strong>листинг 16.4.</strong> Запись движений регистров</p>
<table>
	<tr>
		<td><p>Процедура ОбработкаПроведения(Отказ, Режим) </p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движения.ОстаткиМатериалов.Записывать = Истина;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движения.СтоимостьМатериалов.Записывать = Истина;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движения.Продажи.Записывать = Истина; </p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>Движения.Управленческий.Записывать = Истина; </strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>…</p></td>
	</tr>
</table>
<p>В заключение отредактируем командный интерфейс формы документа, чтобы в панели навигации формы иметь возможность
	переходить к списку записей регистра Управленческий, связанному с документом. Для этого откроем форму документа
	ОказаниеУслуги. В левом верхнем окне перейдем на закладку Командный интерфейс. В разделе Панель навигации раскроем
	группу Перейти и установим видимость для команды открытия регистра бухгалтерии Управленческий. </p>
<p><strong>В режиме «1С:Предприятие»</strong></p>
<p>Запустим «1С:Предприятие» в режиме отладки, откроем документ Оказание услуги № 1 и нажмем Провести. </p>
<p>Выполним команду перехода к регистру Управленческий и посмотрим, какие движения сформировал документ в регистре
	бухгалтерии </p>
<p>(рис. 16.16, 16.17). </p>
<p><strong>Рис. 16.16.</strong> Движения документа «Оказание услуги № 1» в регистре бухгалтерии «Управленческий»</p>
<p><strong>Рис. 16.17.</strong> Движения документа «Оказание услуги № 1» в регистре бухгалтерии «Управленческий»</p>
<p>После этого перепроведем остальные документы Оказание услуги.</p>
<p><strong>Оборотно-сальдовая ведомость</strong></p>
<p>Теперь нам только осталось создать отчет для бухгалтерии предприятия «На все руки мастер», и наше знакомство с
	использованием регистра бухгалтерии будет закончено. </p>
<p>Единственный отчет, которым пользуется бухгалтерия нашего предприятия, – это отчет Оборотно-сальдовая ведомость (рис.
	16.18).</p>
<p>Для того чтобы его создать, откроем конфигуратор и добавим новый объект конфигурации Отчет с именем
	ОборотноСальдоваяВедомость. Создадим новую схему компоновки данных и добавим Набор данных – запрос. Откроем
	конструктор запроса.</p>
<p><strong>Запрос для набора данных</strong></p>
<p>Бухгалтерский отчет Оборотно-сальдовая ведомость представляет собой таблицу, в строках которой перечислены все
	имеющиеся в плане счетов счета, а в колонках – начальное сальдо, оборот и конечное сальдо по дебету и кредиту
	каждого счета.</p>
<p>Поэтому нам для построения такого отчета понадобятся две исходные таблицы: </p>
<ul>
	<li>объектная (ссылочная) таблица плана счетов Основной;</li>
	<li>виртуальная таблица регистра бухгалтерии Управленческий.ОстаткиИОбороты (рис. 16.19).</li>
</ul>
<p><strong>Рис. 16.19.</strong> Таблицы запроса</p>
<p>Из таблицы Основной мы выберем поле Ссылка, а из таблицы УправленческийОстаткиИОбороты возьмем следующие поля (рис.
	16.20):</p>
<ul>
	<li>СуммаНачальныйРазвернутыйОстатокДт,</li>
	<li>СуммаНачальныйРазвернутыйОстатокКт,</li>
	<li>СуммаОборотДт,</li>
	<li>СуммаОборотКт,</li>
	<li>СуммаКонечныйРазвернутыйОстатокДт,  СуммаКонечныйРазвернутыйОстатокКт.</li>
</ul>
<p><strong>Рис. 16.20.</strong> Выбранные поля</p>
<p>Перейдем на закладку Связи и укажем, что из таблицы Основной мы будем выбирать все записи, а из таблицы регистра –
	только те, которые соответствуют условию связи (рис. 16.21). </p>
<p>Затем на закладке Объединения/Псевдонимы зададим псевдонимы полей отчета: Счет, СальдоНачДт, СальдоНачКт, ОборотДт,
	ОборотКт, СальдоКонДт и СальдоКонКт (рис. 16.22). </p>
<p>На этом создание запроса закончено, нажмем ОK.</p>
<p><strong>Ресурсы</strong></p>
<p>Перейдем на закладку Ресурсы и с помощью кнопки Добавить все ресурсы (&gt;&gt;) выберем все доступные ресурсы.</p>
<p><strong>Параметры</strong></p>
<p>Бухгалтерские отчеты, как правило, формируются для определенного периода: месяц, квартал, год и т. д. Поэтому на
	примере нашего отчета продемонстрируем использование стандартного периода для указания периода отчета.</p>
<p>На закладке Параметры добавим параметр с именем Период типа СтандартныйПериод, а для параметров НачалоПериода и
	КонецПериода укажем Выражение для расчета и запретим их редактирование пользователем (листинг 16.5).</p>
<p><strong>листинг 16.5.</strong> Выражение для расчета параметров «НачалоПериода» и «КонецПериода»</p>
<table>
	<tr>
		<td><p>&amp;Период.ДатаНачала</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>&amp;Период.ДатаОкончания</p></td>
	</tr>
</table>
<p>Поскольку бухгалтерские отчеты всегда формируются за определенный период, для параметра Период в колонке
	Использование укажем значение Всегда. В результате в отчетной форме не будет доступен признак использования
	отчетного периода (флажок слева от параметра), и параметр будет использоваться всегда, независимо от желания
	пользователя.</p>
<p>Таким образом, параметры компоновки данных примут вид </p>
<p>(рис. 16.23).</p>
<p><strong>Рис. 16.23.</strong> Параметры схемы компоновки данных</p>
<p>Заметим, что даты начала и конца стандартного периода также содержат и время. Однако здесь, в отличие от параметров
	НачалоПериода и КонецПериода, начальная дата имеет время 00:00:00, а конечная дата – 23:59:59. Таким образом,
	последний день включается в отчет, и не нужно использовать функцию КонецПериода().</p>
<p><strong>Настройки</strong></p>
<p>В заключение перейдем на закладку Настройки и создадим структуру отчета. Добавим группировку, содержащую детальные
	записи. Затем на закладке Выбранные поля выберем поле Счет, затем реквизит этого поля Наименование (для этого
	раскроем поле Счет), а также все остальные поля для вывода в отчет и разместим их в следующем порядке (рис.
	16.24): </p>
<p><strong>Рис. 16.24.</strong> Поля и группировки отчета</p>
<p>На закладке Другие настройки укажем заголовок отчета – Оборотно-сальдовая ведомость. Для параметра Расположение общих
	итогов по вертикали укажем значение Начало и конец. </p>
<p>Затем на закладке Параметры выберем для параметра Период значение из списка стандартных периодов – Этот месяц (рис.
	16.25). </p>
<p><strong>Рис. 16.25.</strong> Создание быстрых настроек отчетного периода</p>
<p>Тем самым мы обеспечим, что при открытии формы отчета в настройке отчетного периода всегда будет указан текущий
	месяц. Причем даты начала и конца периода будут динамически меняться в зависимости от даты выполнения отчета. А
	также, нажав кнопку </p>
<p>Свойства элемента пользовательских настроек, укажем, что параметр Период будет включен в состав пользовательских
	настроек, и эта настройка будет находиться непосредственно в отчетной форме (режим редактирования Быстрый
	доступ). </p>
<p>В заключение определим, в каких подсистемах будет отображаться наш отчет. </p>
<p>Закроем конструктор схемы компоновки данных и в окне редактирования объекта конфигурации Отчет
	ОборотноСальдоваяВедомость перейдем на закладку Подсистемы. </p>
<p>Отметим в списке подсистем конфигурации подсистему Бухгалтерия. </p>
<p><strong>В режиме «1С:Предприятие»</strong></p>
<p>Запустим «1С:Предприятие» в режиме отладки и посмотрим, как работает отчет. </p>
<p>В разделе Бухгалтерия откроем отчет и нажмем Сформировать </p>
<p>(рис. 16.26). </p>
<p>Мы видим, что стандартный период отчета задан по умолчанию – Этот месяц. Пользоваться стандартным периодом отчета
	очень удобно, когда пользователь регулярно выполняет отчет за определенный интервал времени. Тогда можно заранее
	установить в настройках нужный период, и пользователю не придется задавать его перед формированием отчета. Но при
	желании в режиме 1С:Предприятие пользователь может выбрать другой период из списка стандартных периодов.</p>
<h1><a id="_Toc454870672"></a>Лабораторная работа № 27 Основные конструкции языка 1С</h1>
<p><strong>Порядок выполнения работы </strong></p>
<p>1. Ознакомьтесь с теоретическими основами в настоящих указаниях и конспектах лекций. </p>
<p>2. Получите задание у преподавателя. </p>
<p>3. Сделайте скриншоты (кнопка клавиатуры PrtSc) выполненных заданий в текстовом (Word) файле <em>Фамилия_ЛР</em></p>
<p>4. Составьте отчет по лабораторной работе. </p>
<p>5. Отчитайте работу преподавателю.</p>
<p><strong>Добавление плана видов расчета</strong></p>
<p>Приступим теперь к созданию плана видов расчета ОсновныеНачисления, который будет использоваться в нашей
	конфигурации.</p>
<p><strong>В режиме «Конфигуратор»</strong></p>
<p>Откроем конфигуратор и создадим новый объект конфигурации План видов расчета. </p>
<p>Зададим его имя – ОсновныеНачисления, а также зададим Представление списка как Виды расчетов.</p>
<p>На закладке Подсистемы укажем, что план видов расчета будет отображаться в подсистеме РасчетЗарплаты.</p>
<p>На закладке Расчет укажем, что он будет использовать период действия и зависеть от базы по периоду действия. </p>
<p>В качестве базового плана видов расчета укажем его самого, поскольку все наши виды расчетов будут храниться в
	единственном плане видов расчета (рис. 17.4).</p>
<p>зависимость от базы и базовые планы видов расчета</p>
<p>Перейдем на закладку Прочее и зададим предопределенные виды расчета. </p>
<p>Как и в случае с бухгалтерией, расчеты в нашем ООО «На все руки мастер» будут скромные, поэтому мы создадим всего три
	элемента (рис. 17.5):</p>
<ul>
	<li>Невыход – с именем и наименованием Невыход и кодом Невыход;</li>
	<li>Оклад – с именем, кодом и наименованием Оклад, с вытесняющим его видом расчета Невыход и ведущим видом расчета
		Невыход;
	</li>
	<li>Премия – с именем, кодом и наименованием Премия, с базовым видом расчета Оклад и ведущими видами расчета
		Невыход
	</li>
</ul>
<p>«ОсновныеНачисления»</p>
<p>Теперь мы перейдем к рассмотрению второго объекта, используемого при реализации механизмов сложных периодических
	расчетов, – регистра расчета.</p>
<p><strong>Что такое регистр расчета</strong></p>
<p>Объект конфигурации <em>Регистр расчета</em> предназначен для описания структуры накопления данных, являющихся
	результатами расчетов. На основе объекта конфигурации Регистр расчета платформа создает в базе данных таблицы, в
	которых будут накапливаться данные, формируемые различными объектами базы данных. </p>
<p>Отличительной особенностью регистра расчета является то, что он не предназначен для интерактивного редактирования
	пользователем. Разработчик может при необходимости предоставить пользователю возможность редактировать регистр
	расчета, но предназначение регистра расчета заключается в том, чтобы его модификация производилась на основе
	алгоритмов работы объектов базы данных, а не в результате непосредственных действий пользователя.</p>
<p>Как и другие регистры, регистр расчета имеет ресурсы, в которых хранит числовые данные; имеет измерения, в разрезе
	которых можно получать значения ресурсов регистра; имеет реквизиты, которые характеризуют каждую запись регистра
	расчета. </p>
<p>Отличительными же особенностями регистра расчета является его периодичность, возможность использования механизмов
	вытеснения по периоду действия и зависимости по базовому периоду, а также связь с планом видов расчета. Рассмотрим
	все эти особенности по порядку.</p>
<p><strong>Периодичность</strong></p>
<p>Периодичность регистра расчета может быть определена одним из следующих значений:</p>
<ul>
	<li>День,</li>
	<li>Месяц,  Квартал,  Год.</li>
</ul>
<p>Периодичность регистра расчета определяет промежуток времени, к которому будет относиться каждая запись
	регистра. </p>
<p>Если указана периодичность День, то каждая запись регистра будет относиться к какому-либо дню; если периодичность –
	Месяц, то к какому-либо месяцу и т. д. </p>
<p>Для указания факта принадлежности записи к какому-либо периоду регистр имеет служебный реквизит ПериодРегистрации
	типа Дата. При записи данных в регистр платформа всегда приводит значение этого реквизита к началу того периода, в
	который он попадает. </p>
<p>Например, если в регистр расчета с периодичностью месяц записать данные, где ПериодРегистрации задан как 08.04.2004,
	то регистр сохранит эти данные со значением поля ПериодРегистрации 01.04.2004 (рис. 17.6).</p>
<p>Если в этой же ситуации периодичность регистра будет год, сохраненное значение периода регистрации будет 01.01.2004
	(рис. 17.7).</p>
<p><img src="61.jpeg"/></p>
<p><strong>Рис. 17.6.</strong> Запись данных из документа в регистр расчета видов расчета</p>
<p><img src="62.jpeg"/></p>
<p><strong>Рис. 17.7.</strong> Запись данных из документа в регистр расчета видов расчета</p>
<p><strong>Вытеснение по периоду действия</strong></p>
<p>Следующей важной особенностью регистра расчета является возможность использования механизма вытеснения одних записей
	другими по периоду действия. </p>
<p>При этом для каждой записи регистр расчета формирует фактический период действия, который является в общем случае
	совокупностью нескольких периодов, расположенных внутри периода действия (рис. 17.8).</p>
<p><img src="63.jpeg"/></p>
<p><strong>Рис. 17.8.</strong> Запись расчета «Невыход» вытесняет запись расчета «Оклад» по периоду действия</p>
<p>Если рассмотреть структуру записей таблиц регистра расчета, то после внесения записи о начислении по окладу таблицы
	регистра будут выглядеть следующим образом (таблицы 17.1, 17.2).</p>
<p><strong>таблица 17.1.</strong> Таблица регистра расчета</p>
<table>
	<tr>
		<td><p><strong>…</strong></p></td>
		<td><p><strong>начало периода действия</strong></p></td>
		<td><p><strong>конец периода действия</strong></p></td>
		<td><p><strong>Вид расчета</strong></p></td>
		<td><p><strong>…</strong></p></td>
	</tr>
	<tr>
		<td><p>…</p></td>
		<td><p>…</p></td>
		<td><p>…</p></td>
		<td><p>…</p></td>
		<td><p>…</p></td>
	</tr>
	<tr>
		<td><p>…</p></td>
		<td><p>01.04.2013 00:00:00</p></td>
		<td><p>30.04.2013 23:59:59</p></td>
		<td><p>Оклад</p></td>
		<td><p>…</p></td>
	</tr>
	<tr>
		<td><p>…</p></td>
		<td><p>…</p></td>
		<td><p>…</p></td>
		<td><p>…</p></td>
		<td><p>…</p></td>
	</tr>
</table>
<p><strong>таблица 17.2.</strong> Таблица фактического периода действия </p>
<table>
	<tr>
		<td><p><strong>…</strong></p></td>
		<td><p><strong>начало периода действия</strong></p></td>
		<td><p><strong>конец периода действия</strong></p></td>
		<td><p><strong>Вид расчета</strong></p></td>
		<td><p><strong>…</strong></p></td>
	</tr>
	<tr>
		<td><p>…</p></td>
		<td><p>…</p></td>
		<td><p>…</p></td>
		<td><p>…</p></td>
		<td><p>…</p></td>
	</tr>
	<tr>
		<td><p>…</p></td>
		<td><p>01.04.2013 00:00:00</p></td>
		<td><p>30.04.2013 23:59:59</p></td>
		<td><p>Оклад</p></td>
		<td><p>…</p></td>
	</tr>
	<tr>
		<td><p>…</p></td>
		<td><p>…</p></td>
		<td><p>…</p></td>
		<td><p>…</p></td>
		<td><p>…</p></td>
	</tr>
</table>
<p>После добавления в регистр записи вида расчета Невыход, который вытесняет вид расчета Оклад по периоду действия,
	записи о начислении по окладу примут следующий вид (таблицы 17.3, 17.4).</p>
<p><strong>таблица 17.3.</strong> Таблица регистра расчета</p>
<table>
	<tr>
		<td><p><strong>…</strong></p></td>
		<td><p><strong>начало периода действия</strong></p></td>
		<td><p><strong>конец периода действия</strong></p></td>
		<td><p><strong>Вид расчета</strong></p></td>
		<td><p><strong>…</strong></p></td>
	</tr>
	<tr>
		<td><p>…</p></td>
		<td><p>…</p></td>
		<td><p>…</p></td>
		<td><p>…</p></td>
		<td><p>…</p></td>
	</tr>
	<tr>
		<td><p>…</p></td>
		<td><p>01.04.2013 00:00:00</p></td>
		<td><p>30.04.2013 23:59:59</p></td>
		<td><p>Оклад</p></td>
		<td><p>…</p></td>
	</tr>
	<tr>
		<td><p>…</p></td>
		<td><p>04.04.2013 00:00:00</p></td>
		<td><p>10.04.2013 23:59:59</p></td>
		<td><p>Невыход</p></td>
		<td><p>…</p></td>
	</tr>
	<tr>
		<td><p>…</p></td>
		<td><p>…</p></td>
		<td><p>…</p></td>
		<td><p>…</p></td>
		<td><p>…</p></td>
	</tr>
</table>
<p><strong>таблица 17.4.</strong> Таблица фактического периода действия</p>
<table>
	<tr>
		<td><p><strong>…</strong></p></td>
		<td><p><strong>начало периода действия</strong></p></td>
		<td><p><strong>конец периода действия</strong></p></td>
		<td><p><strong>Вид расчета</strong></p></td>
		<td><p><strong>…</strong></p></td>
	</tr>
	<tr>
		<td><p>…</p></td>
		<td><p>…</p></td>
		<td><p>…</p></td>
		<td><p>…</p></td>
		<td><p>…</p></td>
	</tr>
	<tr>
		<td><p>…</p></td>
		<td><p>01.04.2013 00:00:00</p></td>
		<td><p>03.04.2013 23:59:59</p></td>
		<td><p>Оклад</p></td>
		<td><p>…</p></td>
	</tr>
	<tr>
		<td><p>…</p></td>
		<td><p>11.04.2013 00:00:00</p></td>
		<td><p>31.04.2013 23:59:59</p></td>
		<td><p>Оклад</p></td>
		<td><p>…</p></td>
	</tr>
	<tr>
		<td><p>…</p></td>
		<td><p>…</p></td>
		<td><p>…</p></td>
		<td><p>…</p></td>
		<td><p>…</p></td>
	</tr>
</table>
<p><strong>Зависимость по базовому периоду</strong></p>
<p>Другим механизмом, который поддерживает регистр расчета, является зависимость записей по базовому периоду. Этот
	механизм позволяет основывать расчет зависимых (вторичных) записей регистра на данных, полученных в результате
	расчета первичных записей. </p>
<p>Регистр расчета может поддерживать два вида зависимости от базы: зависимость по периоду действия и зависимость по
	периоду регистрации.</p>
<p><strong>Зависимость по периоду действия</strong></p>
<p>Зависимость по периоду действия означает, что при анализе базовых записей будут выбираться те, для которых найдено
	пересечение их фактического периода действия и указанного базового периода. </p>
<p>Например, в начале апреля производится расчет зарплаты за март. Премия за март должна быть начислена исходя из оплаты
	по окладу за март. В этом случае, как правило, используется зависимость по периоду действия (рис. 17.9).</p>
<p><img src="64.jpeg"/></p>
<p><strong>Рис. 17.9.</strong> Зависимость по периоду действия</p>
<p>Следует сделать два замечания к приведенному рисунку.</p>
<p>Поля Начало базового периода и Конец базового периода имеют смысл только для записей тех видов расчета, для которых
	определена зависимость по базовому периоду (в нашем случае для записи расчета премии).</p>
<p>Значение базы, которая будет получена от конкретной влияющей записи, в общем случае не равно результату, который
	содержит эта запись. База будет рассчитана пропорционально тому, какую часть от фактического интервала влияющей
	записи составляет перекрывающийся с указанным базовым периодом участок. При этом будут использованы данные графика,
	связанного с записью.</p>
<p><strong>Зависимость по периоду регистрации</strong></p>
<p>Зависимость по периоду регистрации означает, что при анализе базовых записей будут выбираться те, которые попадают в
	указанный базовый период значением своего поля Период регистрации. </p>
<p>В качестве примера можно привести расчет штрафов при начислении зарплаты за март. В качестве базы для расчета суммы
	штрафов должны браться записи о прогулах, зарегистрированные в марте месяце (это могут быть как записи о мартовских
	прогулах, так и записи о прогулах в феврале). В этом случае, как правило, используется зависимость по периоду
	регистрации (рис. 17.10).</p>
<p><img src="65.jpeg"/></p>
<p><strong>Рис. 17.10.</strong> Зависимость по периоду регистрации</p>
<p>Важной заключительной особенностью регистра расчета является его связь с планом видов расчета. Именно на основе этой
	связи работают механизмы вытеснения по периоду действия и зависимости по базовому периоду, поскольку в плане видов
	расчета описано взаимное влияние видов расчета друг на друга.</p>
<p>У регистра расчета могут существовать подчиненные объекты <em>Перерасчет</em>. Они предназначены для регистрации
	фактов появления в регистре записей, влияющих на результат расчета уже существующих записей регистра. Объект
	конфигурации Перерасчет может иметь несколько измерений, каждое из которых устанавливает связь между измерениями
	данного регистра расчета и влияющих регистров расчета. В частном случае это может быть один и тот же регистр. </p>
<p>В таблице, созданной в базе данных на основе объекта конфигурации Перерасчет, платформа хранит информацию о том,
	какие записи регистра подлежат перерасчету. Таблицы перерасчета заполняются автоматически как на основании записей
	регистров расчета, затронутых ведущими видами расчета, так и на основании записей регистра расчета, для которых
	изменился фактический период действия. Исходя из этой информации, разработчик может принимать решение о
	необходимости перерасчета записей регистра.</p>
<p>Последним замечанием, которое следует сделать, говоря о регистре расчета, является возможность установки связи
	регистра расчета с графиком. Такой график должен представлять собой регистр сведений (непериодический, с
	обязательным измерением типа Дата и ресурсом типа Число), в котором содержится временная схема исходных данных,
	участвующих в расчетах. Измерениями этого графика могут быть, например, график работы (ссылка на справочник) и дата,
	а ресурсом – количество рабочих часов в этой дате. В этом случае можно будет связать запись регистра расчета с
	какимлибо конкретным графиком работы (указав в качестве реквизита записи ссылку на справочник ВидыГрафиковРаботы) и
	в дальнейшем средствами встроенного языка получать информацию о количестве рабочих часов в периоде действия,
	фактическом периоде действия или периоде регистрации этой записи.</p>
<p><strong>Добавление регистра расчета</strong></p>
<p>Прежде чем мы начнем создавать объект конфигурации Регистр расчета Начисления, нам потребуется создать два
	дополнительных объекта конфигурации:</p>
<ul>
	<li>регистр сведений ГрафикиРаботы,</li>
	<li>справочник ВидыГрафиковРаботы.</li>
</ul>
<p>Справочник понадобится нам для хранения информации о том, какие графики работы существуют в ООО «На все руки мастер»,
	а регистр сведений – для указания того, какие дни в месяце являются рабочими, поскольку сумма оплаты по окладу будет
	рассчитываться исходя из того, сколько дней отработал сотрудник в расчетном месяце.</p>
<p><strong>В режиме «Конфигуратор»</strong></p>
<p>Откроем конфигуратор и создадим новый объект конфигурации Справочник с именем ВидыГрафиковРаботы. </p>
<p>На закладке Подсистемы укажем, что справочник будет отображаться в подсистеме РасчетЗарплаты.</p>
<p>На закладке Прочее создадим для справочника два предопределенных графика работы (рис. 17.11) – ГрафикАдминистрации и
	ГрафикМа-</p>
<p><strong>Рис. 17.11.</strong> Предопределенные графики работы</p>
<p>После этого создадим объект конфигурации Регистр сведений с именем ГрафикиРаботы. </p>
<p>Этот регистр будет иметь два измерения:</p>
<p> ГрафикРаботы, тип СправочникСсылка.ВидыГрафиковРаботы;  Дата, тип Дата.</p>
<p>Затем создадим единственный ресурс регистра – Значение с типом Число, длиной 1. На закладке Подсистемы укажем, что
	регистр сведений будет отображаться в подсистеме РасчетЗарплаты. Теперь заполним регистр сведений ГрафикиРаботы
	данными о рабочих днях июля графика мастеров. </p>
<p><strong>В режиме «1С:Предприятие»</strong></p>
<p>Запустим «1С:Предприятие» в режиме отладки и в разделе Расчет зарплаты выполним команду Графики работы. Поочередно
	создадим 31 запись в регистре. </p>
<p>Чтобы проще выполнить эту довольно однообразную работу, воспользуйтесь возможностью добавления элементов в регистр
	копированием текущего элемента (команда Еще  Скопировать (F9)). В качестве измерения ГрафикРаботы нашего регистра
	выберем предопределенный элемент График мастеров справочника ВидыГрафи- ковРаботы. В качестве ресурса Значение у
	рабочих дней проставим 1, а у выходных – 0 (рис. 17.12).</p>
<p><strong>Рис. 17.12.</strong> Записи регистра «Графики работы»</p>
<p>Теперь все готово для создания регистра расчета. </p>
<p><strong>В режиме «Конфигуратор»</strong></p>
<p>Добавим новый объект конфигурации Регистр расчета с именем </p>
<p>Начисления. Зададим Расширенное представление списка как Движения в регистре Начисления. В качестве плана видов
	расчета, используемого регистром, выберем ОсновныеНачисления. </p>
<p>Установим, что регистр будет использовать период действия, график будет задаваться в регистре сведений ГрафикиРаботы,
	значение графика будет находиться в ресурсе Значение, а дата графика – в измерении Дата. </p>
<p>Укажем, что регистр расчета будет использовать базовый период и периодичность регистра будет Месяц (рис. 17.13).</p>
<p>На закладке Подсистемы укажем, что регистр расчета будет отображаться в подсистеме РасчетЗарплаты.</p>
<p>Затем перейдем на закладку Данные и создадим (рис. 17.14):</p>
<ul>
	<li>измерение Сотрудник, тип СправочникСсылка.Сотрудники, Базовое;</li>
	<li>ресурс Результат, тип Число, длина 15, точность 2,</li>
	<li>реквизит ГрафикРаботы, тип СправочникСсылка.ВидыГрафиковРаботы, в разделе свойств Данные зададим свойство Связь
		с графиком по измерению ГрафикРаботы;
	</li>
	<li>реквизит ИсходныеДанные, тип Число, длина 15, точность 2.</li>
</ul>
<p>Реквизит ГрафикРаботы мы будем использовать для того, чтобы связать запись регистра с используемым графиком работы, а
	реквизит ИсходныеДанные – чтобы хранить в нем данные, которые могут понадобиться при расчете или перерасчете (в
	нашем примере это будет расчет оклада).</p>
<p><strong>Рис. 17.14.</strong> Измерения, ресурсы и реквизиты регистра расчета</p>
<p>Теперь перейдем на закладку Перерасчеты. Создадим объект конфигурации Перерасчет, который так и назовем –
	Перерасчет. </p>
<p>У него будет единственное измерение – Сотрудник, для которого в разделе Связь мы укажем:</p>
<ul>
	<li>измерение регистра – Сотрудник;</li>
	<li>данные ведущих регистров – выберем то же самое измерение Сотрудник регистра расчета Начисления (рис. 17.15).
	</li>
</ul>
<p>В заключение отредактируем командный интерфейс, чтобы в разделе Расчет зарплаты была доступна команда для просмотра
	записей регистра расчета. </p>
<p>Для этого в дереве объектов конфигурации выделим подсистему РасчетЗарплаты, вызовем контекстное меню и выполним
	команду Открыть командный интерфейс. </p>
<p>В открывшемся окне командного интерфейса подсистемы в группе Панель навигации.Обычное включим видимость у команды
	Начисления.</p>
<p>На этом создание объекта конфигурации Регистр расчета Начисления завершено.</p>
<h1><a id="_Toc454870673"></a>Лабораторная работа № 28 Основы работы со справочниками</h1>
<p><strong>Порядок выполнения работы </strong></p>
<p>1. Ознакомьтесь с теоретическими основами в настоящих указаниях и конспектах лекций. </p>
<p>2. Получите задание у преподавателя. </p>
<p>3. Сделайте скриншоты (кнопка клавиатуры PrtSc) выполненных заданий в текстовом (Word) файле <em>Фамилия_ЛР</em></p>
<p>4. Составьте отчет по лабораторной работе. </p>
<p>5. Отчитайте работу преподавателю.</p>
<p><strong>Добавление документа о начислениях</strong></p>
<p>Для того чтобы иметь возможность регистрировать в базе данных начисления, производимые сотрудникам ООО «На все руки
	мастер», нам понадобится специальный документ.</p>
<p><strong>В режиме «Конфигуратор»</strong></p>
<p>Откроем конфигуратор и добавим новый объект конфигурации Документ. Назовем его НачисленияСотрудникам. Зададим
	представление объекта как Начисление сотрудникам. На закладке Нумерация установим:</p>
<ul>
	<li>Тип номера – Число,</li>
	<li>Длина номера – 5 (рис. 18.1).</li>
</ul>
<p>На закладке Подсистемы укажем, что документ будет отображаться в подсистеме РасчетЗарплаты.</p>
<p>На закладке Данные укажем, что этот документ будет иметь табличную часть Начисления, содержащую следующие
	реквизиты:</p>
<ul>
	<li>Сотрудник, тип СправочникСсылка.Сотрудники;</li>
	<li>ГрафикРаботы, тип СправочникСсылка.ВидыГрафиковРаботы;</li>
	<li>ДатаНачала, тип Дата;</li>
	<li>ДатаОкончания, тип Дата;</li>
	<li>ВидРасчета, тип ПланВидовРасчетаСсылка.ОсновныеНачисления;  Начислено, Число, длина 15, точность 2.</li>
</ul>
<p><img src="66.jpeg"/></p>
<p><strong>Рис. 18.1.</strong> Нумерация документа</p>
<p>Реквизиты ДатаНачала и ДатаОкончания понадобятся нам для того, чтобы задавать период, в котором должна действовать
	запись расчета.</p>
<p>На закладке Движения запретим оперативное проведение документа. </p>
<p>Отметим, что документ будет создавать движения по регистру расчета Начисления, и запустим конструктор движений (рис.
	18.2).</p>
<p><strong>Рис. 18.2.</strong> Движения документа</p>
<p>В окне конструктора выберем табличную часть Начисления и нажмем Заполнить выражения. </p>
<p>Для реквизитов ПериодДействияКонец и БазовыйПериодКонец укажем выражение
	КонецДня(ТекСтрокаНачисления.ДатаОкончания). </p>
<p>Для поля ПериодРегистрации укажем выражение Дата.</p>
<p>Реквизиту ИсходныеДанные поставим в соответствие реквизит табличной части Начислено, а для ресурса Результат оставим
	пустое выражение, так как мы будем его потом рассчитывать (рис. 18.3).</p>
<p><strong>Рис. 18.3.</strong> Движения документа «НачисленияСотрудникам» по регистру расчета</p>
<p>Нажмем OK и посмотрим текст обработчика, созданный конструктором (листинг 18.1). <strong>листинг 18.1.</strong> Текст
	обработчика, созданный конструктором движений</p>
<table>
	<tr>
		<td><p>Процедура ОбработкаПроведения(Отказ, Режим)</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>//{{__КОНСТРУКТОР_ДВИЖЕНИЙ_РЕГИСТРОВ</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// Данный фрагмент построен конструктором</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// При повторном использовании конструктора </p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// внесенные вручную изменения будут утеряны!!!</p></td>
	</tr>
</table>
<p>Движения.Начисления.Записывать = Истина;</p>
<p>// Регистр Начисления</p>
<table>
	<tr>
		<td><p>Для Каждого ТекСтрокаНачисления Из Начисления Цикл</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение = Движения.Начисления.Добавить();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.Сторно = Ложь;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.ВидРасчета = ТекСтрокаНачисления.ВидРасчета;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.ПериодДействияНачало = ТекСтрокаНачисления.ДатаНачала;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.ПериодДействияКонец = КонецДня(ТекСтрокаНачисления.ДатаОкончания);</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.ПериодРегистрации = Дата;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.БазовыйПериодНачало = ТекСтрокаНачисления.ДатаНачала;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.БазовыйПериодКонец = КонецДня(ТекСтрокаНачисления.ДатаОкончания);</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.Сотрудник = ТекСтрокаНачисления.Сотрудник;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.ГрафикРаботы = ТекСтрокаНачисления.ГрафикРаботы;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движение.ИсходныеДанные = ТекСтрокаНачисления.Начислено;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецЦикла;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>//}}__КОНСТРУКТОР_ДВИЖЕНИЙ_РЕГИСТРОВ </p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецПроцедуры</p></td>
	</tr>
</table>
<p>Прокомментируем этот код. </p>
<p>В целом в нем нет ничего принципиально нового по сравнению с прежними обработчиками проведения документов, создающими
	движения регистров. </p>
<p>Напомним лишь, что Начисления – имя регистра расчета, и в выражениях Движения.Начисления.Записывать() и
	Движения.Начисления.Добавить() мы обращаемся к методам набора записей этого регистра. </p>
<p>В строке Для Каждого ТекСтрокаНачисления Из Начисления Цикл мы обращаемся по имени (Начисления) к табличной части
	нашего документа и организуем цикл обхода этой табличной части. </p>
<p>В цикле мы добавляем к движениям новую запись и присваиваем ее полям значения из табличной части документа. </p>
<p>Для присвоения значений полям ПериодДействияКонец, БазовыйПериодКонец мы используем функцию КонецДня(). Аналогичным
	образом мы поступали при создании отчетов, чтобы последний день периода попал в отчет.</p>
<p>В заключение отредактируем командный интерфейс, чтобы в разделе Расчет зарплаты была доступна команда создания новых
	документов. </p>
<p>Для этого в дереве объектов конфигурации выделим подсистему РасчетЗарплаты, вызовем контекстное меню и выполним
	команду Открыть командный интерфейс. </p>
<p>В группе Панель действий.Создать включим видимость у команды Начисление сотрудникам: создать (рис. 18.4).</p>
<p><strong>В режиме «1С:Предприятие»</strong></p>
<p>Запустим «1С:Предприятие» в режиме отладки и посмотрим, как работает наш документ. </p>
<p>В разделе Расчет зарплаты выполним команду Начисление сотрудникам и начислим оклад за июль всем сотрудникам ООО «На
	все руки мастер» (рис. 18.5).</p>
<p><strong>Рис. 18.5.</strong> Документ «Начисления сотрудникам № 1»</p>
<p>Проведем документ и посмотрим, какие движения он сформировал в регистре Начисления (рис. 18.6, 18.7).</p>
<p><strong>Рис. 18.6.</strong> Движения документа «Начисление сотрудникам № 1» в регистре расчета «Начисления»</p>
<p><strong>Рис. 18.7.</strong> Движения документа «Начисление сотрудникам № 1» в регистре расчета «Начисления»</p>
<p>Обратите внимание на то, что платформа привела период регистрации каждой записи к началу периода регистра расчета –
	началу месяца (в обработчике проведения мы указывали значение даты документа – 24.07.2013).</p>
<p>Кроме этого заметьте, что в каждой записи мы сохранили в реквизите ИсходныеДанные размер оклада сотрудника, введенный
	в документе, чтобы в дальнейшем рассчитать сумму оплаты по окладу.</p>
<p>Для дальнейшего изучения работы регистра расчета нам понадобится служебный отчет, с помощью которого мы сможем
	посмотреть содержимое записей перерасчета.</p>
<p><strong>Иллюстрация механизмов вытеснения и зависимости от базы</strong></p>
<p><strong>Отчет по перерасчетам</strong></p>
<p><strong>В режиме «Конфигуратор»</strong></p>
<p>Создадим новый объект конфигурации Отчет. Назовем его Перерасчет. Создадим основную схему компоновки данных, добавим
	источник данных – запрос и откроем конструктор запроса. </p>
<p>В списке База данных раскроем ветвь Перерасчеты и из виртуальной таблицы перерасчета Начисления.Перерасчет выберем
	все поля:</p>
<ul>
	<li>ОбъектПерерасчета,</li>
	<li>ВидРасчета,</li>
</ul>
<p><strong>Рис. 18.8.</strong> Поля и таблицы запроса</p>
<p>На этом создание запроса закончено, нажмем ОK.</p>
<p>Перейдем на закладку Настройки и добавим группировку детальных записей. На закладке Выбранные поля выберем для вывода
	в отчет поля ОбъектПерерасчета, ВидРасчета и Сотрудник. </p>
<p>На этом создание схемы компоновки данных закончено, закроем ее. </p>
<p>В окне редактирования объекта конфигурации Отчет Перерасчет на закладке Подсистемы укажем, что отчет будет
	принадлежать подсистеме РасчетЗарплаты. </p>
<p><strong>Зависимость по базовому периоду </strong></p>
<p><strong>В режиме «1С:Предприятие»</strong></p>
<p>Если сейчас мы выполним отчет в режиме 1С:Предприятие, то мы увидим, что ни один перерасчет еще не выполнялся.</p>
<p>Поэтому создадим новый документ Начисление сотрудникам </p>
<p>№ 2, в котором начислим премию за июль Гусакову и Деловому </p>
<p>(рис. 18.9).</p>
<p><strong>Рис. 18.9.</strong> Документ «Начисления сотрудникам № 2»</p>
<p>Этим документом мы зафиксируем тот факт, что сотрудникам Гусакову и Деловому нужно начислить премию по итогам работы
	за июль. Поскольку размер премии нам неизвестен (он будет рассчитываться по некоторому алгоритму), поле Начислено мы
	оставляем пустым. Нажмем Провести и закрыть.</p>
<p>Теперь снова откроем документ Начисление сотрудникам № 1 и изменим оклад Гусакова с 10 000 на 7 000. Нажмем Провести
	и<strong> </strong>закрыть. </p>
<p>Сформируем отчет Перерасчет (рис. 18.10).</p>
<p><strong>Рис. 18.10.</strong> Отчет «Перерасчет»</p>
<p>Как видите, отчет теперь содержит какие-то данные. </p>
<p>В самом деле вид расчета Премия зависит у нас по базовому периоду от вида расчета Оклад. Как только мы изменили
	существовавшие в регистре записи по виду расчета Оклад, платформа сразу же сформировала набор записей перерасчета,
	которые должны быть рассчитаны заново, так как изменилась их база.</p>
<p>Вы можете спросить: почему в перерасчет попали записи как про Делового, так и про Гусакова, хотя оклад мы меняли
	только Гусакову? </p>
<p>Дело в том, что платформа не отслеживает конкретные изменения, которые пользователь внес в записи документа. Она
	отслеживает лишь факт изменения набора записей регистра расчета в результате проведения (перепроведения)
	документа. </p>
<p>Поэтому в набор записей перерасчета она включает информацию обо ВСЕХ записях регистра, значение ресурсов которых
	МОЖЕТ измениться в результате перепроведения документа, создавшего базовые записи регистра.</p>
<p>Перепроведем документ Начисления сотрудникам № 2 (которым мы начисляли премию) и сформируем отчет Перерасчет. </p>
<p>Он снова не содержит никаких данных – система отметила тот факт, что мы «пересчитали» зависимые записи, и очистила
	таблицу перерасчета. </p>
<p>На этом примере мы с вами познакомились с работой механизма поддержки зависимости по базовому периоду у регистра
	расчета.</p>
<p><strong>Вытеснение по периоду действия</strong></p>
<p><strong>В режиме «1С:Предприятие»</strong></p>
<p>Теперь посмотрим, как работает механизм вытеснения по периоду действия. </p>
<p>Для этого нам понадобится создать документ Начисления сотрудникам № 3 (рис. 18.11).</p>
<p>Этим документом мы зафиксируем тот факт, что Гусаков не выходил на работу с 1 по 10 июля. </p>
<p>Очевидно, что в этом случае потребуется пересчитать его оплату по окладу и как следствие начисленную премию. </p>
<p><strong>Рис. 18.11.</strong> Документ «Начисления сотрудникам № 3»</p>
<p>Нажмем Провести и закрыть и затем сформируем отчет Перерасчет (рис. 18.12).</p>
<p>Как вы видите, в перерасчет попала запись о начислении оклада Гусакову. Это явилось результатом работы механизма
	вытеснения по периоду действия, ведь вид расчета Невыход вытесняет у нас вид расчета Оклад. </p>
<p>Обратите внимание, что в перерасчет попала и запись о начислении премии Гусакову. </p>
<p>Если вы помните, при создании предопределенных видов расчета мы указали, что результат вида расчета Премия будет
	зависеть от изменения результата вида расчета Невыход. Эта зависимость косвенная, но поскольку явно указали такую
	зависимость, платформа ее отследила.</p>
<p>Перепроведем документы Начисления сотрудникам № 1 и № 2 и убедимся, что таблица перерасчета очистилась.</p>
<p><strong>Процедура расчета записей регистра расчета</strong></p>
<p><strong>В режиме «Конфигуратор»</strong></p>
<p>До сих пор мы с вами просто заносили в регистр расчета Начисления записи о том, что необходимо выполнить какой-либо
	вид расчета. Но каким именно образом получать эти результаты, мы не говорили. </p>
<p>Теперь настало время описать алгоритмы формирования различных видов расчетов.</p>
<p>Поскольку эти алгоритмы нужно будет использовать не только в документе Начисление сотрудникам, удобнее всего будет
	разместить их в отдельном общем модуле. </p>
<p>Откроем в конфигураторе текст обработчика проведения документа НачисленияСотрудникам и добавим в него после
	завершения создания движений в регистре Начисления вызов процедуры РассчитатьНачисления() из общего модуля
	ПроведениеРасчетов (листинг 18.2).</p>
<p><strong>листинг 18.2.</strong> Обработчик проведения документа </p>
<p>«НачисленияСотрудникам»</p>
<table>
	<tr>
		<td><p>Процедура ОбработкаПроведения(Отказ, Режим)</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p> …</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецЦикла;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>//}}__КОНСТРУКТОР_ДВИЖЕНИЙ_РЕГИСТРОВ</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>// Записываем движения регистров</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>Движения.Начисления.Записать();</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>// Получим список всех сотрудников, содержащихся в документе</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>Запрос = Новый Запрос(</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>&quot;<strong>ВЫБРАТЬ РАЗЛИЧНЫЕ</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>| НачисленияСотрудникамНачисления.Сотрудник</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>|ИЗ</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>| Документ.НачисленияСотрудникам.Начисления КАК НачисленияСотрудникамНачисления</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong> |</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>|ГДЕ</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>| НачисленияСотрудникамНачисления.Ссылка = &amp;ТекущийДокумент</strong>&quot;<strong>);</strong>
		</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>Запрос.УстановитьПараметр(</strong>&quot;<strong>ТекущийДокумент</strong>&quot;<strong>,
			Ссылка);</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>// Сформируем список сотрудников</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>ТаблЗнач = Запрос.Выполнить().Выгрузить();</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>МассивСотрудников =
			ТаблЗнач.ВыгрузитьКолонку(</strong>&quot;<strong>Сотрудник</strong>&quot;<strong>);</strong></p></td>
	</tr>
</table>
<p><strong>// Вызов процедуры РассчитатьНачисления из общего модуля</strong></p>
<table>
	<tr>
		<td><p><strong>ПроведениеРасчетов.РассчитатьНачисления(Движения.Начисления, </strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>ПланыВидовРасчета.ОсновныеНачисления.Оклад, МассивСотрудников);</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>Движения.Начисления.Записать( , Истина);</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>ПроведениеРасчетов.РассчитатьНачисления(Движения.Начисления, ПланыВидовРасчета.</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>ОсновныеНачисления.Премия, МассивСотрудников);</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>Движения.Начисления.Записать( , Истина);</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецПроцедуры</p></td>
	</tr>
</table>
<p>Обратите внимание: при проведении документа мы сначала записываем движения, сформированные документом, в регистр
	(Движения.Начисления.Записать()), а затем передаем этот набор записей регистра в процедуру расчета
	РассчитатьНачисления(), которую мы создадим в общем модуле ПроведениеРасчетов. </p>
<p>Эту процедуру мы вызываем сначала для расчета первичных записей (Оклад), а затем для расчета вторичных (Премия). </p>
<p>Процедура расчета на основе описанных в ней алгоритмов и данных, содержащихся в записях регистра, должна сформировать
	значения ресурсов регистра.</p>
<p>После того как ресурсы будут рассчитаны, мы перезаписываем набор записей регистра без формирования записей
	перерасчета (второй параметр в методе Записать() – Истина). </p>
<p>Перед вызовом процедуры из общего модуля мы с помощью запроса формируем массив сотрудников, перечисленных в
	документе, чтобы передать его в вызываемую процедуру. </p>
<p>Для параметра запроса ТекущийДокумент устанавливаем значение стандартного реквизита документа – Ссылка. Используя
	метод запроса Запрос.Выполнить().Выгрузить(), выгружаем результат запроса в таблицу значений (переменную ТаблЗнач).
	Затем формируем массив МассивСотрудников, содержащий колонку Сотрудник из этой таблицы значений.</p>
<p>Теперь создадим в ветке Общие новый общий модуль ПроведениеРасчетов. </p>
<p>Установим флажок Вызов сервера для видимости его экспортных процедур и функций (рис. 18.13).</p>
<p>Добавим в него заготовку процедуры РассчитатьНачисления (листинг 18.3).</p>
<p><strong>листинг 18.3.</strong> Заготовка процедуры «РассчитатьНачисления»</p>
<table>
	<tr>
		<td><p>Процедура РассчитатьНачисления(НаборЗаписейРегистра, ТребуемыйВидРасчета, </p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>СписокСотрудников) Экспорт</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Регистратор = НаборЗаписейРегистра.Отбор.Регистратор.Значение; </p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// Рассчитать первичные записи</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Если ТребуемыйВидРасчета = ПланыВидовРасчета.ОсновныеНачисления.Оклад Тогда</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// Рассчитать вторичные записи</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ИначеЕсли ТребуемыйВидРасчета = ПланыВидовРасчета.ОсновныеНачисления.Премия Тогда</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецЕсли;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецПроцедуры </p></td>
	</tr>
</table>
<p>Алгоритм расчета начислений будет различным при расчете первичных (вид расчета – Оклад) и вторичных записей (вид
	расчета – Премия), и каждая из его частей будет находиться в своей ветке условия Если...</p>
<p>При расчете первичных записей нам понадобятся данные графика из регистра расчета, поэтому добавим в первую ветку
	условия запроса по виртуальной таблице регистра расчета РегистрРасчета.Начис- ления.ДанныеГрафика (листинг
	18.4).</p>
<p><strong>листинг 18.4.</strong> Изменение процедуры «РассчитатьНачисления»</p>
<p>Процедура РассчитатьНачисления(НаборЗаписейРегистра, ТребуемыйВидРасчета, </p>
<table>
	<tr>
		<td><p>СписокСотрудников) Экспорт</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Регистратор = НаборЗаписейРегистра.Отбор.Регистратор.Значение; </p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// Рассчитать первичные записи</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Если ТребуемыйВидРасчета = ПланыВидовРасчета.ОсновныеНачисления.Оклад Тогда</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>Запрос = Новый Запрос;</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>Запрос.Текст = </strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong> </strong>&quot;<strong>ВЫБРАТЬ</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>| НачисленияДанныеГрафика.ЗначениеПериодДействия КАК Норма,</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>| НачисленияДанныеГрафика.ЗначениеФактическийПериодДействия КАК Факт,</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>| НачисленияДанныеГрафика.НомерСтроки КАК НомерСтроки</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>|ИЗ</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>| РегистрРасчета.Начисления.ДанныеГрафика(Регистратор = &amp;Регистратор И </strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>| ВидРасчета = &amp;ВидРасчета И Сотрудник В (&amp;СписокСотрудников)) </strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>| КАК НачисленияДанныеГрафика</strong>&quot;<strong>;</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>Запрос.УстановитьПараметр(</strong>&quot;<strong>Регистратор</strong>&quot;<strong>,
			Регистратор);</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>Запрос.УстановитьПараметр(</strong>&quot;<strong>ВидРасчета</strong>&quot;<strong>,
			ТребуемыйВидРасчета);</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>Запрос.УстановитьПараметр(</strong>&quot;<strong>СписокСотрудников</strong>&quot;<strong>,
			СписокСотрудников);</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>ВыборкаРезультата = Запрос.Выполнить().Выбрать(); </strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// Рассчитать вторичные записи</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ИначеЕсли ТребуемыйВидРасчета = ПланыВидовРасчета.ОсновныеНачисления.Премия Тогда </p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецЕсли; </p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецПроцедуры</p></td>
	</tr>
</table>
<p>В этом запросе мы выбираем из виртуальной таблицы данных графика регистра расчета значение графика для периода
	действия и для фактического периода действия. При задании параметров виртуальной таблицы мы ограничиваем выборку
	регистратором, нужным нам видом расчета и списком сотрудников, по которым нужно получить значения графика.</p>
<p>Теперь добавим обход переданного в процедуру набора записей и расчет записей, для которых получены значения графика
	(листинг 18.5).</p>
<p><strong>листинг 18.5.</strong> Добавление обхода набора записей и расчета первичных записей </p>
<table>
	<tr>
		<td><p>Процедура РассчитатьНачисления(НаборЗаписейРегистра, ТребуемыйВидРасчета, </p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>СписокСотрудников) Эспорт</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Регистратор = НаборЗаписейРегистра.Отбор.Регистратор.Значение;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// Рассчитать первичные записи </p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Если ТребуемыйВидРасчета = ПланыВидовРасчета.ОсновныеНачисления.Оклад Тогда</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>…</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ВыборкаРезультата = Запрос.Выполнить().Выбрать(); </p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>Для Каждого ЗаписьРегистра Из НаборЗаписейРегистра Цикл</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>СтруктураНомер = Новый Структура(&quot;НомерСтроки&quot;);</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>СтруктураНомер.НомерСтроки = ЗаписьРегистра.НомерСтроки;</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>ВыборкаРезультата.Сбросить(); </strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>Если ВыборкаРезультата.НайтиСледующий(СтруктураНомер) Тогда</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>Если ВыборкаРезультата.Норма = 0 Тогда</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>Сообщение = Новый СообщениеПользователю;</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>Сообщение.Текст = </strong>&quot;<strong>Вид расчета: Оклад – </strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>Нет рабочих дней в заданном периоде</strong>&quot;<strong>;</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong> Сообщение.Сообщить();</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong> ЗаписьРегистра.Результат = 0;</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>Иначе</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>// Рассчитать оклад по фактическому периоду и исходным данным</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>ЗаписьРегистра.Результат = (ЗаписьРегистра.ИсходныеДанные </strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>ВыборкаРезультата.Норма) * ВыборкаРезультата.Факт;</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>Сообщение = Новый СообщениеПользователю;</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>Сообщение.Текст = </strong>&quot;<strong>Выполнен расчет </strong>&quot;<strong> +
			ЗаписьРегистра.Регистратор </strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>+ </strong>&quot;<strong> – </strong>&quot;<strong> + ЗаписьРегистра.ВидРасчета + </strong>&quot;<strong>
			– </strong>&quot;<strong> + </strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>ЗаписьРегистра.Сотрудник;</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>Сообщение.Сообщить();</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>КонецЕсли;</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>КонецЕсли;</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>КонецЦикла;</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// Рассчитать вторичные записи</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ИначеЕсли ТребуемыйВидРасчета = ПланыВидовРасчета.ОсновныеНачисления.Премия Тогда</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецЕсли; </p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецПроцедуры</p></td>
	</tr>
</table>
<p>Для каждой записи из набора записей регистра расчета мы получаем номер строки, идентифицирующий начисление для
	конкретного сотрудника, и по этому номеру ищем соответствующую запись в выборке из результата запроса.</p>
<p>Если в результате запроса есть запись с таким номером строки, мы рассчитываем результат записи регистра расчета. То
	есть мы получаем начисление по окладу для каждого сотрудника как результат от деления начисленной суммы (поле
	регистра ИсходныеДанные) на количество рабочих дней в месяце (Норма) и умножения на фактически отработанные рабочие
	дни (Факт).</p>
<p>Добавим текст запроса во вторую ветку условия Если… с той лишь разницей, что теперь мы будем получать значения базы,
	используя виртуальную таблицу регистра расчета РегистрРасчета.Начис- ления.БазаНачисления (листинг 18.6). <strong>листинг
		18.6.</strong> Добавление текста запроса во вторую ветку условия</p>
<table>
	<tr>
		<td><p>Процедура РассчитатьНачисления(НаборЗаписейРегистра, ТребуемыйВидРасчета, </p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>СписокСотрудников) Экспорт</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Регистратор = НаборЗаписейРегистра.Отбор.Регистратор.Значение;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// Рассчитать первичные записи </p></td>
	</tr>
	<tr>
		<td><p>Если ТребуемыйВидРасчета = ПланыВидовРасчета.ОсновныеНачисления.Оклад Тогда</p></td>
	</tr>
	<tr>
		<td><p>…</p></td>
	</tr>
	<tr>
		<td><p>// Рассчитать вторичные записи</p></td>
	</tr>
	<tr>
		<td><p>ИначеЕсли ТребуемыйВидРасчета = ПланыВидовРасчета.ОсновныеНачисления.Премия Тогда </p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>Запрос = Новый Запрос;</strong></p></td>
	</tr>
	<tr>
		<td><p><strong>Запрос.Текст = </strong></p></td>
	</tr>
	<tr>
		<td><p><strong> </strong>&quot;<strong>ВЫБРАТЬ</strong></p></td>
	</tr>
	<tr>
		<td><p><strong>| НачисленияБазаНачисления.РезультатБаза КАК База,</strong></p></td>
	</tr>
	<tr>
		<td><p><strong>| НачисленияБазаНачисления.НомерСтроки КАК НомерСтроки</strong></p></td>
	</tr>
	<tr>
		<td><p><strong>|ИЗ</strong></p></td>
	</tr>
	<tr>
		<td><p><strong>| РегистрРасчета.Начисления.БазаНачисления(&amp;ИзмеренияОсновного, </strong></p></td>
	</tr>
	<tr>
		<td><p><strong>| &amp;ИзмеренияБазового, , Регистратор = </strong></p></td>
	</tr>
	<tr>
		<td><p><strong>| &amp;Регистратор И ВидРасчета = &amp;ВидРасчета И </strong></p></td>
	</tr>
	<tr>
		<td><p><strong>| Сотрудник В (&amp;СписокСотрудников))</strong></p></td>
	</tr>
	<tr>
		<td><p><strong>| КАК НачисленияБазаНачисления</strong>&quot;<strong>;</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>Измер = Новый Массив(1);</strong></p></td>
	</tr>
	<tr>
		<td><p><strong>Измер[0] = </strong>&quot;<strong>Сотрудник</strong>&quot;<strong>;</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>Запрос.УстановитьПараметр(</strong>&quot;<strong>ИзмеренияОсновного</strong>&quot;<strong>,
			Измер);</strong></p></td>
	</tr>
	<tr>
		<td><p><strong>Запрос.УстановитьПараметр(</strong>&quot;<strong>ИзмеренияБазового</strong>&quot;<strong>,
			Измер);</strong></p></td>
	</tr>
	<tr>
		<td><p><strong>Запрос.УстановитьПараметр(</strong>&quot;<strong>Регистратор</strong>&quot;<strong>,
			Регистратор);</strong></p></td>
	</tr>
	<tr>
		<td><p><strong>Запрос.УстановитьПараметр(</strong>&quot;<strong>ВидРасчета</strong>&quot;<strong>,
			ТребуемыйВидРасчета);</strong></p></td>
	</tr>
	<tr>
		<td><p><strong>Запрос.УстановитьПараметр(</strong>&quot;<strong>СписокСотрудников</strong>&quot;<strong>,
			СписокСотрудников);</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>ВыборкаРезультата = Запрос.Выполнить().Выбрать();</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецЕсли;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецПроцедуры</p></td>
	</tr>
</table>
<p>В параметрах виртуальной таблицы запроса мы кроме привычных для нас регистратора, вида расчета и списка сотрудников
	задаем еще измерения основного и базового регистров. В нашем случае это будет один и тот же регистр Начисления, а
	нужное нам измерение – Сотрудник.</p>
<p>В заключение осталось добавить во второе условие Если… обход набора записей регистра расчета и вычисление результата
	вторичных записей (листинг 18.7).</p>
<p><strong>листинг 18.7.</strong> Добавление обхода набора записей регистра </p>
<p>и вычисления результата вторичных записей</p>
<table>
	<tr>
		<td><p>Процедура РассчитатьНачисления(НаборЗаписейРегистра, ТребуемыйВидРасчета, </p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>СписокСотрудников) Экспорт</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Регистратор = НаборЗаписейРегистра.Отбор.Регистратор.Значение;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// Рассчитать первичные записи </p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Если ТребуемыйВидРасчета = ПланыВидовРасчета.ОсновныеНачисления.Оклад Тогда</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>…</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// Рассчитать вторичные записи</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ИначеЕсли ТребуемыйВидРасчета = ПланыВидовРасчета.ОсновныеНачисления.Премия Тогда</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ВыборкаРезультата = Запрос.Выполнить().Выбрать(); </p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>Для Каждого ЗаписьРегистра Из НаборЗаписейРегистра Цикл</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>СтруктураНомер = Новый
			Структура(</strong>&quot;<strong>НомерСтроки</strong>&quot;<strong>);</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>СтруктураНомер.НомерСтроки = ЗаписьРегистра.НомерСтроки;</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>ВыборкаРезультата.Сбросить(); </strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>Если ВыборкаРезультата.НайтиСледующий(СтруктураНомер) Тогда</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>ЗаписьРегистра.Результат = ВыборкаРезультата.База * (10 / 100);</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>Сообщение = Новый СообщениеПользователю;</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong> Сообщение.Текст = </strong>&quot;<strong>Выполнен расчет </strong>&quot;<strong> +
			ЗаписьРегистра.Регистратор + </strong>&quot;<strong> – </strong>&quot;<strong> + </strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>ЗаписьРегистра.ВидРасчета + </strong>&quot;<strong> – </strong>&quot;<strong> +
			ЗаписьРегистра.Сотрудник;</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>Сообщение.Сообщить();</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>КонецЕсли;</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>КонецЦикла;</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецЕсли;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецПроцедуры</p></td>
	</tr>
</table>
<p>Сумму начисленной премии мы рассчитываем как 10 % от рассчитанной оплаты по окладу.</p>
<p><strong>В режиме «1С:Предприятие»</strong></p>
<p>Запустим «1С:Предприятие» в режиме отладки и проверим правильность работы процедуры расчета. </p>
<p>Отменим проведение документа Начисления сотрудникам № 3 (Еще  Отмена проведения) и перепроведем документы Начисления
	сотрудникам № 1 и № 2. Регистр расчета Начисления должен выглядеть следующим образом (рис. 18.14, 18.15).</p>
<p><strong>Рис. 18.15.</strong> Записи регистра «Начисления»</p>
<p>Мы видим, что всем сотрудникам произведены начисления по окладу (поле Результат) за полный месяц в соответствии с
	исходными данными (поле Исходные данные). </p>
<p>Сотрудникам Гусакову и Деловому начислена премия в размере 10 % от суммы начисления по окладу. </p>
<p>Проведем документ Начисление сотрудникам № 3, а затем № 1 и № 2. </p>
<p>При этом отчет Перерасчет должен быть пуст. </p>
<p>Состояние регистра изменится следующим образом (рис. 18.16, 18.17).</p>
<p><strong>Рис. 18.17.</strong> Записи регистра «Начисления»</p>
<p>В результате невыхода Гусакова на работу сумма оплаты по окладу будет уменьшена, и соответствующим образом уменьшится
	начисленная ему премия.</p>
<h1><a id="_Toc454870674"></a>Лабораторная работа № 29 Программирование справочников</h1>
<p><strong>Порядок выполнения работы </strong></p>
<p>1. Ознакомьтесь с теоретическими основами в настоящих указаниях и конспектах лекций. </p>
<p>2. Получите задание у преподавателя. </p>
<p>3. Сделайте скриншоты (кнопка клавиатуры PrtSc) выполненных заданий в текстовом (Word) файле <em>Фамилия_ЛР</em></p>
<p>4. Составьте отчет по лабораторной работе. </p>
<p>5. Отчитайте работу преподавателю.</p>
<p><strong>Отчет о начислениях сотрудникам</strong></p>
<p>Теперь мы посмотрим, каким образом можно использовать данные, хранящиеся в регистре расчета, для получения в отчете
	итоговой информации о начислениях сотрудникам (рис. 18.18).</p>
<p><strong>Рис. 18.18.</strong> Результат отчета</p>
<p><strong>В режиме «Конфигуратор»</strong></p>
<p>Создадим в конфигураторе новый объект конфигурации Отчет. Назовем его НачисленияСотрудникам. Создадим основную схему
	компоновки данных отчета, добавим новый Набор данных – запрос, откроем конструктор запроса. </p>
<p><strong>Запрос для набора данных</strong></p>
<p>Выберем таблицу регистра расчета Начисления (рис. 18.19).</p>
<p><strong>Рис. 18.19.</strong> Состав полей таблицы «Начисления»</p>
<p>Из нее выберем следующие поля: </p>
<ul>
	<li>Сотрудник,</li>
	<li>ВидРасчета,</li>
	<li>ПериодДействияНачало,</li>
	<li>ПериодДействияКонец,</li>
	<li>Регистратор,</li>
	<li>Результат (рис. 18.20).</li>
</ul>
<p><strong>Рис. 18.20.</strong> Выбранные поля</p>
<p>На закладке Объединения/Псевдонимы определим следующие псевдонимы полей ПериодДействияНачало и ПериодДействияКонец
	(рис. 18.21).</p>
<p>На этом создание запроса закончено, нажмем ОK. </p>
<p><strong>Ресурсы</strong></p>
<p>Перейдем на закладку Ресурсы и укажем, что должна быть рассчитана сумма по полю Результат.</p>
<p><strong>Настройки</strong></p>
<p>После этого перейдем на закладку Настройки и создадим структуру отчета. </p>
<p>Добавим группировку по полю Сотрудник и в ней – подчиненную группировку детальных записей. </p>
<p>В качестве полей, выводимых в отчет, выберем поля ВидРасчета, Начало, Окончание, Регистратор и Результат. </p>
<p>В результате окно настроек отчета должно иметь вид (рис. 18.22).</p>
<p><strong>Рис. 18.22.</strong> Структура и выбранные поля отчета</p>
<p>На закладке Сортировка укажем, что сортировка должна выполняться по возрастанию значения поля Сотрудник и Регистратор
	(рис. 18.23).</p>
<p><strong>Рис. 18.23.</strong> Настройка сортировки отчета</p>
<p>И в заключение на закладке Другие настройки зададим заголовок отчета – Начисления сотрудникам. </p>
<p>На этом создание схемы компоновки данных закончено, закроем ее. </p>
<p>В окне редактирования объекта конфигурации Отчет НачисленияСотрудникам на закладке подсистемы укажем, что отчет будет
	вызываться из подсистем РасчетЗарплаты и Бухгалтерия.</p>
<p><strong>В режиме «1С:Предприятие»</strong></p>
<p>Запустим «1С:Предприятие» в режиме отладки. </p>
<p>В командной панели раздела Расчет зарплаты выполним команду Начисления сотрудникам и сформируем отчет (рис.
	18.24).</p>
<p><strong>Рис. 18.24.</strong> Результат отчета</p>
<p><strong>Перерасчет</strong></p>
<p>Итак, в нашем алгоритме работы с данными расчета осталось одно узкое место – контроль актуальности данных,
	содержащихся в регистре расчета. </p>
<p>До сих пор мы с вами использовали служебный отчет Перерасчет для того, чтобы определить, являются ли данные в
	регистре расчета актуальными (если отчет пуст), или же они требуют перерасчета.</p>
<p>Теперь мы с вами создадим специальную процедуру, которая будет определять, требуется ли перерасчет данных регистра
	расчета, и, если такая необходимость есть, выполнять перерасчет.</p>
<p>Поскольку единственным способом получения итоговой информации о начислениях сотрудникам в нашей конфигурации является
	отчет НачисленияСотрудникам, для вызова этой процедуры мы создадим форму этого отчета и добавим в командную панель
	формы кнопку Перерассчитать, по которой будет выполняться перерасчет данных регистра.</p>
<p><strong>В режиме «Конфигуратор»</strong></p>
<p>Для этого в окне редактирования объекта конфигурации Отчет НачисленияСотрудникам перейдем на закладку Формы, нажмем
	кнопку открытия <img src="67.jpeg"/> и создадим основную форму отчета. </p>
<p>Затем в правом верхнем окне редактора форм перейдем на закладку Команды и на закладке Команды формы создадим команду
	формы Перерассчитать (рис. 18.25).</p>
<p>Теперь нужно установить Действие для этой команды. </p>
<p>Для этого нажмем кнопку открытия <img src="68.jpeg"/> в строке Действие. </p>
<p>На запрос конфигуратора о типе обработчика команды ответим, что мы хотим создать обработчик, выполняющийся на
	клиенте.</p>
<p>В модуле формы будет создан шаблон клиентской процедуры Перерассчитать(), в которую мы поместим вызов процедуры
	ПерерассчитатьНачисления() из общего модуля ПроведениеРасчетов (листинг 18.8).</p>
<p>Саму процедуру перерасчета поместим в общем модуле Проведе- ниеРасчетов (листинг 18.9).</p>
<p><strong>Рис. 18.25.</strong> Добавление команды формы</p>
<p><strong>листинг 18.8.</strong> Текст обработчика команды «Перерассчитать»</p>
<table>
	<tr>
		<td><p>&amp;НаКлиенте</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Процедура Перерассчитать(Команда)</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ПроведениеРасчетов.ПерерассчитатьНачисления(ПредопределенноеЗначение(</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>&quot;ПланВидовРасчета.ОсновныеНачисления.Оклад&quot;));</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ПроведениеРасчетов.ПерерассчитатьНачисления(ПредопределенноеЗначение(</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>&quot;ПланВидовРасчета.ОсновныеНачисления.Премия&quot;));</p></td>
	</tr>
	<tr>
		<td><p>КонецПроцедуры</p></td>
	</tr>
</table>
<p><strong>листинг 18.9.</strong> Процедура перерасчета начислений</p>
<table>
	<tr>
		<td><p>Процедура ПерерассчитатьНачисления(ТребуемыйВидРасчета) Экспорт</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// Здесь следует выбрать из набора записей перерасчета записи в следующей последовательности:</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// записи документа1 для сотрудников из списка,</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// записи документа2 для сотрудников из списка и т. д.</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Запрос = Новый Запрос(</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>&quot;ВЫБРАТЬ</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p> | НачисленияПерерасчет.ОбъектПерерасчета,</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p> | НачисленияПерерасчет.Сотрудник</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>|ИЗ</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p> | РегистрРасчета.Начисления.Перерасчет КАК НачисленияПерерасчет</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>|ГДЕ</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p> | НачисленияПерерасчет.ВидРасчета = &amp;ТребуемыйВидРасчета</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>|ИТОГИ ПО</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p> | НачисленияПерерасчет.ОбъектПерерасчета&quot;);</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
</table>
<p>Запрос.УстановитьПараметр(&quot;ТребуемыйВидРасчета&quot;, ТребуемыйВидРасчета); СписокСотрудников = Новый
	СписокЗначений;</p>
<table>
	<tr>
		<td><p>// Перебрать группировку по регистратору.</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ВыборкаПоРегистратору = Запрос.Выполнить().Выбрать(ОбходРезультатаЗапроса.ПоГруппировкам);</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Пока ВыборкаПоРегистратору.Следующий() Цикл</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Регистратор = ВыборкаПоРегистратору.ОбъектПерерасчета;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// Перебрать группировку по сотрудникам для выбранного регистратора </p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// и создать список сотрудников.</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ВыборкаПоСотрудникам = ВыборкаПоРегистратору.Выбрать();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>СписокСотрудников.Очистить();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Пока ВыборкаПоСотрудникам.Следующий() Цикл</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p> СписокСотрудников.Добавить(ВыборкаПоСотрудникам.Сотрудник);</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецЦикла;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// Получить набор записей регистра расчета для выбранного регистратора.</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>НаборЗаписей = РегистрыРасчета.Начисления.СоздатьНаборЗаписей();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>НаборЗаписей.Отбор.Регистратор.Значение = Регистратор;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>НаборЗаписей.Прочитать();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>РассчитатьНачисления(НаборЗаписей, ТребуемыйВидРасчета, СписокСотрудников);</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>НаборЗаписей.Записать( , Истина);</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// Очистить перерассчитанные записи в перерасчете.</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>НаборЗаписейПерерасчета = </p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>РегистрыРасчета.Начисления.Перерасчеты.Перерасчет.СоздатьНаборЗаписей();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>НаборЗаписейПерерасчета.Отбор.ОбъектПерерасчета.Значение = Регистратор;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>НаборЗаписейПерерасчета.Записать();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецЦикла;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецПроцедуры</p></td>
	</tr>
</table>
<p>В самом начале процедуры мы запросом выбираем данные о записях перерасчетов, содержащие переданный вид расчета и
	сгруппированные по объекту перерасчета. </p>
<p>Далее при обходе результата запроса мы формируем для каждого объекта перерасчета список сотрудников, читаем
	соответствующие записи регистра расчета и вызываем процедуру РассчитатьНачисления(), которая использовалась нами при
	расчете записей документа НачисленияСотрудникам. </p>
<p>После того как расчет записей выполнен, мы записываем набор записей без формирования записей перерасчета и очищаем
	записи перерасчета по тому объекту перерасчета, который только что обработали.</p>
<p>Вернемся в форму отчета НачислениеСотрудникам.</p>
<p>Итак, мы указали для команды Перерассчитать действие, то есть процедуру для ее выполнения. Но чтобы можно было
	воспользоваться этой командой, нужно создать в форме кнопку и связать ее с этой командой (в строке ИмяКоманды). </p>
<p>Проще всего это сделать перетаскиванием команды из окна Команды формы в окно элементов формы. </p>
<p>Перетащим мышью команду Перерассчитать в группу элементов формы ОсновнаяКоманднаяПанель. </p>
<p>При этом в форме появится кнопка Перерассчитать, а связь кнопки с командой будет установлена автоматически (рис.
	18.26).</p>
<p><strong>В режиме «1С:Предприятие»</strong></p>
<p>Запустим «1С:Предприятие» и проверим, как выполняется перерасчет записей регистра расчета. </p>
<p>Отменим проведение всех документов Начисления сотрудникам и проведем документ Начисления сотрудникам № 1 и затем №
	2. </p>
<p>Сформируем отчет Начисления сотрудникам (рис. 18.27).</p>
<p>Теперь откроем документ Начисления сотрудникам № 1, изменим оклад Гусакова на 10 000 и проведем документ. </p>
<p>В отчете Начисления сотрудникам нажмем кнопку Перерассчитать. </p>
<p><strong>Рис. 18.27.</strong> Отчет «Начисления сотрудникам»</p>
<p>Будет выполнен перерасчет начисления премии Гусакову и Деловому (рис. 18.28).</p>
<p>Чтобы увидеть в отчете актуальные данные, нажмем кнопку Сформировать. </p>
<p>Результат работы отчета будет содержать новые значения премии Гусакова (рис. 18.29).</p>
<p><strong>Рис. 18.29.</strong> Отчет «Начисления сотрудникам»</p>
<p>И, наконец, проведем документ Начисления сотрудникам № 3 и нажмем Перерассчитать в отчете Начисления
	сотрудникам. </p>
<p>Снова будет произведен перерасчет оклада и премии Гусакова </p>
<p>(рис. 18.30).</p>
<p><strong>Рис. 18.30.</strong> Окно служебных сообщений</p>
<p>Затем нажмем кнопку Сформировать. Данные отчета будут содержать актуальные значения начисления оклада и премии (рис.
	18.31).</p>
<p><strong>Рис. 18.31.</strong> Отчет «Начисления сотрудникам»</p>
<h1><a id="_Toc454870675"></a>Лабораторная работа № 30 Создание БД для отдела кадров</h1>
<p><strong>Порядок выполнения работы </strong></p>
<p>1. Ознакомьтесь с теоретическими основами в настоящих указаниях и конспектах лекций. </p>
<p>2. Получите задание у преподавателя. </p>
<p>3. Сделайте скриншоты (кнопка клавиатуры PrtSc) выполненных заданий в текстовом (Word) файле <em>Фамилия_ЛР</em></p>
<p>4. Составьте отчет по лабораторной работе. </p>
<p>5. Отчитайте работу преподавателю.</p>
<p><strong>Диаграмма Ганта</strong></p>
<p>Помимо наглядной демонстрации работы механизма вытеснения записей по периоду действия этот отчет позволит нам
	познакомиться с элементом формы, позволяющим создавать <em>диаграммы Ганта</em>.</p>
<p><em>Диаграмма Ганта</em> представляет собой диаграмму интервалов на шкале времени (рис. 18.32) и отражает
	использование объектами (точками) ресурсов (серий).</p>
<p>Чтобы проще было представить себе составные части диаграммы Ганта, изучим диаграмму, которая должна получиться в
	результате работы создаваемого нами отчета.</p>
<p>Как мы уже говорили, эта диаграмма будет отображать для каждого сотрудника фактический период действия записи по
	каждому из видов расчета, имеющих место для этого сотрудника.</p>
<p><img src="69.jpeg"/></p>
<p><strong>Рис. 18.32.</strong> Пример диаграммы Ганта</p>
<p>Итак, диаграмма Ганта представляет собой совокупность точек, серий и значений для каждой пары точка-серия. </p>
<p>В нашем случае точками диаграммы являются сотрудники, а сериями – виды расчетов. Таким образом, для каждого
	сотрудника существует некоторое значение диаграммы по каждой из серий, то есть по каждому из видов расчета. </p>
<p>Значение диаграммы Ганта представляет собой специальный объект, который автоматически формируется системой на
	основании того, какие точки и какие серии определены для данной диаграммы. </p>
<p>Этот объект является совокупностью (коллекцией) интервалов, то есть может содержать не один, а несколько интервалов,
	которые соответствуют паре серия-точка (создаваемый по умолчанию объект ЗначениеДиаграммыГанта не содержит ни одного
	интервала). Разработчик может получить значение диаграммы, указав интересующую его точку и серию, и затем добавить в
	коллекцию необходимое количество интервалов.</p>
<p>Все интервалы всех значений диаграммы располагаются с привязкой к единой оси времени, что дает возможность видеть их
	взаимное расположение.</p>
<p>Теперь коротко объясним последовательность наших дальнейших действий. </p>
<p>В качестве исходных данных для построения такой диаграммы мы возьмем данные регистра расчета Начисления. Каждая
	запись этого регистра уже содержит все необходимое для построения диаграммы: сотрудника, вид расчета, начало и конец
	интервала. </p>
<p>Нам останется только средствами встроенного языка разместить все это в диаграмме. </p>
<p>Итак, приступим.</p>
<p><strong>В режиме «Конфигуратор»</strong></p>
<p>Создадим новый объект конфигурации Отчет и назовем его ДиаграммаНачислений. </p>
<p>Для этого отчета мы не будем создавать схему компоновки данных, а создадим основную форму отчета и обеспечим
	формирование и настройку диаграммы Ганта с помощью кода на встроенном языке. В окне редактирования объекта
	конфигурации Отчет ДиаграммаНачислений перейдем на закладку Формы, нажмем кнопку открытия <img src="70.jpeg"/> и
	создадим основную форму отчета. </p>
<p>В правом верхнем окне редактора форм на закладке Реквизиты находятся реквизиты формы. Мы видим здесь основной
	реквизит формы Отчет, который был создан автоматически при создании формы. </p>
<p>Нажмем кнопку Добавить и добавим новый реквизит формы. Назовем его ДиаграммаГанта и выберем его тип ДиаграммаГанта
	(рис. 18.33).</p>
<p>Теперь перетащим новый реквизит в окно элементов формы, которое пока пусто. </p>
<p>В окне элементов формы будет создано новое поле для отображения диаграммы Ганта, а в нижнем окне просмотра формы мы
	сразу увидим поле диаграммы (рис. 18.34).</p>
<p><strong>Рис. 18.34.</strong> Добавление диаграммы Ганта в форму</p>
<p>На закладке Команды создадим команду формы Сформировать </p>
<p>(рис. 18.35).</p>
<p><strong>Рис. 18.35.</strong> Добавление команды формы</p>
<p>Теперь нужно установить Действие для этой команды. </p>
<p>Для этого нажмем кнопку открытия <img src="71.jpeg"/> в строке Действие. </p>
<p>На запрос конфигуратора о типе обработчика команды ответим, что мы хотим создать клиентский обработчик команды формы
	с вызовом из него процедуры, выполняющейся на сервере без контекста формы (рис. 18.36).</p>
<p><strong>Рис. 18.36.</strong> Выбор типа обработчика команды формы</p>
<p>В модуле формы будут созданы шаблоны двух процедур: клиентской процедуры Сформировать() и серверной внеконтекстной
	процедуры СформироватьНаСервере(), которая вызывается из процедуры Сформировать().</p>
<p>Мы не будем сейчас подробно рассматривать, что такое серверная внеконтекстная процедура. Отметим только, что
	внеконтекстная процедура выполняется на сервере значительно быстрее за счет того, что на сервер с клиента не
	передается весь контекст формы.</p>
<p>Однако нам нужно передать в процедуру СформироватьНаСервере() в качестве параметра ссылку на реквизит формы
	ДиаграммаГанта, чтобы на сервере заполнить его данными. Поэтому изменим текст модуля следующим образом (листинг
	18.10).</p>
<p><strong>листинг 18.10.</strong> Текст обработчика команды «Сформировать»</p>
<table>
	<tr>
		<td><p>&amp;НаКлиенте</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Процедура Сформировать(Команда)</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>СформироватьНаСервере(<strong>ДиаграммаГанта</strong>);</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецПроцедуры</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>&amp;НаСервереБезКонтекста</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Процедура СформироватьНаСервере(<strong>Диаграмма</strong>)</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// Вставить содержимое обработчика.</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецПроцедуры</p></td>
	</tr>
</table>
<p>В процедуру СформироватьНаСервере() мы вставим заготовку запроса (листинг 18.11).</p>
<p><strong>листинг 18.11.</strong> Процедура «СформироватьНаСервере()»</p>
<table>
	<tr>
		<td><p>&amp;НаСервереБезКонтекста</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Процедура СформироватьНаСервере(Диаграмма)</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Запрос = Новый Запрос;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Запрос.Текст = ;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецПроцедуры</p></td>
	</tr>
</table>
<p>Установим курсор перед точкой с запятой, вызовем контекстное меню, откроем конструктор запроса и создадим новый
	запрос. </p>
<p>Выберем виртуальную таблицу регистра расчета Начисления.ФактическийПериодДействия. </p>
<p>Из этой таблицы выберем следующие поля (рис. 18.37):</p>
<ul>
	<li>Сотрудник,</li>
	<li>ВидРасчета,</li>
	<li>ПериодДействияНачало,</li>
	<li>ПериодДействияКонец,</li>
	<li>Результат,</li>
	<li>Регистратор,</li>
</ul>
<p><strong>Рис. 18.37.</strong> Выбранные поля</p>
<p>Все, запрос готов. </p>
<p>Теперь нажмем OK и после текста запроса добавим в процедуру следующий текст (листинг 18.12). <strong>листинг
	18.12.</strong> Процедура «СформироватьНаСервере()»</p>
<table>
	<tr>
		<td><p>&amp;НаСервереБезКонтекста</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Процедура СформироватьНаСервере(Диаграмма)</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Запрос = Новый Запрос;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Запрос.Текст = </p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>&quot;ВЫБРАТЬ</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p> | НачисленияФактическийПериодДействия.Сотрудник,</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p> | НачисленияФактическийПериодДействия.ВидРасчета,</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p> | НачисленияФактическийПериодДействия.ПериодДействияНачало,</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p> | НачисленияФактическийПериодДействия.ПериодДействияКонец,</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p> | НачисленияФактическийПериодДействия.Результат,</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p> | НачисленияФактическийПериодДействия.Регистратор,</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p> | НачисленияФактическийПериодДействия.Регистратор.Представление</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>|ИЗ</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p> | РегистрРасчета.Начисления.ФактическийПериодДействия </p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p> | КАК НачисленияФактическийПериодДействия&quot;;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>ВыборкаРезультата = Запрос.Выполнить().Выбрать();</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>// Запретить обновление диаграммы.</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>Диаграмма.Обновление = Ложь;</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>Диаграмма.Очистить();</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>Диаграмма.ОтображатьЗаголовок = Ложь;</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>// Заполнить диаграмму.</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>Пока ВыборкаРезультата.Следующий() Цикл</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>// Получить серию, точку и значение для них.</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>ТекущаяСерия = Диаграмма.УстановитьСерию(ВыборкаРезультата.ВидРасчета);</strong></p></td>
	</tr>
</table>
<p><strong>ТекущаяТочка = Диаграмма.УстановитьТочку(ВыборкаРезультата.Сотрудник);</strong></p>
<p><strong>ТекущееЗначение = Диаграмма.ПолучитьЗначение(ТекущаяТочка, ТекущаяСерия);</strong></p>
<table>
	<tr>
		<td><p><strong>// Создать нужные нам интервалы в значении. </strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>ТекущийИнтервал = ТекущееЗначение.Добавить();</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>ТекущийИнтервал.Начало = ВыборкаРезультата.ПериодДействияНачало;</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>ТекущийИнтервал.Конец = ВыборкаРезультата.ПериодДействияКонец;</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>ТекущийИнтервал.Текст = ВыборкаРезультата.РегистраторПредставление;</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>ТекущийИнтервал.Расшифровка = ВыборкаРезультата.Регистратор;</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>КонецЦикла;</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>// Раскрасить серии своими цветами.</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>Для Каждого Серия из Диаграмма.Серии Цикл</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>Если Серия.Значение = ПланыВидовРасчета.ОсновныеНачисления.Оклад Тогда</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>Серия.Цвет = WEBЦвета.Желтый;</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>ИначеЕсли Серия.Значение = ПланыВидовРасчета.ОсновныеНачисления.Премия Тогда</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>Серия.Цвет = WEBЦвета.Зеленый;</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>ИначеЕсли Серия.Значение = ПланыВидовРасчета.ОсновныеНачисления.Невыход Тогда</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>Серия.Цвет = WEBЦвета.Красный;</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>КонецЕсли;</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>КонецЦикла;</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>// Разрешить обновление диаграммы.</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>Диаграмма.Обновление = Истина;</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецПроцедуры</p></td>
	</tr>
</table>
<p>Сначала мы запрещаем обновление диаграммы на то время, пока мы будем заполнять ее данными. Это нужно для того, чтобы
	в процессе заполнения не выполнялись пересчеты при каждом изменении данных диаграммы. После окончания заполнения
	диаграммы мы разрешим обновление, и все пересчеты будут выполнены один раз.</p>
<p>Затем в цикле по выборке запроса мы заполняем диаграмму. </p>
<p>Сначала, используя методы УстановитьСерию() и Установить Точку(), мы получаем либо существующие, либо новые точку и
	серию. Точки и серии однозначно идентифицируются своими значениями, в качестве которых мы используем сотрудника и
	вид расчета из результата запроса.</p>
<p>После того как точка и серия получены, с помощью метода ПолучитьЗначение() мы получаем соответствующее им значение
	диаграммы.</p>
<p>Затем мы добавляем в значение диаграммы новый интервал, задаем его начало и конец, задаем текст интервала, который
	будет показываться во всплывающей подсказке, и задаем расшифровку интервала, которая будет выполняться при двойном
	щелчке мышью на этом интервале.</p>
<p>После того как все значения диаграммы сформированы, мы раскрашиваем серии своими цветами. Серии диаграммы
	представляют собой коллекцию значений, которую мы перебираем при помощи конструкции Для Каждого … Цикл.</p>
<p>Теперь вернемся в форму и добавим в нее кнопку для выполнения команды Сформировать. </p>
<p>Для этого перетащим мышью команду Сформировать из окна Команды формы в окно элементов формы (рис. 18.38).</p>
<p>В заключение в окне редактирования объекта конфигурации Отчет ДиаграммаНачислений на закладке подсистемы укажем, что
	отчет будет вызываться из подсистемы РасчетЗарплаты.</p>
<p><strong>В режиме «1С:Предприятие»</strong></p>
<p>Запустим «1С:Предприятие» в режиме отладки и посмотрим на результат работы отчета (рис. 18.39).</p>
<p><strong>Рис. 18.39.</strong> Отчет «Диаграмма начислений»</p>
<p>А теперь посмотрим, как выглядит механизм вытеснения по периоду действия на конкретном примере.</p>
<p>Откроем документ Начисления сотрудникам № 3 и вместо одного прогула с 1 по 10 число зададим Гусакову два прогула: с 3
	по 7 число и с 12 по 15 число. </p>
<p>Проведем документ и снова нажмем Сформировать в нашем отчете (рис. 18.40).</p>
<p><strong>Рис. 18.40.</strong> Отчет «Диаграмма начислений»</p>
<p>Теперь вы наглядно видите, как записи вида расчета Невыход вытеснили по периоду действия запись расчета Оклад,
	изменив ее фактический период действия.</p>
<p>Следует отметить, что существует также возможность интерактивной настройки параметров диаграммы Ганта в режиме
	1С:Предприятие, доступная через пункт контекстного меню Настройка… Также настройку параметров диаграммы, таких как
	Отображать заголовок, Отображать легенду, Прозрачный фон и т. п., можно выполнить в конфигураторе, в редакторе формы
	отчета Диаграмма начислений. Для этого в панели свойств реквизита, содержащего диаграмму, нужно выполнить команду
	Настройка Открыть.</p>
<h1><a id="_Toc454870676"></a>Лабораторная работа № 31Программирование документов</h1>
<p><strong>Порядок выполнения работы </strong></p>
<p>1. Ознакомьтесь с теоретическими основами в настоящих указаниях и конспектах лекций. </p>
<p>2. Получите задание у преподавателя. </p>
<p>3. Сделайте скриншоты (кнопка клавиатуры PrtSc) выполненных заданий в текстовом (Word) файле <em>Фамилия_ЛР</em></p>
<p>4. Составьте отчет по лабораторной работе. </p>
<p>5. Отчитайте работу преподавателю.</p>
<p><strong>Полнотекстовый индекс</strong></p>
<p>Прежде всего, познакомимся со свойствами конфигурации и ее объектов, которые отвечают за полнотекстовый поиск. </p>
<p><strong>В режиме «Конфигуратор»</strong></p>
<p>Каждый объект конфигурации, данные которого могут участвовать в полнотекстовом индексировании, имеет свойство
	Полнотекстовый поиск. По умолчанию при создании нового объекта это свойство установлено в значение
	Использовать. </p>
<p>Таким образом, в данный момент от нас не требуется вносить какиелибо изменения, но, тем не менее, для знакомства
	откроем окно редактирования объекта конфигурации Справочник Номенклатура на закладке Прочее (рис. 19.1).</p>
<p>Кроме объектов конфигурации свойство Полнотекстовый поиск существует и у реквизитов этих объектов. Таким образом, мы
	имеем возможность указывать конкретные реквизиты, данные которых должны участвовать в полнотекстовом
	индексировании. </p>
<p><strong>Рис. 19.1.</strong> Свойство «Полнотекстовый поиск»</p>
<p>По умолчанию для новых реквизитов это свойство также устанавливается в значение Использовать, поэтому и в данном
	случае не требуется вносить каких-либо изменений. </p>
<p>Например, откроем палитру свойств реквизита ВидНоменклатуры справочника Номенклатура (рис. 19.2).</p>
<p><strong>Рис. 19.2.</strong> Свойство </p>
<p>«Полнотекстовый поиск»</p>
<p>Таким образом, по умолчанию в нашей конфигурации полнотекстовый поиск используется для всех возможных реквизитов всех
	возможных объектов конфигурации. </p>
<p>Перейдем в режим 1С:Предприятие.</p>
<p><strong>В режиме «1С:Предприятие»</strong></p>
<p>Выполним команду главного меню приложения Все функции  Стандартные  Управление полнотекстовым поиском (рис.
	19.3).</p>
<p><strong>Рис. 19.3.</strong> Вызов диалога управления полнотекстовым поиском</p>
<p>В результате будет открыто окно управления полнотекстовым поиском (рис. 19.4).</p>
<p><strong>Рис. 19.4.</strong> Окно управления полнотекстовым поиском</p>
<p>Это окно позволяет создавать и обновлять полнотекстовый индекс интерактивно. Кроме этого, оно позволяет разрешать или
	запрещать вообще все операции, связанные с полнотекстовым поиском: обновление, очистка полнотекстового индекса,
	полнотекстовый поиск.</p>
<p>Как вы видите, по умолчанию полнотекстовый поиск стандартно разрешен.</p>
<p>Также система сообщает нам о том, что требуется обновление полнотекстового индекса. Это действительно так, потому что
	в нашем случае индекс вообще отсутствует (дата актуальности индекса пуста). Для того чтобы создать (или обновить)
	полнотекстовый индекс, нажмем кнопку Обновить индекс. </p>
<p>Обратите внимание, что при больших размерах информационной базы создание и обновление полнотекстового индекса могут
	занимать несколько минут. Поэтому в процессе обновления индекса в нижнем правом углу экрана всплывает сообщение о
	том, какая часть данных в данный момент обрабатывается. </p>
<p>После того как создание полнотекстового индекса будет закончено, система сообщит об этом (рис. 19.5), и в окне
	управления полнотекстовым поиском будет отображена дата актуальности полнотекстового индекса – дата, когда последний
	раз выполнялось обновление индекса (см. рис. 19.6).</p>
<p><strong>Рис. 19.6.</strong> Окно управления полнотекстовым поиском</p>
<p>Итак, мы создали полнотекстовый индекс для нашей информационной базы. Теперь, используя этот индекс, выполним
	полнотекстовый поиск в базе данных.</p>
<h1><a id="_Toc454870677"></a>Лабораторная работа № 32 Система учета библиотеки</h1>
<p><strong>Порядок выполнения работы </strong></p>
<p>1. Ознакомьтесь с теоретическими основами в настоящих указаниях и конспектах лекций. </p>
<p>2. Получите задание у преподавателя. </p>
<p>3. Сделайте скриншоты (кнопка клавиатуры PrtSc) выполненных заданий в текстовом (Word) файле <em>Фамилия_ЛР</em></p>
<p>4. Составьте отчет по лабораторной работе. </p>
<p>5. Отчитайте работу преподавателю.</p>
<p><strong>Примеры поиска в базе данных</strong></p>
<p><strong>В режиме «1С:Предприятие»</strong></p>
<p>Поиск в данных на основе полнотекстового индекса является стандартной функцией платформы «1С:Предприятие». Для начала
	поиска достаточно нажать кнопку Поиск (со значком лупы) в панели инструментов приложения (рис. 19.7).</p>
<p>Количество данных в нашей базе данных невелико, но даже и на них мы сможем познакомиться с основными возможностями
	полнотекстового поиска. </p>
<p>Для начала попробуем найти данные, связанные с Ивановым. Введем в строку поиска значение иванов и нажмем Найти или
	клавишу Enter (рис. 19.8).</p>
<p><strong>Рис. 19.8.</strong> Поиск по выражению «иванов»</p>
<p>Результат поиска содержит 5 элементов, и найденные слова в реквизитах этих элементов выделены жирным шрифтом. </p>
<p>Обратите внимание, что кроме элемента справочника Иванов и документа оказания услуги клиенту Иванов система нашла
	также и другие объекты, которые содержат различные словоформы введенного выражения (в данном случае – Иван). </p>
<p>Чтобы выполнить точный поиск по указанному выражению, его необходимо заключить в кавычки (рис. 19.9).</p>
<p><strong>Рис. 19.9.</strong> Поиск по выражению «иванов»</p>
<p>Часто пользователь не помнит точно, например, название номенклатуры. В этом случае можно выполнить поиск по
	нескольким начальным символам слова, заменив последние символы звездочкой (*). Например, при поиске по выражению
	тран* будут найдены элементы номенклатуры: транзистор и трансформатор (рис. 19.10).</p>
<p><strong>Рис. 19.10.</strong> Поиск по первым символам поискового слова</p>
<p>Как правило, для получения наилучших результатов полнотекстового поиска рекомендуется использовать в поисковом
	выражении пару слов. </p>
<p>Например, если требуется узнать, какого числа клиенту Симонову заменили трансформатор в телевизоре, можно ввести
	поисковое выражение трансформатор симонов (рис. 19.11).</p>
<p><strong>Рис. 19.11.</strong> Поиск по выражению «трансформатор Симонов»</p>
<p>При нажатии на гиперссылку система откроет документ Оказание услуги № 3, и можно будет просмотреть полный перечень
	работ, выполненных для этого клиента.</p>
<p>Система индексирует не только данные, содержащиеся в объектах конфигурации, но и имена реквизитов и объектов
	метаданных. </p>
<p>Поэтому, например, если требуется найти информацию о сотруднике по фамилии Деловой, в поисковом выражении следует
	указать имя справочника, который нас интересует: сотрудник деловой (рис. 19.12).</p>
<p><strong>Рис. 19.12.</strong> Поиск по выражению «сотрудник Деловой»</p>
<p>Как видите, система нашла также и документы начисления сотрудникам, которые содержат формы слова «сотрудники», но,
	несмотря на это, искомый нами справочник Сотрудники находится первым в списке найденных.</p>
<p>Система позволяет выполнять также нечеткий поиск. Например, пользователь не уверен в правильности написания
	поискового слова. В этом случае в поисковом выражении можно задать признак нечеткого поиска – решетку (#) и
	количество символов после нее, на которое поисковое выражение может отличаться от оригинала в базе данных. В
	результате, даже если пользователь ввел в поисковую строку римонт#2, в базе данных будут найдены все объекты,
	содержащие слово ремонт (рис. 19.13).</p>
<p><strong>Рис. 19.13.</strong> Нечеткий поиск по выражению «римонт»</p>
<p>Также можно выполнять поиск по синонимам слов. Для этого перед поисковым выражением нужно поставить символ !
	(восклицательный знак). Например, поиск по выражению !починка даст такой же результат (см. рис. 19.13), так как
	ремонт и починка являются синонимами.</p>
<p>Для составления поисковых выражений можно использовать разнообразные операторы, которые подробно описаны в
	документации «1С:Предприятие 8.3. Руководство разработчика», приложение 5 «Поисковые выражения полнотекстового
	поиска». Их использование не должно вызвать у вас затруднений.</p>
<p>Форма поиска, которая появляется при нажатии кнопки Поиск в панели инструментов приложения (рис. 19.7–19.13),
	стандартно генерируется платформой. Так происходит потому, что свойство конфигурации ОсновнаяФормаПоиска по
	умолчанию не определено. </p>
<p>Но при желании можно внести изменения в стандартный механизм поиска. Для этого нужно нажать кнопку открытия (со
	значком лупы) возле этого свойства. При этом будет вызван конструктор общих форм и сконструирована ровно та форма,
	которую вызывает платформа. Можно изменить ее по своему желанию, и тогда для поиска будет использоваться именно
	она.</p>
<p><strong>Поиск при вводе по строке</strong></p>
<p><strong>В режиме «Конфигуратор»</strong></p>
<p>В платформе «1С:Предприятие» реализован мощный механизм поиска при вводе по строке в поле ввода. Мы с вами уже
	неоднократно использовали его, когда добавляли номенклатуру в табличную часть документов.</p>
<p>Настроить параметры поиска при вводе по строке можно на закладке Поле ввода окна редактирования объектов
	конфигурации, которые используются в прикладном решении в качестве ссылочных полей. При этом можно настроить
	свойства: Способ поиска строки (по умолчанию – Начало), Полнотекстовый поиск (по умолчанию – Не использовать) и
	Режим получения данных выбора (по умолчанию – Непосредственно).</p>
<p>Установим параметры поиска поля ввода для справочника Номенклатура так, как показано на рис. 19.14.</p>
<p>Таким образом, при вводе значений в поля, ссылающиеся на номенклатуру, будет использоваться полнотекстовый поиск, и
	этот поиск будет выполняться в фоновом режиме, т. е. с помощью фонового задания. Возможность задействовать
	полнотекстовый поиск, а также возможность выполнять поиск фоновым заданием наиболее полезна при больших объемах
	данных.</p>
<p>Если база данных невелика, то можно не использовать полнотекстовый поиск, но при этом искать в любом месте поля
	ввода, а не только по началу строки (Способ поиска строки – Любая часть).</p>
<p><strong>Рис. 19.14.</strong> Свойства поиска по строке в поле ввода</p>
<p>Все перечисленные свойства можно, при необходимости, переопределить в процессе выполнения прикладного решения из
	встроенного языка. Для этого используются клиентские обработчики событий поля ввода АвтоПодбор и
	ОкончаниеВводаТекста. А также это можно сделать в модуле менеджера того объекта, в данных которого выполняется
	поиск, в обработчике события ОбработкаПолученияДанныхВыбора (за исключением свойства
	РежимПолученияДанныхВыбора).</p>
<p><strong>В режиме «1С:Предприятие»</strong></p>
<p>Запустим «1С:Предприятие» и начнем вводить новую цену на номенклатуру в регистр Цены на номенклатуру.</p>
<p>Как только мы начинаем вводить символы в поле ввода Номенклатура, имеющего тип ссылки на номенклатуру, в выпадающем
	окне под полем ввода отображаются наименования номенклатуры, содержащие в начале слов, составляющих название,
	введенные нами символы (рис. 19.15).</p>
<p><strong>Рис. 19.15.</strong> Поиск по строке в поле ввода</p>
<p>При этом согласно установленным в конфигураторе свойствам будет задействован полнотекстовый поиск, который будет
	выполняться в фоновом режиме.</p>
<h1><a id="_Toc454870678"></a>Лабораторная работа № 33 Программирование отчетов</h1>
<p><strong>Порядок выполнения работы </strong></p>
<p>1. Ознакомьтесь с теоретическими основами в настоящих указаниях и конспектах лекций. </p>
<p>2. Получите задание у преподавателя. </p>
<p>3. Сделайте скриншоты (кнопка клавиатуры PrtSc) выполненных заданий в текстовом (Word) файле <em>Фамилия_ЛР</em></p>
<p>4. Составьте отчет по лабораторной работе. </p>
<p>5. Отчитайте работу преподавателю.</p>
<p><strong>Создание регламентных заданий </strong></p>
<p><strong>В режиме «Конфигуратор»</strong></p>
<p>Сначала создадим первое регламентное задание по обновлению индекса. </p>
<p>Раскроем ветвь Общие дерева объектов конфигурации. Выделим строку Регламентные задания и добавим новый объект
	конфигурации Регламентное задание. Зададим его имя – ОбновлениеИндекса (рис. 20.1).</p>
<p>После этого создадим процедуру, которая и будет выполнять обновление полнотекстового индекса нашей информационной
	базы. </p>
<p><strong>Рис. 20.1.</strong> Создание регламентного задания</p>
<p>В качестве такой процедуры может выступать любая процедура или функция неглобального общего модуля, которую можно
	вызвать на сервере (у общего модуля должно быть установлено свойство Сервер).</p>
<p>Добавим в конфигурацию общий модуль с именем Регламент- ныеПроцедуры и установим флажок Вызов сервера для видимости
	его экспортных процедур и функций </p>
<p>(рис. 20.2).</p>
<p><strong>Рис. 20.2.</strong> Свойства общего модуля</p>
<p>Вернемся к свойствам регламентного задания ОбновлениеИндекса. Нажмем кнопку открытия <img src="72.jpeg"/> у поля
	ввода Имя метода. </p>
<p>Система откроет окно выбора общего модуля (рис. 20.3).</p>
<p><strong>Рис. 20.3.</strong> Выбор обработчика события</p>
<p>Выберем модуль РегламентныеПроцедуры. В этом модуле будет создан шаблон процедуры ОбновлениеИндекса(). Заполним его
	следующим образом (листинг 20.1).</p>
<p><strong>листинг 20.1.</strong> Процедура обновления индекса</p>
<table>
	<tr>
		<td><p>Если ПолнотекстовыйПоиск.ПолучитьРежимПолнотекстовогоПоиска() = </p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>РежимПолнотекстовогоПоиска.Разрешить Тогда</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Если Не ПолнотекстовыйПоиск.ИндексАктуален() Тогда</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ПолнотекстовыйПоиск.ОбновитьИндекс( , Истина);</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецЕсли;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецЕсли;</p></td>
	</tr>
</table>
<p>Сначала в этой процедуре проверяется возможность выполнения операций, связанных с полнотекстовым поиском (ведь они
	могут быть запрещены, например, интерактивно, см. рис. 19.4.).</p>
<p>Если операции полнотекстового поиска разрешены, проверяется, актуален ли полнотекстовый индекс (если после последнего
	индексирования данные, подлежащие полнотекстовому индексированию, не изменялись, то индекс будет актуален и
	повторное индексирование не требуется). </p>
<p>В случае необходимости индексирования вызывается метод ОбновитьИндекс() менеджера полнотекстового поиска. </p>
<p>Первый параметр этого метода отвечает за слияние индексов и по умолчанию имеет значение Ложь. Это значит, что слияние
	индексов выполняться не будет. </p>
<p>Второй параметр метода определяет, какое количество данных будет индексироваться: сразу все, которые необходимо
	проиндексировать, или порциями. Наша задача – выполнить индексирование как можно быстрее, поэтому указываем, что
	индексирование будет выполняться порциями (значение Истина). </p>
<p>Размер одной порции фиксирован – 10 000 объектов. Таким образом, если в данный момент требуется проиндексировать,
	например, 15 000 объектов, то при вызове этого метода из них будет проиндексировано только 10 000 (первая порция), а
	оставшиеся объекты будут проиндексированы при следующем вызове этого метода (при следующем запуске нашего
	регламентного задания).</p>
<p>Перейдем к составлению расписания запуска регламентного задания. </p>
<p>Нажмем на ссылку Открыть в свойствах регламентного задания (в строке Расписание), и система откроет диалог
	редактирования расписания (рис. 20.4).</p>
<p><strong>Рис. 20.4.</strong> Диалог редактирования расписания</p>
<p>Диалог содержит несколько закладок, которые позволяют задать различные виды расписаний; в нижней части диалога
	отображается итоговый результат всех установок.</p>
<p>Наша задача – запускать регламентное задание ежедневно, каждую минуту. </p>
<p>закладке Общие укажем, что запуск задания должен повторяться каждый день </p>
<p>(Повторять каждые: 1 дн.), рис. 20.5.</p>
<p><strong>Рис. 20.5.</strong> Запуск задания каждый день</p>
<p>задания в течение дня. </p>
<p>Укажем, что запуск задания должен повторяться каждые 60 секунд </p>
<p>(Повторять через: 60 сек.), рис. 20.6.</p>
<p><strong>Рис. 20.6.</strong> Запуск задания каждую минуту</p>
<p>В нижней части диалога отображено созданное нами расписание запуска: Выполнять: каждый день; каждые 60 сек. </p>
<p>Вроде бы мы получили то, что хотели: регламентное задание запускается ежедневно, каждую минуту. </p>
<p>Однако наше ООО «На все руки мастер» не работает круглосуточно, и запуск этого задания в ночное время будет явно
	бесполезным – данные в базе данных не изменяются. В то же время вполне возможна ситуация, когда некоторые сотрудники
	задерживаются после окончания рабочего </p>
<p>Поэтому доработаем расписание следующим образом: укажем Время начала: 08:00 (рис. 20.7).</p>
<p><strong>Рис. 20.7.</strong> Указание времени начала запуска</p>
<p>В результате запуск задания будет выполняться не круглые сутки, а только с 8 часов утра. Так как время окончания
	запуска не указано, запуск задания будет прекращен по окончании текущих суток. Таким образом, с 00:00 до 08:00 часов
	запуск задания выполняться не будет. </p>
<p>На этом создание расписания регламентного задания закончено, нажмем ОK.</p>
<p>В качестве последнего штриха установим в свойствах регламентного задания флажок Предопределенное (рис. 20.8).</p>
<p>Установка этого свойства означает, что после запуска системы в режиме 1С:Предприятие будет создано одно
	предопределенное регламентное задание. В противном случае такое задание пришлось бы создавать средствами встроенного
	языка. </p>
<p>На этом создание регламентного задания Обновление индекса завершено.</p>
<p><strong>Рис. 20.8.</strong> Предопределенное регламентное задание</p>
<p>Теперь по аналогии создадим второе регламентное задание – СлияниеИндексов. В палитре его свойств нажмем кнопку
	открытия <img src="73.jpeg"/> у поля ввода Имя метода. В открывшемся диалоге выберем модуль РегламентныеПроцедуры.
</p>
<p>В этом модуле будет создан шаблон процедуры СлияниеИндексов(). Заполним его следующим образом (листинг 20.2).</p>
<p><strong>листинг 20.2.</strong> Процедура «СлияниеИндексов»</p>
<table>
	<tr>
		<td><p>Если ПолнотекстовыйПоиск.ПолучитьРежимПолнотекстовогоПоиска() = </p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>РежимПолнотекстовогоПоиска.Разрешить Тогда</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Если Не ПолнотекстовыйПоиск.ИндексАктуален() Тогда</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ПолнотекстовыйПоиск.ОбновитьИндекс(Истина);</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецЕсли;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецЕсли;</p></td>
	</tr>
</table>
<p>Эта процедура аналогична показанной в листинге 20.1, за исключением того, что при обновлении индекса выполняется
	слияние индексов (первый параметр Истина), и индексирование выполняется целиком, для всех данных (второй параметр
	Ложь по умолчанию), поскольку в данном случае время выполнения индексирования для нас не критично.</p>
<p>В свойствах задания установим также флажок Предопределенное и приступим к редактированию расписания. Для этого нажмем
	на ссылку Открыть в свойствах регламентного задания (в строке Расписание).</p>
<p>На закладке Общее укажем, что задание будет запускаться каждый день (Повторять каждые: 1 дн.), а на закладке Дневное
	укажем время начала выполнения задания (Время начала: 01:00), рис. 20.9.</p>
<p>В результате мы получим следующее расписание запуска регламентного задания: Выполнять: каждый день; с 1:00 один раз в
	день. </p>
<p>На этом создание регламентного задания СлияниеИндексов завершено, нажмем ОK.</p>
<p><strong>Запуск регламентных заданий</strong></p>
<p>Дальнейшее выполнение регламентных заданий не требует никаких дополнительных действий разработчика.</p>
<p>Система «1С:Предприятие» поддерживает два варианта работы: файловый и клиент-серверный. </p>
<p>Наша демонстрационная информационная база работает в файловом варианте работы. При старте клиентского приложения
	запускается еще один поток с подключением к базе данных, последовательно выполняющий регламентные задания,
	инициированные клиентом.</p>
<p>Если бы наша информационная база работала в клиент-серверном варианте, то для автоматического запуска и выполнения
	созданных нами заданий также не требовалось бы дополнительных действий. </p>
<p>Можно было бы обновить конфигурацию базы данных, и менеджер кластера серверов «1С:Предприятия» начал бы
	самостоятельно выполнять задания в соответствии с указанным расписанием. </p>
<p><strong>В режиме «1С:Предприятие»</strong></p>
<p>Итак, проверим, как работают наши регламентные задания. </p>
<p>Запустим «1С:Предприятие» и изменим состояние базы данных. Например, добавим новый элемент номенклатуры и затем
	удалим его. Подождем пару минут. </p>
<p>Затем выполним команду главного меню приложения Все функции &gt; Стандартные &gt; Управление полнотекстовым поиском.
	Дата актуальности индекса будет соответствовать дате и времени нашей последней манипуляции с базой данных плюс еще
	минуту (рис. 20.10).</p>
<p><strong>Рис. 20.10.</strong> Изменение даты актуальности полнотекстового индекса</p>
<p>Таким образом, мы видим, что задание обновления индекса запускается каждые 60 секунд, как мы и указали в расписании.
	Чтобы обеспечить выполнение обоих регламентных заданий, нужно не закрывать хотя бы один экземпляр приложения в
	течение суток.</p>
<h1><a id="_Toc454870679"></a>Лабораторная работа № 34 Интернет-магазин</h1>
<p><strong>Порядок выполнения работы </strong></p>
<p>1. Ознакомьтесь с теоретическими основами в настоящих указаниях и конспектах лекций. </p>
<p>2. Получите задание у преподавателя. </p>
<p>3. Сделайте скриншоты (кнопка клавиатуры PrtSc) выполненных заданий в текстовом (Word) файле <em>Фамилия_ЛР</em></p>
<p>4. Составьте отчет по лабораторной работе. </p>
<p>5. Отчитайте работу преподавателю.</p>
<p><strong>В режиме «Конфигуратор»</strong></p>
<p>Создадим новый объект конфигурации Документ с именем ВводНачальныхОстатковНоменклатуры. </p>
<p>На закладке Движения запретим проведение документа (поскольку сами будем формировать записи регистра) и отметим, что
	движения документа будут находиться в регистре накопления ОстаткиМатериалов (рис. 21.1).</p>
<p>После этого перейдем на закладку Формы и создадим основную форму документа. </p>
<p>В окне редактора форм на закладке Реквизиты раскроем основной реквизит формы Объект, затем раскроем коллекцию
	движений Движения, найдем строку ОстаткиМатериалов и перетащим ее в окно элементов формы. На вопрос системы
	«Добавить колонки таблицы?» ответим утвердительно (рис. 21.2). </p>
<p>Обратите внимание, что в палитре свойств этой таблицы в строке Данные автоматически будет установлена связь с данными
	набора записей регистра Объект.Движения.ОстаткиМатериалов. </p>
<p><strong>Рис. 21.2.</strong> Редактирование формы документа </p>
<p>«Ввод начальных остатков номенклатуры»</p>
<p>Немного изменим внешний вид формы. В окне элементов формы добавим группу полей типа Обычная группа без отображения с
	типом группировки Горизонтальная и перетащим в нее поля документа Номер и Дата. А также поменяем местами поля
	таблицы Движе- нияОстаткиМатериалов НаборСвойств и Склад (рис. 21.3).</p>
<p><strong>Рис. 21.3.</strong> Измененная форма документа </p>
<p>«Ввод начальных остатков номенклатуры»</p>
<p>В заключение отредактируем командный интерфейс формы документа, чтобы в панели навигации формы иметь возможность
	переходить к списку записей регистра ОстаткиМатериалов, связанному с документом. </p>
<p>Для этого в левом верхнем окне редактора форм перейдем на закладку Командный интерфейс. </p>
<p>В группе Панель навигации в подгруппе Перейти установим видимость для команды открытия регистра Остатки материалов
	(рис. 21.4).</p>
<p><strong>Рис. 21.4.</strong> Редактирование командного интерфейса формы</p>
<p>В окне редактирования объекта конфигурации Документ ВводНачальныхОстатковНоменклатуры на закладке Подсистемы мы
	укажем его принадлежность к подсистеме Бухгалтерия. </p>
<p>В заключение отредактируем командный интерфейс этой подсистемы. Для этого в дереве объектов конфигурации выделим
	подсистему Бухгалтерия, вызовем контекстное меню и выполним команду Открыть командный интерфейс. </p>
<p>В группе Панель действий.Создать включим видимость у команды Ввод начальных остатков номенклатуры: создать. </p>
<p><strong>В режиме «1С:Предприятие»</strong></p>
<p>Запустим «1С:Предприятие» в режиме отладки и проверим работу нашего документа. </p>
<p>Выполним команду Ввод начальных остатков номенклатуры в разделе Бухгалтерия. </p>
<p>Создадим документ для ввода начальных остатков в регистр ОстаткиМатериалов и внесем в него следующие данные (рис.
	21.5).</p>
<p><strong>Рис. 21.5.</strong> Документ «Ввод начальных остатков номенклатуры № 1»</p>
<p>Обратите внимание на то, что дата документа не совпадает с датами отдельных записей, которые мы создаем в движениях
	документа. </p>
<p>Нажмем Записать и в панели навигации формы документа перейдем к движениям нашего документа в регистре
	ОстаткиМатериалов </p>
<p>(рис. 21.6).</p>
<p><strong>Рис. 21.6.</strong> Записи регистра «ОстаткиМатериалов»</p>
<p>Таким образом, мы добились поставленной цели: с одной стороны, задавая дату документа, мы можем фиксировать момент
	внесения изменений в записи регистра; с другой стороны, для каждой создаваемой нами записи регистра мы можем указать
	индивидуальное значение поля Период.</p>
<p>Теперь займемся ужесточением требований, предъявляемых к тому, как наш документ формирует записи регистра, и
	рассмотрим два типичных варианта.</p>
<p><strong>Программное редактирование записей регистра</strong></p>
<p><strong>Запись движений регистра из формы</strong></p>
<p><strong>В режиме «Конфигуратор»</strong></p>
<p>Первое требование, которое мы реализуем, будет заключаться в том, что записи регистра должны формироваться той же
	датой, что и дата документа. Иначе говоря, синхронизируем дату движений с датой документа.</p>
<p>Для этого создадим для формы документа клиентский обработчик события ПередЗаписью и добавим в него следующий текст
	(листинг 21.1). <strong>листинг 21.1.</strong> Обработчик события «ПередЗаписью» формы документа</p>
<table>
	<tr>
		<td><p>Для Каждого ЗаписьРегистра Из Объект.Движения.ОстаткиМатериалов Цикл</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ЗаписьРегистра.Период = Объект.Дата;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецЦикла;</p></td>
	</tr>
</table>
<p><strong>В режиме «1С:Предприятие»</strong></p>
<p>Снова запустим «1С:Предприятие» в режиме отладки, откроем наш документ и нажмем Записать. </p>
<p>Открыв движения документа в регистре ОстаткиМатериалов, увидим, что значение поля Период у всех записей стало равно
	дате документа (рис. 21.7).</p>
<p><strong>Рис. 21.7.</strong> Измененные записи регистра «ОстаткиМатериалов»</p>
<p>Можно сказать, что мы достигли поставленной цели, но лишь в ситуации, когда запись документа выполняется
	интерактивными средствами. </p>
<p><strong>Программная запись движений регистра</strong></p>
<p>Если программно вызвать метод Записать() у объекта нашего документа, он будет записан без участия формы документа.
	Это значит, что событие ПередЗаписью формы документа вызвано не будет и наш код обработчика не отработает.</p>
<p>Чтобы предусмотреть возможность синхронизации периода движений документа с датой документа и в случае программной
	записи объекта Документ, следует использовать обработчик события ПередЗаписью объекта Документ, а не формы
	документа.</p>
<p>Событие ПередЗаписью в случае интерактивной записи документа сначала будет вызвано у формы документа, а затем у
	объекта Документ. </p>
<p><strong>В режиме «Конфигуратор»</strong></p>
<p>Поэтому вернемся в конфигуратор, закомментируем в модуле формы добавленный нами текст и создадим обработчик события
	ПередЗаписью в модуле объекта Документ ВводНачальныхОстатковНоменклатуры. </p>
<p>Для этого на закладке Прочее окна редактирования этого объекта конфигурации откроем модуль объекта и внесем в него
	следующий текст (листинг 21.2). <strong>листинг 21.2.</strong> Обработчик события «ПередЗаписью» модуля объекта </p>
<table>
	<tr>
		<td><p>Процедура ПередЗаписью(Отказ, РежимЗаписи, РежимПроведения)</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// Определить, нужно ли обновлять дату в движениях.</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ОбновитьДатуДвижений = ЭтоНовый() Или Движения.ОстаткиМатериалов.Модифицированность();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Если Не ОбновитьДатуДвижений Тогда</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// Проверить, что дата изменилась.</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Запрос = Новый Запрос;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Запрос.УстановитьПараметр(&quot;ТекущийДокумент&quot;, Ссылка);</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Запрос.Текст = </p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>&quot;ВЫБРАТЬ</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p> | Дата</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>|ИЗ </p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p> | Документ.ВводНачальныхОстатковНоменклатуры </p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>|ГДЕ</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p> | Ссылка = &amp;ТекущийДокумент&quot;;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Выборка = Запрос.Выполнить().Выбрать();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Выборка.Следующий();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ОбновитьДатуДвижений = Выборка.Дата &lt;&gt; Дата; </p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецЕсли;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// Установить всем новую дату, если нужно.</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Если ОбновитьДатуДвижений Тогда</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Если Не Движения.ОстаткиМатериалов.Выбран() </p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>И Не Движения.ОстаткиМатериалов.Модифицированность() Тогда</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Движения.ОстаткиМатериалов.Прочитать(); </p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецЕсли;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Для Каждого ЗаписьРегистра Из Движения.ОстаткиМатериалов Цикл</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ЗаписьРегистра.Период = Дата;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецЦикла;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецЕсли;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецПроцедуры</p></td>
	</tr>
</table>
<p>Как вы видите, в этом случае обработчик содержит больше кода за счет дополнительных проверок, которые выполняются в
	результате возможности как интерактивной, так и программной записи объекта.</p>
<p>Поясним содержание обработчика. Если записывается новый документ или были изменены его движения, следует обновить
	дату движений. В противном случае мы считываем запросом дату документа из базы данных и сравниваем ее с датой,
	установленной у записываемого объекта. Если даты разные, также следует обновить дату движений.</p>
<p>Перед установкой даты мы проверяем, был ли прочитан набор записей в свойстве Движения объекта и изменялся ли он. Если
	оба эти условия ложны, значит набор записей в свойстве Движения объекта пуст, и это состояние не связано с его
	изменением. В этом случае, чтобы предотвратить ошибочное удаление записей в регистре (перезапись пустым набором
	записей), мы предварительно читаем движения из регистра в набор записей в свойстве Движения. </p>
<p>Затем, как и в предыдущем случае (при записи из формы документа), устанавливаем нужную дату для всех записей этого
	набора. При выполнении записи объекта Документ этот набор будет записан в регистр накопления.</p>
<p><strong>В режиме «1С:Предприятие»</strong></p>
<p>Запустим «1С:Предприятие» в режиме отладки и убедимся, что, указав новую дату (например, 03.09.2013) для нашего
	документа и записав его, мы получим движения в регистре накопления с новой датой.</p>
<p>В процессе записи нашего документа можно управлять не только периодом записей регистра накопления, но и значениями
	других полей регистра.</p>
<p>Например, по аналогичному принципу может быть создан документ Операция, позволяющий вводить ручные операции в регистр
	бухгалтерии. </p>
<p>При этом вероятно, что кроме управления периодом записей регистра вам потребуется управлять значением поля Активность
	(«включать» и «выключать» проводки документа) и т. д.</p>
<p><strong>Где создавать обработчики событий</strong></p>
<p>В заключение следует сказать, что выбор обработчика, в который будет помещен текст процедуры, зависит от логики
	работы создаваемого объекта. Если конфигурация не предусматривает программной записи объекта, можно выбрать
	обработчик модуля формы. Если предполагается и программная модификация объекта, следует выбирать обработчик модуля
	объекта. </p>
<p>Заметьте, что оба эти способа не исключают модификацию записей регистра через объект Регистр&lt;…&gt;НаборЗаписей.&lt;имя
	регистра&gt;. Поэтому если логика конфигурации подразумевает возможность программной модификации объекта
	НаборЗаписей, код обработки следует помещать в обработчик события набора записей. Все попытки изменить данные
	регистра будут сведены в конечном счете к записи именно набора записей.</p>
<h1><a id="_Toc454870680"></a>Лабораторная работа № 35 Программирование регистров</h1>
<p><strong>Порядок выполнения работы </strong></p>
<p>1. Ознакомьтесь с теоретическими основами в настоящих указаниях и конспектах лекций. </p>
<p>2. Получите задание у преподавателя. </p>
<p>3. Сделайте скриншоты (кнопка клавиатуры PrtSc) выполненных заданий в текстовом (Word) файле <em>Фамилия_ЛР</em></p>
<p>4. Составьте отчет по лабораторной работе. </p>
<p>5. Отчитайте работу преподавателю.</p>
<p><strong>Создание ролей</strong></p>
<p><strong>В режиме «Конфигуратор»</strong></p>
<p>При создании ролей исходят, как правило, из того, какие полномочия требуются различным группам пользователей на
	доступ к информации. Для этого мы воспользуемся подсистемами, которые значительно облегчат нашу задачу. </p>
<p><strong>Администратор</strong></p>
<p>Первая роль, которую мы создадим, будет Администратор. Она должна включать в себя полные права на работу с данными
	информационной базы.</p>
<p>Раскроем ветвь Общие дерева объектов конфигурации. Выделим строку Роли и добавим новый объект конфигурации Роль.
	Зададим его имя – Администратор (рис. 22.1).</p>
<p><strong>Рис. 22.1.</strong> Создание роли</p>
<p>Откроется окно редактирования прав этой роли (рис. 22.2).</p>
<p>Слева, в списке объектов, перечислены все объекты и виды объектов конфигурации, а справа, в окне прав, – доступные
	права для выбранного объекта или видов объектов конфигурации. </p>
<p><strong>Рис. 22.2.</strong> Окно редактирования прав для роли «Администратор»</p>
<p>Администратор должен иметь права на все объекты и все виды объектов. Для этого выполним команду Действия  Установить
	все права в командной панели окна. </p>
<p>После этого все права для всех объектов будут помечены. </p>
<p>Однако можно поставить или снять отметку для прав конкретного объекта конфигурации, пользуясь кнопками Отметить все
	элементы и Снять отметку со всех элементов, расположенными над окном прав. </p>
<p>Теперь единственное, что следует сделать, – снять разрешение на интерактивное удаление для всех объектов. Это
	необходимо для того, чтобы администратор случайно не мог удалить какой-либо объект базы данных. Для этого пройдемся
	по всем видам объектов конфигурации (Справочники, Документы и т. д.) и снимем отметку с команды Интерактивное
	удаление. Заметьте, что одновременно с отключением права на интерактивное удаление объектов снимается также отметка
	с права Интерактивное удаление предопределенных (см. рис. 22.2). </p>
<p>Для того чтобы наш Администратор мог работать с объектами, которые мы будем создавать после расстановки прав, зададим
	для него параметр Устанавливать права для новых объектов (см. рис. 22.2).</p>
<p>На этом создание роли Администратор закончено.</p>
<p><strong>Директор</strong></p>
<p>Следующей ролью, которую мы создадим, будет роль Директор. </p>
<p>Создадим новый объект конфигурации Роль с именем Директор. </p>
<p>Нас устраивает, что у новой роли нет прав на доступ ко всем объектам, за исключением тех видов объектов конфигурации,
	для которых не создано ни одного объекта. Для таких видов объектов конфигурации останутся установленными полные
	права. </p>
<p>Убедимся, что право Вывод для всей конфигурации у этой роли установлено.</p>
<p>Теперь нам останется лишь пройти по видам объектов конфигурации и установить для них право Просмотр (права Чтение и
	Использование при этом установятся автоматически).</p>
<p>Затем раскроем ветвь Общие, выделим ветвь Подсистемы и отметим право Просмотр у всех подсистем. Тем самым мы
	предоставим директору возможность просматривать все данные информационной базы, а позднее с помощью установки
	видимости команд по ролям мы исключим из его интерфейса все действия, которые по логике нашей конфигурации не
	относятся к прикладной ее части (рис. 22.3).</p>
<p>Вторая роль нашей конфигурации готова.</p>
<p><strong>Мастер</strong></p>
<p>Следующая роль, которую мы создадим, будет роль Мастер. Снова добавим новый объект конфигурации Роль с именем Мастер.
	Выполним команду Действия  Установить по подсистемам… и выберем подсистемы УчетМатериалов и ОказаниеУслуг. Нажмем
	Установить.</p>
<p>В результате будут установлены все права на объекты конфигурации, относящиеся к данным подсистемам. </p>
<p>Если теперь установить фильтр объектов по подсистемам УчетМатериалов и ОказаниеУслуг, то можно при необходимости
	внести уточнения в установленные права (рис. 22.4).</p>
<p><strong>Рис. 22.4.</strong> Установка фильтра по подсистеме</p>
<p>В частности, для справочника Сотрудники мы запретим права Добавление, Изменение и Удаление. </p>
<p>Обратите внимание, что при запрете права Добавление исчезла отметка и у права Интерактивное добавление, так как оно
	является «уточнением» права Добавление. Точно так же уточненные права запрещаются и при отмене прав на изменение и
	удаление. </p>
<p>Кроме этого, мы снова снимем разрешения на интерактивное удаление для всех объектов базы данных. Для этого пройдем по
	всем видам объектов конфигурации и снимем у всех право Интерактивное удаление.</p>
<p>Затем снимем фильтр и установим все права, кроме интерактивного удаления для следующих объектов конфигурации: </p>
<ul>
	<li>справочник ВариантыНоменклатуры,</li>
	<li>справочник ДополнительныеСвойстваНоменклатуры,</li>
	<li>план видов характеристик СвойстваНоменклатуры,  регистр сведений ЗначенияСвойствНоменклатуры.</li>
</ul>
<p>Эти объекты мы не привязывали ни к каким подсистемам, но они будут нужны для работы с характеристиками
	номенклатуры.</p>
<p>В заключение раскроем ветвь Общие, выделим ветвь Подсистемы и отметим право Просмотр у подсистемы Предприятие. Тем
	самым мы предоставим доступ к нормативно-справочной информации, которая будет находиться в этой подсистеме. А
	ненужную мастерам функциональность скроем с помощью видимости команд по ролям.</p>
<p>Роль Мастер готова.</p>
<p><strong>Расчетчик</strong></p>
<p>В заключение нам с вами осталось создать две роли: Бухгалтер и Расчетчик. </p>
<p>Мы разделим права по расчету зарплаты и по ведению бухгалтерского учета. </p>
<p>Дело в том, что в ООО «На все руки мастер» есть бухгалтер и помощник бухгалтера. Помощник бухгалтера занят в основном
	расчетом зарплаты, но иногда это делает и главный бухгалтер. </p>
<p>Поэтому главному бухгалтеру необходимо будет назначить обе роли, в то время как помощнику – только роль
	Расчетчик.</p>
<p>Создадим новый объект конфигурации Роль с именем Расчетчик. </p>
<p>В окне редактирования прав установим их по подсистеме РасчетЗарплаты (и не забудем запретить интерактивное удаление).
	А также установим право Просмотр для объекта конфигурации: Регистр накопления Продажи и справочника Клиенты.</p>
<p>В заключение установим право Просмотр у подсистемы Предприятие. </p>
<p>Роль Расчетчик готова.</p>
<p><strong>Бухгалтер</strong></p>
<p>В заключение создадим объект конфигурации Роль с именем Бухгалтер. В окне редактирования прав установим их по
	подсистеме Бухгалтерия. </p>
<p>После этого отфильтруем список объектов по этой подсистеме и для справочника Номенклатура запретим добавление,
	изменение и удаление. </p>
<p>Также запретим интерактивное удаление для всех объектов.</p>
<p>Затем снимем фильтр и установим все права, кроме интерактивного удаления для объекта конфигурации Справочник
	Субконто. </p>
<p>А также установим право Просмотр для следующих объектов конфигурации:</p>
<ul>
	<li>Справочник Склады,</li>
	<li>Справочник ВариантыНоменклатуры,</li>
	<li>Справочник ДополнительныеСвойстваНоменклатуры,</li>
	<li>План видов характеристик СвойстваНоменклатуры,  Регистр сведений ЗначенияСвойствНоменклатуры.</li>
</ul>
<p>В заключение установим право Просмотр у подсистемы Предприятие. </p>
<p><strong>Права на запуск клиентских приложений</strong></p>
<p>В заключение убедимся, что у каждой роли есть права на запуск клиентского приложения (тонкого клиента и
	веб-клиента).</p>
<p>Для этого воспользуемся другим, более удобным инструментом – редактором Все роли. В дереве объектов конфигурации
	выделим ветку Роли и в контекстном меню выполним команду Все роли. Мы видим, что права Тонкий клиент и Веб-клиент
	включены для всех ролей (рис. 22.5).</p>
<p>Администратор также имеет возможность подключаться и с помощью других клиентских приложений.</p>
<p>Список прав для каждой роли можно получить, выполнив в окне редактирования прав команду Действия  Вывести список…
	(рис. 22.6).</p>
<p>Аналогичный список, но только для всех ролей, которые есть в конфигурации, можно получить из редактора Все роли.</p>
<p><strong>Рис. 22.6.</strong> Список прав для роли «Бухгалтер»</p>
<p><strong>Добавление новых пользователей</strong></p>
<p>Для того чтобы иметь возможность отличать друг от друга пользователей, работающих с информационной базой, в системе
	«1С:Предприятие» существует <em>список пользователей</em>. </p>
<p>Можно создавать и удалять пользователей системы, назначать им роли и т. д. </p>
<p><strong>В режиме «Конфигуратор»</strong></p>
<p>Прежде чем мы приступим к созданию пользователей, необходимо выполнить обновление конфигурации базы данных
	(Конфигурация  Обновить конфигурацию базы данных (F7) <img src="74.jpeg"/>), поскольку пользователю можно поставить
	в соответствие только те роли, которые существуют в конфигурации базы данных.</p>
<p>После того как обновление произведено, выполним команду главного меню Администрирование  Пользователи. </p>
<p>Откроется список пользователей системы. Пока что он пуст, поэтому добавим нового пользователя (Действия  Добавить)
	или нажмем кнопку Добавить в командной панели окна (рис. 22.7).</p>
<p>Откроется окно редактирования пользователя (рис. 22.8).</p>
<p><strong>ВниМАние!</strong></p>
<p>Если вы используете учебную версию платформы «1С:Пред- приятие 8.3», то возможность задания паролей пользователей и
	аутентификация операционной системы будут недоступны. Это ограничения учебной версии.</p>
<p>Имя пользователя – это идентификатор, который будет появляться в окне выбора пользователей при запуске системы в
	режиме 1С:Предприятие. </p>
<p>Полное имя – строка, которая может быть использована внутри конфигурации при выводе различной справочной информации.
	Хорошим стилем администрирования считается указание в качестве полного имени фамилии, имени и отчества пользователя
	(без сокращений).</p>
<p>Следующие две области окна посвящены способам аутентификации пользователя.</p>
<p>Аутентификация средствами «1С:Предприятия» подразумевает, что после запуска системы пользователю будет предложено
	выбрать имя одного из пользователей системы и ввести пароль. Если введенный пароль соответствует сохраненному в
	системе для этого идентификатора пользователя, система открывается с правами, которые указаны для этого
	пользователя. При этом он сможет поменять пароль, если флажок Пользователю запрещено изменять пароль не
	установлен.</p>
<p>Аутентификация операционной системы подразумевает, что при запуске системы «1С:Предприятие» от пользователя не
	требуется никакой дополнительной информации. Система «1С:Предприятие» определяет, под каким пользователем запущена
	операционная система, и затем обращается к своему списку пользователей. Если она находит в нем пользователя,
	которому поставлен в соответствие текущий пользователь операционной системы, информационная база открывается с
	правами, указанными для этого пользователя.</p>
<p>Приступим к созданию пользователей.</p>
<p>Зададим имя пользователя Администратор, полное имя тоже Администратор. Перейдем на закладку Прочие. Отметим роль
	Администратор и язык конфигурации выберем Русский (рис. 22.9).</p>
<p><strong>Рис. 22.9.</strong> Закладка «Прочие» окна редактирования пользователя</p>
<p>Нажмем ОК.</p>
<p>После этого создадим остальных пользователей системы (рис. 22.10). Для всех них мы будем использовать аутентификацию
	«1С:Предприятия» и русский язык.</p>
<p><strong>Рис. 22.10.</strong> Список пользователей системы</p>
<p><strong>пРиМеЧАние</strong></p>
<p>Если некоторые колонки, например Роли, не видны в списке пользователей, можно настроить список, выполнив команду
	Действия Настройка списка…, и добавить нужные колонки.</p>
<p>Обратите внимание, что главному бухгалтеру Назаровой поставлены в соответствие две роли: Расчетчик и Бухгалтер,
	поскольку она должна иметь возможность не только вести бухгалтерский учет, но и рассчитывать зарплату.</p>
<p>Список пользователей, зарегистрированных в системе, можно получить, выполнив команду Действия  Вывести список…</p>
<h1><a id="_Toc454870681"></a>Лабораторная работа № 36 Работа с регистрами</h1>
<p><strong>Порядок выполнения работы </strong></p>
<p>1. Ознакомьтесь с теоретическими основами в настоящих указаниях и конспектах лекций. </p>
<p>2. Получите задание у преподавателя. </p>
<p>3. Сделайте скриншоты (кнопка клавиатуры PrtSc) выполненных заданий в текстовом (Word) файле <em>Фамилия_ЛР</em></p>
<p>4. Составьте отчет по лабораторной работе. </p>
<p>5. Отчитайте работу преподавателю.</p>
<p><strong>Ограничение доступа к данным на уровне записей и полей базы данных</strong></p>
<p>В системе «1С:Предприятие» используется <em>механизм ограничения доступа на уровне записей и полей базы данных</em>.
	Этот механизм позволяет для четырех основных прав (чтение, добавление, изменение и удаление) уточнить, какие же
	именно данные информационной базы будут доступны пользователю.</p>
<p>Такое уточнение записывается на специальном языке, являющемся подмножеством языка запросов.</p>
<p>Далее на примере документа Начисления сотрудникам мы рассмотрим небольшой пример, когда мастерам нужно дать
	возможность просмотреть начисленную им зарплату, но руководство запрещает им доступ к информации о начисленной
	премии. </p>
<p>Другими словами, мастерам нужно запретить просмотр тех документов Начисления сотрудникам, в которых есть записи о
	начислении премии.</p>
<p><strong>В режиме «Конфигуратор»</strong></p>
<p>Для решения этой задачи сначала установим для роли Мастер право Просмотр для документа НачисленияСотрудникам.</p>
<p>Поскольку этот документ принадлежит подсистеме РасчетЗарплаты, дадим право на просмотр этой подсистемы. Также дадим
	права на просмотр справочника ВидыГрафиковРаботы и плана видов расчета Основные начисления, т. к. ссылки на эти
	объекты используются в документе НачисленияСотрудникам. Вернемся к редактированию прав для документа
	НачисленияСотрудникам.</p>
<p>Как мы видим, при установке права Просмотр право Чтение документа НачисленияСотрудникам установилось автоматически.
	Выделим его. В правой нижней части экрана находится поле Ограничение доступа к данным. Нажмем кнопку Добавить (рис.
	22.11).</p>
<p>Мы хотим запретить доступ ко всем полям документа Начисления сотрудникам. </p>
<p>Поэтому мы не будем выбирать поля, а нажмем кнопку выбора в поле Ограничение доступа (рис. 22.12).</p>
<p>Откроется окно Ограничение доступа, в котором можно задать текст на специальном языке, являющемся подмножеством языка
	запроса.</p>
<p>Для облегчения работы мы воспользуемся конструктором запроса. Нажмем кнопку Конструктор запроса. </p>
<p>Откроется конструктор ограничений доступа к данным. Он похож на конструктор запросов (см. рис. 22.13). </p>
<p>Таблица НачисленияСотрудникам автоматически попала на закладку Таблицы и поля, а конструктор открылся на закладке
	Условия. </p>
<p>Перенесем в список условий поле ВидРасчета табличной части Начисления, установим флажок Произвольное и заполним
	правую часть условия, как показано в листинге 22.1 (рис. 22.13).</p>
<p><strong>Рис. 22.12.</strong> Вызов редактора ограничений доступа</p>
<p><strong>листинг 22.1.</strong> Ограничение доступа к данным</p>
<table>
	<tr>
		<td><p>НачисленияСотрудникам.Начисления.ВидРасчета &lt;&gt; </p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ЗНАЧЕНИЕ(ПланВидовРасчета.ОсновныеНачисления.Премия)</p></td>
	</tr>
</table>
<p><strong>Рис. 22.13.</strong> Конструктор ограничений доступа к данным</p>
<p>Нажмем ОК (рис. 22.14). </p>
<p><strong>Рис. 22.14.</strong> Текст ограничения доступа к данным</p>
<p>Текущий пользователь имеет право прочитать или изменить некоторый объект базы данных только в том случае, если
	ограничение доступа предоставляет ему такое право. То есть когда условие ограничения истинно. </p>
<p>В нашем случае пользователь сможет прочитать документ Начисления сотрудникам НачисленияСотрудникам ГДЕ… только в том
	случае, если в его табличной части Начисления … ГДЕ НачисленияСотрудникам.Начисления … есть виды расчета … ГДЕ
	НачисленияСотрудникам.Начисления.ВидРасчета …, не являющиеся видом расчета Премия … &lt;&gt;
	ЗНАЧЕНИЕ(ПланВидовРасчета.ОсновныеНачисления.Премия).</p>
<p>Нажмем ОК.</p>
<p>Окно ограничений доступа к данным для роли Мастер будет выглядеть следующим образом (рис. 22.15).</p>
<p><strong>Рис. 22.15.</strong> Ограничение доступа для роли «Мастер»</p>
<p><strong>В режиме «1С:Предприятие»</strong></p>
<p>Обновим информационную базу, нажав F7, и запустим «1С:Пред- приятие» для пользователя с ролью Мастер, например, для
	пользователя Гусаков.</p>
<p>В разделе Расчет зарплаты откроем список документов НачисленияСотрудникам (рис. 22.16).</p>
<p><strong>Рис. 22.16.</strong> Список документов «Начисления сотрудникам»</p>
<p>Как мы видим, в списке показаны только документы № 1 и № 3, так как в документе № 2 начисляется премия.</p>
<p>Хотя это и не относится к вопросу ограничения доступа к данным, поясним по ходу еще один момент.</p>
<p>На рис. 22.16 мы видим внизу окна приложения панель истории. Так получилось потому, что еще на третьем занятии, в
	момент заполнения данными первого справочника, мы задали ее отображение в конфигураторе. Затем мы убрали видимость
	этой панели, но уже в режиме 1С:Предприятие. Но, как уже говорилось, настройка панелей прикладного решения в режиме
	1С:Предприятие относится только к тому пользователю, кто эту настройку выполнил, в то время как настройка
	отображения панелей в конфигураторе относится к конфигурации в целом. В тот момент у нас еще не было заведено
	пользователей, поэтому панель истории стала опять видна. И так будет для каждого нового пользователя.</p>
<p>Чтобы этого не происходило, вернемся в конфигуратор и уберем видимость панели истории. Эта настройка будет
	действовать сразу для всех пользователей.</p>
<p><strong>В режиме «Конфигуратор»</strong></p>
<p>Выделим корень дерева объектов конфигурации и из контекстного меню выберем пункт Открыть интерфейс клиентского
	приложения. В появившемся окне Интерфейс клиентского приложения выделим элемент Панель истории в левом списке и
	нажмем кнопку Удалить в командной панели окна (рис. 22.17).</p>
<p><strong>Рис. 22.17.</strong> Настройка панелей прикладного решения в конфигураторе</p>
<p>Вернемся к вопросу ограничения доступа к данным.</p>
<p>Немного усложним задачу. Мы все так же не хотим, чтобы мастер видел начисленные премии, но в то же время не хотим
	скрывать от него факт существования такого документа.</p>
<p>Другими словами, в списке документов мастер должен его видеть, но не должен иметь возможности открыть его.</p>
<p>Посмотрим на наше ограничение доступа к данным документа Начисления сотрудникам для роли Мастер.</p>
<p>Мы не задавали никаких полей, поэтому ограничение применяется ко всем полям документа (см. рис. 22.15).</p>
<p>Поэтому сейчас мы безусловно разрешим читать те поля документа, которые необходимы для отображения документа в
	списке. </p>
<p>Тем самым мы разрешим документу отображаться в списке. Но поскольку существующее условие на прочие поля мы удалять не
	будем, то открыть документ, как и раньше, можно будет только в том случае, если в его табличной части есть виды
	расчета, отличные от Премия.</p>
<p>Добавим к ограничениям доступа еще одно условие.</p>
<p>В списке полей выберем поля:</p>
<ul>
	<li>Ссылка,</li>
	<li>ПометкаУдаления,</li>
	<li>Номер,</li>
	<li>Дата,</li>
	<li>Проведен.</li>
</ul>
<p>В ограничении доступа напишем ГДЕ ИСТИНА (рис. 22.18).</p>
<p><strong>Рис. 22.18.</strong> Установка ограничений доступа к данным для роли «Мастер»</p>
<p>Закроем окно редактирования прав.</p>
<p><strong>В режиме «1С:Предприятие»</strong></p>
<p>Обновим информационную базу, нажав F7, и запустим «1С:Пред- приятие» для пользователя с ролью Мастер, например, для
	пользователя Гусаков.</p>
<p>В разделе Расчет зарплаты откроем список документов НачисленияСотрудникам (рис. 22.19).</p>
<p><strong>Рис. 22.19.</strong> Список документов «Начисления сотрудникам»</p>
<p>В списке документов мы увидим все документы начислений. Документы № 1 и № 3 мы сможем открыть и просмотреть, но при
	попытке открыть документ № 2 мы получим сообщение о нарушении прав доступа (рис. 22.20).</p>
<p>То есть мы добились того, чего хотели.</p>
<p>Теперь обратим внимание на следующий момент.</p>
<p>Все хорошо, пока в документе № 2 содержатся записи только о расчете премии. Но вспомним, как формулируется наше
	ограничение доступа: пользователь сможет прочитать документ Начисления сотрудникам только в том случае, если в его
	табличной части Начисления есть виды расчета, не являющиеся видом расчета Премия. </p>
<p><strong>Рис. 22.20.</strong> Сообщение о нарушении прав доступа к данным</p>
<p>Это значит, что если в этом документе окажутся виды расчета, отличные от Премия, мастер сможет его открыть и
	просмотреть.</p>
<p>Убедимся в этом.</p>
<p>Запустим «1С:Предприятие» от имени пользователя Администратор.</p>
<p>В разделе Расчет зарплаты откроем список документов Начисле- нияСотрудникам. Откроем документ № 2 и скопируем любую
	его строку. В новой строке изменим вид расчета на Оклад. Проведем и закроем документ. Завершим сеанс работы.</p>
<p>Теперь запустим «1С:Предприятие» от имени пользователя Гусаков. Точно так же в разделе Расчет зарплаты откроем список
	документов НачисленияСотрудникам. </p>
<p>Откроем документ № 2. Документ откроется, и мы увидим все его строки.</p>
<p><strong>В режиме «Конфигуратор»</strong></p>
<p>Вернемся в конфигуратор.</p>
<p>Для того чтобы документ невозможно было просмотреть и в этой ситуации, нам нужно будет изменить существующее условие
	ограничения доступа.</p>
<p>Новое условие будет более сложным, поэтому заодно мы продемонстрируем использование шаблонов в ограничениях
	доступа.</p>
<p>Итак, откроем роль Мастер и перейдем на закладку Шаблоны ограничений (рис. 22.21).</p>
<p>к данным для роли «Мастер»</p>
<p>Здесь добавим новый шаблон, назовем его ЕстьПремия.</p>
<p>Текст шаблона будет выглядеть следующим образом (листинг 22.2). <strong>листинг 22.2.</strong> Ограничение доступа к
	данным</p>
<table>
	<tr>
		<td><p>ВЫБРАТЬ</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p> 1</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ИЗ</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Документ.НачисленияСотрудникам.Начисления</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ГДЕ</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Документ.НачисленияСотрудникам.Начисления.ВидРасчета = </p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ЗНАЧЕНИЕ(ПланВидовРасчета.ОсновныеНачисления.Премия)</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>И Документ.НачисленияСотрудникам.Начисления.Ссылка = #Параметр(1).Ссылка</p></td>
	</tr>
</table>
<p>По сути это запрос к табличной части документа НачисленияСотрудникам, который либо не вернет нам ничего, либо вернет
	одну запись с одним полем, в котором будет значение 1. </p>
<p>Такую запись он вернет нам в том случае, если в табличной части документа есть вид расчета Премия.</p>
<p>Второе условие в этом запросе нужно нам для того, чтобы указать, табличная часть какого именно документа нас
	интересует. В этом условии используется возможность указания параметров в шаблоне.</p>
<p><strong>листинг 22.3.</strong> Ограничение доступа к данным</p>
<p>И Документ.НачисленияСотрудникам.Начисления.Ссылка = <strong>#Параметр(1)</strong>.Ссылка</p>
<p>Вместо #Параметр(1) будет подставлена та строка, которую мы укажем при вызове этого шаблона в условии ограничения
	доступа.</p>
<p>Теперь вернемся на закладку Права.</p>
<p>В имеющемся ограничении прав доступа для прочих полей (в первой строке списка ограничений) заменим старый текст новым
	(листинг 22.4), рис. 22.22.</p>
<p><strong>листинг 22.4.</strong> Ограничение доступа к данным</p>
<p>ДокНачисления ГДЕ НЕ 1 В (#ЕстьПремия(&quot;ДокНачисления&quot;))</p>
<p><strong>Рис. 22.22.</strong> Установка ограничений доступа к данным для роли «Мастер»</p>
<p>Здесь с помощью конструкции #ЕстьПремия(&quot;ДокНачисления&quot;) мы обращаемся к нашему шаблону. Текст шаблона
	просто механически будет подставлен в это место, причем строка ДокНачисления заменит собой первый параметр шаблона
	(#Параметр(1)).</p>
<p>Как мы уже говорили, если в табличной части есть начисление Премия, запрос в шаблоне вернет единственную запись со
	значе- нием 1. </p>
<p>Поэтому это условие (см. листинг 22.4) разрешит нам прочитать ДокНачисления тогда, когда запрос из шаблона не
	возвращает 1: ГДЕ НЕ 1 В (#ЕстьПремия(«ДокНачисления»))</p>
<p>То есть тогда, когда в табличной части нет начисления Премия.</p>
<p>Можно было бы записать это условие ограничения и без использования шаблонов. </p>
<p>Но, во-первых, такая запись была бы менее читаемой (листинг 22.5), а во-вторых, использование шаблонов позволяет
	выделить и не дублировать части условий ограничений, которые могут использоваться в разных условиях.</p>
<p><strong>листинг 22.5.</strong> Ограничение доступа к данным</p>
<table>
	<tr>
		<td><p>ДокНачисления ГДЕ НЕ 1 В (</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ВЫБРАТЬ</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>1</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p> ИЗ</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Документ.НачисленияСотрудникам.Начисления</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ГДЕ</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Документ.НачисленияСотрудникам.Начисления.ВидРасчета = </p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ЗНАЧЕНИЕ(ПланВидовРасчета.ОсновныеНачисления.Премия)</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p> И Документ.НачисленияСотрудникам.Начисления.Ссылка = ДокНачисления.Ссылка)</p></td>
	</tr>
</table>
<p>Закроем окно редактирования прав. Проверим, как это работает.</p>
<p><strong>В режиме «1С:Предприятие»</strong></p>
<p>Обновим информационную базу, нажав F7, и запустим «1С:Пред- приятие» от имени пользователя Гусаков. </p>
<p>В разделе Расчет зарплаты откроем список документов НачисленияСотрудникам. </p>
<p>Как вы помните, в документе № 2 есть строки и с видом расчета Премия, и с видом расчета Оклад. Раньше этот документ у
	нас открывался.</p>
<p>Попробуем открыть его теперь.</p>
<p>Мы получим сообщение о нарушении прав доступа, что нам и требовалось (см. рис. 22.20).</p>
<p><strong>В режиме «Конфигуратор»</strong></p>
<p>Поскольку пример с ограничением прав доступа на уровне записей и полей базы данных мы делали скорее в
	демонстрационных целях, вернемся к исходному состоянию конфигурации.</p>
<p>Снимем для роли Мастер право Чтение для документа НачисленияСотрудникам. Снимем право Просмотр для подсистемы
	РасчетЗарплаты. Снимем право Чтение для справочника ВидыГрафиковРаботы и для плана видов расчета Основные
	начисления. Запустим «1С:Предприятие» от имени пользователя Администратор. В разделе Расчет зарплаты откроем список
	документов НачисленияСотрудникам. Откроем документ № 2 и удалим последнюю строку (которую мы добавляли). Проведем и
	закроем документ.</p>
<h1><a id="_Toc454870682"></a>Лабораторная работа № 37 Программирование запросов</h1>
<p><strong>Порядок выполнения работы </strong></p>
<p>1. Ознакомьтесь с теоретическими основами в настоящих указаниях и конспектах лекций. </p>
<p>2. Получите задание у преподавателя. </p>
<p>3. Сделайте скриншоты (кнопка клавиатуры PrtSc) выполненных заданий в текстовом (Word) файле <em>Фамилия_ЛР</em></p>
<p>4. Составьте отчет по лабораторной работе. </p>
<p>5. Отчитайте работу преподавателю.</p>
<p><strong>Настройка командного интерфейса разделов</strong></p>
<p>До сих пор мы практически не занимались организацией командного интерфейса разделов (подсистем), так как занимались
	другими, более важными, с точки зрения разработчика, вопросами.</p>
<p>Теперь пришло время заняться этим очень существенным для пользователя моментом, то есть осмысленно рассортировать
	команды, разложить их по группам в зависимости от приоритета и частоты использования. </p>
<p>Кроме этого, с помощью видимости команд по ролям мы облегчим интерфейс разделов и сделаем его более «прозрачным» для
	отдельных пользователей.</p>
<p><strong>В режиме «Конфигуратор»</strong></p>
<p>Если сейчас посмотреть на интерфейс разделов, то мы увидим, что он довольно хаотичен, и много места в нем занимают
	команды для открытия списков и создания новых элементов справочников. </p>
<p>Поскольку работать со справочниками в той или иной мере нужно всем пользователям, то логично все справочники
	перенести в подсистему Предприятие, доступ к которой мы предоставили всем ролям на предыдущем занятии. Конечно, не
	все пользователи смогут изменять эти справочники (например, Директор), но удобно, когда вся нормативно-справочная
	информация находится в одном месте. А интерфейс остальных разделов будет разгружен за счет этой перестановки.</p>
<p>Итак, откроем поочередно окно редактирования каждого справочника и на закладке Подсистемы отметим единственную
	подсистему Предприятие (рис. 23.1).</p>
<p>Это изменение относится также и к тем справочникам, для которых раньше не было установлено ни одной подсистемы
	(например, ВариантыНоменклатуры, Субконто и т. п.).</p>
<p>Также зададим подсистему Предприятие для регистра сведений ЗначенияСвойствНоменклатуры, который содержит соответствие
	характеристик номенклатуры и их значений.</p>
<p>Теперь займемся настройкой командного интерфейса для каждого раздела. Расположим команды в порядке их приоритета,
	установим или скроем их видимость для отдельных ролей.</p>
<p>Раскроем ветвь Подсистемы, выделим подсистему УчетМатериалов и вызовем из контекстного меню команду Открыть командный
	интерфейс (рис. 23.2).</p>
<p>На подсистему УчетМатериалов имеют права пользователи с ролями Администратор, Директор, Мастер.</p>
<p>Зададим расположение и общую видимость команд подсистемы следующим образом:</p>
<ul>
	<li>С помощью мыши переместим команду Приходные накладные из группы Панель навигации.Обычное в группу команд Панель
		навигации.Важное. Это обусловлено тем, что в разделе Учет материалов наиболее часто пользователю может
		понадобиться создавать приходные накладные и просматривать их список. Команды из группы Важное будут выделены
		жирным шрифтом в панели команд раздела.
	</li>
	<li>В группе Панель действий.Создать включим видимость команды Цена:создать и зададим следующий порядок расположения
		этих команд:
	</li>
</ul>
<p>□ Приходная накладная: создать, □ Цена:создать.</p>
<p>Следующие группы команд оставим без изменения:</p>
<ul>
	<li>Группа Панель навигации.Обычное:</li>
</ul>
<p>□ Цены на Номенклатуру.</p>
<ul>
	<li>Группа Панель навигации.См. также:</li>
</ul>
<p>□ Остатки материалов,</p>
<p>□ Стоимость материалов, □ Продажи.</p>
<ul>
	<li>Группа Панель действий.Отчеты: □ Материалы,</li>
</ul>
<p>□ Остатки материалов по свойствам.</p>
<p>То есть мы расположили команды в порядке важности и частоты их использования.</p>
<p>Теперь настроим видимость команд по ролям, исходя из следующих соображений:</p>
<ul>
	<li>Просматривать полностью все движения в регистрах накопления (из группы Панель навигации.См. также) может
		понадобиться только Администратору, поэтому отключим видимость этих команд для Директора и Мастера.
	</li>
	<li>Команды создания приходной накладной и новой цены (из группы Панель навигации.Создать) нужны только Мастеру.
		Директор вообще может только просматривать документы, а Администратор не занимается массовым вводом данных, при
		необходимости он может создать новые документы через их списки. Поэтому скроем эти команды для Администратора и
		Директора.
	</li>
</ul>
<p>В результате командный интерфейс подсистемы примет вид </p>
<p>(рис. 23.3).</p>
<p><strong>Рис. 23.3.</strong> Командный интерфейс подсистемы «УчетМатериалов»</p>
<p>Руководствуясь подобными соображениями, отредактируем командный интерфейс остальных подсистем.</p>
<p>На подсистему ОказаниеУслуг имеют права пользователи с ролями Администратор, Директор, Мастер.</p>
<p>Зададим расположение и общую видимость команд подсистемы следующим образом:</p>
<ul>
	<li>Группа Панель навигации.Важное:</li>
</ul>
<p>□ Оказание услуг.</p>
<ul>
	<li>Группа Панель навигации.Обычное:</li>
</ul>
<p>□ Цены на Номенклатуру.</p>
<ul>
	<li>Группа Панель навигации.См. также:</li>
</ul>
<p>□ Остатки материалов, □ Стоимость материалов, □ Продажи.</p>
<ul>
	<li>Группа Панель действий.Создать:</li>
</ul>
<p>□ Оказание услуги: создать, □ Цена:создать.</p>
<ul>
	<li>Группа Панель действий.Отчеты:</li>
</ul>
<p>□ Материалы,</p>
<p>□ Реестр документов Оказание услуги,</p>
<p>□ Рейтинг услуг,</p>
<p>□ Выручка мастеров, </p>
<p>□ Перечень услуг,</p>
<p>□ Рейтинг клиентов, □ Универсальный.</p>
<p>Настроим видимость команд по ролям, исходя из следующих соображений:</p>
<ul>
	<li>Просматривать полностью все движения в регистрах накопления (из группы Панель навигации.См. также) может
		понадобиться только Администратору, поэтому отключим видимость этих команд для Директора и Мастера.
	</li>
	<li>Команды создания документов Оказание услуги и новой цены (из группы Панель навигации.Создать) нужны только
		Мастеру. Директор вообще может только просматривать документы, а Администратор не занимается массовым вводом
		данных,
	</li>
</ul>
<p>при необходимости он может создать новые документы через их списки. Поэтому скроем эти команды для Администратора и
	Директора.</p>
<p>В результате командный интерфейс подсистемы примет вид </p>
<p>(рис. 23.4).</p>
<p><strong>Рис. 23.4.</strong> Командный интерфейс подсистемы «ОказаниеУслуг»</p>
<p>На подсистему Бухгалтерия имеют права пользователи с ролями Администратор, Директор, Бухгалтер.</p>
<p>Зададим расположение и общую видимость команд подсистемы следующим образом:</p>
<ul>
	<li>Группа Панель навигации.Важное:</li>
</ul>
<p>□ Управленческий,</p>
<p>□ Основной план счетов,</p>
<p>□ Ввод начальных остатков номенклатуры.</p>
<ul>
	<li>Группа Панель навигации.Обычное:</li>
</ul>
<p>□ Приходные накладные,</p>
<p>□ Оказание услуг,</p>
<p>□ Цены на Номенклатуру.</p>
<ul>
	<li>Группа Панель навигации.См. также:</li>
</ul>
<p>□ Виды субконто,</p>
<p>□ Остатки материалов, □ Стоимость материалов, □ Продажи.</p>
<ul>
	<li>Группа Панель действий.Создать: сделаем все команды невидимыми, так как в этом разделе не предполагается
		массового создания объектов.
	</li>
	<li>Группа Панель действий.Отчеты:</li>
</ul>
<p>□ Оборотно-сальдовая ведомость,</p>
<p>□ Начисления сотрудникам,</p>
<p>□ Материалы,</p>
<p>□ Рейтинг услуг,</p>
<p>□ Перечень услуг,</p>
<p>□ Рейтинг клиентов,</p>
<p>□ Остатки материалов по свойствам.</p>
<p>Настроим видимость команд по ролям, исходя из следующих соображений:</p>
<ul>
	<li>Просматривать полностью все движения в регистрах накопления (из группы Панель навигации.См. также) может
		понадобиться только Администратору, поэтому отключим видимость этих команд для Директора и Бухгалтера.
	</li>
	<li>Команда для просмотра видов субконто (из группы Панель навигации.См. также) не понадобится Директору, так как
		это чисто бухгалтерская специфика. Отключим видимость этой команды для Директора.
	</li>
</ul>
<p>В результате командный интерфейс подсистемы примет вид </p>
<p>(рис. 23.5).</p>
<p>На подсистему РасчетЗарплаты имеют права пользователи с ролями Администратор, Директор, Расчетчик.</p>
<p>Зададим расположение и общую видимость команд подсистемы следующим образом:</p>
<ul>
	<li>Группа Панель навигации.Важное:</li>
</ul>
<p>□ Начисления сотрудникам, □ Графики работы.</p>
<ul>
	<li>Группа Панель навигации.Обычное:</li>
</ul>
<p>□ Виды расчетов, □ Начисления.</p>
<ul>
	<li>Группа Панель действий.Создать:</li>
</ul>
<p>□ Начисления сотрудникам: создать.</p>
<ul>
	<li>Группа Панель действий.Отчеты:</li>
</ul>
<p>□ Начисления сотрудникам, □ Диаграмма начислений, □ Выручка мастеров.</p>
<p><strong>Рис. 23.5.</strong> Командный интерфейс подсистемы «Бухгалтерия»</p>
<p>Настроим видимость команд по ролям, исходя из следующих соображений:</p>
<ul>
	<li>Команда для просмотра плана видов расчетов (из группы Панель навигации.Обычное) не понадобится Директору. Скроем
		эту команду для Директора.
	</li>
	<li>Команда для анализа движений в регистре Начисления (из группы Панель навигации.Обычное) может понадобиться
		только Администратору. Поэтому скроем эту команду для Директора и Расчетчика.
	</li>
	<li>Команда для создания документов Начисления сотрудникам (из группы Панель навигации.Создать) нужна только
		Расчетчику. Поэтому отключим видимость этой команды для Директора и Администратора. А для команд создания
		графиков работы и видов расчетов (ОсновныеНачисления) мы отключили общую видимость, так как массового ввода этих
		данных не предполагается.
	</li>
	<li>Для отчета Перерасчет отключим общую видимость, так как это чисто технический отчет, который мы использовали в
		18-м занятии.
	</li>
</ul>
<p>В результате командный интерфейс подсистемы примет вид </p>
<p>(рис. 23.6):</p>
<p><strong>Рис. 23.6.</strong> Командный интерфейс подсистемы «РасчетЗарплаты»</p>
<p>На подсистему Предприятие имеют права все пользователи. В данном разделе будет отображаться нормативно справочная
	информация.</p>
<p>Команды для открытия списков справочников расположим в порядке их приоритета и частоты использования, а для команд
	создания элементов справочников отключим общую видимость. Дело в том, что массового ввода этих данных не
	предполагается, а там, где возникает необходимость создания таких новых объектов, их удобно создавать прямо из
	выпадающего списка в поле ввода.</p>
<p>В результате командный интерфейс подсистемы будет выглядеть следующим образом:</p>
<ul>
	<li>Группа Панель навигации.Важное:</li>
</ul>
<p>□ Номенклатура,</p>
<p>□ Клиенты,</p>
<p>□ Сотрудники, □ Склады.</p>
<ul>
	<li>Группа Панель навигации.Обычное:</li>
</ul>
<p>□ Варианты номенклатуры,</p>
<p>□ Дополнительные свойства номенклатуры,</p>
<p>□ Субконто,</p>
<p>□ Виды графиков работы,</p>
<p>□ Состав варианта номенклатуры.</p>
<p>Для Директора отключим видимость команд для просмотра списков справочников из группы Панель навигации.Обычное, так
	как это несущественные «подробности» для пользователя с этой ролью.</p>
<p>В результате командный интерфейс подсистемы примет вид </p>
<p>(рис. 23.7).</p>
<p><strong>Рис. 23.7.</strong> Командный интерфейс подсистемы «Предприятие»</p>
<p><strong>В режиме «1С:Предприятие»</strong></p>
<p>Запустим «1С:Предприятие» в режиме отладки. </p>
<p>Поскольку мы создали пользователей нашей конфигурации и присвоили им роли, то теперь перед запуском приложения нужно
	указать пользователя. </p>
<p>Выберем пользователя Администратор, пароль для пользователей указывать не нужно, так как мы его не задавали. </p>
<p>Если же вы уже вошли в конфигуратор под ролью Администратор, то при запуске «1С:Предприятия» из конфигуратора
	пользователя указывать не потребуется.</p>
<p>Посмотрим, как структурировано и лаконично выглядит теперь интерфейс приложения, например, в разделе Расчет
	зарплаты </p>
<p>(рис. 23.8).</p>
<p><strong>Рис. 23.8.</strong> Командный интерфейс раздела «Расчет зарплаты»</p>
<p>Группы команд в каждом разделе зрительно отделены друг от друга, а наиболее важные команды в панели команд разделов
	выделены жирным шрифтом. Те команды, которые не поместились в панели команд текущего раздела, содержатся в подменю
	Еще.</p>
<p>Итак, мы настроили командный интерфейс разделов согласно нашим представлениям о работе прикладного решения. </p>
<p>Однако если у пользователя – другие предпочтения, то в режиме 1С:Предприятие он может настраивать командный интерфейс
	по своему усмотрению. Для этого нужно вызвать меню функций раздела из панели инструментов приложения (или дважды
	щелкнуть мышью на названии раздела) и выполнить команду Настройка навигации или Настройка действий (см. рис.
	23.9).</p>
<p>Помимо этого, пользователь может открыть меню функций раздела и пометить как избранные наиболее часто используемые им
	команды. Они будут помечены звездочкой слева от названия команды (рис. 23.9).</p>
<p><strong>Рис. 23.9.</strong> Меню функций раздела «Бухгалтерия»</p>
<p>Затем, открыв Избранное из панели инструментов, можно также пометить наиболее важные из списка избранных элементов.
	Они будут помечены специальной пиктограммой (рис. 23.10). Также они будут выделены жирным шрифтом и расположены
	вверху списка избранного, чтобы пользователь мог быстро их найти.</p>
<p><strong>Рис. 23.10.</strong> Список избранного для пользователя с ролью «Бухгалтер»</p>
<h1><a id="_Toc454870683"></a>Лабораторная работа № 39 Программирование таблицы значений</h1>
<p><strong>Раздел «Главное». </strong></p>
<p><strong>Настройка начальной страницы</strong></p>
<p>Раздел Главное в интерфейсе приложения предназначен для размещения наиболее часто используемых пользователем
	документов, отчетов, справочников и т. п. </p>
<p>В рабочей области раздела Главное для каждого пользователя содержится <em>начальная страница</em>, на которую нужно
	поместить те формы документов, отчетов и пр., работа с которыми входит в его ежедневные должностные обязанности. В
	панели команд раздела Главное для каждого пользователя нужно поместить наиболее важные для него команды в
	соответствии с его ролью.</p>
<p>Например, для кладовщика было бы удобно иметь под руками список номенклатуры и список приходных накладных, для
	менеджера – список клиентов и документов оказания услуг и т. д.</p>
<p>При запуске «1С:Предприятия» раздел Главное становится активным по умолчанию и нужные формы сразу открываются в
	рабочей области приложения (рис. 23.11).</p>
<p><strong>Рис. 23.11.</strong> Раздел «Главное» для пользователя с ролью «Директор»</p>
<p>Таким образом, пользователю не нужно ходить по разделам, искать в них нужную команду, а можно сразу начинать
	работать, предварительно включив компьютер и запустив «1С:Предприятие». </p>
<p>Однако не стоит перегружать раздел Главное различными формами и командами, иначе вместо удобства пользователь будет
	ощущать дискомфорт.</p>
<p><strong>В режиме «Конфигуратор»</strong></p>
<p>Итак, начнем настраивать командный интерфейс раздела Главное.</p>
<p>Выделим корень дерева объектов конфигурации ПособиеДляНачинающих, вызовем его контекстное меню и выберем пункт
	Открыть командный интерфейс основного раздела (рис. 23.12).</p>
<p>основного раздела</p>
<p>В открывшемся окне слева расположены все созданные нами объекты конфигурации, сгруппированные по видам объектов, и
	команды для работы с ними. Двойным щелчком мыши будем переносить их направо, заполняя командный интерфейс основного
	раздела и устанавливая видимость для каждой роли.</p>
<p>Для роли Мастер наиболее важными командами будут команды для создания документов Приходная накладная и Оказание
	услуги, а также команды для открытия отчетов Материалы и Выручка мастеров. Для команд создания документов установим
	общую видимость и скроем эти команды для всех ролей, кроме Мастера. Для команд открытия отчетов снимем видимость для
	всех ролей, кроме Мастера и Директора (рис. 23.13).</p>
<p><strong>Рис. 23.13.</strong> Окно настройки командного интерфейса основного раздела</p>
<p>Для роли Расчетчик приоритетными командами являются команды для создания документа Начисление сотрудникам и просмотра
	отчета Начисления сотрудникам. Для команды создания документа установим общую видимость и скроем эту команду для
	всех ролей, кроме Расчетчика. Для команды открытия отчета оставим видимость только для Расчетчика и Директора.</p>
<p>Для роли Бухгалтер вынесем в панель команд основного раздела команды для создания документа Ввод начальных остатков
	номенклатуры и просмотра отчета Оборотно-сальдовая ведомость. Для команды создания документа установим общую
	видимость и скроем эту команду для всех ролей, кроме Бухгалтера. Для команды открытия отчета оставим видимость
	только для Бухгалтера и Директора.</p>
<p>Для роли Директор приоритетными являются команды для просмотра самых важных отчетов: Материалы, Выручка мастеров,
	Начисления сотрудникам, Оборотно-сальдовая ведомость. Эти команды мы уже добавили в панель команд основного раздела
	и сделали их видимыми для Директора.</p>
<p>Для Администратора панель команд основного раздела остается пока пустой, а позднее мы поместим туда команды
	управления обменом данными.</p>
<p>В результате окно настройки командного интерфейса основного раздела примет следующий вид (рис. 23.14).</p>
<p><strong>Рис. 23.14.</strong> Окно настройки командного интерфейса основного раздела</p>
<p>Теперь выполним настройку начальной страницы.</p>
<p>Выделим корень дерева объектов конфигурации ПособиеДляНачинающих, вызовем его контекстное меню и выберем пункт
	Открыть рабочую область начальной страницы (см. рис. 23.12).</p>
<p>Откроется окно настройки начальной страницы (рис. 23.15). Сначала вверху окна выберем шаблон рабочего стола Две
	колонки разной </p>
<p><strong>Рис. 23.15.</strong> Окно настройки начальной страницы</p>
<p>Это значит, что формы на начальной странице будут располагаться в две колонки, при этом левая колонка будет в два
	раза шире правой. </p>
<p>Можно выбрать другой шаблон, при котором колонки будут одинаковой ширины или будет всего одна колонка. Но кажется,
	что предпочтительнее первый вариант (2:1), так как в этом случае взгляд пользователя сразу будет падать на наиболее
	приоритетные для работы формы, которые мы расположим в левой колонке. </p>
<p>Следует иметь в виду, что автоматически сгенерированные системой формы нельзя располагать на начальной странице.
	Поэтому прежде чем добавлять форму на начальную страницу, нужно создать ее в явном виде в конфигурации. Чтобы не
	путаться, будем создавать нужные формы прямо по ходу.</p>
<p><strong>ВниМАние!</strong></p>
<p>Для того чтобы создавать новые формы и любые другие объекты конфигурации, нужно зайти в конфигуратор от имени
	пользователя с ролью Администратор. Так как только у администратора есть права на вновь создаваемые объекты.</p>
<p>Итак, начнем настройку рабочего стола для роли Мастер. </p>
<p>Наше ООО «На все руки мастер» – фирма по оказанию услуг, и мастера имеют к этому непосредственное отношение. Поэтому
	логично, если для мастеров в левой колонке начальной страницы будет располагаться список документов об оказании
	услуг, а в правой колонке – список приходных накладных. </p>
<p>Перечисленные формы списка отсутствуют в конфигурации, поэтому создадим формы списка для объектов конфигурации:</p>
<p> документ ПриходнаяНакладная,  документ ОказаниеУслуги. </p>
<p>По умолчанию в форме списка документов присутствуют только колонки Дата и Номер. Добавим вручную в форму списка
	документа ПриходнаяНакладная колонку Склад (рис. 23.16).</p>
<p>Аналогично добавим в форму списка документа ОказаниеУслуги колонки Склад, Клиент, Мастер.</p>
<p>Теперь перейдем в окно настройки начальной страницы и над списком форм левой колонки нажмем Добавить. </p>
<p><strong>Рис. 23.16.</strong> Создание формы списка документа «Приходная накладная» Выберем форму списка документа
	ОказаниеУслуги (рис. 23.17).</p>
<p><strong>Рис. 23.17.</strong> Настройка начальной страницы для пользователя с ролью </p>
<p>«Мастер»</p>
<p>Аналогичным образом в правую колонку добавим формы списка документа ПриходнаяНакладная.</p>
<p>Теперь для каждой из форм нажмем ссылку в колонке Видимость и установим видимость этих форм только для роли
	Мастер </p>
<p>(рис. 23.18).</p>
<p><strong>Рис. 23.18.</strong> Настройка начальной страницы для пользователя с ролью «Мастер»</p>
<p>Теперь настроим начальную страницу для роли Бухгалтер. </p>
<p>Предположим, бухгалтер наиболее часто будет пользоваться оборотно-сальдовой ведомостью. Расположим этот отчет в левой
	колонке начальной страницы, а правую оставим пустой. </p>
<p>Создадим форму отчета для отчета ОборотноСальдоваяВедомость. Затем перейдем в окно настройки начальной страницы,
	добавим эту форму в левую колонку и установим видимость этой формы только для роли Бухгалтер. </p>
<p>Затем настроим начальную страницу для роли Расчетчик. </p>
<p>По роду деятельности расчетчик в основном пользуется документами и отчетами о начислениях сотрудникам. Расположим
	список документов о начислениях сотрудникам в правой колонке начальной страницы. А отчет о начислениях сотрудникам
	расчетчик всегда может открыть из панели команд раздела Главное.</p>
<p>Создадим форму списка документа НачисленияСотрудникам. Перейдем в окно настройки начальной страницы, добавим форму
	списка в правую колонку и установим видимость этой формы только для роли Расчетчик. </p>
<p>Затем настроим начальную страницу для роли Директор. </p>
<p>Мы предполагаем, что эта роль будет назначена пользователю, осуществляющему руководящие функции. Ему не нужно вводить
	никаких документов, да у него и нет на это прав. Но ему понадобится регулярно просматривать отчеты о деятельности
	фирмы, чтобы принимать руководящие решения.</p>
<p>Команды для открытия наиболее важных для директора отчетов будут находиться в панели команд раздела Главное. На его
	начальной странице расположим один отчет Выручка мастеров. Создадим форму этого отчета, затем перейдем в окно
	настройки начальной страницы, добавим эту форму в левую колонку и установим видимость этой формы только для роли
	Директор.</p>
<p>Для роли Администратор начальная страница останется пока пустой, а позднее мы расположим на ней формы для управления
	обменом данными.</p>
<p>В результате окно настройки начальной страницы должно принять следующий вид (рис. 23.19).</p>
<p><strong>Рис. 23.19.</strong> Окно настройки начальной страницы </p>
<p>Если у пользователя на начальной странице видима только какая-то одна форма (например, у директора – отчет Выручка
	мастеров, у расчетчика – список документов о начислениях сотрудникам), то эти формы в интерфейсе приложения
	растягиваются на всю ширину начальной страницы, независимо от того, в какой колонке начальной страницы (правой или
	левой) они изначально находились в конфигураторе.</p>
<p>Если же для одной роли видимы несколько форм и все они расположены в какой-то одной колонке начальной страницы в
	конфигураторе, то в интерфейсе приложения на начальной странице они будут показаны друг под другом.</p>
<p><strong>В режиме «1С:Предприятие»</strong></p>
<p>Теперь, если мы зайдем в систему в режиме 1С:Предприятие, указав пользователя Назарова (с ролями Бухгалтер и
	Расчетчик), мы увидим такую начальную страницу (рис. 23.20).</p>
<p><strong>Рис. 23.20.</strong> Начальная страница для пользователя с ролью «Бухгалтер», «Расчетчик»</p>
<p><strong>ВниМАние!</strong></p>
<p>Чтобы зайти в режим 1С:Предприятие под различными пользователями, нужно выполнить обновление конфигурации и запустить
	«1С:Предприятие» еще раз, выбрав режим 1С:Предприятие (тонкий клиент) и нужного пользователя. Если вы, как обычно,
	запустите «1С:Предприятие» в режиме отладки, то есть из конфигуратора, то система будет считать, что вы заходите в
	программу под тем же пользователем, что и в конфигуратор, то есть Администратор.</p>
<p>Обратите внимание, что на рабочем столе находится также список документов о начислениях сотрудникам, так как
	пользователь </p>
<p>Назарова имеет две роли – Бухгалтер и Расчетчик. А также этому пользователю доступны разделы Бухгалтерия, Расчет
	зарплаты и Предприятие в соответствии с правами, которые мы установили для этих ролей на предыдущем занятии.</p>
<p>А для пользователя Деловой (с ролью Директор) начальная страница будет выглядеть следующим образом (рис. 23.21).</p>
<p><strong>Рис. 23.21.</strong> Начальная страница для пользователя с ролью «Директор»</p>
<p>Причем для директора нужно показывать красивый вариант этого отчета в виде измерительной диаграммы. Поскольку в
	конфигурации задать стартовый вариант отчета нельзя, то нужно зайти в систему от имени пользователя с ролью Директор
	и выбрать вариант отчета Объем выручки. В дальнейшем этот вариант отчета станет вариантом по умолчанию для данного
	пользователя.</p>
<p>Для пользователя Гусаков (с ролью Мастер) начальная страница будет выглядеть следующим образом (рис. 23.22).</p>
<p>Этому пользователю доступны разделы Учет материалов, Оказание услуг и Предприятие в соответствии с правами, которые
	мы установили для этой роли на предыдущем занятии.</p>
<p><strong>Рис. 23.22.</strong> Начальная страница для пользователя с ролью «Мастер»</p>
<p>Если теперь мастер откроет какой-то из документов, то слева от заголовка документа будет доступна кнопка Начальная
	страница (с иконкой домика) для перехода на начальную страницу (рис. 23.23).</p>
<p><strong>Рис. 23.23.</strong> Возврат на начальную страницу</p>
<p>Таким образом, мы добились того, что при запуске «1С:Предприятия» для каждой роли, например для пользователя с ролью
	Мастер, на начальной странице сразу открываются формы списков документов, нужные ему для работы. А в панели команд
	раздела Главное находятся команды для создания этих документов и наиболее важные для Мастера отчеты.</p>
<p>Кроме начальной страницы каждый пользователь, безусловно, может пользоваться всей функциональностью других разделов
	прикладного решения, которая ему доступна в соответствии с его правами.</p>
<p>И наконец, в процессе работы «1С:Предприятия» пользователь может настраивать начальную страницу по своему усмотрению,
	выполнив команду главного меню Вид  Настройка начальной страницы. </p>
<p>Но следует иметь в виду, что пользователь может размещать на своей начальной странице только те формы, которые
	разработчик создал в<strong> </strong>конфигурации.</p>
<p>Если же какой-то пользователь решит минимизировать командный интерфейс и тем самым расширить рабочее пространство, то
	он может скрыть все панели прикладного решения, кроме панели инструментов, по команде главного меню Вид  Скрыть все
	панели (рис. 23.24).</p>
<p><strong>Рис. 23.24.</strong> Минималистичный командный интерфейс приложения</p>
<p>В реальной конфигурации, конечно, роли пользователей и наполнение их начальных страниц будут другими. Это зависит от
	специфики работы предприятия и пожеланий заказчика. </p>
<p>На последних двух занятиях мы показали только принцип организации интерфейса прикладного решения по ролям и
	ограничения доступа к отдельным командам и разделам в целом в зависимости от прав пользователя.</p>
<h1><a id="_Toc454870684"></a>Лабораторная работа № 40 Программирование форм</h1>
<p><strong>Константа для обмена данных</strong></p>
<p><strong>В режиме «Конфигуратор»</strong></p>
<p><strong>ВниМАние!</strong></p>
<p>Поскольку на предыдущем занятии мы создали в конфигурации</p>
<p>список пользователей, теперь при входе в конфигуратор система спросит имя пользователя. Нужно указать пользователя –
	Администратор, так как он имеет полный доступ ко всем объектам конфигурации. Пароль задавать не нужно, так как мы
	его не устанавливали.</p>
<p>Объект конфигурации Константа предназначен для создания в базе данных таблиц, в которых будет храниться информация,
	не изменяющаяся во времени или изменяющаяся очень редко. </p>
<p>Каждый объект конфигурации Константа описывает таблицу для хранения одного значения. </p>
<p>Теперь приступим к созданию константы, в которой мы будем хранить значение префикса номеров.</p>
<p>Откроем конфигуратор и добавим новый объект конфигурации Константа с именем ПрефиксНумерации. </p>
<p>Определим тип значения константы – Строка с фиксированной длиной 2 символа.</p>
<p><strong>Доработка объектов конфигурации, участвующих в обмене</strong></p>
<p><strong>В режиме «Конфигуратор»</strong></p>
<p>Первое, что нам следует сделать, – внести изменения в модули всех объектов, участвующих в обмене (в нашем случае это
	будут документы, справочники и планы видов характеристик). </p>
<p>Эти изменения будут заключаться в том, что теперь при формировании номера документа и кода справочника или плана
	видов характеристик будет использоваться значение константы ПрефиксНумерации для обеспечения уникальности номеров и
	кодов в каждой из наших баз.</p>
<p>Функцию формирования префикса номера мы вынесем в общий модуль, поскольку не исключена возможность того, что в
	будущем алгоритм формирования префикса документов может быть изменен.</p>
<p>Добавим общий модуль Обмен. </p>
<p>В модуль поместим следующую функцию (листинг 24.1).</p>
<p><strong>листинг 24.1.</strong> Функция формирования префикса номера</p>
<table>
	<tr>
		<td><p>Функция ПолучитьПрефиксНомера() Экспорт</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Возврат Константы.ПрефиксНумерации.Получить();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецФункции </p></td>
	</tr>
</table>
<p>Как вы видите, эта функция просто возвращает значение константы ПрефиксНумерации.</p>
<p>Теперь доработаем справочник Клиенты. </p>
<p>Выделим этот объект в дереве объектов конфигурации, вызовем контекстное меню и откроем модуль объекта. </p>
<p>Добавим в него обработчик события ПриУстановкеНовогоКода (листинг 24.2).</p>
<p><strong>листинг 24.2.</strong> Обработчик события «ПриУстановкеНовогоКода»</p>
<table>
	<tr>
		<td><p>Процедура ПриУстановкеНовогоКода(СтандартнаяОбработка, Префикс)</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Префикс = Обмен.ПолучитьПрефиксНомера();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецПроцедуры</p></td>
	</tr>
</table>
<p>Событие ПриУстановкеНовогоКода возникает в момент, когда выполняется установка нового кода элемента справочника.
	Обратите внимание, что мы пишем этот код не в модуле формы, а в модуле объекта, поскольку это событие возникает не
	для формы, а для объекта в целом.</p>
<p>Вторым параметром вызова обработчика передается префикс, который будет заполнен в данной процедуре и использован
	системой для генерации кода. </p>
<p>В обработчике события мы вызываем функцию общего модуля. Поскольку модуль неглобальный, то обращаемся к ней по имени
	модуля и имени функции (Обмен.ПолучитьПрефиксНомера). В этой процедуре мы устанавливаем префикс равным значению
	константы ПрефиксНумерации. </p>
<p>Такие же обработчики нужно будет добавить во все справочники и планы видов характеристик, участвующие в обмене. </p>
<p>В нашем случае это:</p>
<ul>
	<li>справочники:</li>
</ul>
<table>
	<tr>
		<td><p>□ </p></td>
		<td><p>Сотрудники, </p></td>
	</tr>
	<tr>
		<td><p>□ </p></td>
		<td><p>Склады,</p></td>
	</tr>
	<tr>
		<td><p>□ </p></td>
		<td><p>Номенклатура, </p></td>
	</tr>
	<tr>
		<td><p>□ </p></td>
		<td><p>ВариантыНоменклатуры,</p></td>
	</tr>
	<tr>
		<td><p>□ </p></td>
		<td><p>ДополнительныеСвойстваНоменклатуры, </p></td>
	</tr>
</table>
<ul>
	<li>план видов характеристик: СвойстваНоменклатуры.</li>
</ul>
<p>После этого у всех этих объектов и у справочника Клиенты нужно (в палитре свойств объекта конфигурации) увеличить
	длину кода до 11 символов.</p>
<p>Теперь займемся доработкой документов. </p>
<p>В модуль документа ПриходнаяНакладная добавим обработчик события ПриУстановкеНовогоНомера (листинг 24.3).</p>
<p><strong>листинг 24.3.</strong> Обработчик события «ПриУстановкеНовогоНомера»</p>
<table>
	<tr>
		<td><p>Процедура ПриУстановкеНовогоНомера(СтандартнаяОбработка, Префикс)</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Префикс = Обмен.ПолучитьПрефиксНомера();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецПроцедуры</p></td>
	</tr>
</table>
<p>Такие же обработчики нужно будет добавить во все документы, участвующие в обмене. </p>
<p>В нашем случае это единственный документ – ОказаниеУслуги. </p>
<p>После этого для обоих документов нужно (в палитре свойств объекта конфигурации) увеличить длину номера до 11
	символов.</p>
<p>На этом подготовительная работа с существующими объектами конфигурации завершена, и мы можем перейти к созданию
	процедур обмена данными.</p>
<p><strong>Добавление плана обмена</strong></p>
<p><strong>В режиме «Конфигуратор»</strong></p>
<p>Теперь займемся созданием центра любого алгоритма обмена данными, вокруг которого группируются прочие механизмы, –
	плана обмена. </p>
<p>Раскроем ветвь Общие дерева объектов конфигурации и добавим новый объект конфигурации План обмена с именем Филиалы,
	представление объекта – Филиал. </p>
<p>На закладке Данные создадим реквизит плана обмена Главный, имеющий тип Булево (рис. 24.2).</p>
<p><strong>Рис. 24.2.</strong> Реквизит плана обмена</p>
<p>Этот реквизит понадобится нам для того, чтобы разрешать <em>коллизии</em> при обмене данными. Под коллизией
	понимается ситуация, когда один и тот же объект обмена данными был изменен одновременно в двух узлах. </p>
<p>В этом случае мы будем анализировать значение реквизита Главный и принимать изменения только в том случае, если они
	сделаны в главном узле. В случае коллизии изменения, произведенные не в главном узле, мы будем отвергать.</p>
<p>Теперь определим состав объектов, участвующих в обмене. Для этого на закладке Основные нажмем кнопку Состав. Включим
	в обмен все объекты, не относящиеся к ведению бухгалтерии и расчету зарплаты. </p>
<p>Обратите внимание, что константа ПрефиксНумерации не участвует в обмене, поскольку ее значение должно быть уникальным
	для каждой базы, участвующей в обмене.</p>
<p>Состав данных обмена должен выглядеть следующим образом </p>
<p>(рис. 24.3).</p>
<p>Теперь на закладке Формы окна редактирования объекта конфигурации нажмем кнопку открытия и с помощью конструктора
	создадим основную форму узла (рис. 24.4).</p>
<p><strong>Рис. 24.4.</strong> Создание формы узла обмена</p>
<p>В окне элементов формы выделим корневой элемент Форма, вызовем из контекстного меню палитру его свойств и создадим
	обработчик события формы ПриСозданииНаСервере. </p>
<p>Этот обработчик понадобится нам для того, чтобы запретить установку реквизита Главный для предопределенного узла,
	соответствующего данной информационной базе (листинг 24.4).</p>
<p><strong>листинг 24.4.</strong> Обработчик события формы «ПриСозданииНаСервере»</p>
<table>
	<tr>
		<td><p>&amp;НаСервере</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Если Объект.Ссылка = ПланыОбмена.Филиалы.ЭтотУзел() Тогда</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Элементы.Главный.Доступность = Ложь;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецЕсли;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецПроцедуры</p></td>
	</tr>
</table>
<p>В этой процедуре мы используем метод менеджера плана обмена ЭтотУзел(), который возвращает ссылку на узел плана
	обмена, соответствующий данной информационной базе.</p>
<p>Затем создадим основную форму списка плана обмена, чтобы описать в ней некоторые действия по регистрации нового узла
	обмена. </p>
<p>Суть этих действий будет заключаться в том, что при регистрации нового узла обмена мы должны будем сформировать для
	него все необходимые записи регистрации изменений для всех объектов конфигурации, входящих в данный план обмена. Это
	будет своего рода начальная синхронизация узла обмена всеми данными обмена.</p>
<p>Для этого на закладке Команды создадим команду ЗарегистрироватьИзменения.</p>
<p>В открывшейся палитре свойств нажмем кнопку открытия в строке Действие. </p>
<p>На запрос конфигуратора о типе обработчика команды ответим, что мы хотим создать клиентский обработчик команды формы
	с вызовом из него процедуры, выполняющейся на сервере без контекста формы (выберем вариант Создать на клиенте и
	процедуру на сервере без контекста).</p>
<p>В модуле формы будут созданы шаблоны двух процедур: клиентской процедуры ЗарегистрироватьИзменения() и серверной
	внеконтекстной процедуры ЗарегистрироватьИзмененияНаСервере(), которая вызывается из клиентской процедуры.</p>
<p>Как мы уже знаем, внеконтекстная процедура выполняется на сервере значительно быстрее за счет того, что на сервер с
	клиента не передается весь контекст формы.</p>
<p>В процедуру ЗарегистрироватьИзмененияНаСервере() нам нужно передать в качестве параметра ссылку на объект
	ПланОбмена.Филиалы, используя свойство ТекущаяСтрока для таблицы Список (источником данных этой таблицы является
	динамический список узлов плана обмена Филиалы).</p>
<p>Поэтому изменим текст модуля следующим образом (листинг 24.5). <strong>листинг 24.5.</strong> Текст обработчика
	команды «ЗарегистрироватьИзменения»</p>
<table>
	<tr>
		<td><p>&amp;НаКлиенте</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Процедура ЗарегистрироватьИзменения(Команда)</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ЗарегистрироватьИзмененияНаСервере(<strong>Элементы.Список.ТекущаяСтрока</strong>);</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецПроцедуры</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>&amp;НаСервереБезКонтекста</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Процедура ЗарегистрироватьИзмененияНаСервере(<strong>Узел</strong>)</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// Вставить содержимое обработчика.</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецПроцедуры</p></td>
	</tr>
</table>
<p>В процедуру ЗарегистрироватьИзмененияНаСервере() мы поместим следующий текст (листинг 24.6).</p>
<p><strong>листинг 24.6.</strong> Процедура «ЗарегистрироватьИзмененияНаСервере»</p>
<table>
	<tr>
		<td><p>&amp;НаСервереБезКонтекста</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Процедура ЗарегистрироватьИзмененияНаСервере(Узел)</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// Регистрация изменений всех данных для узла.</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ПланыОбмена.ЗарегистрироватьИзменения(Узел); </p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецПроцедуры</p></td>
	</tr>
</table>
<p>В этой процедуре мы обращаемся к механизму регистрации изменений, вызывая метод менеджера планов обмена –
	ЗарегистрироватьИзменения(). </p>
<p>В этот метод передается ссылка на текущий узел плана обмена Филиалы. </p>
<p>В результате выполнения этой процедуры в информационной базе будут созданы записи регистрации изменений,
	предназначенные для пересылки в созданный нами узел, для всех объектов обмена, указанных в составе данного плана
	обмена.</p>
<p>В заключение перейдем на закладку Форма и перетащим команду ЗарегистрироватьИзменения из окна команд в командную
	панель формы. </p>
<p>В результате форма списка примет вид (рис. 24.5).</p>
<p><strong>Рис. 24.5.</strong> Форма списка плана обмена</p>
<p>Заметьте, что при перетаскивании команды в дерево элементов формы имя кнопки может не совпадать с именем команды, с
	которой она связана. В частности, при перетаскивании команды в командную панель формы к имени команды автоматически
	добавляется префикс «Форма». Поэтому кнопке присваивается имя ФормаЗарегистрироватьИзменения. Именно по этому имени
	мы будем обращаться к кнопке из встроенного языка (см. листинг 24.8).</p>
<p>Причем кнопка Зарегистрировать изменения должна быть доступна только в случае, если текущий узел не является
	предопределенным для данной информационной базы, иначе регистрация изменений невозможна. </p>
<p>Чтобы обеспечить такое поведение кнопки, создадим в модуле формы списка функцию, выполняющуюся на сервере без
	контекста и возвращающую истину, если переданный в функцию узел является предопределенным (листинг 24.7).</p>
<p><strong>листинг 24.7.</strong> Функция «ПредопределенныйУзел()»</p>
<table>
	<tr>
		<td><p>&amp;НаСервереБезКонтекста</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Функция ПредопределенныйУзел(Узел)</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Возврат Узел = ПланыОбмена.Филиалы.ЭтотУзел();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецФункции</p></td>
	</tr>
</table>
<p>Затем в окне элементов формы выделим элемент Список, вызовем его палитру свойств и создадим обработчик события
	ПриАктивизацииСтроки. Укажем, что событие будет обрабатываться только на клиенте.</p>
<p>Заполним обработчик следующим образом (листинг 24.8).</p>
<p><strong>листинг 24.8.</strong> Обработчик события «ПриАктивизацииСтроки()» </p>
<p>элемента формы «Список»</p>
<table>
	<tr>
		<td><p>&amp;НаКлиенте</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Процедура СписокПриАктивизацииСтроки(Элемент)</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Если ПредопределенныйУзел(Элемент.ТекущаяСтрока) Тогда</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Элементы.ФормаЗарегистрироватьИзменения.Доступность = Ложь;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Иначе</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Элементы.ФормаЗарегистрироватьИзменения.Доступность = Истина;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецЕсли;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецПроцедуры</p></td>
	</tr>
</table>
<p>В этой процедуре доступность кнопки Зарегистрировать изменения определяется в зависимости от значения функции
	ПредопределенныйУзел(), в которую передается ссылка на текущий узел (Элемент.ТекущаяСтрока).</p>
<p>На этом создание плана обмена завершено, и мы можем перейти непосредственно к созданию процедур обмена данными.</p>
<p><strong>Процедуры обмена данными</strong></p>
<p><strong>В режиме «Конфигуратор»</strong></p>
<p>Для инициализации обмена данными мы используем обработку. </p>
<p>Добавим новый объект конфигурации Обработка с именем</p>
<p>ОбменДанными. На закладке Формы создадим основную форму обработки. В окне редактора форм на закладке Команды создадим
	команду формы ВыполнитьОбмен. В строке Действие нажмем кнопку открытия.</p>
<p>На запрос конфигуратора о типе обработчика команды выберем вариант Создать на клиенте и процедуру на сервере без
	контекста. В модуле формы будут созданы шаблоны двух процедур: клиентской процедуры ВыполнитьОбмен() и серверной
	внеконтекстной процедуры ВыполнитьОбменНаСервере(), которая вызывается из клиентской процедуры.</p>
<p>Процедура ВыполнитьОбмен() автоматически будет заполнена следующим образом (листинг 24.9).</p>
<p><strong>листинг 24.9.</strong> Обработчик команды «ВыполнитьОбмен»</p>
<table>
	<tr>
		<td><p>&amp;НаКлиенте</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Процедура ВыполнитьОбмен(Команда)</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ВыполнитьОбменНаСервере();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецПроцедуры </p></td>
	</tr>
</table>
<p>В процедуру ВыполнитьОбменНаСервере() поместим следующий текст (листинг 24.10).</p>
<p><strong>листинг 24.10.</strong> Создание процедуры «ВыполнитьОбменНаСервере»</p>
<table>
	<tr>
		<td><p>&amp;НаСервереБезКонтекста</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Процедура ВыполнитьОбменНаСервере() Экспорт</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ВыборкаУзлов = ПланыОбмена.Филиалы.Выбрать();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Пока ВыборкаУзлов.Следующий() Цикл</p></td>
	</tr>
</table>
<p>// Произвести обмен данными со всеми узлами, кроме текущего (ЭтотУзел). Если ВыборкаУзлов.Ссылка &lt;&gt;
	ПланыОбмена.Филиалы.ЭтотУзел() Тогда</p>
<table>
	<tr>
		<td><p>УзелОбъект = ВыборкаУзлов.ПолучитьОбъект();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// Получить сообщение.</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>УзелОбъект.ПрочитатьСообщениеСИзменениями();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// Сформировать сообщение.</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>УзелОбъект.ЗаписатьСообщениеСИзменениями();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецЕсли;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецЦикла;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецПроцедуры</p></td>
	</tr>
</table>
<p>Алгоритм работы этой процедуры заключается в следующем: в цикле мы перебираем узлы, которые содержатся в плане обмена
	Филиалы, и для всех узлов, кроме себя самого, производим сначала чтение сообщений, поступивших из других узлов
	обмена (процедуру ПрочитатьСообщенияСИзменениями мы создадим позднее). </p>
<p>Затем мы формируем для них сообщения, предназначенные для передачи и содержащие измененные данные для этого узла
	(процедура ЗаписатьСообщениеСИзменениями также будет создана нами позднее).</p>
<p>В заключение перетащим команду ВыполнитьОбмен из окна команд в окно элементов формы. В результате форма обработки
	будет выглядеть следующим образом (рис. 24.6).</p>
<p><strong>Рис. 24.6.</strong> Форма обработки</p>
<p><strong>Процедура записи данных</strong></p>
<p>Сами процедуры записи и чтения данных обмена мы разместим в модуле объекта План обмена Филиалы. </p>
<p>В окне редактирования этого объекта конфигурации перейдем на закладку Прочее и откроем модуль объекта. Сначала
	создадим процедуру, которая используется нами при обмене данными, – ЗаписатьСообщениеСИзменениями. Создавать ее мы
	будет постепенно.</p>
<p>Сначала мы сформируем имя файла, который будет содержать данные для обмена, и сообщим пользователю о начале и
	окончании выгрузки данных в узел (листинг 24.11).</p>
<p><strong>листинг 24.11.</strong> Формирование имени файла в процедуре записи данных</p>
<table>
	<tr>
		<td><p>Процедура ЗаписатьСообщениеСИзменениями() Экспорт</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Сообщение = Новый СообщениеПользователю;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Сообщение.Текст = &quot;-------- Выгрузка в узел &quot; + Строка(ЭтотОбъект) + &quot;
			------------&quot;;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Сообщение.Сообщить();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Каталог = КаталогВременныхФайлов();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// Сформировать имя временного файла.</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ИмяФайла = Каталог + ?(Прав(Каталог, 1) = &quot;\&quot;,&quot;&quot;, &quot;\&quot;) + &quot;Message&quot;
			+ </p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>СокрЛП(ПланыОбмена.Филиалы.ЭтотУзел().Код) + &quot;_&quot; + СокрЛП(Ссылка.Код) + &quot;.xml&quot;;</p>
		</td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Сообщение = Новый СообщениеПользователю;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Сообщение.Текст = &quot;-------- Конец выгрузки ------------&quot;;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Сообщение.Сообщить();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецПроцедуры </p></td>
	</tr>
</table>
<p>Для упрощения примера мы будем обмениваться сообщениями через каталог временных файлов. Имена сообщений
	стандартизованы и имеют вид MessageКодУзлаОтправителя_КодУзлаПолучателя.xml.</p>
<p>После этого обратимся к механизмам записи/чтения XML-доку- ментов и создадим новый объект – ЗаписьXML. С помощью него
	откроем новый XML-файл для записи, запишем в него объявление XML. В конце процедуры завершим запись XML и закроем
	файл (листинг 24.12). <strong>листинг 24.12.</strong> Создание объекта записи XML в процедуре записи данных</p>
<table>
	<tr>
		<td><p>Процедура ЗаписатьСообщениеСИзменениями() Экспорт</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Сообщение = Новый СообщениеПользователю;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Сообщение.Текст = &quot;-------- Выгрузка в узел &quot; + Строка(ЭтотОбъект) + &quot;
			------------&quot;;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Сообщение.Сообщить();</p></td>
	</tr>
</table>
<p>Каталог = КаталогВременныхФайлов();</p>
<p>// Сформировать имя временного файла.</p>
<table>
	<tr>
		<td><p>ИмяФайла = Каталог + ?(Прав(Каталог, 1) = &quot;\&quot;,&quot;&quot;, &quot;\&quot;) + &quot;Message&quot;
			+ </p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>СокрЛП(ПланыОбмена.Филиалы.ЭтотУзел().Код) + &quot;_&quot; + СокрЛП(Ссылка.Код) + &quot;.xml&quot;;</p>
		</td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>// Создать объект записи XML</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>// *** ЗаписьXML-документов.</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>ЗаписьXML = Новый ЗаписьXML;</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>ЗаписьXML.ОткрытьФайл(ИмяФайла);</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>ЗаписьXML.ЗаписатьОбъявлениеXML();</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>ЗаписьXML.Закрыть();</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Сообщение = Новый СообщениеПользователю;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Сообщение.Текст = &quot;-------- Конец выгрузки ------------&quot;;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Сообщение.Сообщить();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецПроцедуры </p></td>
	</tr>
</table>
<p>Теперь мы обратимся к механизмам инфраструктуры сообщений и создадим новый объект ЗаписьСообщенияОбмена, метод
	которого НачатьЗапись() позволяет, кроме всего прочего, создать очередной номер сообщения и записать заголовок
	сообщения в XML. В конце процедуры мы опять же закончим запись сообщения (листинг 24.13).</p>
<p><strong>листинг 24.13.</strong> Создание очередного номера сообщения </p>
<p>и запись заголовка сообщения в XML</p>
<table>
	<tr>
		<td><p>Процедура ЗаписатьСообщениеСИзменениями() Экспорт</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Сообщение = Новый СообщениеПользователю;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Сообщение.Текст = &quot;-------- Выгрузка в узел &quot; + Строка(ЭтотОбъект) + &quot;
			------------&quot;;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Сообщение.Сообщить();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Каталог = КаталогВременныхФайлов();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// Сформировать имя временного файла.</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ИмяФайла = Каталог + ?(Прав(Каталог, 1) = &quot;\&quot;,&quot;&quot;, &quot;\&quot;) + &quot;Message&quot;
			+ </p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>СокрЛП(ПланыОбмена.Филиалы.ЭтотУзел().Код) + &quot;_&quot; + СокрЛП(Ссылка.Код) + &quot;.xml&quot;;</p>
		</td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// Создать объект записи XML.</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// *** ЗаписьXML-документов.</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ЗаписьXML = Новый ЗаписьXML;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ЗаписьXML.ОткрытьФайл(ИмяФайла);</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ЗаписьXML.ЗаписатьОбъявлениеXML();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>// *** Инфраструктура сообщений.</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>ЗаписьСообщения = ПланыОбмена.СоздатьЗаписьСообщения();</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>ЗаписьСообщения.НачатьЗапись(ЗаписьXML, Ссылка);</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>Сообщение = Новый СообщениеПользователю;</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>Сообщение.Текст = </strong>&quot;<strong> Номер сообщения: </strong>&quot;<strong> +
			ЗаписьСообщения.НомерСообщения;</strong></p></td>
	</tr>
</table>
<p><strong>Сообщение.Сообщить();</strong></p>
<p><strong>ЗаписьСообщения.ЗакончитьЗапись();</strong></p>
<table>
	<tr>
		<td><p>ЗаписьXML.Закрыть();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Сообщение = Новый СообщениеПользователю;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Сообщение.Текст = &quot;-------- Конец выгрузки ------------&quot;;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Сообщение.Сообщить();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецПроцедуры </p></td>
	</tr>
</table>
<p>Поскольку мы находимся в модуле объекта, то мы используем стандартный реквизит Ссылка в качестве ссылки на объект
	План обмена Филиалы.</p>
<p>После этого, чтобы получить данные, которые необходимо сохранить в этом файле, мы обратимся к механизму регистрации
	изменений и получим выборку из записей регистрации изменений, предназначенных данному узлу. При формировании выборки
	мы передаем вторым параметром номер сообщения (листинг 24.14).</p>
<p><strong>листинг 24.14.</strong> Получение выборки из записей регистрации изменений, </p>
<p>предназначенных данному узлу</p>
<table>
	<tr>
		<td><p>Процедура ЗаписатьСообщениеСИзменениями() Экспорт</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Сообщение = Новый СообщениеПользователю;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Сообщение.Текст = &quot;-------- Выгрузка в узел &quot; + Строка(ЭтотОбъект) + &quot;
			------------&quot;;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Сообщение.Сообщить();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Каталог = КаталогВременныхФайлов();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// Сформировать имя временного файла.</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ИмяФайла = Каталог + ?(Прав(Каталог, 1) = &quot;\&quot;,&quot;&quot;, &quot;\&quot;) + &quot;Message&quot;
			+ </p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>СокрЛП(ПланыОбмена.Филиалы.ЭтотУзел().Код) + &quot;_&quot; + СокрЛП(Ссылка.Код) + &quot;.xml&quot;;</p>
		</td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// Создать объект записи XML</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// *** ЗаписьXML-документов.</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ЗаписьXML = Новый ЗаписьXML;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ЗаписьXML.ОткрытьФайл(ИмяФайла);</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ЗаписьXML.ЗаписатьОбъявлениеXML();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// *** Инфраструктура сообщений.</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ЗаписьСообщения = ПланыОбмена.СоздатьЗаписьСообщения();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ЗаписьСообщения.НачатьЗапись(ЗаписьXML, Ссылка);</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Сообщение = Новый СообщениеПользователю;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Сообщение.Текст = &quot; Номер сообщения: &quot; + ЗаписьСообщения.НомерСообщения;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Сообщение.Сообщить();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>// Получить выборку измененных данных</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>// *** Механизм регистрации изменений.</strong></p></td>
	</tr>
</table>
<p><strong>ВыборкаИзменений = ПланыОбмена.ВыбратьИзменения(ЗаписьСообщения.</strong></p>
<p><strong>Получатель,ЗаписьСообщения.НомерСообщения);</strong></p>
<table>
	<tr>
		<td><p>ЗаписьСообщения.ЗакончитьЗапись();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ЗаписьXML.Закрыть();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Сообщение = Новый СообщениеПользователю;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Сообщение.Текст = &quot;-------- Конец выгрузки ------------&quot;;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Сообщение.Сообщить();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецПроцедуры </p></td>
	</tr>
</table>
<p>Теперь осталось только перебрать выборку записей в цикле и сериализовать их в открытый XML-файл (листинг 24.15).</p>
<p><strong>листинг 24.15.</strong> Перебор выборки записей и сериализация их </p>
<p>в открытый XML-файл</p>
<table>
	<tr>
		<td><p>Процедура ЗаписатьСообщениеСИзменениями() Экспорт</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Сообщение = Новый СообщениеПользователю;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Сообщение.Текст = &quot;-------- Выгрузка в узел &quot; + Строка(ЭтотОбъект) + &quot; ------------»;</p>
		</td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Сообщение.Сообщить();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Каталог = КаталогВременныхФайлов();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// Сформировать имя временного файла.</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ИмяФайла = Каталог + ?(Прав(Каталог, 1) = &quot;\&quot;,&quot;&quot;, &quot;\&quot;) + &quot;Message&quot;
			+ </p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>СокрЛП(ПланыОбмена.Филиалы.ЭтотУзел().Код) + &quot;_&quot; + СокрЛП(Ссылка.Код) + &quot;.xml&quot;;</p>
		</td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// Создать объект записи XML</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// *** ЗаписьXML-документов.</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ЗаписьXML = Новый ЗаписьXML;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ЗаписьXML.ОткрытьФайл(ИмяФайла);</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ЗаписьXML.ЗаписатьОбъявлениеXML();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// *** Инфраструктура сообщений.</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ЗаписьСообщения = ПланыОбмена.СоздатьЗаписьСообщения();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ЗаписьСообщения.НачатьЗапись(ЗаписьXML, Ссылка);</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Сообщение = Новый СообщениеПользователю;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Сообщение.Текст = &quot; Номер сообщения: &quot; + ЗаписьСообщения.НомерСообщения;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Сообщение.Сообщить();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// Получить выборку измененных данных</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// *** Механизм регистрации изменений.</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ВыборкаИзменений = ПланыОбмена.ВыбратьИзменения(ЗаписьСообщения.</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Получатель,ЗаписьСообщения.НомерСообщения);</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>Пока ВыборкаИзменений.Следующий() Цикл</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>// Записать данные в сообщение *** XML-сериализация.</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>ЗаписатьXML(ЗаписьXML, ВыборкаИзменений.Получить());</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>КонецЦикла;</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
</table>
<p>ЗаписьСообщения.ЗакончитьЗапись(); ЗаписьXML.Закрыть();</p>
<table>
	<tr>
		<td><p>Сообщение = Новый СообщениеПользователю;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Сообщение.Текст = &quot;-------- Конец выгрузки ------------&quot;;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Сообщение.Сообщить();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецПроцедуры </p></td>
	</tr>
</table>
<p>На этом создание процедуры записи данных обмена закончено.</p>
<p><strong>Процедура чтения данных</strong></p>
<p>Порядок создания процедуры чтения данных обмена будет таким же, как и ранее: сначала мы сформируем имя файла,
	содержащего данные обмена (листинг 24.16).</p>
<p><strong>листинг 24.16.</strong> Формирование имени файла, </p>
<p>содержащего данные обмена</p>
<table>
	<tr>
		<td><p>Процедура ПрочитатьСообщениеСИзменениями() Экспорт</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Каталог = КаталогВременныхФайлов();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// Сформировать имя файла.</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ИмяФайла = Каталог + ?(Прав(Каталог, 1) = &quot;\&quot;, &quot;&quot;, &quot;\&quot;) + &quot;Message&quot;
			+ СокрЛП(Ссылка.Код) + &quot;_&quot; + </p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>СокрЛП(ПланыОбмена.Филиалы.ЭтотУзел().Код) + &quot;.xml&quot;;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Файл = Новый Файл(ИмяФайла);</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Если Не Файл.Существует() Тогда</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Возврат;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецЕсли;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>УдалитьФайлы(ИмяФайла);</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Сообщение = Новый СообщениеПользователю;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Сообщение.Текст = &quot;-------- Конец загрузки ------------&quot;;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Сообщение.Сообщить();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецПроцедуры</p></td>
	</tr>
</table>
<p>Мы формируем имя файла, которое надеемся найти в этом каталоге, а затем, создав новый объект Файл с таким именем,
	проверяем, существует ли он. Если такого файла нет, мы завершаем работу процедуры. Если же такой файл найден, нужно
	будет удалить его после того, как все данные, содержащиеся в нем, будут обработаны.</p>
<p>Теперь добавим в процедуру команды чтения найденного файла с данными обмена (листинг 24.17).</p>
<p><strong>листинг 24.17.</strong> Добавление чтения найденного файла с данными обмена</p>
<p>Процедура ПрочитатьСообщениеСИзменениями() Экспорт</p>
<table>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Каталог = КаталогВременныхФайлов();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// Сформировать имя файла.</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ИмяФайла = Каталог + ?(Прав(Каталог, 1) = &quot;\&quot;, &quot;&quot;, &quot;\&quot;) + &quot;Message&quot;
			+ СокрЛП(Ссылка.Код) + &quot;_&quot; + </p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>СокрЛП(ПланыОбмена.Филиалы.ЭтотУзел().Код) + &quot;.xml&quot;;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Файл = Новый Файл(ИмяФайла);</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Если Не Файл.Существует() Тогда</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Возврат;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецЕсли;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>// *** Чтение документов XML </strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>// Попытаться открыть файл.</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>ЧтениеXML = Новый ЧтениеXML;</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>Попытка </strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>ЧтениеXML.ОткрытьФайл(ИмяФайла);</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>Исключение </strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>Сообщение = Новый СообщениеПользователю;</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>Сообщение.Текст = &quot;Невозможно открыть файл обмена данными.&quot;;</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>Сообщение.Сообщить();</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>Возврат;</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>КонецПопытки;</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>Сообщение = Новый СообщениеПользователю;</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>Сообщение.Текст = &quot;-------- Загрузка из &quot; + Строка(ЭтотОбъект) + &quot; ------------&quot;;</strong>
		</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>Сообщение.Сообщить();</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>Сообщение = Новый СообщениеПользователю;</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>Сообщение.Текст = &quot; – Считывается файл &quot; + ИмяФайла;</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>Сообщение.Сообщить();</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>ЧтениеXML.Закрыть();</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>УдалитьФайлы(ИмяФайла);</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Сообщение = Новый СообщениеПользователю;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Сообщение.Текст = &quot;-------- Конец загрузки ------------&quot;;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Сообщение.Сообщить();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецПроцедуры</p></td>
	</tr>
</table>
<p>Именно в этот момент мы обращаемся к механизмам записи/чтения документов XML, которые работают с ними на базовом
	уровне.</p>
<p>Для этого мы создаем новый объект ЧтениеXML, с помощью которого открываем найденный файл для чтения. В случае успеха
	мы выводим сообщение о начале загрузки данных из файла. В конце процедуры мы также прекращаем чтение XML-данных из
	файла методом </p>
<p>Закрыть().</p>
<p>Полученные таким образом данные должны являться некоторым сообщением обмена данными. Для того чтобы представить их в
	терминах сообщений, мы добавим в процедуру следующий код (листинг 24.18). <strong>листинг 24.18.</strong> Добавление
	чтения заголовка XML-сообщения</p>
<table>
	<tr>
		<td><p>Процедура ПрочитатьСообщениеСИзменениями() Экспорт</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Каталог = КаталогВременныхФайлов();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// Сформировать имя файла.</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ИмяФайла = Каталог + ?(Прав(Каталог, 1) = &quot;\&quot;, &quot;&quot;, &quot;\&quot;) + &quot;Message&quot;
			+ СокрЛП(Ссылка.Код) + &quot;_&quot; + </p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>СокрЛП(ПланыОбмена.Филиалы.ЭтотУзел().Код) + &quot;.xml&quot;;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Файл = Новый Файл(ИмяФайла);</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Если Не Файл.Существует() Тогда</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Возврат;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецЕсли;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// *** Чтение документов XML </p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// Попытаться открыть файл.</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ЧтениеXML = Новый ЧтениеXML;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Попытка </p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ЧтениеXML.ОткрытьФайл(ИмяФайла);</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Исключение </p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Сообщение = Новый СообщениеПользователю;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Сообщение.Текст = &quot;Невозможно открыть файл обмена данными.&quot;;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Сообщение.Сообщить();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Возврат;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецПопытки;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Сообщение = Новый СообщениеПользователю;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Сообщение.Текст = &quot;-------- Загрузка из &quot; + Строка(ЭтотОбъект) + &quot; ------------&quot;;</p>
		</td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Сообщение.Сообщить();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Сообщение = Новый СообщениеПользователю;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Сообщение.Текст = &quot; – Считывается файл &quot; + ИмяФайла;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Сообщение.Сообщить();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>// Загрузить из найденного файла</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>// *** Инфраструктура сообщений.</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>ЧтениеСообщения = ПланыОбмена.СоздатьЧтениеСообщения();</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>// Читать заголовок сообщения обмена данными – файла XML.</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>ЧтениеСообщения.НачатьЧтение(ЧтениеXML);</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>ЧтениеСообщения.ЗакончитьЧтение();</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ЧтениеXML.Закрыть();</p></td>
	</tr>
</table>
<p>УдалитьФайлы(ИмяФайла);</p>
<p>Сообщение = Новый СообщениеПользователю;</p>
<table>
	<tr>
		<td><p>Сообщение.Текст = &quot;-------- Конец загрузки ------------&quot;;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Сообщение.Сообщить();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецПроцедуры</p></td>
	</tr>
</table>
<p>Здесь мы обращаемся к механизмам инфраструктуры сообщений планов обмена и создаем объект ЧтениеСообщенияОбмена.
	Используя метод этого объекта НачатьЧтение(), мы считываем заголовок XML-сообщения, в котором содержится в том числе
	информация об отправителе сообщения. После того как все сообщение будет нами обработано, мы заканчиваем чтение.</p>
<p>Теперь, когда мы представили данные обмена в виде сообщения и получили его заголовок, можно произвести одну проверку,
	перед тем как начать собственно обрабатывать данные (листинг 24.19). <strong>листинг 24.19.</strong> Добавление
	проверки сообщения</p>
<table>
	<tr>
		<td><p>Процедура ПрочитатьСообщениеСИзменениями() Экспорт</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Каталог = КаталогВременныхФайлов();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// Сформировать имя файла.</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ИмяФайла = Каталог + ?(Прав(Каталог, 1) = &quot;\&quot;, &quot;&quot;, &quot;\&quot;) + &quot;Message&quot;
			+ СокрЛП(Ссылка.Код) + &quot;_&quot; + </p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>СокрЛП(ПланыОбмена.Филиалы.ЭтотУзел().Код) + &quot;.xml&quot;;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Файл = Новый Файл(ИмяФайла);</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Если Не Файл.Существует() Тогда</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Возврат;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецЕсли;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// *** Чтение документов XML </p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// Попытаться открыть файл.</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ЧтениеXML = Новый ЧтениеXML;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Попытка </p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ЧтениеXML.ОткрытьФайл(ИмяФайла);</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Исключение </p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Сообщение = Новый СообщениеПользователю;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Сообщение.Текст = &quot;Невозможно открыть файл обмена данными.&quot;;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Сообщение.Сообщить();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Возврат;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецПопытки;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Сообщение = Новый СообщениеПользователю;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Сообщение.Текст = &quot;-------- Загрузка из &quot; + Строка(ЭтотОбъект) + &quot; ------------&quot;;</p>
		</td>
	</tr>
</table>
<p>Сообщение.Сообщить();</p>
<p>Сообщение = Новый СообщениеПользователю;</p>
<p>Сообщение.Текст = &quot; – Считывается файл &quot; + ИмяФайла;</p>
<table>
	<tr>
		<td><p>Сообщение.Сообщить();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// Загрузить из найденного файла</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// *** Инфраструктура сообщений.</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ЧтениеСообщения = ПланыОбмена.СоздатьЧтениеСообщения();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// Читать заголовок сообщения обмена данными – файла XML.</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ЧтениеСообщения.НачатьЧтение(ЧтениеXML);</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>// Сообщение предназначено не для этого узла.</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>Если ЧтениеСообщения.Отправитель &lt;&gt; Ссылка Тогда</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>ВызватьИсключение &quot;Неверный узел&quot;;</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>КонецЕсли;</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ЧтениеСообщения.ЗакончитьЧтение();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ЧтениеXML.Закрыть();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>УдалитьФайлы(ИмяФайла);</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Сообщение = Новый СообщениеПользователю;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Сообщение.Текст = &quot;-------- Конец загрузки ------------&quot;;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Сообщение.Сообщить();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецПроцедуры</p></td>
	</tr>
</table>
<p>Мы проверяем, является ли отправитель сообщения тем узлом, для которого мы в данном вызове этой процедуры производим
	обмен данными. </p>
<p>Если все в порядке, то перед тем как начать чтение данных, следует удалить все записи регистрации изменений, которые
	были сделаны для этого узла и соответствовали номерам сообщений меньше или равным указанному в обрабатываемом нами
	сообщении как номер принятого. Это делается затем, чтобы исключить дублирование данных, которые уже были ранее
	посланы этому узлу и им обработаны (листинг 24.20).</p>
<p><strong>листинг 24.20.</strong> Удаление записей регистрации изменений </p>
<p>для узла отправителя</p>
<table>
	<tr>
		<td><p>Процедура ПрочитатьСообщениеСИзменениями() Экспорт</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Каталог = КаталогВременныхФайлов();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// Сформировать имя файла.</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ИмяФайла = Каталог + ?(Прав(Каталог, 1) = &quot;\&quot;, &quot;&quot;, &quot;\&quot;) + &quot;Message&quot;
			+ СокрЛП(Ссылка.Код) + &quot;_&quot; + </p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>СокрЛП(ПланыОбмена.Филиалы.ЭтотУзел().Код) + &quot;.xml&quot;;</p></td>
	</tr>
</table>
<p>Файл = Новый Файл(ИмяФайла);</p>
<p>Если Не Файл.Существует() Тогда</p>
<p>Возврат;</p>
<table>
	<tr>
		<td><p>КонецЕсли;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// *** Чтение документов XML </p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// Попытаться открыть файл.</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ЧтениеXML = Новый ЧтениеXML;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Попытка </p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ЧтениеXML.ОткрытьФайл(ИмяФайла);</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Исключение </p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Сообщение = Новый СообщениеПользователю;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Сообщение.Текст = &quot;Невозможно открыть файл обмена данными.&quot;;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Сообщение.Сообщить();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Возврат;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецПопытки;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Сообщение = Новый СообщениеПользователю;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Сообщение.Текст = &quot;-------- Загрузка из &quot; + Строка(ЭтотОбъект) + &quot; ------------&quot;;</p>
		</td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Сообщение.Сообщить();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Сообщение = Новый СообщениеПользователю;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Сообщение.Текст = &quot; – Считывается файл &quot; + ИмяФайла;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Сообщение.Сообщить();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// Загрузить из найденного файла</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// *** Инфраструктура сообщений.</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ЧтениеСообщения = ПланыОбмена.СоздатьЧтениеСообщения();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// Читать заголовок сообщения обмена данными – файла XML.</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ЧтениеСообщения.НачатьЧтение(ЧтениеXML);</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// Сообщение предназначено не для этого узла.</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Если ЧтениеСообщения.Отправитель &lt;&gt; Ссылка Тогда</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ВызватьИсключение &quot;Неверный узел&quot;;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецЕсли;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>// Удаляем регистрацию изменений для узла отправителя сообщения.</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>// *** Служба регистрации изменений.</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>ПланыОбмена.УдалитьРегистрациюИзменений(ЧтениеСообщения.Отправитель, </strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>ЧтениеСообщения.НомерПринятого);</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ЧтениеСообщения.ЗакончитьЧтение();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ЧтениеXML.Закрыть();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>УдалитьФайлы(ИмяФайла);</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Сообщение = Новый СообщениеПользователю;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Сообщение.Текст = &quot;-------- Конец загрузки ------------&quot;;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Сообщение.Сообщить();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецПроцедуры</p></td>
	</tr>
</table>
<p>Обратите внимание, что здесь мы обращаемся к службе регистрации изменений и используем метод
	УдалитьРегистрациюИзменений() для выполнения описанных действий.</p>
<p>Теперь, наконец, мы можем приступить к чтению непосредственно самих данных, содержащихся в сообщении (листинг 24.21).
	<strong>листинг 24.21.</strong> Чтение данных из сообщения</p>
<table>
	<tr>
		<td><p>Процедура ПрочитатьСообщениеСИзменениями() Экспорт</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Каталог = КаталогВременныхФайлов();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// Сформировать имя файла.</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ИмяФайла = Каталог + ?(Прав(Каталог, 1) = &quot;\&quot;, &quot;&quot;, &quot;\&quot;) + &quot;Message&quot;
			+ СокрЛП(Ссылка.Код) + &quot;_&quot; + </p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>СокрЛП(ПланыОбмена.Филиалы.ЭтотУзел().Код) + &quot;.xml&quot;;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Файл = Новый Файл(ИмяФайла);</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Если Не Файл.Существует() Тогда</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Возврат;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецЕсли;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// *** Чтение документов XML </p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// Попытаться открыть файл.</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ЧтениеXML = Новый ЧтениеXML;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Попытка </p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ЧтениеXML.ОткрытьФайл(ИмяФайла);</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Исключение </p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Сообщение = Новый СообщениеПользователю;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Сообщение.Текст = &quot;Невозможно открыть файл обмена данными.&quot;;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Сообщение.Сообщить();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Возврат;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецПопытки;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Сообщение = Новый СообщениеПользователю;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Сообщение.Текст = &quot;-------- Загрузка из &quot; + Строка(ЭтотОбъект) + &quot; ------------&quot;;</p>
		</td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Сообщение.Сообщить();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Сообщение = Новый СообщениеПользователю;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Сообщение.Текст = &quot; – Считывается файл &quot; + ИмяФайла;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Сообщение.Сообщить();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// Загрузить из найденного файла</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// *** Инфраструктура сообщений.</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ЧтениеСообщения = ПланыОбмена.СоздатьЧтениеСообщения();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// Читать заголовок сообщения обмена данными – файла XML.</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ЧтениеСообщения.НачатьЧтение(ЧтениеXML);</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// Сообщение предназначено не для этого узла.</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Если ЧтениеСообщения.Отправитель &lt;&gt; Ссылка Тогда</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ВызватьИсключение &quot;Неверный узел&quot;;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецЕсли;</p></td>
	</tr>
</table>
<p>// Удаляем регистрацию изменений для узла отправителя сообщения.</p>
<p>// *** Служба регистрации изменений</p>
<table>
	<tr>
		<td><p>ПланыОбмена.УдалитьРегистрациюИзменений(ЧтениеСообщения.Отправитель, </p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ЧтениеСообщения.НомерПринятого);</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>// Читаем данные из сообщения *** XML-сериализация.</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>Пока ВозможностьЧтенияXML(ЧтениеXML) Цикл</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>КонецЦикла;</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ЧтениеСообщения.ЗакончитьЧтение();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ЧтениеXML.Закрыть();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>УдалитьФайлы(ИмяФайла);</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Сообщение = Новый СообщениеПользователю;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Сообщение.Текст = &quot;-------- Конец загрузки ------------&quot;;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Сообщение.Сообщить();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецПроцедуры</p></td>
	</tr>
</table>
<p>Чтение данных выполняется в цикле, причем мы снова обращаемся к механизмам XML-сериализации и методом глобального
	контекста ВозможностьЧтенияXML() получаем очередной тип данных XML из объекта ЧтениеXML и определяем, имеется ли
	соответствующий тип «1С:Предприятия». В случае успеха выполнение цикла продолжается.</p>
<p>И первое, что нам нужно сделать, – представить данные XML в виде некоторого значения, имеющего тип «1С:Предприятия».
	Для этого мы используем метод глобального контекста ПрочитатьXML(), листинг 24.22. <strong>листинг 24.22.</strong>
	Представление данных XML в виде значения, имеющего тип</p>
<table>
	<tr>
		<td><p>Процедура ПрочитатьСообщениеСИзменениями() Экспорт</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Каталог = КаталогВременныхФайлов();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// Сформировать имя файла.</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ИмяФайла = Каталог + ?(Прав(Каталог, 1) = &quot;\&quot;, &quot;&quot;, &quot;\&quot;) + &quot;Message&quot;
			+ СокрЛП(Ссылка.Код) + &quot;_&quot; + </p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>СокрЛП(ПланыОбмена.Филиалы.ЭтотУзел().Код) + &quot;.xml&quot;;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Файл = Новый Файл(ИмяФайла);</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Если Не Файл.Существует() Тогда</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Возврат;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецЕсли;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// *** Чтение документов XML </p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// Попытаться открыть файл.</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ЧтениеXML = Новый ЧтениеXML;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Попытка </p></td>
	</tr>
</table>
<p>ЧтениеXML.ОткрытьФайл(ИмяФайла);</p>
<p>Исключение </p>
<table>
	<tr>
		<td><p>Сообщение = Новый СообщениеПользователю;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Сообщение.Текст = &quot;Невозможно открыть файл обмена данными.&quot;;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Сообщение.Сообщить();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Возврат;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецПопытки;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Сообщение = Новый СообщениеПользователю;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Сообщение.Текст = &quot;-------- Загрузка из &quot; + Строка(ЭтотОбъект) + &quot; ------------&quot;;</p>
		</td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Сообщение.Сообщить();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Сообщение = Новый СообщениеПользователю;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Сообщение.Текст = &quot; – Считывается файл &quot; + ИмяФайла;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Сообщение.Сообщить();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// Загрузить из найденного файла</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// *** Инфраструктура сообщений.</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ЧтениеСообщения = ПланыОбмена.СоздатьЧтениеСообщения();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// Читать заголовок сообщения обмена данными – файла XML.</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ЧтениеСообщения.НачатьЧтение(ЧтениеXML);</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// Сообщение предназначено не для этого узла.</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Если ЧтениеСообщения.Отправитель &lt;&gt; Ссылка Тогда</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ВызватьИсключение &quot;Неверный узел&quot;;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецЕсли;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// Удаляем регистрацию изменений для узла отправителя сообщения.</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// *** Служба регистрации изменений.</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ПланыОбмена.УдалитьРегистрациюИзменений(ЧтениеСообщения.Отправитель, </p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ЧтениеСообщения.НомерПринятого);</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// Читаем данные из сообщения *** XML-сериализация.</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Пока ВозможностьЧтенияXML(ЧтениеXML) Цикл</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>// Читаем очередное значение.</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>Данные = ПрочитатьXML(ЧтениеXML);</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецЦикла;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ЧтениеСообщения.ЗакончитьЧтение();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ЧтениеXML.Закрыть();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>УдалитьФайлы(ИмяФайла);</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Сообщение = Новый СообщениеПользователю;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Сообщение.Текст = &quot;-------- Конец загрузки ------------&quot;;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Сообщение.Сообщить();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецПроцедуры</p></td>
	</tr>
</table>
<p>В результате выполнения этого метода переменная Данные будет содержать объект «1С:Предприятия», соответствующий
	данным XML.</p>
<p>Теперь, после того как объект «1С:Предприятия» получен, следует разрешить возможную коллизию (листинг 24.23).
	<strong>листинг 24.23.</strong> Разрешение возможных коллизий</p>
<table>
	<tr>
		<td><p>Процедура ПрочитатьСообщениеСИзменениями() Экспорт</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Каталог = КаталогВременныхФайлов();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// Сформировать имя файла.</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ИмяФайла = Каталог + ?(Прав(Каталог, 1) = &quot;\&quot;, &quot;&quot;, &quot;\&quot;) + &quot;Message&quot;
			+ СокрЛП(Ссылка.Код) + &quot;_&quot; + </p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>СокрЛП(ПланыОбмена.Филиалы.ЭтотУзел().Код) + &quot;.xml&quot;;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Файл = Новый Файл(ИмяФайла);</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Если Не Файл.Существует() Тогда</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Возврат;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецЕсли;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// *** Чтение документов XML </p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// Попытаться открыть файл.</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ЧтениеXML = Новый ЧтениеXML;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Попытка </p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ЧтениеXML.ОткрытьФайл(ИмяФайла);</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Исключение </p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Сообщение = Новый СообщениеПользователю;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Сообщение.Текст = &quot;Невозможно открыть файл обмена данными.&quot;;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Сообщение.Сообщить();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Возврат;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецПопытки;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Сообщение = Новый СообщениеПользователю;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Сообщение.Текст = &quot;-------- Загрузка из &quot; + Строка(ЭтотОбъект) + &quot; ------------&quot;;</p>
		</td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Сообщение.Сообщить();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Сообщение = Новый СообщениеПользователю;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Сообщение.Текст = &quot; – Считывается файл &quot; + ИмяФайла;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Сообщение.Сообщить();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// Загрузить из найденного файла</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// *** Инфраструктура сообщений.</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ЧтениеСообщения = ПланыОбмена.СоздатьЧтениеСообщения();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// Читать заголовок сообщения обмена данными – файла XML.</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ЧтениеСообщения.НачатьЧтение(ЧтениеXML);</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// Сообщение предназначено не для этого узла.</p></td>
	</tr>
</table>
<p>Если ЧтениеСообщения.Отправитель &lt;&gt; Ссылка Тогда ВызватьИсключение &quot;Неверный узел&quot;; КонецЕсли;</p>
<table>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// Удаляем регистрацию изменений для узла - отправителя сообщения.</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// *** Служба регистрации изменений.</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ПланыОбмена.УдалитьРегистрациюИзменений(ЧтениеСообщения.Отправитель, </p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ЧтениеСообщения.НомерПринятого);</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// Читаем данные из сообщения *** XML-сериализация.</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Пока ВозможностьЧтенияXML(ЧтениеXML) Цикл</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// Читаем очередное значение. </p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Данные = ПрочитатьXML(ЧтениеXML);</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>// Не переносим изменение, полученное в главный из неглавного, </strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>// если есть регистрация изменения.</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>Если Не ЧтениеСообщения.Отправитель.Главный И </strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>ПланыОбмена.ИзменениеЗарегистрировано(</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>ЧтениеСообщения.Отправитель, Данные) Тогда</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>Сообщение = Новый СообщениеПользователю;</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>Сообщение.Текст = </strong>&quot;<strong> – Изменения отклонены</strong>&quot;<strong>;</strong>
		</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>Сообщение.Сообщить();</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>Продолжить;</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>КонецЕсли;</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецЦикла;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ЧтениеСообщения.ЗакончитьЧтение();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ЧтениеXML.Закрыть();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>УдалитьФайлы(ИмяФайла);</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Сообщение = Новый СообщениеПользователю;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Сообщение.Текст = &quot;-------- Конец загрузки ------------&quot;;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Сообщение.Сообщить();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецПроцедуры</p></td>
	</tr>
</table>
<p>Возможная коллизия разрешается следующим образом: мы проверяем, является ли узел-отправитель главным узлом и есть ли
	записи об изменении этого объекта для данного узла в нашей базе данных. Если объект изменялся в нашей базе и
	отправитель не является главным узлом, мы отклоняем запись полученного объекта. Во всех остальных случаях мы
	принимаем изменения полученного объекта.</p>
<p>Теперь единственное, что нам осталось сделать, – записать полученные данные (листинг 24.24).</p>
<p><strong>листинг 24.24.</strong> Запись полученных данных</p>
<p>Процедура ПрочитатьСообщениеСИзменениями() Экспорт</p>
<table>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Каталог = КаталогВременныхФайлов();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// Сформировать имя файла.</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ИмяФайла = Каталог + ?(Прав(Каталог, 1) = &quot;\&quot;, &quot;&quot;, &quot;\&quot;) + &quot;Message&quot;
			+ СокрЛП(Ссылка.Код) + &quot;_&quot; + </p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>СокрЛП(ПланыОбмена.Филиалы.ЭтотУзел().Код) + &quot;.xml&quot;;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Файл = Новый Файл(ИмяФайла);</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Если Не Файл.Существует() Тогда</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Возврат;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецЕсли;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// *** Чтение документов XML </p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// Попытаться открыть файл.</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ЧтениеXML = Новый ЧтениеXML;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Попытка </p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ЧтениеXML.ОткрытьФайл(ИмяФайла);</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Исключение </p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Сообщение = Новый СообщениеПользователю;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Сообщение.Текст = &quot;Невозможно открыть файл обмена данными.&quot;;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Сообщение.Сообщить();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Возврат;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецПопытки;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Сообщение = Новый СообщениеПользователю;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Сообщение.Текст = &quot;-------- Загрузка из &quot; + Строка(ЭтотОбъект) + &quot; ------------&quot;;</p>
		</td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Сообщение.Сообщить();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Сообщение = Новый СообщениеПользователю;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Сообщение.Текст = &quot; – Считывается файл &quot; + ИмяФайла;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Сообщение.Сообщить();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// Загрузить из найденного файла</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// *** Инфраструктура сообщений.</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ЧтениеСообщения = ПланыОбмена.СоздатьЧтениеСообщения();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// Читать заголовок сообщения обмена данными – файла XML.</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ЧтениеСообщения.НачатьЧтение(ЧтениеXML);</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// Сообщение предназначено не для этого узла.</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Если ЧтениеСообщения.Отправитель &lt;&gt; Ссылка Тогда</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ВызватьИсключение &quot;Неверный узел&quot;;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецЕсли;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// Удаляем регистрацию изменений для узла отправителя сообщения</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// *** Служба регистрации изменений.</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ПланыОбмена.УдалитьРегистрациюИзменений(ЧтениеСообщения.Отправитель, </p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ЧтениеСообщения.НомерПринятого);</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// Читаем данные из сообщения *** XML-сериализация.</p></td>
	</tr>
</table>
<p>Пока ВозможностьЧтенияXML(ЧтениеXML) Цикл</p>
<p>// Читаем очередное значение. </p>
<table>
	<tr>
		<td><p>Данные = ПрочитатьXML(ЧтениеXML);</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// Не переносим изменение, полученное в главный из неглавного, </p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// если есть регистрация изменения.</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Если Не ЧтениеСообщения.Отправитель.Главный И </p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ПланыОбмена.ИзменениеЗарегистрировано(</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ЧтениеСообщения.Отправитель, Данные) Тогда</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Сообщение = Новый СообщениеПользователю;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Сообщение.Текст = &quot; – Изменения отклонены&quot;;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Сообщение.Сообщить();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Продолжить;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецЕсли;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>// Записать полученные данные.</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>Данные.ОбменДанными.Отправитель = ЧтениеСообщения.Отправитель;</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>Данные.ОбменДанными.Загрузка = Истина;</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p><strong>Данные.Записать();</strong></p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецЦикла;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ЧтениеСообщения.ЗакончитьЧтение();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ЧтениеXML.Закрыть();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>УдалитьФайлы(ИмяФайла);</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Сообщение = Новый СообщениеПользователю;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Сообщение.Текст = &quot;-------- Конец загрузки ------------&quot;;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Сообщение.Сообщить();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецПроцедуры</p></td>
	</tr>
</table>
<p>Перед записью полученного объекта мы устанавливаем у него в параметрах обмена данными узел отправителя для того,
	чтобы система при записи этого объекта в нашей базе данных не формировала записи регистрации изменений этого объекта
	для того узла, от которого мы его только что получили. </p>
<p>Кроме этого, в параметрах обмена данными мы устанавливаем свойство Загрузка, информирующее систему о том, что запись
	объекта будет происходить в режиме обновления данных, полученных в результате обмена. Такое указание позволяет
	системе упростить процедуру записи объекта, отказавшись от ряда стандартных проверок и исключив изменения связанных
	данных, которые выполняются при обычной записи.</p>
<p>На этом создание процедуры получения и обработки данных обмена закончено.</p>
<h1><a id="_Toc454870685"></a>Лабораторная работа № 41Работа с компонентой. Расчет</h1>
<p><strong>Проверка работы обмена данными</strong></p>
<p><strong>В режиме «Конфигуратор»</strong></p>
<p>Чтобы иметь возможность редактировать константу ПрефиксНумерации, раскроем ветвь Общие дерева объектов конфигурации,
	выделим ветвь Общие формы и с помощью конструктора форм создадим форму констант с именем ОбщиеНастройки.</p>
<p>В открывшемся окне свойств Дополнительно для этой формы укажем принадлежность формы к подсистеме Предприятие (рис.
	24.7).</p>
<p>В окне редактирования объекта конфигурации План обмена Филиалы и объекта Обработка ОбменДанными на закладке
	Подсистемы также укажем их принадлежность к подсистеме Предприятие. </p>
<p>Затем настроим командный интерфейс подсистемы Предприятие, чтобы доступ к командам открытия плана обмена, обработки,
	а также формы констант имел только Администратор, и переместим команду Филиалы в самое начало группы Панель
	навигации.Важное. А также в группе команд Панель действий.Создать включим видимость у команды Филиал: создать только
	для роли Администратор. Затем установим следующий порядок следования команд в группе Панель действий.Сервис:</p>
<p> Общие настройки,  Обмен данными.</p>
<p>И в заключение создадим новый каталог, в котором будет размещаться база нашего филиала. </p>
<p>Обновим конфигурацию базы данных (F7). Затем сохраним в созданный каталог нашу конфигурацию, выполнив команду
	главного меню Конфигурация Сохранить конфигурацию в файл…</p>
<p><strong>Рис. 24.8.</strong> Командный интерфейс подсистемы «Предприятие»</p>
<p><strong>В режиме «1С:Предприятие»</strong></p>
<p>Запустим «1С:Предприятие» в режиме отладки и установим необходимые значения в нашей центральной базе. </p>
<p>Прежде всего, зададим значение константы Префикс нумерации – ЦБ. Для этого выполним команду Общие настройки в подменю
	Сервис панели команд раздела Предприятие (рис. 24.9).</p>
<p>Нажмем Записать и закрыть. После этого откроем план обмена Филиалы и зададим параметры узла по умолчанию, то есть
	параметры нашей базы. </p>
<p>Для этого выполним команду Филиалы в панели команд раздела Предприятие. В списке планов обмена уже присутствует одна
	запись. Откроем и отредактируем ее. </p>
<p>Код базы будет ЦБ, а наименование – Центральная база. </p>
<p>Не забудьте, что именно код идентифицирует узлы обмена в различных базах, поэтому в базе филиала мы будем создавать
	узлы с такими же кодами (рис. 24.10).</p>
<p><strong>Рис. 24.10.</strong> Создание узла плана обмена</p>
<p>Нажмем Записать и закрыть. </p>
<p>Затем нажмем кнопку Создать или воспользуемся командой Филиал в подменю Создать.</p>
<p>Создадим новый узел, который будет соответствовать базе филиала, присвоим ему код Фил и наименование Филиал (рис.
	24.11).</p>
<p><strong>Рис. 24.11.</strong> Создание узла плана обмена</p>
<p>Обратите внимание, что предопределенный узел нашей информационной базы (Центральная база) выделен в списке узлов
	обмена специальной пиктограммой. Кнопка Зарегистрировать изменения недоступна для этого узла. </p>
<p>Выделим в списке новый узел Филиал и нажмем кнопку Зарегистрировать изменения.</p>
<p>Теперь вызовем обработку Обмен данными и нажмем Выполнить обмен. </p>
<p>В окне сообщений появится следующий текст (рис. 24.12).</p>
<p><strong>Рис. 24.12.</strong> Окно служебных сообщений</p>
<p>Таким образом, в результате обмена данными центральная база сформировала файл обмена, содержащий изменения всех
	данных, которыми она обменивается с филиалом. <strong>Запуск базы филиала</strong></p>
<p>Настало время перейти к базе филиала. </p>
<p>Запустим «1С:Предприятие» и добавим в список баз новую базу с пустой конфигурацией, которая будет расположена в
	созданном нами каталоге базы филиала. Для этого в окне запуска «1С:Предприятия» нажмем кнопку Добавить и выберем
	Создание новой информационной базы. Нажмем Далее. </p>
<p>В следующем окне выберем Создание информационной базы без конфигурации для … загрузки выгруженной ранее
	информационной базы. </p>
<p>Нажмем Далее, затем укажем наименование информационной базы, например, база Филиала. </p>
<p>Нажмем Далее, затем укажем каталог информационной базы, где находится сохраненная конфигурация, например, D:\
	Практическое пособие разработчика 8.3\Филиал, нажмем Далее и затем Готово. </p>
<p>В режиме «Конфигуратор»</p>
<p>Откроем созданную нами конфигурацию база Филиала в режиме Конфигуратор. Выполним команду главного меню Конфигурация 
	Открыть конфигурацию. Мы видим, что список объектов конфигурации пуст. </p>
<p>Теперь загрузим конфигурацию из файла (Конфигурация  Загрузить конфигурацию из файла…). </p>
<p>В окне выбора файла выберем каталог и имя файла, где находится сохраненная конфигурация, например, D:\Практическое
	пособие разработчика 8.3\Филиал\1Cv8.cf. На вопрос системы об обновлении конфигурации ответим утвердительно и в окне
	изменений структуры конфигурации нажмем Принять. </p>
<p>Теперь все объекты конфигурации перенесены из нашей центральной базы. </p>
<p>Однако тут есть одна тонкость, на которой следует остановиться отдельно. Дело в том, что в обмене данными у нас
	участвует справочник Склады, содержащий предопределенный элемент с именем Основной. </p>
<p>При создании справочников и других объектов конфигурации, которые могут содержать предопределенные элементы, свойство
	Обновление предопределенных данных для этих объектов стандартно устанавливается в значение Авто. Это приводит к
	тому, что при реструктуризации базы данных или при первом обращении к таблице, хранящей данные объекта конфигурации,
	создаются или обновляются элементы данных, связанных по имени с предопределенными элементами данных в
	конфигурации.</p>
<p>В нашем случае при открытии списка складов в базе филиала будет автоматически создан элемент справочника Склады,
	связанный с предопределенным элементом справочника с именем Основной. При этом свойство этого элемента справочника
	ИмяПредопределенныхДанных будет установлено в значение Основной. Изменить эту связь можно только с помощью
	встроенного языка.</p>
<p>Но затем при загрузке данных из центральной базы в справочник Склады будет добавлен еще один элемент данных,
	связанный с предопределенным элементом справочника с именем Основной. В дальнейшем это приведет к ошибке, так как в
	системе не может быть двух объектов, связанных с одинаковым предопределенным элементом.</p>
<p>Чтобы избежать такой ситуации, откроем окно редактирования объекта конфигурации Справочник Склады, перейдем на
	закладку Прочее и установим свойство Обновление предопределенных данных в значение Не обновлять автоматически (рис.
	24.13).</p>
<p>Выполним команду главного меню Администрирование  Пользователи и создадим в конфигурации филиала одного пользователя
	– Администратор с ролью Администратор. Дело в том, что пользователей в каждой информационной базе нужно создавать
	заново.</p>
<p>В режиме «1С:Предприятие»</p>
<p>Запустим «1С:Предприятие» в режиме отладки.</p>
<p>Первым делом зададим значение константы ПрефиксНумерации – ФЛ (рис. 24.14).</p>
<p><strong>Рис. 24.14.</strong> Редактирование константы</p>
<p>Затем откроем план обмена Филиал и опишем предопределенный узел (узел текущей информационной базы). Для этого
	выполним команду Филиалы в панели команд раздела Предприятие. </p>
<p>В списке планов обмена уже присутствует одна запись. Откроем и отредактируем ее. Зададим код Фил и наименование
	Филиал </p>
<p>(рис. 24.15).</p>
<p><strong>Рис. 24.15.</strong> Создание узла плана обмена</p>
<p>После этого создадим новый узел плана обмена с кодом ЦБ, наименованием Центральная база и признаком Главный (рис.
	24.16).</p>
<p><strong>Рис. 24.16.</strong> Создание узла плана обмена</p>
<p>Выделим в списке узлов обмена новый узел Центральная база и нажмем кнопку Зарегистрировать изменения.</p>
<p>Теперь для большей наглядности откроем список справочника Клиенты. Сейчас в нем нет ни одного элемента. И в
	справочнике Склады также нет элементов, так как мы установили свойство справочника Обновление предопределенных
	данных в значение Не обновлять автоматически.</p>
<p>Запустим обработку Обмен данными и нажмем Выполнить обмен. Справочники (и другие объекты конфигурации, участвующие в
	обмене данными) будет заполнены элементами, а в окне сообщений появится текст (рис. 24.17).</p>
<p><strong>пРиМеЧАние</strong></p>
<p>Чтобы увидеть клиентов, перенесенных из центральной базы, нужно обновить список клиентов (Еще  Обновить – F5).</p>
<p>Теперь проверим, как будет происходить обмен в другую сторону. </p>
<p>Создадим в справочнике Клиенты нового клиента с произвольным наименованием. </p>
<p>Обратите внимание, что нумерация кода нового клиента начинается с единицы и имеет префикс ФЛ. </p>
<p>После этого снова нажмем Выполнить обмен в открытой форме обработки Обмен данными. Затем перейдем в центральную базу,
	также выполним обмен данными и убедимся, что клиент, созданный в базе филиала, перенесен в центральную базу.</p>
<p><strong>Механизм распределенных информационных баз</strong></p>
<p><em>Механизм распределенных информационных баз</em> является развитием универсального механизма обмена данными. </p>
<p><strong>ВниМАние!</strong></p>
<p>Если вы используете учебную версию платформы «1С:Пред- приятие 8.3», то воспроизвести этот пример не удастся, так как
	учебная версия не поддерживает работу с распределенными информационными базами.</p>
<p>Он реализует привычную по прежним версиям «1С:Предприятия» модель распределенной информационной базы, которая
	подразумевает наличие идентичных конфигураций во всех узлах, имеет древовидную структуру и позволяет выполнять обмен
	как измененными данными, так и изменениями, внесенными в конфигурацию.</p>
<p>Механизм распределенных информационных баз реализуется планами обмена. Для этого объект конфигурации План обмена
	содержит свойство Распределенная информационная база. </p>
<p>Если это свойство установлено, для данного плана обмена включается механизм распределенных информационных баз и
	разработчик получает возможность создать распределенную базу исключительно интерактивными средствами, без написания
	кода. </p>
<p>Такая возможность не исключает программного управления обменом, которое также доступно при работе с распределенными
	информационными базами. </p>
<p>В ходе создания примера мы рассмотрим оба варианта организации обмена в распределенных информационных базах.</p>
<p><strong>Основные сведения</strong></p>
<p>Как мы уже говорили выше, распределенная информационная база должна иметь четко определенную древовидную структуру.
	Количество уровней в такой структуре не ограничено, главное – между двумя связанными узлами всегда должно быть
	определено отношение «главный – подчиненный» (рис. 24.18).</p>
<p><img src="75.jpeg"/></p>
<p><strong>Рис. 24.18.</strong> Структура распределенной информационной базы</p>
<p>Таким образом, любой узел этой структуры может иметь произвольное количество подчиненных узлов (в том числе и ни
	одного). Кроме этого, все узлы, кроме одного, должны иметь по одному главному узлу, и один узел не будет иметь
	главного узла – это корневой узел. Такое жесткое задание структуры узлов необходимо для определения порядка миграции
	изменений данных и изменений конфигурации.</p>
<p>Конфигурация может быть изменена только в узле, не имеющем главного узла (то есть в корневом). Изменения данных могут
	выполняться в любом узле.</p>
<p>Изменения конфигурации будут передаваться от главного к подчиненным узлам. Изменения данных могут передаваться между
	любыми связанными узлами.</p>
<p>Разрешение коллизий также будет производиться исходя из отношения «главный – подчиненный». Если изменения выполнены
	одновременно и в главном, и в подчиненном узле, при обмене данными будут приняты только изменения главного узла, а
	изменения подчиненного отвергнуты.</p>
<p>Для любого подчиненного узла возможно создание <em>начального образа</em> – информационной базы, созданной на
	основании конфигурации и данных главного узла в соответствии с правилами, определяемыми планом обмена. Процедура
	создания начального образа узла может выполняться неоднократно, при этом удаляются все записи изменений в базе
	главного узла для подчиненного узла. Сразу после создания начальный образ готов к обмену с главным узлом.</p>
<p>Создать подчиненный узел в распределенной информационной базе можно разными способами, но создание начального образа
	является рекомендуемым.</p>
<p><strong>Постановка задачи</strong></p>
<p>В качестве примера, на котором мы проиллюстрируем использование механизма распределенных информационных баз, будет
	создание нескольких отделений нашего ООО «На все руки мастер». </p>
<p>В отличие от филиалов, которые расположены в других городах, являются отдельными юридическими лицами и довольно
	самостоятельны в плане организации учета своей деятельности, отделения нашего предприятия расположены в этом же
	городе, никакой юридической самостоятельностью не обладают и ведут учет в точности так, как это организовано в
	главном офисе. </p>
<p>Поэтому все они используют ту же конфигурацию, что и главный офис, причем если главный офис вносит какие-либо
	изменения в свою конфигурацию, они должны быть своевременно внесены и в конфигурации отделений.</p>
<p>Для реализации такой схемы работы распределенная информационная база подойдет как нельзя лучше, и сначала мы
	организуем обмен с отделениями, используя исключительно интерактивные средства.</p>
<p><strong>Интерактивный обмен</strong></p>
<p><strong>В режиме «Конфигуратор»</strong></p>
<p>Для построения распределенной информационной базы нам понадобится создать еще один объект конфигурации План обмена,
	который мы назовем Отделения, представление объекта – Отделение. </p>
<p>Для этого плана обмена мы установим свойство Распределенная информационная база (рис. 24.19).</p>
<p>На закладке Поле ввода установим флажок Быстрый выбор, чтобы иметь возможность выбора узлов плана обмена из
	выпадающего списка. Затем определим состав объектов, участвующих в обмене. </p>
<p>На закладке Основные нажмем кнопку Состав и определим тот же состав данных для обмена, что и в плане обмена
	Филиалы. </p>
<p>Включим в обмен все объекты, не относящиеся к ведению бухгалтерии и расчету зарплаты. </p>
<p>В результате состав данных обмена должен выглядеть следующим образом (рис. 24.20).</p>
<p><strong>Рис. 24.20.</strong> Состав данных обмена</p>
<p>На закладке Подсистемы укажем принадлежность плана обмена к подсистеме Предприятие. </p>
<p>В окне настройки командного интерфейса этой подсистемы перенесем команду для открытия плана обмена Отделения в группу
	Панель навигации.Важное (после команды Филиалы) и установим видимость этой команды только для роли Администратор. А
	также в группе команд Панель действий.Создать включим видимость у команды Отделение: создать только для роли
	Администратор.</p>
<p><strong>В режиме «1С:Предприятие»</strong></p>
<p>Запустим «1С:Предприятие» в режиме отладки. Откроем план обмена Отделения и зададим параметры центрального узла
	(предопределенный элемент плана обмена). Для этого выполним команду Отделения в панели команд раздела
	Предприятие. </p>
<p>В списке планов обмена уже присутствует одна запись. Это предопределенный узел нашей информационной базы. Откроем и
	отредактируем его. </p>
<p>Внесем код ЦБ и наименование Центральная база. После этого создадим новый узел с кодом Отд и наименованием
	Отделение. </p>
<p>Для созданного нами узла доступны три кнопки в командной панели формы плана обмена: Записать изменения, Прочитать
	изменения и Создать начальный образ (рис. 24.21).</p>
<p><strong>Рис. 24.21.</strong> Команды работы с распределенной информационной базой</p>
<p>Не откладывая, воспользуемся одной из них, чтобы создать начальный образ информационной базы нашего отделения. Для
	этого нам потребуется сначала создать на диске новый каталог, в котором будет располагаться база отделения. </p>
<p>После этого выделим в списке узлов обмена узел Отделение, выполним команду Создать начальный образ. В появившемся
	окне укажем, что информационная база будет расположена на данном компьютере, и нажмем кнопку Создать начальный
	образ. На следующем шаге нажмем Сохранить и укажем каталог информационной базы (рис. 24.22).</p>
<p><strong>Рис. 24.22.</strong> Создание начального образа информационной базы</p>
<p>Вернемся в диалог создания начального образа информационной базы и нажмем Закрыть. </p>
<p>Система создаст в указанном каталоге начальный образ информационной базы нашего отделения. <strong>Запуск базы
	отделения</strong></p>
<p>Теперь перейдем к базе отделения. </p>
<p>Запустим «1С:Предприятие» и добавим в список баз созданную нами базу, расположенную в каталоге, в который мы
	поместили начальный образ информационной базы нашего отделения.</p>
<p>Для этого в окне запуска «1С:Предприятия» нажмем кнопку Добавить и выберем Добавление существующей информационной
	базы. </p>
<p>Нажмем Далее, затем укажем наименование информационной базы, например, база Отделения. Нажмем Далее, затем укажем
	каталог информационной базы, например, D:\Практическое пособие разработчика 8.3\Отделение, нажмем Далее и затем
	Готово. </p>
<p>В режиме «Конфигуратор»</p>
<p>Откроем созданную нами конфигурацию база Отделения в режиме Конфигуратор. </p>
<p>Выполним команду главного меню Конфигурация  Открыть конфигурацию. Мы видим, что конфигурация нашего отделения стала
	защищенной от изменений средствами управления распределенной информационной базой (рис. 24.23).</p>
<p>от изменений средствами управления распределенной информационной базой</p>
<p>Выполним команду главного меню Администрирование  Пользо- ватели и создадим в конфигурации отделения одного
	пользователя – Администратор с ролью Администратор.</p>
<p>В режиме «1С:Предприятие»</p>
<p>Запустим базу отделения в режиме отладки и откроем план обмена Отделения (рис. 24.24).</p>
<p><strong>Рис. 24.24.</strong> Узлы плана обмена «Отделения» </p>
<p>Обратите внимание, что в базе подчиненного узла сам подчиненный узел (Отделение) является предопределенным узлом
	плана обмена, а узел центральной базы отмечен желтой пиктограммой, указывающей на то, что он является главным для
	информационной базы отделения. Кроме этого, для узла центральной базы доступны только команды Записать изменения и
	Прочитать изменения. </p>
<p>Теперь проверим работу обмена данными. </p>
<p>Откроем список констант и зададим значение константы ПрефиксНумерации – ОТ. </p>
<p><strong>подскАзкА</strong></p>
<p>Если занятие № 24 Обмен данными выполняется после занятия № 25 Функциональные опции, в панели разделов может быть не
	видно каких-то разделов, использующихся в данном узле (например, Бухгалтерия). В этом случае откройте форму Общие
	настройки и проверьте значения функциональных опций, которые отвечают за видимость разделов (например, Бухгалтерский
	учет). Имейте в виду, что функциональные опции не копируются между узлами, а настраиваются в каждом узле
	отдельно.</p>
<p>После этого откроем справочник клиентов и добавим в него нового клиента. </p>
<p>Затем откроем план обмена Отделения, выделим узел Центральная база (тот узел, в который нужно передать изменения) и
	выполним команду Записать изменения. В появившемся окне нажмем Записать и сохранить в файл, на следующем шаге нажмем
	Сохранить и укажем имя файла сообщения (рис. 24.25).</p>
<p><strong>Рис. 24.25.</strong> Диалог записи сообщения с изменениями</p>
<p>Вернемся в диалог записи сообщения с изменениями и нажмем Закрыть. </p>
<p>Перейдем в центральную базу. Откроем план обмена Отделения, выделим узел Отделение (тот узел, от которого нужно
	принять изменения) и выполним команду Прочитать изменения. В появившемся окне нажмем Выбрать файл и прочитать
	изменения и укажем имя файла сообщения. Вернемся в диалог чтения сообщения с изменениями и нажмем Закрыть. </p>
<p>Убедимся, что новый клиент, созданный в базе отделения, присутствует и в центральной базе. Закроем окно
	«1С:Предприятия» для центральной базы.</p>
<p>Теперь посмотрим, как будут переноситься изменения конфигурации между главным и подчиненным узлами. В конфигураторе
	центральной базы создадим новую константу с именем НоваяКонстанта. А также добавим новый предопределенный элемент в
	справочник Склады с именем Офис. Выполним обновление конфигурации базы данных и запустим «1С:Предприятие» в режиме
	отладки. </p>
<p>Откроем план обмена Отделения и выполним запись изменений для подчиненного узла Отделение. </p>
<p>После этого закроем окно «1С:Предприятия» и конфигуратор информационной базы отделения, запустим эту базу в режиме
	1С:Предприятие и выполним чтение изменений от узла Центральная база. </p>
<p>По окончании чтения система выдаст следующее сообщение </p>
<p>(рис. 24.26).</p>
<p>Закроем окно «1С:Предприятия», откроем конфигуратор базы отделения и увидим, что в основной конфигурации появилась
	новая константа НоваяКонстанта, а также новый предопределенный элемент в справочнике Склады с именем Офис. То есть
	изменения, внесенные в конфигурацию центральной базы, были автоматически перенесены в конфигурацию подчиненного
	узла. </p>
<p>Теперь единственное, что остается сделать, – это выполнить обновление конфигурации базы данных в подчиненном
	узле. </p>
<p>Следует сказать несколько слов о порядке принятия изменений, когда в одном сообщении получены как изменения
	конфигурации, так и изменения данных. </p>
<p>В этом случае сначала будет изменена основная конфигурация и выдано сообщение о необходимости выполнения обновления
	конфигурации базы данных. </p>
<p>Но самих данных, например, новой записи в справочнике Склады, связанной с предопределенным элементом Офис, мы пока не
	увидим. </p>
<p>Что касается предопределенных данных, то здесь не будет такой проблемы с дублированием данных, связанных с одним
	предопределенным элементом, как при выполнении универсального обмена данными. Дело в том, что автоматическое
	создание предопределенных данных в дочерних узлах распределенной информационной базы не производится.</p>
<p>Затем следует выполнить повторное получение данных, при котором будут приняты уже изменения данных, содержащиеся в
	сообщении. </p>
<p>Такой порядок принятия изменений не зависит от того, относятся измененные данные к существующим объектам конфигурации
	или к новым.</p>
<p>В заключение удалим объект НоваяКонстанта из дерева объектов нашей конфигурации. Также удалим предопределенный
	элемент Офис из справочника Склады.</p>
<p><strong>Программный обмен</strong></p>
<p>Все описанные выше действия по обмену данными в распределенной информационной базе можно выполнить программно. </p>
<p>Мы создадим обработку, которая будет программно выполнять для выбранного узла все те действия, которые были
	рассмотрены в предыдущем разделе.</p>
<p><strong>В режиме «Конфигуратор»</strong></p>
<p>В конфигураторе центральной базы создадим новый объект конфигурации Обработка с именем ОбменСОтделениями. </p>
<p>На закладке Формы создадим основную форму обработки. В окне редактора форм на закладке Реквизиты добавим реквизит
	формы ПолеВводаОтделение с типом ПланОбменаСсылка.Отделения и перетащим его в окно элементов формы. </p>
<p>В открывшейся палитре свойств этого поля зададим заголовок – Отделение, вид поля (Поле ввода) оставим по умолчанию
	(рис. 24.27).</p>
<p><strong>Рис. 24.27.</strong> Редактирование формы обработки</p>
<p>Затем на закладке Команды поочередно создадим команды Соз- датьНачальныйОбраз, ЗаписатьИзменения и
	ПрочитатьИзменения. Нажмем кнопку открытия в строке Действие для каждой команды. </p>
<p>Создадим клиентские обработчики этих команд в модуле формы, но заполнять их пока не будем, а перейдем на закладку
	Форма и поочередно перетащим эти команды в окно элементов формы. </p>
<p>В результате форма обработки примет вид (рис. 24.28).</p>
<p>Откроем палитру свойств кнопки СоздатьНачальныйОбраз и снимем флажок у свойства Доступность. </p>
<p>Таким образом, при открытии обработки кнопка будет недоступной, пока не выбран узел плана обмена в поле
	ПолеВводаОтделение. Эта кнопка также будет недоступной в случае выбора предопределенного узла нашей информационной
	базы, то есть создание начального образа невозможно, если выбранный узел является предопределенным. </p>
<p>Чтобы обеспечить такое поведение кнопки, создадим в модуле формы обработки функцию, выполняющуюся на сервере и
	возвращающую истину, если переданный в функцию узел является предопределенным (листинг 24.25).</p>
<p><strong>листинг 24.25.</strong> Функция «ПредопределенныйУзел()»</p>
<p>&amp;НаСервереБезКонтекста</p>
<table>
	<tr>
		<td><p>Функция ПредопределенныйУзел(Узел)</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Возврат Узел = ПланыОбмена.Отделения.ЭтотУзел();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецФункции</p></td>
	</tr>
</table>
<p>Затем в окне элементов формы выделим элемент ПолеВводаОтделение, вызовем его палитру свойств и создадим клиентский
	обработчик события ОбработкаВыбора. </p>
<p>Заполним обработчик следующим образом (листинг 24.26).</p>
<p><strong>листинг 24.26.</strong> Процедура «ПолеВводаОтделениеОбработкаВыбора()»</p>
<table>
	<tr>
		<td><p>&amp;НаКлиенте</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Процедура ПолеВводаОтделениеОбработкаВыбора(Элемент, ВыбранноеЗначение, СтандартнаяОбработка)</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Если ПредопределенныйУзел(ВыбранноеЗначение)Тогда</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Элементы.СоздатьНачальныйОбраз.Доступность = Ложь;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Иначе</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Элементы.СоздатьНачальныйОбраз.Доступность = Истина;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецЕсли;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецПроцедуры</p></td>
	</tr>
</table>
<p>В этой процедуре доступность кнопки СоздатьНачальныйОбраз определяется в зависимости от значения функции
	ПредопределенныйУзел(), в которую передается ссылка на выбранный узел (ВыбранноеЗначение).</p>
<p>Теперь заполним обработчик команды СоздатьНачальныйОбраз следующим образом (листинг 24.27). <strong>листинг
	24.27.</strong> Обработчик нажатия кнопки «Создать начальный образ»</p>
<table>
	<tr>
		<td><p>&amp;НаКлиенте</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Процедура СоздатьНачальныйОбраз(Команда)</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Диалог = Новый ДиалогВыбораФайла(РежимДиалогаВыбораФайла.ВыборКаталога);</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Диалог.Заголовок = &quot;Укажите каталог информационной базы:&quot;;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Если Диалог.Выбрать() Тогда</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>СоздатьНачальныйОбразНаСервере(ПолеВводаОтделение, Диалог.Каталог);</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Сообщение = Новый СообщениеПользователю;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Сообщение.Текст = &quot;Создание начального образа узла завершено.&quot;;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Сообщение.Сообщить();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецЕсли;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецПроцедуры</p></td>
	</tr>
</table>
<p>В начале процедуры мы вызываем диалог выбора каталога, в который будет помещен образ информационной базы, и затем
	вызываем процедуру СоздатьНачальныйОбразНаСервере(), исполняющуюся на сервере без контекста, в которой вызывается
	метод СоздатьНачальныйОбраз() объекта ПланыОбменаМенеджер. </p>
<p>Именно этот метод и позволяет нам создать образ для подчиненного узла распределенной информационной базы. В первом
	параметре метода передается ссылка на узел (реквизит формы ПолеВводаОтделение), для которого мы хотим создать
	начальный образ, а во втором – строка соединения, указывающая информационную базу (листинг 24.28).</p>
<p><strong>листинг 24.28.</strong> Процедура «СоздатьНачальныйОбразНаСервере»</p>
<table>
	<tr>
		<td><p>&amp;НаСервереБезКонтекста</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Процедура СоздатьНачальныйОбразНаСервере(Узел, КаталогСоединения)</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ПланыОбмена.СоздатьНачальныйОбраз(Узел, &quot;File =&quot;&quot;&quot; + КаталогСоединения + &quot;&quot;&quot;&quot;);</p>
		</td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецПроцедуры</p></td>
	</tr>
</table>
<p>Теперь создадим обработчик команды Записать изменения. </p>
<p>Текст обработчика будет выглядеть следующим образом </p>
<p>(листинг 24.29).</p>
<p><strong>листинг 24.29.</strong> Обработчик нажатия кнопки «Записать изменения»</p>
<table>
	<tr>
		<td><p>&amp;НаКлиенте</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Процедура ЗаписатьИзменения(Команда)</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Диалог = Новый ДиалогВыбораФайла(РежимДиалогаВыбораФайла.Сохранение);</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Диалог.Заголовок = &quot;Укажите файл обмена:&quot;;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Если Диалог.Выбрать() Тогда</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ЗаписатьИзмененияНаСервере(ПолеВводаОтделение, Диалог.ПолноеИмяФайла);</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Сообщение = Новый СообщениеПользователю;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Сообщение.Текст = &quot;Запись изменений завершена.&quot;;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Сообщение.Сообщить();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецЕсли;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецПроцедуры</p></td>
	</tr>
</table>
<p>В начале процедуры мы вызываем диалог ввода имени файла, в который будут записаны изменения, и затем вызываем
	процедуру ЗаписатьИзмененияНаСервере(), исполняющуюся на сервере без контекста. В первом параметре метода передается
	ссылка на узел (реквизит формы ПолеВводаОтделение), для которого будет производиться запись изменений.</p>
<p>В этой процедуре мы создаем объект ЗаписьXML для работы с этим файлом. </p>
<p>Затем создаем объект ЗаписьСообщенияОбмена, с помощью которого будем делать сообщение обмена. В методе
	НачатьЗапись(), во втором параметре, мы указываем, для какого узла обмена будет создаваться это сообщение. </p>
<p>После этого мы выполняем метод ЗаписатьИзменения() объекта ПланыОбменаМенеджер, который и записывает изменения,
	предназначенные для передачи в выбранный узел, в указанное сообщение обмена. </p>
<p>В заключение мы, как обычно, заканчиваем запись сообщения обмена и закрываем файл (листинг 24.30).</p>
<p><strong>листинг 24.30.</strong> Процедура «ЗаписатьИзмененияНаСервере»</p>
<table>
	<tr>
		<td><p>&amp;НаСервереБезКонтекста</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Процедура ЗаписатьИзмененияНаСервере(Узел, ИмяФайла)</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// Создать и проинициализировать объект ЗаписьXML. </p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ЗаписьXML = Новый ЗаписьXML;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ЗаписьXML.ОткрытьФайл(ИмяФайла);</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// Создать объект ЗаписьСообщенияОбмена и начать запись сообщения.</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ЗаписьСообщения = ПланыОбмена.СоздатьЗаписьСообщения();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ЗаписьСообщения.НачатьЗапись(ЗаписьXML, Узел);</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// Записать содержимое тела сообщения обмена данными распределенной ИБ.</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ПланыОбмена.ЗаписатьИзменения(ЗаписьСообщения); </p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// Закончить запись сообщения и запись XML.</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ЗаписьСообщения.ЗакончитьЗапись();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ЗаписьXML.Закрыть(); </p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецПроцедуры</p></td>
	</tr>
</table>
<p><strong>УзнАй больше!</strong></p>
<p><em>Следует отметить, что метод «ЗаписатьИзменения()» позволяет задать максимальное число элементов данных, которые
	помещаются в сообщение в рамках одной транзакции базы данных. По умолчанию все данные помещаются в сообщение в
	рамках одной транзакции.</em></p>
<p><em>Такой режим является рекомендуемым, так как гарантирует согласованность данных, помещаемых в сообщение. </em></p>
<p><em>Но при создании сообщения в многопользовательском режиме могут быть конфликты блокировок между транзакцией, в
	которой данные помещаются в сообщение, и транзакциями, выполняемыми другими пользователями. Для снижения вероятности
	возникновения таких конфликтов можно задать значение этого параметра, отличное от значения по умолчанию. Чем меньше
	значение параметра, тем меньше вероятность конфликта блокировок, но выше вероятность помещения в сообщение
	несогласованных данных.</em></p>
<p><em>Учитывая все вышесказанное, идеальным вариантом является выполнение обмена данными в монопольном режиме. Однако
	такой вариант не всегда приемлем в силу специфики организации работы конкретных информационных баз.</em></p>
<p>И последним мы создадим обработчик команды Прочитать изменения. </p>
<p>Текст обработчика будет выглядеть следующим образом </p>
<p>(листинг 24.31).</p>
<p><strong>листинг 24.31.</strong> Обработчик нажатия кнопки «Прочитать изменения»</p>
<table>
	<tr>
		<td><p>&amp;НаКлиенте</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Процедура ПрочитатьИзменения(Команда)</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Диалог = Новый ДиалогВыбораФайла(РежимДиалогаВыбораФайла.Открытие);</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Диалог.Заголовок = &quot;Укажите файл обмена:&quot;;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Если Диалог.Выбрать() Тогда</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ПрочитатьИзмененияНаСервере(Диалог.ПолноеИмяФайла);</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Сообщение = Новый СообщениеПользователю;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Сообщение.Текст = &quot;Чтение изменений завершено.&quot;;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Сообщение.Сообщить();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецЕсли;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецПроцедуры</p></td>
	</tr>
</table>
<p>В начале процедуры мы снова вызываем диалог выбора имени файла, который будет прочитан, и затем вызываем процедуру
	ПрочитатьИзмененияНаСервере(), исполняющуюся на сервере без контекста. </p>
<p>В этой процедуре мы создаем объект ЧтениеXML для работы с этим файлом. Затем создаем объект ЧтениеСообщенияОбмена для
	чтения сообщения, содержащегося в указанном файле. </p>
<p>Затем методом ПрочитатьИзменения() объекта ПланыОбменаМенеджер мы читаем полученное сообщение. </p>
<p>В заключение процедуры мы завершаем чтение сообщения обмена и закрываем файл (листинг 24.32).</p>
<p><strong>листинг 24.32.</strong> Процедура «ПрочитатьИзмененияНаСервере»</p>
<p>&amp;НаСервереБезКонтекста</p>
<table>
	<tr>
		<td><p>Процедура ПрочитатьИзмененияНаСервере(ИмяФайла)</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// Создать и проинициализировать объект ЧтениеXML. </p></td>
	</tr>
	<tr>
		<td><p>ЧтениеXML = Новый ЧтениеXML;</p></td>
	</tr>
	<tr>
		<td><p>ЧтениеXML.ОткрытьФайл(ИмяФайла);</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// Создать объект ЧтениеСообщенияОбмена и начать чтение сообщения.</p></td>
	</tr>
	<tr>
		<td><p>ЧтениеСообщения = ПланыОбмена.СоздатьЧтениеСообщения();</p></td>
	</tr>
	<tr>
		<td><p>ЧтениеСообщения.НачатьЧтение(ЧтениеXML);</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// Прочитать содержимое тела сообщения.</p></td>
	</tr>
	<tr>
		<td><p>ПланыОбмена.ПрочитатьИзменения(ЧтениеСообщения);</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// Закончить чтение сообщения и чтение XML.</p></td>
	</tr>
	<tr>
		<td><p>ЧтениеСообщения.ЗакончитьЧтение();</p></td>
	</tr>
	<tr>
		<td><p>ЧтениеXML.Закрыть();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецПроцедуры</p></td>
	</tr>
</table>
<p>В заключение на закладке Подсистемы укажем принадлежность обработки ОбменСОтделениями к подсистеме Предприятие. </p>
<p>Теперь настроим командный интерфейс основного раздела для администратора. Вызовем окно настройки командного
	интерфейса (Открыть командный интерфейс основного раздела) из контекстного меню корня дерева объектов конфигурации.
	Добавим команды для открытия форм Общие настройки, Обмен данными и Обмен с отделениями в список команд основного
	раздела и зададим видимость этих форм только для роли Администратор (рис. 24.29).</p>
<p><strong>Рис. 24.29.</strong> Настройка командного интерфейса основного раздела для администратора</p>
<p>А также расположим формы списка планов обмена Филиалы и Отделения на начальной странице администратора. Вызовем
	настройку начальной страницы (Открыть рабочую область начальной страницы) из контекстного меню корня дерева объектов
	конфигурации. </p>
<p>Создадим форму списка плана обмена Отделения. Добавим формы списка планов обмена Филиалы и Отделения в левую часть
	начальной страницы и зададим видимость этих форм только для роли Администратор (рис. 24.30).</p>
<p><strong>Рис. 24.30.</strong> Настройка начальной страницы для администратора</p>
<p>Теперь выполним пример программного обмена данными. </p>
<p><strong>подскАзкА</strong></p>
<p>При выполнении примера обмена данными нужно правильно задавать узел, в который записываются и от которого принимаются
	изменения. Например, после изменения данных в центральной базе в списке узлов плана обмена нужно выбрать подчиненный
	узел, которому будут передаваться данные (например, Отделение), и нажать кнопку Записать изменения. А в базе узла, в
	который будут загружаться данные, в списке узлов плана обмена нужно выбрать узел, из которого данные были выгружены
	(например, Центральная база), и нажать кнопку Прочитать изменения.</p>
<p>Запустим «1С:Предприятие» для пользователя с ролью Администратор. Откроется начальная страница приложения (рис.
	24.31).</p>
<p><strong>Рис. 24.31.</strong> Начальная страница «1С:Предприятия» для администратора</p>
<p>Из командной панели раздела Главное, из подменю Сервис откроем форму обработки Обмен с отделениями. Выберем в поле
	ввода Отделение узел обмена Отделение, для которого мы хотим создать начальный образ нашей информационной базы (рис.
	24.32).</p>
<p>Затем выполним команду Создать начальный образ. Создадим каталог, куда будет выгружен начальный образ информационной
	базы, и укажем его в диалоге выбора каталога. </p>
<p>Теперь создадим в центральной базе нового сотрудника. В форме Обмен с отделениями выберем в поле ввода Отделение узел
	обмена Отделение, в который мы хотим передать изменения. Нажмем кнопку Записать изменения и укажем имя файла
	сообщения с изменениями.</p>
<p>Затем откроем базу отделения (куда был выгружен начальный образ центральной базы) в конфигураторе. Создадим в ней
	пользователя с ролью Администратор и запустим «1С:Предприятие». На начальной странице в форме Обмен с отделениями
	выберем в поле ввода Отделение узел обмена Центральная база, от которого мы хотим принять изменения. Нажмем кнопку
	Прочитать изменения и укажем имя файла сообщения с изменениями.</p>
<p><strong>Рис. 24.32.</strong> Пример программного обмена с отделениями</p>
<p>Убедимся, что сотрудник центральной базы (с префиксом кода ЦБ) присутствует в базе отделения.</p>
<p>Следует лишь сделать несколько заключительных замечаний. </p>
<p>При использовании механизма распределенных информационных баз становятся доступными четыре события объекта
	встроенного языка ПланОбменаОбъект.&lt;имя&gt;, которые позволяют управлять отправкой и приемом данных на уровне
	отдельных элементов данных:</p>
<ul>
	<li>ПриОтправкеДанныхГлавному(),</li>
	<li>ПриОтправкеДанныхПодчиненному(),</li>
	<li>ПриПолученииДанныхОтГлавного(),</li>
	<li>ПриПолученииДанныхОтПодчиненного().</li>
</ul>
<p>Эти события будут вызываться для каждого элемента данных, включаемого в сообщение. </p>
<p>Работу этих событий можно увидеть, добавив в модуль объекта План обмена Отделения следующий текст (листинг
	24.33).</p>
<p><strong>листинг 24.33.</strong> Просмотр работы событий объекта «ПланОбменаОбъект»</p>
<p>Процедура ПриОтправкеДанныхГлавному(ЭлементДанных, ОтправкаЭлемента)</p>
<table>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Сообщение = Новый СообщениеПользователю;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Сообщение.Текст = &quot;ПриОтправкеДанныхГлавному &quot; + ЭлементДанных;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Сообщение.Сообщить();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецПроцедуры </p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Процедура ПриОтправкеДанныхПодчиненному(ЭлементДанных, ОтправкаЭлемента)</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Сообщение = Новый СообщениеПользователю;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Сообщение.Текст = &quot;ПриОтправкеДанныхПодчиненному &quot; + ЭлементДанных;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Сообщение.Сообщить();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецПроцедуры</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Процедура ПриПолученииДанныхОтГлавного(ЭлементДанных, ПолучениеЭлемента, ОтправкаНазад)</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Сообщение = Новый СообщениеПользователю;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Сообщение.Текст = &quot;ПриПолученииДанныхОтГлавного &quot; + ЭлементДанных;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Сообщение.Сообщить();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецПроцедуры</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Процедура ПриПолученииДанныхОтПодчиненного(ЭлементДанных, </p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ПолучениеЭлемента, ОтправкаНазад)</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Сообщение = Новый СообщениеПользователю;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Сообщение.Текст = &quot;ПриПолученииДанныхОтПодчиненного &quot; + ЭлементДанных;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Сообщение.Сообщить();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецПроцедуры</p></td>
	</tr>
</table>
<p>В первом параметре всех перечисленных событий находится тот элемент данных, для которого вызвано это событие. </p>
<p>Параметр ОтправкаЭлемента позволяет управлять тем, какая информация будет помещена в сообщение. Он может принимать
	три значения:</p>
<ul>
	<li>Авто – значение по умолчанию. Указывает на то, что элемент данных будет помещен в сообщение;</li>
	<li>Удалить – в сообщение будет помещено значение, предназначенное для удаления этого элемента данных;</li>
	<li>Игнорировать – в сообщение не будет помещено ничего, связан-</li>
</ul>
<p>ного с этим элементом данных.</p>
<p>Параметр ПолучениеЭлемента позволяет указать, будет ли прочитанный элемент данных записан в базу данных или нет.
	Параметр также может принимать три значения:</p>
<ul>
	<li>Авто – значение по умолчанию. Если элемент данных получен от главного узла, он будет записан всегда. Если
		элемент данных получен от подчиненного узла, он будет записан, только если не зарегистрированы изменения для
		этого элемента данных;
	</li>
	<li>Принять – полученный элемент данных будет записан всегда;</li>
	<li>Игнорировать – проигнорировать получение элемента данных и ничего не записывать.</li>
</ul>
<p>Также в событиях получения данных существует третий параметр – ОтправкаНазад, имеющий тип Булево. </p>
<p>Этот параметр позволяет выполнять принудительную регистрацию изменений для полученного элемента данных в
	базе-получателе. </p>
<p>Такая необходимость может возникнуть, например, когда при приеме данных от узла-отправителя обнаружено, что
	полученные данные противоречивы (например, в узле-отправителе была допущена ошибка при изменении данных). </p>
<p>Тогда мы можем проигнорировать присланные изменения и, установив флажок ОтправкаНазад, вызвать принудительную
	регистрацию изменений полученного элемента данных в нашей базе для узла-отправителя. </p>
<p>В результате последующего обмена состояние этого элемента данных в узле-отправителе будет установлено таким же, как и
	в нашей базе.</p>
<p><strong>Изменение структуры узлов</strong></p>
<p>В заключение следует сказать о том, что механизм распределенных информационных баз содержит программное средство
	реконфигурирования структуры узлов распределенной базы.</p>
<p>Для этого следует использовать метод УстановитьГлавныйУзел() объекта ПланыОбменаМенеджер. </p>
<p>В параметре этого метода передается ссылка на узел плана обмена распределенной информационной базы, который
	устанавливается главным для текущей базы. Также в этом параметре может быть передано значение Неопределено, и это
	приведет к тому, что у текущей информационной базы будет отсутствовать главный узел.</p>
<p>Допустим, необходимо переместить один из подчиненных узлов в корень дерева (рис. 24.33).</p>
<p><img src="76.jpeg"/></p>
<p><strong>Рис. 24.33.</strong> Реконфигурирование структуры узлов Для этого нужно выполнить следующие действия (листинг
	24.34). <strong>листинг 24.34.</strong> Перемещение Узла2 в корень дерева</p>
<table>
	<tr>
		<td><p>// В информационной базе Узла2.</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ПланыОбменаМенеджер.УстановитьГлавныйУзел(Неопределено);</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// В информационной базе Узла1.</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ПланыОбменаМенеджер.УстановитьГлавныйУзел(Узел2);</p></td>
	</tr>
</table>
<p>При этом будут удалены все записи регистрации изменений конфигурации Узла1, относящиеся к Узлу2, т. к. передача
	изменений конфигурации будет возможна теперь только от Узла2 к Узлу1. Записи регистрации изменения данных удалены не
	будут, так как передача изменений данных будет по-прежнему возможна между этими узлами.</p>
<p>Таким же образом, используя значение параметра метода Неопределено, мы можем отключать от дерева отдельную
	информационную базу или целое поддерево (рис. 24.34, листинг 24.35). <strong>листинг 24.35.</strong> Перемещение
	Узла2 в корень дерева</p>
<table>
	<tr>
		<td><p>// В информационной базе Узла1.</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ПланыОбменаМенеджер.УстановитьГлавныйУзел(Неопределено);</p></td>
	</tr>
</table>
<p><img src="77.jpeg"/></p>
<p><strong>Рис. 24.34.</strong> Отключение поддерева от распределенной информационной базы</p>
<p>Кроме этого, мы можем создавать распределенную информационную базу из отдельных информационных баз с идентичной
	конфигурацией (рис. 24.35, листинг 24.36).</p>
<p><img src="78.jpeg"/></p>
<p><strong>Рис. 24.35.</strong> Информационная база из отдельных информационных баз с идентичной конфигурацией</p>
<p><strong>листинг 24.36.</strong> Создание распределенной информационной базы </p>
<p>из баз с идентичной конфигурацией</p>
<table>
	<tr>
		<td><p>// В информационных базах Узла2, Узла3 и Узла4.</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ПланыОбменаМенеджер.УстановитьГлавныйУзел(Узел1);</p></td>
	</tr>
</table>
<h1><a id="_Toc454870686"></a>Лабораторная работа № 42 Создание новой заданной конфигурации</h1>
<p><strong>Опции «Бухгалтерский учет» и «Расчет зарплаты»</strong></p>
<p>Предположим, что косметический салон по каким-то причинам не ведет бухгалтерский учет и расчет заработной платы. Для
	отключения соответствующей функциональности мы создадим функциональные опции БухгалтерскийУчет и РасчетЗарплаты,
	установим их для соответствующих объектов конфигурации и отключим их в режиме 1С:Предприятие. </p>
<p>Таким образом, при совершенно одинаковой конфигурации в прикладном решении косметического салона не будет видно
	никаких действий, связанных с расчетом зарплаты и ведением бухучета, как будто их и нет вовсе.</p>
<p><strong>В режиме «Конфигуратор»</strong></p>
<p>Поскольку значения функциональных опций обязательно должны где-то храниться, добавим сначала константы
	БухгалтерскийУчет и РасчетЗарплаты с типом Булево, в которых будут храниться значения функциональных опций (рис.
	25.1).</p>
<p><strong>Рис. 25.1.</strong> Создание константы</p>
<p>Если значение константы Истина, значит, функциональная опция включена. Если значение Ложь, функциональная опция
	выключена.</p>
<p>Затем раскроем ветвь Общие, выделим ветвь Функциональные опции и создадим функциональные опции БухгалтерскийУчет и
	РасчетЗарплаты, указав в свойстве Хранение соответствующие константы (рис. 25.2).</p>
<p><strong>Рис. 25.2.</strong> Создание функциональной опции</p>
<p>Теперь нам нужно привязать объекты конфигурации к функциональным опциям.</p>
<p>К ведению бухгалтерского учета в нашей конфигурации относятся следующие объекты:</p>
<ul>
	<li>справочник Субконто,</li>
	<li>документ ВводНачальныхОстатковНоменклатуры,</li>
	<li>отчет ОборотноСальдоваяВедомость,</li>
	<li>план видов характеристик ВидыСубконто,</li>
	<li>план счетов Основной,</li>
	<li>регистр бухгалтерии Управленческий.</li>
</ul>
<p>На закладке Состав отметим эти объекты для функциональной опции БухгалтерскийУчет (рис. 25.3).</p>
<p>К расчету заработной платы в нашей конфигурации относятся следующие объекты:</p>
<ul>
	<li>справочник ВидыГрафиковРаботы,</li>
	<li>документ НачисленияСотрудникам,</li>
	<li>отчет НачисленияСотрудникам,</li>
	<li>отчет Перерасчет,</li>
	<li>отчет ДиаграммаНачислений,</li>
	<li>план видов расчета ОсновныеНачисления,</li>
	<li>регистр сведений ГрафикиРаботы,  регистр расчета Начисления.</li>
</ul>
<p>На закладке Состав отметим эти объекты для функциональной опции РасчетЗарплаты.</p>
<p>Теперь, если мы откроем окно редактирования объекта конфигурации Справочник Субконто или любого другого объекта
	конфигурации, входящего в состав функциональной опции БухгалтерскийУчет, то эта опция будет включена на закладке
	Функциональные опции окна редактирования этого объекта (рис. 25.4).</p>
<p><strong>Рис. 25.4.</strong> Значение функциональных опций для объектов бухгалтерского учета</p>
<p>Таким образом, отображение объектов конфигурации в интерфейсе приложения зависит от того, включена связанная с ними
	функциональная опция (значение соответствующей константы – Истина) или нет.</p>
<p>У объектов, относящихся к расчету зарплаты, мы увидим включенной функциональную опцию РасчетЗарплаты на закладке
	Функциональные опции окна редактирования этих объектов.</p>
<p>Для остальных объектов конфигурации на закладке Функциональные опции ничего не отмечено. Если функциональная опция
	для объекта выключена, это значит, что данный объект не зависит от значения функциональной опции и отображается
	всегда (рис. 25.5).</p>
<p><strong>пРиМеЧАние</strong></p>
<p>Если включить в состав функциональной опции какую-либо подсистему, то мы вообще не увидим соответствующего раздела в
	«1С:Предприятии», пока данная функциональная опция отключена.</p>
<p>После этого раскроем ветвь Общие формы и откроем общую форму констант. Эту форму с именем ОбщиеНастройки мы создали
	на предыдущем занятии, и она уже содержит константу ПрефиксНумерации. </p>
<p>Теперь нам нужно добавить в нее новые константы, чтобы затем в пользовательском режиме открывать форму констант и
	изменять значение функциональных опций.</p>
<p>На закладке Реквизиты этой формы раскроем основной реквизит НаборКонстант и перетащим константы БухгалтерскийУчет и
	РасчетЗарплаты в окно элементов формы (рис. 25.6).</p>
<p><strong>Рис. 25.6.</strong> Редактирование общей формы констант</p>
<p><strong>В режиме «1С:Предприятие»</strong></p>
<p>Запустим «1С:Предприятие» в режиме отладки и проверим работу функциональных опций. В панели команд раздела Главное
	выполним команду Общие настройки. </p>
<p>В открывшейся форме констант мы видим, что обе константы имеют значение Ложь (рис. 25.7).</p>
<p><strong>Рис. 25.7.</strong> Форма констант</p>
<p>Это значит, что соответствующие функциональные опции отключены. </p>
<p>И действительно, в разделах Бухгалтерия и Расчет зарплаты мы не видим команд для ведения бухучета и расчета
	заработной платы </p>
<p>(рис. 25.8).</p>
<p><strong>Рис. 25.8.</strong> Интерфейс раздела «Расчет зарплаты»</p>
<p>Теперь если через некоторое время руководство косметического салона пожелает вести расчет зарплаты, то администратор
	включит соответствующую опцию Расчет зарплаты, и все!</p>
<p>для расчета зарплаты</p>
<p>Нужно только сохранить измененное значение констант и перезапустить «1С:Предприятие», чтобы платформа «отрисовала»
	новый интерфейс. </p>
<p>В результате раздел Расчет зарплаты будет выглядеть следующим образом (рис. 25.10).</p>
<p><strong>Рис. 25.10.</strong> Интерфейс раздела «Расчет зарплаты»</p>
<p>А если мы включим и вторую функциональную опцию Бухгалтерский учет, то мы восстановим интерфейс прикладного решения,
	разработанный нами для фирмы ООО «На все руки мастер».</p>
<p>Вот так быстро и легко происходит настройка прикладного решения под требования заказчика.</p>
<p><strong>Опция «Учет клиентов»</strong></p>
<p>Нужно отметить, что функциональные опции могут влиять не только на командный интерфейс приложения, но и на внешний
	вид форм, используемых в прикладном решении. Кроме этого, включение/ выключение функциональности можно выполнять и
	без перезапуска клиентского приложения. А если к этому прибавить возможности работы с функциональными опциями во
	встроенном языке, то становится понятным, что механизм функциональных опций может сделать процесс внедрения и
	настройки прикладного решения у заказчика простым и понятным даже для неопытного пользователя. </p>
<p>Рассмотрим еще один пример.</p>
<p>«Поименный» учет клиентов при оказании услуг востребован далеко не всегда. Зачастую важен лишь сам факт оказания
	услуги, при этом «личность» клиента не имеет значения. </p>
<p>Поэтому предусмотрим в нашей конфигурации возможность отключить ведение списка клиентов и избавимся от необходимости
	указывать клиента каждый раз при оказании услуги.</p>
<p>Также доработаем существующие функциональные опции, включив в них и подсистемы Бухгалтерия и РасчетЗарплаты, чтобы
	наше решение выглядело «законченным». Раз бухгалтерия не нужна, значит ее нет нигде.</p>
<p><strong>В режиме «Конфигуратор»</strong></p>
<p>Откроем состав функциональной опции БухгалтерскийУчет и добавим в него подсистему Бухгалтерия. </p>
<p>Аналогичным образом добавим в состав функциональной опции РасчетЗарплаты подсистему РасчетЗарплаты (рис. 25.11).</p>
<p>Теперь займемся созданием новой функциональной опции.</p>
<p>и «БухгалтерскийУчет»</p>
<p>Для хранения этой опции добавим константу с именем УчетКлиентов. Она будет иметь тип Булево (рис. 25.12).</p>
<p>Добавим функциональную опцию УчетКлиентов и укажем, что ее значение будет храниться в константе УчетКлиентов (рис.
	25.13).</p>
<p>Теперь на закладке Состав укажем, какие объекты будут входить в эту функциональную опцию.</p>
<p><strong>Рис. 25.13.</strong> Функциональная опция «УчетКлиентов»</p>
<p>Прежде всего – справочник Клиенты. Затем – реквизит Клиент документа ОказаниеУслуги. И в заключение – измерение
	Клиент регистра накопления Продажи (рис. 25.14).</p>
<p>Теперь доработаем общую форму ОбщиеНастройки, с помощью которой мы устанавливаем значения функциональных опций. </p>
<p>Прежде всего перенесем в состав элементов формы нашу новую константу УчетКлиентов (рис. 25.15).</p>
<p>После этого обеспечим автоматическую перерисовку интерфейса прикладного решения после установки новых значений
	функциональных опций. </p>
<p>Для этого в дереве элементов формы выделим корень (Форма), в палитре свойств найдем событие формы ПослеЗаписи и
	нажмем кнопку открытия в поле ввода этого события. Укажем, что событие будет обрабатываться только на клиенте.</p>
<p>В открывшемся модуле формы, в обработчике события формы ПослеЗаписи напишем единственную строку (листинг 25.1).
	<strong>листинг 25.1.</strong> Обработчик события «ПослеЗаписи» формы</p>
<table>
	<tr>
		<td><p>&amp;НаКлиенте</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Процедура ПослеЗаписи(ПараметрыЗаписи)</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ОбновитьИнтерфейс();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецПроцедуры</p></td>
	</tr>
</table>
<p>ОбновитьИнтерфейс() – это метод глобального контекста, который обновляет командный интерфейс, начальную страницу и
	открытые формы с учетом текущих значений функциональных опций и их параметров.</p>
<p>Для того чтобы проверка работы функциональных опций стала для нас максимально удобной и легкой, сделаем так, чтобы
	открытие этой общей формы не блокировало основное окно программы.</p>
<p>Сейчас при открытии формы ОбщиеНастройки в режиме 1С:Пред- приятие форма, открытая в основном окне программы,
	блокируется. Так происходит потому, что по умолчанию конструктор форм установил для этой формы свойство
	РежимОткрытияОкна в значение Блокировать окно владельца.</p>
<p>Поэтому перейдем за закладку Форма, в дереве элементов формы выделим корневой элемент, в палитре свойств найдем
	свойство РежимОткрытияОкна и установим его в значение Независимый (рис. </p>
<p>25.16).</p>
<p><strong>В режиме «1С:Предприятие»</strong></p>
<p>Запустим систему в режиме 1С:Предприятие. В разделе Главное выполним команду Общие настройки. Мы видим, что
	функциональная опция Учет клиентов отключена (рис. 25.17).</p>
<p><strong>Рис. 25.17.</strong> Функциональная опция «УчетКлиентов» отключена</p>
<p>Проверим, как это скажется на документе Оказание услуги. Перейдем в раздел Оказание услуг и выполним команду Оказание
	услуг. Откроем любой документ Оказание услуги, например № 2 (рис. 25.18).</p>
<p><strong>Рис. 25.18.</strong> Документ «Оказание услуги»</p>
<p>Мы видим, что в документе нет поля Клиент, а если в панели навигации формы перейти к движениям регистра Продажи, то
	мы не увидим колонки Клиент. Также в разделе Предприятие нет команды Клиенты.</p>
<p>Теперь вернемся в форму Общие настройки, установим флажок Учет клиентов и нажмем кнопку Записать.</p>
<p>Интерфейс прикладного решения изменится. Для примера откроем снова документ Оказание услуги № 2 (рис. 25.19).</p>
<p><strong>Рис. 25.19.</strong> Документ «Оказание услуги»</p>
<p>В документе появилось поле Клиент, в списке движений регистра Продажи появилась колонка Клиент, а в разделе
	Предприятие – команда Клиенты.</p>
<p>Аналогичным образом вы можете самостоятельно переключить различные функциональные опции и посмотреть, как при этом
	меняется интерфейс прикладного решения.</p>
<p>В заключение в форме Общие настройки включим все функциональные опции и нажмем кнопку Записать (рис. 25.20).</p>
<p><strong>Рис. 25.20.</strong> Общие настройки прикладного решения</p>
<p>Таким образом, мы включили всю функциональность разработанного нами прикладного решения. Заметьте, что интерфейс
	приложения перерисовался сразу же после записи общих настроек.</p>
<p>На этом мы фактически завершили разработку нашей конфигурации.</p>
<p>Следующие два занятия будут посвящены отдельным приемам разработки, которые часто используются в
	«1С:Предприятии». </p>
<p>Некоторые примеры мы будем выполнять в нескольких различных вариантах, поэтому какой из этих вариантов использовать в
	имеющейся конфигурации – это уже дело вашего личного вкуса.</p>
<h1><a id="_Toc454870687"></a>Лабораторная работа № 43 Система расчета зарплаты</h1>
<p><strong>Организация подборов</strong></p>
<p>Задача организации подбора заключается, как правило, в заполнении табличной части документа информацией, которую
	выбирает пользователь в списке какого-либо объекта. </p>
<p>Для иллюстрации механизма подбора информации в форме мы будем использовать задачу подбора элементов справочника в
	табличную часть документа как наиболее распространенную. </p>
<p>Поскольку механизм подбора реализован на уровне форм, то в других случаях просто будут задействованы иные прикладные
	объекты. Сама механика подбора не изменится.</p>
<p>Для организации подбора в форму документа следует открыть форму справочника как подчиненную форме документа в целом
	либо одному из элементов формы. Способ получения формы справочника может быть любым, также как и сама форма
	справочника, которая будет использована. Важно лишь то, что эта форма должна быть открыта как подчиненная. </p>
<p>Результат подбора будет доступен в обработчике события ОбработкаВыбора формы документа или элемента формы (в
	зависимости от того, чему мы подчиним форму справочника при открытии). </p>
<p>Событие ОбработкаВыбора в форме документа будет вызвано в двух случаях:</p>
<ul>
	<li>когда в форме справочника будет выполнен интерактивный выбор;</li>
	<li>когда в форме справочника будет вызван метод ОповеститьОВыборе().</li>
</ul>
<p>Различные способы подбора мы проиллюстрируем на примере подбора элементов справочника Номенклатура в документ
	ПриходнаяНакладная.</p>
<p><strong>Одиночный подбор</strong></p>
<p>При одиночном подборе форма справочника будет закрываться сразу после выбора элемента. Для выбора следующего элемента
	необходимо будет снова инициировать подбор.</p>
<p><strong>В режиме «Конфигуратор»</strong></p>
<p>Откроем форму документа ПриходнаяНакладная. </p>
<p>На закладке Команды создадим команду Подбор и в открывшейся палитре свойств нажмем кнопку открытия в строке Действие.
	Укажем, что команда будет выполняться на клиенте.</p>
<p>Шаблон обработчика команды заполнять пока не будем, а перейдем на закладку Форма и перетащим эту команду в окно
	элементов формы, в командную панель таблицы Материалы (рис. 26.1).</p>
<p>В форме документа в обработчик команды Подбор добавим следующий текст (листинг 26.1).</p>
<p><strong>листинг 26.1.</strong> Обработчик нажатия кнопки «Подбор»</p>
<p>&amp;НаКлиенте</p>
<table>
	<tr>
		<td><p>Процедура Подбор(Команда)</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ОткрытьФорму(&quot;Справочник.Номенклатура.ФормаВыбора&quot;, , Элементы.Материалы);</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецПроцедуры</p></td>
	</tr>
</table>
<p>В этой процедуре мы открываем форму выбора для справочника Номенклатура, указывая, что она подчинена таблице
	Материалы формы документа ПриходнаяНакладная (Элементы.Материалы). </p>
<p>При выборе из формы выбора справочника выбранное значение будет передано в обработчик события ОбработкаВыбора таблицы
	формы Материалы, так как она является владельцем открытой формы выбора. </p>
<p>Поэтому откроем палитру свойств таблицы Материалы и создадим обработчик события ОбработкаВыбора (рис. 26.2). Укажем,
	что событие будет обрабатываться только на клиенте (листинг 26.2).</p>
<p>для таблицы «Материалы»</p>
<p><strong>листинг 26.2.</strong> Обработчик события «ОбработкаВыбора» таблицы «Материалы»</p>
<table>
	<tr>
		<td><p>&amp;НаКлиенте</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Процедура МатериалыОбработкаВыбора(Элемент, ВыбранноеЗначение, СтандартнаяОбработка)</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Элементы.Материалы.ДобавитьСтроку();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Элементы.Материалы.ТекущиеДанные.Материал = ВыбранноеЗначение;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p> КонецПроцедуры</p></td>
	</tr>
</table>
<p>В этой процедуре мы добавляем новую строку в таблицу Материалы и присваиваем колонке Материал в новой строке
	выбранное в форме выбора справочника значение. Это значение передается в обработчик события в параметре
	ВыбранноеЗначение.</p>
<p><strong>В режиме «1С:Предприятие»</strong></p>
<p>Запустим «1С:Предприятие» в режиме отладки. </p>
<p>Перейдем в раздел Учет материалов, откроем список приходных накладных и создадим новую приходную накладную.</p>
<p>В командной панели списка материалов нажмем кнопку Подбор и двойным щелчком мыши подберем в накладную один
	материал.</p>
<p><strong>Множественный подбор</strong></p>
<p><strong>В режиме «Конфигуратор»</strong></p>
<p>При множественном подборе форма справочника будет открыта до тех пор, пока пользователь не закроет ее интерактивно
	или не будет вызван метод формы Закрыть(). </p>
<p>В форме документа ПриходнаяНакладная, в обработчике команды Подбор заменим прежний текст новым (листинг 26.3).
	<strong>листинг 26.3.</strong> Обработчик нажатия кнопки «Подбор»</p>
<table>
	<tr>
		<td><p>&amp;НаКлиенте</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Процедура Подбор(Команда)</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ПараметрыФормы = Новый Структура(&quot;ЗакрыватьПриВыборе&quot;, Ложь);</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ОткрытьФорму(&quot;Справочник.Номенклатура.ФормаВыбора&quot;, </p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ПараметрыФормы, Элементы.Материалы);</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецПроцедуры</p></td>
	</tr>
</table>
<p>При открытии формы мы используем ее <em>параметры</em>. </p>
<p>Параметры формы нужны для того, чтобы открыть форму в некотором нужном нам состоянии. Параметры формы представляют
	собой структуру. Каждый элемент этой структуры описывает один параметр формы. Ключ элемента – это имя параметра
	формы.</p>
<p>Такую структуру мы передаем в метод ОткрытьФорму() вторым параметром (переменная ПараметрыФормы).</p>
<p>Предварительно мы эту структуру формируем. В ней у нас всего один элемент с ключом ЗакрыватьПриВыборе. </p>
<p>Таким образом, передавая эту структуру в метод ОткрытьФорму(), мы устанавливаем параметр открываемой формы
	ЗакрыватьПриВыборе в значение Ложь.</p>
<p>Это значит, что созданная форма выбора после двойного щелчка мыши на номенклатуре закрываться не будет. </p>
<p><strong>В режиме «1С:Предприятие»</strong></p>
<p>Запустим «1С:Предприятие» в режиме отладки. </p>
<p>Перейдем в раздел Учет материалов, откроем список приходных накладных и создадим новую приходную накладную.</p>
<p>В командной панели списка материалов нажмем кнопку Подбор. Двойным щелчком мыши подберем в накладную один материал,
	затем другой материал. Перейдем в группу Услуги и подберем несколько услуг. </p>
<p>Когда все желаемые товары и услуги будут выбраны, закроем окно с формой выбора.</p>
<p><strong>Подбор с использованием множественного выбора</strong></p>
<p><strong>В режиме «Конфигуратор»</strong></p>
<p>Еще одним способом организации подбора является возможность выделения в списке сразу нескольких строк.</p>
<p>Режим множественного выделения в списке устанавливается, как правило, во всех формах списков по умолчанию.</p>
<p>Однако возможность выбрать сразу несколько элементов из списка по умолчанию, как правило, отключена.</p>
<p>Поэтому для того, чтобы в форме списка справочника Номенклатура можно было не только отметить, но и выбрать сразу
	несколько элементов, мы снова воспользуемся одним из параметров расширения формы динамического списка –
	МножественныйВыбор.</p>
<p>В форме документа ПриходнаяНакладная изменим текст обработчика команды Подбор следующим образом (листинг 26.4).
	<strong>листинг 26.4.</strong> Обработчик нажатия кнопки «Подбор»</p>
<table>
	<tr>
		<td><p>&amp;НаКлиенте</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Процедура Подбор(Команда)</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ПараметрыФормы = Новый Структура(&quot;МножественныйВыбор&quot;, Истина);</p></td>
	</tr>
	<tr>
		<td><p>ОткрытьФорму(&quot;Справочник.Номенклатура.ФормаВыбора&quot;, </p></td>
	</tr>
	<tr>
		<td><p>ПараметрыФормы, Элементы.Материалы);</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецПроцедуры</p></td>
	</tr>
</table>
<p>При множественном выборе форма выбора будет возвращать уже не один элемент, а массив элементов.</p>
<p>Поэтому в обработчик события ОбработкаВыбора добавим обход массива переданных элементов (листинг 26.5). </p>
<p><strong>листинг 26.5.</strong> Обработчик события «ОбработкаВыбора» таблицы «Материалы»</p>
<table>
	<tr>
		<td><p>&amp;НаКлиенте</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Процедура МатериалыОбработкаВыбора(Элемент, ВыбранноеЗначение, СтандартнаяОбработка)</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Для Каждого ВыбранныйЭлемент Из ВыбранноеЗначение Цикл</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>НоваяСтрока = Объект.Материалы.Добавить();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>НоваяСтрока.Материал = ВыбранныйЭлемент;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецЦикла;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p> КонецПроцедуры</p></td>
	</tr>
</table>
<p><strong>В режиме «1С:Предприятие»</strong></p>
<p>Запустим «1С:Предприятие» в режиме отладки. </p>
<p>Перейдем в раздел Учет материалов, откроем список приходных накладных и создадим новую приходную накладную.</p>
<p>В командной панели списка материалов нажмем кнопку Подбор. Для удобства в открывшейся форме выбора справочника
	Номенклатура установим режим просмотра в виде списка – Еще  Режим просмотра  Список.</p>
<p>Удерживая клавишу Ctrl, выделим в списке несколько товаров и несколько услуг.</p>
<p>Нажмем кнопку Выбрать.</p>
<p>Отмеченные элементы появятся в табличной части документа.</p>
<p><strong>Множественный подбор </strong></p>
<p><strong>с использованием множественного выбора</strong></p>
<p><strong>В режиме «Конфигуратор»</strong></p>
<p>Последний способ подбора, который мы рассмотрим, будет сочетать в себе оба рассмотренных ранее способа. Мы будем
	отмечать сразу несколько элементов справочника и подбирать их в документ без закрытия формы выбора. Затем снова
	отмечать несколько элементов справочника и подбирать их в документ.</p>
<p>Для этого нам будет необходимо при открытии формы выбора установить оба параметра: ЗакрыватьПриВыборе и
	МножественныйВыбор.</p>
<p>Процедура нажатия кнопки Подбор будет выглядеть следующим образом (листинг 26.6).</p>
<p><strong>листинг 26.6.</strong> Обработчик нажатия кнопки «Подбор»</p>
<table>
	<tr>
		<td><p>&amp;НаКлиенте</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Процедура Подбор(Команда)</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ПараметрыФормы = </p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Новый Структура(&quot;ЗакрыватьПриВыборе, МножественныйВыбор&quot;, Ложь, Истина);</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ОткрытьФорму(&quot;Справочник.Номенклатура.ФормаВыбора&quot;, </p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ПараметрыФормы, Элементы.Материалы);</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецПроцедуры</p></td>
	</tr>
</table>
<p><strong>В режиме «1С:Предприятие»</strong></p>
<p>Запустим «1С:Предприятие» в режиме отладки. </p>
<p>Перейдем в раздел Учет материалов, откроем список приходных накладных и создадим новую приходную накладную.</p>
<p>В командной панели списка материалов нажмем кнопку Подбор. </p>
<p>Откроем группу Услуги  Телевизоры, выделим в ней все услуги и нажмем кнопку Выбрать.</p>
<p>Откроем группу Материалы  Прочее, выделим в ней все материалы и нажмем кнопку Выбрать.</p>
<p>Закроем окно с формой выбора справочника Номенклатура.</p>
<p><strong>Использование метода «Оповестить о выборе()»</strong></p>
<p>Метод формы ОповеститьОВыборе() используется в тех случаях, когда алгоритм формирования данных подбора сложен и кроме
	собственно выбора элемента справочника от пользователя требуется указание некоторой дополнительной информации. В
	этом случае метод ОповеститьОВыборе() вызывается тогда, когда вся необходимая информация подбора сформирована.</p>
<p>Метод ОповеститьОВыборе() посылает оповещение владельцу формы о выполнении выбора или подбора, передает ему выбранное
	значение и закрывает форму, если она открыта не в режиме множественного выбора. </p>
<p>Также метод ОповеститьОВыборе() может использоваться в тех случаях, когда требуется передать в форму документа не
	только выбранный элемент справочника (или массив элементов), а некоторую произвольную структуру данных.</p>
<p><strong>Особенности разработки в режиме без использования модальности</strong></p>
<p>На этом же примере с подбором номенклатуры в табличную часть приходной накладной рассмотрим те особенности, которые
	нужно знать разработчику о режиме работы интерфейса без использования модальных окон.</p>
<p>Этот режим является стандартным для новых, создаваемых с нуля конфигураций и определяется свойством конфигурации
	РежимИспользованияМодальности.</p>
<p><strong>Теория</strong></p>
<p>Прежде чем приступить к практической части, нужно сказать несколько слов о том, почему стандартно используется именно
	такой режим работы интерфейса.</p>
<p>Исторически сложилось так, что обычные «десктопные» приложения часто используют в своей работе модальные окна. И
	«1С:Предприятие» не является исключением. Модальные окна очень удобны в тех ситуациях, когда от пользователя
	требуется ввод информации, без которой невозможно дальнейшее выполнение алгоритма. При этом полностью блокируется
	весь остальной интерфейс программы, а исполнение программного кода останавливается до тех пор, пока пользователь не
	закроет модальное окно.</p>
<p>Однако с тех пор, как «1С:Предприятие» перестало быть «обычным десктопным приложением», с появлением веб-клиента и с
	переходом «1С:Предприятия» на мобильные платформы использование модальных окон стало вызывать много проблем.</p>
<p>Основные неудобства заключались в том, что для нормальной работы веб-клиента на обычных компьютерах требовалась
	предварительная настройка браузера. А на мобильных устройствах браузеры вообще не поддерживают работу с модальными
	окнами.</p>
<p>Поэтому в «1С:Предприятии» был стандартно реализован специальный режим работы интерфейса без использования модальных
	окон. В чем заключается его основная особенность?</p>
<p>В этом режиме работы интерфейса окно, которое раньше было бы модальным, рисуется в пределах родительского окна и
	точно так же блокирует весь остальной интерфейс. Таким образом обеспечивается «модальность» для пользователя. Он не
	сможет выполнить никакие другие действия, пока не закроет такое окно.</p>
<p>Однако для разработчика в момент отображения блокирующего окна исполнение программного кода не останавливается.
	Программный код продолжает выполняться дальше. Это означает, что алгоритм, который обычно являлся одним целым,
	теперь придется разделить на две части: одну, которая заканчивается открытием блокирующего окна, и вторую, которая
	будет выполнена тогда, когда пользователь закроет это окно. </p>
<p>Чтобы система знала, с какого места продолжать исполнение программного кода, блокирующему окну передается имя
	процедуры, которая должна быть выполнена тогда, когда пользователь закроет это окно. Именно с этой процедуры и
	продолжится выполнение программного кода.</p>
<p>Суть этих изменений проще всего увидеть на следующем примере. Этот пример немного надуман и вряд ли представляет
	большую практическую ценность. Но он нужен для того, чтобы легче понять второй, уже достаточно практический
	пример.</p>
<p><strong>Как задать вопрос пользователю в команде формы</strong></p>
<p>Предположим, прежде чем выполнять подбор номенклатуры в табличную часть приходной накладной, нам нужно задать вопрос
	пользователю о необходимости подбора.</p>
<p><strong>В режиме «Конфигуратор»</strong></p>
<p>Прежде всего, откроем палитру свойств нашей конфигурации и посмотрим на свойство Режим использования модальности </p>
<p>(рис. 26.3).</p>
<p><strong>Рис. 26.3.</strong> Свойство конфигурации </p>
<p>«Режим использования модальности»</p>
<p>Мы видим, что это свойство стандартно установлено в значение Не использовать. Этот режим является рекомендуемым. </p>
<p>Это значит, что при попытке открытия модального окна в режиме 1С:Предприятие будет получена ошибка.</p>
<p>Чтобы этого избежать, зададим вопрос пользователю в обработчике команды Подбор, но будем использовать не модальный
	метод Вопрос(), а его немодальный аналог ПоказатьВопрос(). </p>
<p>Для разработки конфигураций в режиме отказа от модальности в платформу добавлены методы, аналогичные модальным
	методам, но, в отличие от них, не блокирующие программный код. Эти методы уже не используют модальные окна, поэтому
	могут беспрепятственно использоваться при разработке веб-приложений. Эти методы имеют следующие особенности:</p>
<ul>
	<li>имена этих методов начинаются со слов Показать либо Начать, например ПоказатьВопрос() вместо Вопрос(),
		НачатьПомещениеФайла() вместо ПоместитьФайл() и т. п.;
	</li>
	<li>первым параметром в эти методы передается объект ОписаниеОповещения, указывающий на процедуру модуля, которая
		будет выполнена после того, как пользователь сделает выбор в блокирующем окне;
	</li>
	<li>методы не возвращают значения, вместо этого результат выбора пользователя будет передан в процедуру модуля,
		описанную объектом ОписаниеОповещения.
	</li>
</ul>
<p><strong>подРобнее</strong></p>
<p>Соответствие модальных методов их немодальным аналогам приведено в документации «1С:Предприятие 8.3. Руководство
	разработчика», раздел 7.7.3 «Форма. Различные подходы к модальности. Соответствие методов».</p>
<p>Добавим в модуль формы документа следующий код (листинг 26.7).</p>
<p><strong>листинг 26.7.</strong> Обработчик нажатия кнопки «Подбор» </p>
<p>с предварительным вопросом пользователю</p>
<table>
	<tr>
		<td><p>&amp;НаКлиенте</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Процедура ПодборВопрос(Команда)</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Оповещение = Новый ОписаниеОповещения(&quot;ПодборЗавершение&quot;, ЭтотОбъект);</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ПоказатьВопрос(Оповещение, &quot;Подобрать номенклатуру в документ?&quot;, </p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>РежимДиалогаВопрос.ДаНет);</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецПроцедуры</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>&amp;НаКлиенте</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Процедура ПодборЗавершение(Результат, Параметры) Экспорт</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
</table>
<p>Если Результат = КодВозвратаДиалога.Да Тогда</p>
<p>ПараметрыФормы = Новый Структура(&quot;МножественныйВыбор&quot;, Истина); ОткрытьФорму(&quot;Справочник.Номенклатура.ФормаВыбора&quot;, </p>
<table>
	<tr>
		<td><p>ПараметрыФормы, Элементы.Материалы);</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецЕсли; </p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецПроцедуры</p></td>
	</tr>
</table>
<p>Поясним этот код.</p>
<p>В процедуре ПодборВопрос() сначала создается объект ОписаниеОповещения, в конструкторе которого первым параметром
	указывается имя процедуры – обработчика оповещения, которая будет выполнена после получения ответа пользователя. А
	во втором параметре указывается, в каком модуле расположена эта процедура. </p>
<p>Процедура – обработчик оповещения может располагаться в модуле управляемой формы, в общем неглобальном клиентском
	модуле или модуле команды. В данном случае эта процедура располагается в модуле нашей формы, на что указывает ссылка
	ЭтотОбъект.</p>
<p>После этого с помощью немодального метода ПоказатьВопрос() отображается окно с вопросом пользователю. В этот метод
	передается объект ОписаниеОповещения, указывающий на процедуру модуля (ПодборЗавершение), которая будет выполнена
	после того, как пользователь сделает выбор в блокирующем окне.</p>
<p>Процедура – обработчик оповещения должна быть объявлена как экспортная, с использованием ключевого слова Экспорт. В
	параметре Результат содержится результат ответа пользователя. Если он положительный, то производится открытие формы
	выбора номенклатуры для подбора в документ.</p>
<p>Чтобы не путаться, установим новый обработчик для команды Подбор. В палитре свойств этой команды в строке Действие
	выберем процедуру ПодборВопрос (рис. 26.4).</p>
<p><strong>Рис. 26.4.</strong> Установка действия для команды «Подбор»</p>
<p><strong>В режиме «1С:Предприятие»</strong></p>
<p>Запустим «1С:Предприятие» в режиме отладки. </p>
<p>Перейдем в раздел Учет материалов, откроем список приходных накладных и создадим новую приходную накладную. В
	командной панели списка материалов нажмем кнопку Подбор. </p>
<p>Перед тем как выполнять подбор, всплывает блокирующее окно с вопросом пользователю о необходимости подбора. Это окно
	блокирует интерфейс, но не останавливает выполнение прикладного решения. Подбор номенклатуры в документ выполняется
	только в случае положительного ответа пользователя.</p>
<p><strong>Как задать вопрос пользователю в обработчике события</strong></p>
<p>Рассмотрим теперь более сложный пример, когда вопрос пользователю требуется задать в обработчике события. Например,
	перед добавлением номенклатуры в табличную часть приходной накладной нужно спросить, добавлять ли выбранные элементы
	номенклатуры в документ. Причем подтверждение о добавлении номенклатуры в документ у пользователя нужно спрашивать
	только один раз.</p>
<p>Конечно, этот пример (как и предыдущий) вряд ли понадобится при разработке реальной конфигурации, но в целом оба
	примера хорошо демонстрируют общий подход отказа от использования модальных окон, описанный выше в теоретической
	части этого раздела.</p>
<p>Реализуем вариант одиночного подбора с использованием множественного выбора. В форме документа ПриходнаяНакладная
	откроем палитру свойств команды Подбор и в строке Действие установим в качестве обработчика команды процедуру
	Подбор.</p>
<p>Изменим текст обработчика команды Подбор следующим образом (листинг 26.8). <strong>листинг 26.8.</strong> Обработчик
	нажатия кнопки «Подбор»</p>
<table>
	<tr>
		<td><p>&amp;НаКлиенте</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Процедура Подбор(Команда)</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ПараметрыФормы = Новый Структура(&quot;МножественныйВыбор&quot;, Истина);</p></td>
	</tr>
	<tr>
		<td><p>ОткрытьФорму(&quot;Справочник.Номенклатура.ФормаВыбора&quot;, ПараметрыФормы, </p></td>
	</tr>
	<tr>
		<td><p>Элементы.Материалы);</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецПроцедуры</p></td>
	</tr>
</table>
<p>Затем добавим в обработчик события ОбработкаВыбора таблицы </p>
<p>Материалы открытие блокирующего окна с вопросом пользователю (листинг 26.9).</p>
<p><strong>листинг 26.9.</strong> Обработчик события «ОбработкаВыбора» таблицы </p>
<p>«Материалы» с предварительным вопросом пользователю</p>
<table>
	<tr>
		<td><p>&amp;НаКлиенте</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Процедура МатериалыОбработкаВыбора(Элемент, ВыбранноеЗначение, СтандартнаяОбработка)</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Если ОтветПередДобавлением &lt;&gt; Истина Тогда</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>СтандартнаяОбработка = Ложь;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Оповещение = Новый ОписаниеОповещения(</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>&quot;ДобавлениеЗавершение&quot;, ЭтотОбъект, ВыбранноеЗначение);</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ПоказатьВопрос(Оповещение, &quot;Добавить номенклатуру в табличную часть?&quot;, </p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>РежимДиалогаВопрос.ДаНет);</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Иначе</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Для Каждого ВыбранныйЭлемент Из ВыбранноеЗначение Цикл</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>НоваяСтрока = Объект.Материалы.Добавить();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>НоваяСтрока.Материал = ВыбранныйЭлемент;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецЦикла;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецЕсли; </p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p> КонецПроцедуры</p></td>
	</tr>
</table>
<p>Поясним этот код.</p>
<p>Используя переменную ОтветПередДобавлением, мы определяем, был ли получен ответ от пользователя.</p>
<p>Если нет, то отменяем стандартную обработку для события ОбработкаВыбора и показываем блокирующее окно с вопросом
	пользователю. Если ответ от пользователя уже был получен, то список номенклатуры добавляется в табличную часть без
	вопросов.</p>
<p>Если значение переменной ОтветПередДобавлением не истинно, то сначала создается объект ОписаниеОповещения, в
	конструкторе которого первым параметром указывается имя процедуры – обработчика оповещения, которая будет выполнена
	после получения ответа пользователя. Во втором параметре указывается, в каком модуле расположена эта процедура (в
	нашем случае – в модуле формы). А в третьем параметре в качестве дополнительного параметра передается массив
	выбранных значений номенклатуры (ВыбранноеЗначение).</p>
<p>После этого с помощью немодального метода ПоказатьВопрос() отображается окно с вопросом пользователю. В этот метод
	передается объект ОписаниеОповещения, указывающий на экспортную процедуру модуля (ДобавлениеЗавершение), которая
	будет выполнена после того, как пользователь сделает выбор в блокирующем окне.</p>
<p>В этой процедуре в параметре СписокНоменклатуры содержится массив выбранных значений номенклатуры. В параметре
	Результат содержится результат ответа пользователя. В случае положительного ответа пользователя значение переменной
	ОтветПередДобавлением становится истинным, и затем выполняется добавление выбранных элементов номенклатуры в
	табличную часть документа (листинг 26.10).</p>
<p><strong>листинг 26.10.</strong> Процедура – обработчик оповещения «ДобавлениеЗавершение()»</p>
<table>
	<tr>
		<td><p>&amp;НаКлиенте</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Процедура ДобавлениеЗавершение(Результат, СписокНоменклатуры) Экспорт</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Если Результат = КодВозвратаДиалога.Да Тогда</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ОтветПередДобавлением = Истина;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Для Каждого ВыбранныйЭлемент Из СписокНоменклатуры Цикл</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>НоваяСтрока = Объект.Материалы.Добавить();</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>НоваяСтрока.Материал = ВыбранныйЭлемент;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецЦикла;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецЕсли; </p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецПроцедуры</p></td>
	</tr>
</table>
<p>Причем если пользователь уже подтвердил, что он хочет добавить номенклатуру в документ, то больше это вопрос не
	задается, так как значение переменной ОтветПередДобавлением становится истинным.</p>
<p>Остается только объявить эту переменную в самом начале модуля формы (листинг 26.11). <strong>листинг 26.11.</strong>
	Объявление переменной в модуле формы</p>
<table>
	<tr>
		<td><p>&amp;НаКлиенте</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Перем ОтветПередДобавлением;</p></td>
	</tr>
</table>
<p><strong>В режиме «1С:Предприятие»</strong></p>
<p>Запустим «1С:Предприятие» в режиме отладки. </p>
<p>Результат выполнения примера будет таким же, как и в предыдущем случае, за исключением того, что вопрос пользователю
	будет задан после выбора номенклатуры, а не до этого. А также подтверждение о добавлении номенклатуры в документ
	требуется только один раз.</p>
<p><strong>пРиМеЧАние</strong></p>
<p>Проверить код конфигурации на предмет отсутствия модальных методов можно с помощью команды конфигуратора Конфигурация
	 Проверка конфигурации... В окне параметров проверки нужно установить флажок Поиск использования модальности.</p>
<p><strong>Ввод на основании</strong></p>
<p>Механизм ввода на основании может быть использован для ввода новых объектов различного типа (документы, справочники,
	планы видов характеристик и т. д.). Мы рассмотрим этот механизм на примере ввода новых документов как наиболее
	распространенном.</p>
<p>Для каждого объекта конфигурации Документ можно разрешить его ввод на основании других объектов базы данных и
	возможность являться основанием для других объектов. </p>
<p>Действия по заполнению реквизитов при вводе на основании должны быть описаны в модуле объекта Документ, в обработчике
	события ОбработкаЗаполнения. </p>
<p>Это можно сделать вручную или с использованием конструктора ввода на основании, который позволяет визуальными
	средствами конструировать текст обработчика.</p>
<p>Рассмотрим пример, когда документ ОказаниеУслуги будет вводиться на основании элемента справочника Клиенты.</p>
<p><strong>Команда ввода на основании</strong></p>
<p><strong>В режиме «Конфигуратор»</strong></p>
<p>Откроем окно редактирования объекта конфигурации Документ ОказаниеУслуги и добавим новый реквизит документа –
	ОбъектОснование с типом СправочникСсылка.Клиенты. </p>
<p>Создание такого реквизита не является обязательной частью механизма ввода на основании и понадобится нам только для
	того, чтобы впоследствии построить цепочку зависимых документов.</p>
<p>Перейдем на закладку Ввод на основании и определим состав документов, на основании которых может вводиться документ
	ОказаниеУслуги и основанием для которых он может являться. </p>
<p>Нажмем кнопку Редактировать элемент списка над списком Вводится на основании и выберем справочник Клиенты (рис.
	26.5).</p>
<p><strong>Рис. 26.5.</strong> Определение состава объектов, на основании которых вводится документ</p>
<p>Затем вызовем конструктор ввода на основании и зададим значения реквизитов документа, создаваемого на основании. Для
	этого воспользуемся кнопкой Заполнить выражения (рис. 26.6).</p>
<p><strong>Рис. 26.6.</strong> Заполнение значений реквизитов документа, создаваемого на основании</p>
<p>Обратите внимание, что для заполнения реквизита ОбъектОсно- вание конструктор предложил использовать значение
	ДанныеЗаполнения.Ссылка. В данном случае такая запись будет избыточной, поскольку в качестве основания будет
	передана ссылка на элемент справочника. </p>
<p>Однако в общем случае событие ОбработкаЗаполнения возникает при создании нового объекта на основании некоторого
	переданного значения. Совсем не обязательно, что это значение будет иметь тип ссылки. </p>
<p>Согласимся со всем, что предложил конструктор, и нажмем OK. </p>
<p>В модуле документа будет сформирован текст обработчика события ОбработкаЗаполнения (листинг 26.12). <strong>листинг
	26.12.</strong> Обработчик события «ОбработкаЗаполнения»</p>
<table>
	<tr>
		<td><p>Процедура ОбработкаЗаполнения(ДанныеЗаполнения, СтандартнаяОбработка)</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>//{{__КОНСТРУКТОР_ВВОД_НА_ОСНОВАНИИ</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// Данный фрагмент построен конструктором.</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// При повторном использовании конструктора внесенные вручную изменения будут утеряны!!!</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Если ТипЗнч(ДанныеЗаполнения) = Тип(&quot;СправочникСсылка.Клиенты&quot;) Тогда</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>// Заполнение шапки</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>Клиент = ДанныеЗаполнения.Ссылка;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>ОбъектОснование = ДанныеЗаполнения.Ссылка;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецЕсли;</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>//}}__КОНСТРУКТОР_ВВОД_НА_ОСНОВАНИИ</p></td>
	</tr>
	<tr>
		<td></td>
	</tr>
	<tr>
		<td><p>КонецПроцедуры</p></td>
	</tr>
</table>
<p>Как видите, для каждого типа объекта-основания формируется своя ветка условия Если…, в которой происходит заполнение
	реквизитов нового документа. </p>
<p><strong>В режиме «1С:Предприятие»</strong></p>
<p>Запустим «1С:Предприятие» в режиме отладки и проверим работу ввода на основании. </p>
<p>Откроем список клиентов. Обратите внимание, что в командной панели формы списка справочника Клиенты появилась команда
	Создать на основании. </p>
<p>Выделив нужного клиента и выполнив команду Создать на основании  Оказание услуги, создадим новый документ Оказание
	услуги, где в качестве клиента будет выбран выделенный в списке справочника клиент (рис. 26.7).</p>
<p><strong>Рис. 26.7.</strong> Создание документа «Оказание услуги» на основании клиента</p>
<p>Введите самостоятельно еще несколько документов на основании какого-либо клиента.</p>
<p><strong>Объекты, введенные на основании</strong></p>
<p>Наряду с тем, что платформа содержит механизмы, позволяющие создавать одни объекты на основании других, каких-либо
	специальных механизмов для анализа цепочек связанных объектов в платформе нет. </p>
<p>Для решения подобной задачи мы дадим некоторые рекомендации, которые могут быть положены в основу конкретного
	решения.</p>
<p>Для построения цепочек связанных объектов необходимо у каждого объекта, который будет вводиться на основании, создать
	служебный реквизит для хранения ссылки на объект-основание. Затем следует создать объект конфигурации <em>КритерийОтбора</em>,
	который будет использоваться для установки отбора по требуемому значению служебного реквизита. </p>
<p>В дальнейшем для получения всех объектов, введенных на основании, достаточно будет установить нужное значение отбора
	в критерии отбора.</p>
<p><strong>Критерий отбора</strong></p>
<p>Объект конфигурации КритерийОтбора предназначен для задания правил, по которым может выполняться отбор объектов. </p>
<p>Этот объект используется в случае поиска различной информации, когда, например, требуется отобрать все документы, в
	которых используется (в реквизитах и в табличных частях) определенный контрагент. </p>
<p>При этом можно учитывать также и другие условия отбора информации (например, поиск ведется только среди проведенных
	документов или в определенном интервале дат).</p>
<p><strong>Получение объектов, введенных на основании</strong></p>
<p>Поскольку задача получения всех объектов, введенных на основании какого-либо другого объекта, чаще всего возникает
	при анализе документов, мы рассмотрим применение описанной выше методики на примере получения списка документов,
	введенных на основании элемента справочника Клиенты.</p>
<p><strong>В режиме «Конфигуратор»</strong></p>
<p>Раскроем ветвь Общие и создадим новый объект конфигурации КритерийОтбора с именем ОказаниеУслуги. </p>
<p>На закладке Данные выберем тип используемого критерия – СправочникСсылка.Клиенты. </p>
<p>На закладке Состав в качестве объектов, входящих в критерий, выберем реквизит ОбъектОснование документа
	ОказаниеУслуги </p>
<p>(рис. 26.8).</p>
<p>После этого в панели навигации формы элемента справочника Клиенты в группе Перейти появится команда для открытия
	критерия отбора. </p>
<p>Создадим эту форму и на закладке Командный интерфейс установим видимость команды Оказание услуги (рис. 26.9).</p>
<p><strong>Рис. 26.9.</strong> Команда открытия критерия отбора из формы элемента справочника «Клиенты»</p>
<p><strong>В режиме «1С:Предприятие»</strong></p>
<p>Запустим «1С:Предприятие» в режиме отладки и проверим работу критерия отбора. </p>
<p>В форме списка клиентов выделим клиента Роман, на основании которого мы создавали документы Оказание услуги. </p>
<p>Откроем форму этого клиента. В панели навигации появилась команда Оказание услуги для открытия формы списка
	созданного нами критерия отбора с установленным отбором по открытому элементу справочника Клиенты. Выполним эту
	команду (рис. 26.10).</p>
<p>с отбором по клиенту</p>
<p>Мы видим в этом списке документы Оказание услуги, созданные на основании клиента Роман. К содержимому документа можно
	перейти, нажав соответствующую ссылку в списке документов.</p>
<p><a id="_Toc454870688"></a><a id="_Toc454870470"></a><strong>Литература</strong></p>
<ol>
	<li>1С:Бухгалтерия 8. Учебная версия (ред. 3.0) (+CD). Издание 8 М., 2013.- 484с.</li>
	<li>Чистов Д.В., С.А. Харитонов «Хозяйственные операции в 1с:Бухгалтерия 8(редакция 3.0). Учебное пособие» - М, 2014
		год, 365с.
	</li>
	<li>Радченко М. Г., Хрусталева Е. Ю 1C:Предприятие 8.3. Практическое пособие разработчика. Примеры и типовые приемы-
		М., 965 стр, 2012 год.
	</li>
	<li>Чистов Д.В Бухгалтерский и налоговый учет в &quot;1С:Бухгалтерии 8&quot; (редакция 3.0) Издание 6.-М, 2014 год,
		795 стр.
	</li>
</ol>